function e(){"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[20198],{225741:(e,t,i)=>{i.d(t,{VK_DOMAIN_REGEX_UNSAFE:()=>s.VK_DOMAIN_REGEX_UNSAFE,VK_HOST_REGEX_GROUP_UNSAFE:()=>s.VK_HOST_REGEX_GROUP_UNSAFE,VK_ORIGIN_PREFIX_REGEX:()=>s.VK_ORIGIN_PREFIX_REGEX,VK_SITE_RELATIVE_URL:()=>s.VK_SITE_RELATIVE_URL,getBlobType:()=>s.getBlobType,getHostName:()=>s.getHostName,getPhotoFromVideo:()=>s.getPhotoFromVideo,isMvk:()=>s.isMvk,loadVideo:()=>s.loadVideo});var s=i(105330)},794343:(e,t,i)=>{i.d(t,{constructSources:()=>s.constructSources,constructVideoData:()=>s.constructVideoData});var s=i(897976)},715378:(e,t,i)=>{i.d(t,{ClipsPlayer:()=>p});var s=i(474848),r=i(296540),o=i(689900),a=i(132028),n=i(456921),d=i(773439),c=i(794343),h=i(540675);const l=new(i(517769).ObjectPool)((()=>{const e=document.createElement("video");return e.muted=!0,e.playsInline=!0,e.disablePictureInPicture=!0,e})),u=(0,n.observer)((function(){const e=(0,h.useClipPlayerModel)(),{loop:t=!0,muted:i,volume:a,playing:n,mode:u,video:p,onLooped:g,onPlayingChanged:m,onPlaying:v,onPaused:_,onMutedChanged:y,onPositionChanged:S,onStalledChanged:f,onStarted:b,onVideoCurQualityChanged:C,onVideoEndedChanged:P,onVideoVolumeChanged:w,newCurrentTime:V,onDurationChanged:A,onVideoFormatChanged:k,onVideoBitrateChanged:I,onEnded:E,onFirstBytes:O,onFirstFrame:M,onError:F}=e.props.current,[T,R]=(0,r.useState)(null);(0,r.useEffect)((()=>{if(e.vkPlayer&&(e.initOneStat(),e.oneStat))return e.oneStat.pause(),e.authorizeOneStat(),e.oneStat.attachTo(e.vkPlayer),()=>{e.oneStat?.destroy()}}),[e.vkPlayer,p?.ov_id]),(0,r.useEffect)((()=>{if(e.sendViewSegments)return e.subscribeViewSegments(),()=>{e.addPoint(!1),e.unsubscribe()}}),[e.vkPlayer,e.addPoint,e.sendViewSegments]),(0,r.useEffect)((()=>{let t=null,i=null;if(p&&T&&!e.playerConfigData?.loadingConfig){t=new d.Player(e.playerConfigData?.config?.core),i=l.allocate(),T.innerHTML="",T.appendChild(i);const s=(0,c.constructSources)(p);if(e.userEnv.partConfigEnabled("video_clips_mvk_hls_min_quality_from_backend")){const e=s[d.VideoFormat.HLS];e&&(e.url+="&lq=480")}t.setMuted(!0).setLooped(!0).setAutoQualityLimits({min:d.VideoQuality.Q_480P}).initVideo({container:T,sources:s,failoverHosts:p.files?.failover_host?[p.files.failover_host]:void 0,meta:{videoId:p.ov_id}}).prepare()}return e.setVkPlayer(t),()=>{t?.destroy(),T&&(T.innerHTML=""),i&&l.free(i)}}),[p,T,e.playerConfigData]),(0,r.useEffect)((()=>(e.subscribe(),()=>{e.unsubscribe()})),[e.vkPlayer,P,m,v,_,y,f,w,b,g,S,C,A,E,O,M,k,I,F]);const L=(0,r.useCallback)((()=>{e.vkPlayer?.play()}),[e.vkPlayer]),D=(0,r.useCallback)((()=>{e.vkPlayer?.pause()}),[e.vkPlayer]),j=(0,r.useCallback)((t=>{e.vkPlayer?.setMuted(t)}),[e.vkPlayer]),N=(0,r.useCallback)((t=>{t&&e.vkPlayer?.setVolume(t)}),[e.vkPlayer]),U=(0,r.useCallback)((t=>{e.vkPlayer?.setLooped(t)}),[e.vkPlayer]),B=(0,r.useCallback)((t=>{e.vkPlayer?.seekTime(t)}),[e.vkPlayer]);return(0,r.useEffect)((()=>{n?L():D()}),[n,L,D]),(0,r.useEffect)((()=>{N(a??0)}),[a,N]),(0,r.useEffect)((()=>{j(i)}),[i,j]),(0,r.useEffect)((()=>{U(t)}),[t,U]),(0,r.useEffect)((()=>{"number"==typeof V&&B(V)}),[V,B]),(0,s.jsx)(o.ClipPlayerContainer,{mode:u,setContainer:R,hidden:e.isPlayerHidden})})),p=(0,a.createWidget)(h.ClipsPlayerProvider,u)},298732:(e,t,i)=>{i.d(t,{ClipPlayerViewModel:()=>r.ClipPlayerViewModel,ClipsPlayer:()=>s.ClipsPlayer});var s=i(715378),r=i(540675)},366024:(e,t,i)=>{i.d(t,{ClipsPlayerProvider:()=>_,useClipPlayerModel:()=>v});var s=i(331635),r=i(852487),o=i(979549),a=i(291566),n=i(327813),d=i(132028),c=i(24516),h=i(951652),l=i(809424),u=i(773439),p=i(89923),g=i(231450);class m{async[d.init](){this.getConfig()}get isPlayerHidden(){return this._isPlayerHidden}async getConfig(){const e=this.props.current.module??"clips",t=await this.videoPlayerConfigProvider.ensure({module:e});(0,n.runInAction)((()=>{this.playerConfigData={config:t,loadingConfig:!1}}))}get vkPlayer(){return this._vkPlayer}get oneStat(){return this._oneStat}constructor(e,t,i,s,r,o,a){this.props=e,this.videoPlayerConfigProvider=t,this.userEnv=i,this.videoViewSegmentsService=s,this.stats=r,this.authService=o,this.metaData=a,this.playerConfigData={config:null,loadingConfig:!0},this._vkPlayer=null,this._isPlayerHidden=!0,this._oneStat=null,this.subs=new u.Subscription,this.segment=[],this.setPlayerVisible=()=>{this._isPlayerHidden=!1},this.sendViewSegments=e=>{const{id:t,owner_id:i,track_code:s=""}=this.props.current.video;t&&i&&this.videoViewSegmentsService.send({video_id:t,owner_id:i,ranges:e,ref:"clips",muted:this.props.current.muted?1:0,track_code:s})},this.refreshAuthToken=async()=>{if(this.authService.isAuthorized)try{return await this.stats.getToken({refresh:!0})}catch{await this.stats.trackOneStatError("video.getStatsToken")}},this.authorizeToken=async()=>{try{return await this.stats.getToken({refresh:!0})}catch{await this.stats.trackOneStatError("video.getStatsToken")}},this.subscribe=()=>{if(this.vkPlayer&&(this.props.current.onStalledChanged&&this.subs.add(this.vkPlayer.info.isStalled$.subscribe(this.props.current.onStalledChanged)),this.props.current.onVideoEndedChanged&&this.subs.add(this.vkPlayer.info.isEnded$.subscribe(this.props.current.onVideoEndedChanged)),this.props.current.onLooped&&this.subs.add(this.vkPlayer.events.looped$.subscribe(this.props.current.onLooped)),this.props.current.onVideoVolumeChanged&&this.subs.add(this.vkPlayer.info.volume$.subscribe(this.props.current.onVideoVolumeChanged)),this.subs.add(this.vkPlayer.info.currentQuality$.subscribe((e=>e!==u.VideoQuality.INVARIANT&&this.props.current.onVideoCurQualityChanged&&this.props.current.onVideoCurQualityChanged(e)))),this.props.current.onDurationChanged&&this.subs.add(this.vkPlayer.info.duration$.subscribe(this.props.current.onDurationChanged)),this.props.current.onPositionChanged&&this.subs.add(this.vkPlayer.info.position$.subscribe(this.props.current.onPositionChanged)),this.props.current.onPlayingChanged&&(this.subs.add(this.vkPlayer.events.playing$.subscribe((()=>this.props.current.onPlayingChanged&&this.props.current.onPlayingChanged(!0)))),this.subs.add(this.vkPlayer.events.paused$.subscribe((()=>this.props.current.onPlayingChanged&&this.props.current.onPlayingChanged(!1))))),this.props.current.onPlaying&&this.vkPlayer.events.playing$.subscribe(this.props.current.onPlaying),this.props.current.onPaused&&(this.vkPlayer.events.paused$.subscribe(this.props.current.onPaused),this.vkPlayer.events.willDestruct$.subscribe(this.props.current.onPaused)),this.props.current.onMutedChanged&&this.vkPlayer.info.muted$.subscribe(this.props.current.onMutedChanged),this.props.current.onStarted&&this.subs.add(this.vkPlayer.events.started$.subscribe(this.props.current.onStarted)),this.props.current.onFirstBytes&&this.subs.add(this.vkPlayer.events.firstBytes$.subscribe(this.props.current.onFirstBytes)),this.subs.add(this.vkPlayer.events.firstFrame$.subscribe((e=>{this.setPlayerVisible(),this.props.current.onFirstFrame&&this.props.current.onFirstFrame(e)}))),this.props.current.onVideoFormatChanged&&this.subs.add(this.vkPlayer.info.currentFormat$.subscribe(this.props.current.onVideoFormatChanged)),this.props.current.onVideoBitrateChanged&&this.subs.add(this.vkPlayer.info.videoBitrate$.subscribe(this.props.current.onVideoBitrateChanged)),this.props.current.onEnded&&(this.subs.add(this.vkPlayer.events.ended$.subscribe(this.props.current.onEnded)),this.subs.add(this.vkPlayer.events.looped$.subscribe(this.props.current.onEnded))),this.props.current.onCurrentTimeChanged&&(this.subs.add(this.vkPlayer.events.started$.subscribe((()=>{this.props.current.onCurrentTimeChanged&&this.props.current.onCurrentTimeChanged(0)}))),this.subs.add(this.vkPlayer.info.position$.subscribe((e=>{e&&this.props.current.onCurrentTimeChanged&&this.props.current.onCurrentTimeChanged(e)})))),this.props.current.onError)){const e=e=>{this.props.current.onError?.(e,this.vkPlayer?.info.hostname$.getValue()??"")};this.subs.add(this.vkPlayer.events.fatalError$.subscribe(e)),this.subs.add(this.vkPlayer.events.managedError$.subscribe(e))}},this.unsubscribe=()=>{this.subs&&this.subs.unsubscribe()},this.setVkPlayer=e=>{this._vkPlayer=e},this.play=()=>{this._vkPlayer?.play()},this.pause=()=>{this._vkPlayer?.pause()},this.setMuted=e=>{this._vkPlayer?.setMuted(e)},this.setVolume=e=>{e&&this._vkPlayer?.setVolume(e)},this.setLooped=e=>{this._vkPlayer?.setLooped(e)},this.setCurrentTime=e=>{this._vkPlayer?.seekTime(e)},this.initOneStat=()=>{const{platformId:e}=this.metaData.get();this._oneStat=new p.OneStat({movieId:Number(this.props.current.video?.ov_id),place:this.metaData.get().module??"",mobile:"mvk"===this.props.current.platform,autoplay:!0,trackCode:(0,g.getTrackCode)()||this.props.current.video?.track_code,vkAppId:this.userEnv.partConfigEnabled("video_client_appid")?String(e):void 0},{apiEnv:p.ApiEnv.PROD,refreshAuthToken:this.refreshAuthToken,config:{apiEnv:p.ApiEnv.PROD,requestRetryCount:1}})},this.authorizeOneStat=async()=>{if(!this._oneStat)return;const e=await this.authorizeToken();this.authService.isAuthorized&&e?(this._oneStat.authorize(e),this._oneStat.resume()):(this._oneStat.authorize(),this._oneStat.resume())},this.addPoint=e=>{if(this.vkPlayer){if(e)this.segment=[];else if(!this.segment.length)return;this.segment.push(Math.trunc(this.vkPlayer.info.position$.getValue())),2===this.segment.length&&(this.sendViewSegments(this.segment.join("-")),this.segment=[])}},this.subscribeViewSegments=()=>{this.vkPlayer&&(this.subs.add(this.vkPlayer.events.playing$.subscribe((()=>this.addPoint(!0)))),this.subs.add(this.vkPlayer.events.paused$.subscribe((()=>this.addPoint(!1)))),this.subs.add(this.vkPlayer.events.willSeek$.subscribe((()=>this.addPoint(!1)))),this.subs.add(this.vkPlayer.events.ended$.subscribe((()=>this.addPoint(!1)))),this.subs.add(this.vkPlayer.events.looped$.subscribe((()=>this.addPoint(!1)))))},(0,n.makeAutoObservable)(this)}}m=(0,s.__decorate)([d.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===d.Props?Object:d.Props,void 0===r.VideoPlayerConfigProvider?Object:r.VideoPlayerConfigProvider,void 0===c.UserEnv?Object:c.UserEnv,void 0===o.VideoViewSegmentsService?Object:o.VideoViewSegmentsService,void 0===a.ShortVideoStatsTokenService?Object:a.ShortVideoStatsTokenService,void 0===h.AuthService?Object:h.AuthService,void 0===l.MetaData?Object:l.MetaData])],m);const{useModel:v,Provider:_}=(0,d.createProvider)(m,{isolatedContext:!1,onlyTransient:!0})},76876:(e,t,i)=>{i.d(t,{ClipsPlayerProvider:()=>s.ClipsPlayerProvider,useClipPlayerModel:()=>s.useClipPlayerModel});var s=i(366024)},449396:(e,t,i)=>{i.d(t,{ClipPlayerViewModel:()=>r});var s=i(327813);class r{get activeVolume(){return this.videoIsMuted?0:this.playerVolume.volume}get videoIsEnded(){return this._videoIsEnded}get videoIsMuted(){return this._videoIsMuted}get currentTime(){return this._currentTime}constructor(e,t,i){this.props=e,this.playerVolume=t,this.userEnv=i,this._currentTime=0,this._videoIsEnded=!1,this._videoIsMuted=!1,this.setVideoIsEnded=e=>{this._videoIsEnded=e},this.setVideoMuted=e=>{this._videoIsMuted=e},this.muteButtonClick=()=>{this.setVideoMuted(!this._videoIsMuted),this._videoIsMuted||this.activeVolume||this.playerVolume.setVolume(1)},this.volumeChange=e=>{this.playerVolume.setVolume(e),this.setVideoMuted(0===e)},this.setCurrentTime=e=>{this._currentTime=e},(0,s.makeAutoObservable)(this),this._videoIsMuted=this.props.current.muted??!1}}},84011:(e,t,i)=>{i.d(t,{ClipPlayerViewModel:()=>s.ClipPlayerViewModel});var s=i(449396)},540675:(e,t,i)=>{i.d(t,{ClipPlayerViewModel:()=>s.ClipPlayerViewModel,ClipsPlayerProvider:()=>r.ClipsPlayerProvider,useClipPlayerModel:()=>r.useClipPlayerModel});var s=i(84011),r=i(76876)},517769:(e,t,i)=>{i.d(t,{ObjectPool:()=>s});class s{allocate(){const e=[...this.pool.entries()].find((([,e])=>e)),[t]=e||[this.makeItem()];return this.pool.set(t,!1),t}free(e){this.pool.has(e)&&this.pool.set(e,!0)}size(){return this.pool.size}constructor(e){this.makeItem=e,this.pool=new Map}}},64507:(e,t,i)=>{i.d(t,{Q_1080P:()=>s});const s="1080p"},732079:(e,t,i)=>{i.d(t,{usePlayingStats:()=>r});var s=i(296540);function r({stats:e,statsRef:t,video:i,autoplay:r=!0,playerType:o="carousel"}){const a=(0,s.useRef)({onStalledChanged:()=>{},onVideoCurQualityChanged:()=>{},onDurationChanged:()=>{},onPositionChanged:()=>{},onEnded:()=>{},onVideoFormatChanged:()=>{},onVideoBitrateChanged:()=>{},onFirstBytes:()=>{},onFirstFrame:()=>{},onStarted:()=>{},onPlaying:()=>{},onPaused:()=>{},onMutedChanged:()=>{},onError:()=>{}}),n=i?.rawId&&e.getPlayerStatsHandlersStore(i.rawId,{video:i,statsRef:t,autoplay:r,playerType:o});return n&&(a.current=n.playerHandlers),(0,s.useEffect)((()=>()=>{i?.rawId&&e.resetPlayerStatsHandlersStore(i.rawId)}),[i?.rawId,e]),a.current}},348882:(e,t,i)=>{i.d(t,{ClipPlayerViewModel:()=>o.ClipPlayerViewModel,ClipsFeedModel:()=>s.ClipsFeedModel,ClipsPlayer:()=>o.ClipsPlayer,ClipsPlayerSearchStatsService:()=>s.ClipsPlayerSearchStatsService,ClipsPlayerStatusModel:()=>s.ClipsPlayerStatusModel,ClipsTopFeed:()=>s.ClipsTopFeed,FETCH_QUERY:()=>s.FETCH_QUERY,PrimaryAttachmentClipWrapper:()=>c.PrimaryAttachmentClipWrapper,Q_1080P:()=>r.Q_1080P,UPLOAD_AUDIO_RIGHTS_LINK:()=>a.UPLOAD_AUDIO_RIGHTS_LINK,UPLOAD_AUTHOR_ADVICES_LINK:()=>a.UPLOAD_AUTHOR_ADVICES_LINK,UPLOAD_MAX_VIDEO_SIZE:()=>a.UPLOAD_MAX_VIDEO_SIZE,UploadAudioSearchModel:()=>a.UploadAudioSearchModel,createLink:()=>d.createLink,getClipCover:()=>n.getClipCover,getClipIcon:()=>n.getClipIcon,getUrlToShortVideoStats:()=>d.getUrlToShortVideoStats,isLockedVideo:()=>n.isLockedVideo,isOzonProgram:()=>n.isOzonProgram,toRawIdOrUndefined:()=>n.toRawIdOrUndefined,usePlayingStats:()=>h.usePlayingStats});var s=i(322089),r=i(64507),o=i(298732),a=i(615382),n=i(667984),d=i(735221),c=i(862420),h=i(732079)},974097:(e,t,i)=>{i.d(t,{ClipsPlayerSearchStatsService:()=>c});var s=i(331635),r=i(327813),o=i(132028),a=i(214079),n=i(517401),d=i(70515);class c{constructor(e){this.statsInfo=e,this.collectSearchClick=(e,t)=>{this.statsInfo.getBlockId()&&t?n.searchStatsCollector.logEvent({action:e,track_code:t,type:d.EventItemType.CLIP}):this.statsInfo.getFromType("search")&&n.searchStatsCollector.logOutOfSerpEvent({action:e,type:d.EventItemType.CLIP})},(0,r.makeAutoObservable)(this)}}c=(0,s.__decorate)([o.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.StatsInfo?Object:a.StatsInfo])],c)},161416:(e,t,i)=>{i.d(t,{ClipsFeedModel:()=>S});var s=i(331635),r=i(914492),o=i(632520),a=i(509739),n=i(876922),d=i(534871),c=i(338454),h=i(474436),l=i(989066),u=i(327813),p=i(132028),g=i(231450),m=i(348882),v=i(631780),_=i(425367),y=i(900209);class S{async initFeed(e,t){const i=(0,_.getFeedObjectKey)(e),s=(0,g.getTrackCode)("search_track_code")||"";switch(this.feedFirstClip.delete(i),"top"!==e.feed&&"subscriptions"!==e.feed||!t||(this.feedFirstClip.set(i,t),this.shortVideoVideosProvider.fetchAllFields(t,s)),e.feed){case"compilation":case"effect":case"music":case"hashtag":case"place":case"top":this.feedsMap.get(i)?.reset();const r=this.topVideosProvider.createList((0,_.getFeedObjectRequestParams)(e));return this.feedsMap.set(i,r),r.fetch();case"ownerFeed":case"postponed":case"playlist":this.feedsMap.get(i)?.reset();const o=this.ownerVideosProvider.createList((0,_.getFeedObjectRequestParams)(e));return this.feedsMap.set(i,o),o.fetch();case"subscriptions":this.feedsMap.get(i)?.reset();const a=this.newsVideosProvider.createList((0,_.getFeedObjectRequestParams)(e));return this.feedsMap.set(i,a),a.fetch();case"search":this.feedsMap.get(i)?.reset();const n=this.searchVideosProvider.createList((0,_.getFeedObjectRequestParams)(e));return this.feedsMap.set(i,n),n.fetch();case"searchBlock":{this.feedsMap.get(i)?.reset();const r=this.searchCatalogProvider.createList({block_id:e.blockId??"",...(0,_.getFeedObjectRequestParams)(e)});if(await r.fetch(),!t||r.ids.has(t))return void this.feedsMap.set(i,r);r.reset(),this.feedFirstClip.set(i,t),this.shortVideoVideosProvider.fetchAllFields(t,s);const o=this.topVideosProvider.createList((0,_.getFeedObjectRequestParams)({feed:"top"}));return this.feedsMap.set(i,o),o.fetch()}default:throw new Error(`${e.feed} does not support in ShortVideoPage`)}}getFeedData(e){const t=this.feedsMap.get((0,_.getFeedObjectKey)(e));if(!t)return;const{ids:i,isLoading:s,count:r,fullyLoaded:o,error:a}=t;return{ids:this.processFeedItems(e,i),isLoading:s,count:r,fullyLoaded:o,error:a}}fetchNext(e){return this.feedsMap.get((0,_.getFeedObjectKey)(e))?.fetch()}setFeedFirstClip(e,t){this.feedFirstClip.set((0,_.getFeedObjectKey)(e),t)}processFeedItems(e,t){if(!t.size)return[];const i=this.feedFirstClip.get((0,_.getFeedObjectKey)(e));let s=Array.from(t.values());return i&&(s=[i,...s.filter((e=>e!==i))]),"top"!==e.feed&&"subscriptions"!==e.feed||(s=s.filter((e=>!this.shortVideoDeleteService.isDeleted(e)))),"subscriptions"===e.feed&&(s=s.filter((e=>this.shortVideoOwnersProvider.get(this.shortVideoVideosProvider.get(e)?.data.owner_id??0)?.isSubscribed))),s}async createAndInitFeed(e={}){const t=(0,_.isValidFeedType)(e.feedType)?e.feedType:"top",i=e.hashtag,s=(0,m.toRawIdOrUndefined)(e.music),r=Number(e.place),o=(0,m.toRawIdOrUndefined)(e.playlist),a=Number(e.compilation),n=void 0!==e.owner?Number(e.owner):void 0,d=(0,m.toRawIdOrUndefined)(e.effect),c=(0,m.toRawIdOrUndefined)(e.clipId);let h;return"ownerFeed"===t&&n?(h=new v.ClipsOwnerFeed(this.ownerVideosProvider,new y.FirstClip(this.shortVideoVideosProvider),new y.DeletedClips(this.shortVideoDeleteService)),await h.init({ownerId:n},c)):"hashtag"===t&&i?(h=new v.ClipsHashtagFeed(this.topVideosProvider,new y.FirstClip(this.shortVideoVideosProvider),new y.DeletedClips(this.shortVideoDeleteService)),await h.init({hashtag:i},c)):"music"===t&&s?(h=new v.ClipsMusicFeed(this.topVideosProvider,new y.FirstClip(this.shortVideoVideosProvider),new y.DeletedClips(this.shortVideoDeleteService)),await h.init({musicId:s},c)):"playlist"===t&&o?(h=new v.ClipsPlaylistFeed(this.ownerVideosProvider,new y.FirstClip(this.shortVideoVideosProvider),new y.DeletedClips(this.shortVideoDeleteService)),await h.init({playlistId:o},c)):"compilation"!==t||Number.isNaN(a)?"place"!==t||Number.isNaN(r)?"effect"===t&&d?(h=new v.ClipsEffectFeed(this.topVideosProvider,new y.FirstClip(this.shortVideoVideosProvider),new y.DeletedClips(this.shortVideoDeleteService)),await h.init({effectId:d},c)):(h=new v.ClipsTopFeed(this.topVideosProvider,new y.FirstClip(this.shortVideoVideosProvider),new y.DeletedClips(this.shortVideoDeleteService)),await h.init(c)):(h=new v.ClipsPlaceFeed(this.topVideosProvider,new y.FirstClip(this.shortVideoVideosProvider),new y.DeletedClips(this.shortVideoDeleteService)),await h.init({placeId:r},c)):(h=new v.ClipsCompilationFeed(this.topVideosProvider,new y.FirstClip(this.shortVideoVideosProvider),new y.DeletedClips(this.shortVideoDeleteService)),await h.init({compilationId:a},c)),h}constructor(e,t,i,s,r,o,a,n){this.shortVideoOwnersProvider=e,this.shortVideoVideosProvider=t,this.shortVideoDeleteService=i,this.topVideosProvider=s,this.searchVideosProvider=r,this.ownerVideosProvider=o,this.newsVideosProvider=a,this.searchCatalogProvider=n,this.feedsMap=new Map,this.feedFirstClip=new Map,(0,u.makeAutoObservable)(this)}}S=(0,s.__decorate)([p.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===r.ShortVideoOwnersProvider?Object:r.ShortVideoOwnersProvider,void 0===o.ShortVideoVideosProvider?Object:o.ShortVideoVideosProvider,void 0===a.ShortVideoDeleteService?Object:a.ShortVideoDeleteService,void 0===n.ShortVideoFeedTopVideosProvider?Object:n.ShortVideoFeedTopVideosProvider,void 0===d.ShortVideoFeedSearchVideosProvider?Object:d.ShortVideoFeedSearchVideosProvider,void 0===c.ShortVideoFeedOwnerVideosProvider?Object:c.ShortVideoFeedOwnerVideosProvider,void 0===h.ShortVideoFeedNewsVideosProvider?Object:h.ShortVideoFeedNewsVideosProvider,void 0===l.ShortVideoFeedSearchCatalogProvider?Object:l.ShortVideoFeedSearchCatalogProvider])],S)},800811:(e,t,i)=>{i.d(t,{FETCH_QUERY:()=>s});const s={fields:i(110343).SHORT_VIDEO_FETCH_OWNER_FIELDS.join(","),count:10}},232716:(e,t,i)=>{i.d(t,{ClipsCompilationFeed:()=>c});var s=i(331635),r=i(327813),o=i(876922),a=i(132028),n=i(348882),d=i(900209);class c{async init({compilationId:e},t){this.feed=this.topVideosProvider.createList({filters:JSON.stringify({compilationId:e}),from_video:t,...n.FETCH_QUERY}),await Promise.all([this.feed.fetch(),...this.transformers.map((e=>e.init(t)))])}async fetchNext(){await(this.feed?.fetch())}fetchBefore(){return Promise.resolve()}get ids(){return this.transformers.reduce(((e,t)=>t.transformIds(e)),Array.from(this.feed?.ids.values()??[]))}get isLoadingBefore(){return!1}get isLoadingNext(){return Boolean(this.feed?.isLoading)}get emptyPlaceholder(){return this.feed?.error?"error":this.feed?.fullyLoaded?"empty":"none"}constructor(e,t,i){this.topVideosProvider=e,this.feedType="compilation",this.transformers=[t,i],(0,r.makeAutoObservable)(this)}}c=(0,s.__decorate)([a.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.ShortVideoFeedTopVideosProvider?Object:o.ShortVideoFeedTopVideosProvider,void 0===d.FirstClip?Object:d.FirstClip,void 0===d.DeletedClips?Object:d.DeletedClips])],c)},755006:(e,t,i)=>{i.d(t,{ClipsEffectFeed:()=>c});var s=i(331635),r=i(327813),o=i(876922),a=i(132028),n=i(348882),d=i(900209);class c{async init({effectId:e},t){this.feed=this.topVideosProvider.createList({filters:JSON.stringify({maskId:e}),from_video:t,...n.FETCH_QUERY}),await Promise.all([this.feed.fetch(),...this.transformers.map((e=>e.init(t)))])}async fetchNext(){await(this.feed?.fetch())}fetchBefore(){return Promise.resolve()}get ids(){return this.transformers.reduce(((e,t)=>t.transformIds(e)),Array.from(this.feed?.ids.values()??[]))}get isLoadingBefore(){return!1}get isLoadingNext(){return Boolean(this.feed?.isLoading)}get emptyPlaceholder(){return this.feed?.error?"error":this.feed?.fullyLoaded?"empty":"none"}constructor(e,t,i){this.topVideosProvider=e,this.feedType="effect",this.transformers=[t,i],(0,r.makeAutoObservable)(this)}}c=(0,s.__decorate)([a.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.ShortVideoFeedTopVideosProvider?Object:o.ShortVideoFeedTopVideosProvider,void 0===d.FirstClip?Object:d.FirstClip,void 0===d.DeletedClips?Object:d.DeletedClips])],c)},356691:(e,t,i)=>{i.d(t,{ClipsHashtagFeed:()=>c});var s=i(331635),r=i(327813),o=i(876922),a=i(132028),n=i(348882),d=i(900209);class c{async init({hashtag:e},t){this.feed=this.topVideosProvider.createList({filters:JSON.stringify({tag:`#${e}`}),from_video:t,...n.FETCH_QUERY}),await Promise.all([this.feed.fetch(),...this.transformers.map((e=>e.init(t)))])}async fetchNext(){await(this.feed?.fetch())}fetchBefore(){return Promise.resolve()}get ids(){return this.transformers.reduce(((e,t)=>t.transformIds(e)),Array.from(this.feed?.ids.values()??[]))}get isLoadingBefore(){return!1}get isLoadingNext(){return Boolean(this.feed?.isLoading)}get emptyPlaceholder(){return this.feed?.error?"error":this.feed?.fullyLoaded?"empty":"none"}constructor(e,t,i){this.topVideosProvider=e,this.feedType="hashtag",this.transformers=[t,i],(0,r.makeAutoObservable)(this)}}c=(0,s.__decorate)([a.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.ShortVideoFeedTopVideosProvider?Object:o.ShortVideoFeedTopVideosProvider,void 0===d.FirstClip?Object:d.FirstClip,void 0===d.DeletedClips?Object:d.DeletedClips])],c)},496964:(e,t,i)=>{i.d(t,{ClipsMusicFeed:()=>c});var s=i(331635),r=i(327813),o=i(876922),a=i(132028),n=i(348882),d=i(900209);class c{async init({musicId:e},t){this.feed=this.topVideosProvider.createList({filters:JSON.stringify({audioId:e}),ref:"clip_grid",from_video:t,...n.FETCH_QUERY}),await Promise.all([this.feed.fetch(),...this.transformers.map((e=>e.init(t)))])}async fetchNext(){await(this.feed?.fetch())}fetchBefore(){return Promise.resolve()}get ids(){return this.transformers.reduce(((e,t)=>t.transformIds(e)),Array.from(this.feed?.ids.values()??[]))}get isLoadingBefore(){return!1}get isLoadingNext(){return Boolean(this.feed?.isLoading)}get emptyPlaceholder(){return this.feed?.error?"error":this.feed?.fullyLoaded?"empty":"none"}constructor(e,t,i){this.topVideosProvider=e,this.feedType="music",this.transformers=[t,i],(0,r.makeAutoObservable)(this)}}c=(0,s.__decorate)([a.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.ShortVideoFeedTopVideosProvider?Object:o.ShortVideoFeedTopVideosProvider,void 0===d.FirstClip?Object:d.FirstClip,void 0===d.DeletedClips?Object:d.DeletedClips])],c)},357136:(e,t,i)=>{i.d(t,{ClipsOwnerFeed:()=>c});var s=i(331635),r=i(327813),o=i(338454),a=i(132028),n=i(348882),d=i(900209);class c{async init({ownerId:e,trackCode:t},i){this.feed=this.ownerVideosProvider.createList({owner_id:e,track_code:t,...n.FETCH_QUERY}),await Promise.all([this.feed.fetch(),...this.transformers.map((e=>e.init(i)))])}async fetchNext(){await(this.feed?.fetch())}fetchBefore(){return Promise.resolve()}get ids(){return this.transformers.reduce(((e,t)=>t.transformIds(e)),Array.from(this.feed?.ids.values()??[]))}get isLoadingBefore(){return!1}get isLoadingNext(){return Boolean(this.feed?.isLoading)}get emptyPlaceholder(){return this.feed?.error?"error":this.feed?.fullyLoaded?"empty":"none"}constructor(e,t,i){this.ownerVideosProvider=e,this.feedType="ownerFeed",this.transformers=[t,i],(0,r.makeAutoObservable)(this)}}c=(0,s.__decorate)([a.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.ShortVideoFeedOwnerVideosProvider?Object:o.ShortVideoFeedOwnerVideosProvider,void 0===d.FirstClip?Object:d.FirstClip,void 0===d.DeletedClips?Object:d.DeletedClips])],c)},264128:(e,t,i)=>{i.d(t,{ClipsPlaceFeed:()=>c});var s=i(331635),r=i(327813),o=i(876922),a=i(132028),n=i(348882),d=i(900209);class c{async init({placeId:e},t){this.feed=this.topVideosProvider.createList({filters:JSON.stringify({placeId:e}),from_video:t,...n.FETCH_QUERY}),await Promise.all([this.feed.fetch(),...this.transformers.map((e=>e.init(t)))])}async fetchNext(){await(this.feed?.fetch())}fetchBefore(){return Promise.resolve()}get ids(){return this.transformers.reduce(((e,t)=>t.transformIds(e)),Array.from(this.feed?.ids.values()??[]))}get isLoadingBefore(){return!1}get isLoadingNext(){return Boolean(this.feed?.isLoading)}get emptyPlaceholder(){return this.feed?.error?"error":this.feed?.fullyLoaded?"empty":"none"}constructor(e,t,i){this.topVideosProvider=e,this.feedType="place",this.transformers=[t,i],(0,r.makeAutoObservable)(this)}}c=(0,s.__decorate)([a.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.ShortVideoFeedTopVideosProvider?Object:o.ShortVideoFeedTopVideosProvider,void 0===d.FirstClip?Object:d.FirstClip,void 0===d.DeletedClips?Object:d.DeletedClips])],c)},693421:(e,t,i)=>{i.d(t,{ClipsPlaylistFeed:()=>h});var s=i(331635),r=i(327813),o=i(338454),a=i(768035),n=i(132028),d=i(348882),c=i(900209);class h{async init({playlistId:e},t){const{id:i,ownerId:s}=(0,a.parseRawId)(e);this.feed=this.ownerVideosProvider.createList({owner_id:s,playlist_id:i,start_from_video_id:t,...d.FETCH_QUERY}),await Promise.all([this.feed.fetch(),...this.transformers.map((e=>e.init(t)))])}async fetchNext(){await(this.feed?.fetch())}fetchBefore(){return Promise.resolve()}get ids(){return this.transformers.reduce(((e,t)=>t.transformIds(e)),Array.from(this.feed?.ids.values()??[]))}get isLoadingBefore(){return!1}get isLoadingNext(){return Boolean(this.feed?.isLoading)}get emptyPlaceholder(){return this.feed?.error?"error":this.feed?.fullyLoaded?"empty":"none"}constructor(e,t,i){this.ownerVideosProvider=e,this.feedType="playlist",this.transformers=[t,i],(0,r.makeAutoObservable)(this)}}h=(0,s.__decorate)([n.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.ShortVideoFeedOwnerVideosProvider?Object:o.ShortVideoFeedOwnerVideosProvider,void 0===c.FirstClip?Object:c.FirstClip,void 0===c.DeletedClips?Object:c.DeletedClips])],h)},710517:(e,t,i)=>{var s=i(331635),r=i(327813),o=i(474436),a=i(132028),n=i(348882),d=i(900209);class c{async init(e){this.feed=this.newsVideosProvider.createList({filters:"clip",source_ids:"friends,groups,following",...n.FETCH_QUERY}),await Promise.all([this.feed.fetch(),...this.transformers.map((t=>t.init(e)))])}async fetchNext(){await(this.feed?.fetch())}fetchBefore(){return Promise.resolve()}get ids(){return this.transformers.reduce(((e,t)=>t.transformIds(e)),Array.from(this.feed?.ids.values()??[]))}get isLoadingBefore(){return!1}get isLoadingNext(){return Boolean(this.feed?.isLoading)}get emptyPlaceholder(){return this.feed?.error?"error":this.feed?.fullyLoaded?"empty":"none"}constructor(e,t,i,s){this.newsVideosProvider=e,this.feedType="subscriptions",this.transformers=[t,i,s],(0,r.makeAutoObservable)(this)}}c=(0,s.__decorate)([a.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.ShortVideoFeedNewsVideosProvider?Object:o.ShortVideoFeedNewsVideosProvider,void 0===d.FirstClip?Object:d.FirstClip,void 0===d.DeletedClips?Object:d.DeletedClips,void 0===d.UnsubscribedClips?Object:d.UnsubscribedClips])],c)},196216:(e,t,i)=>{i.d(t,{ClipsTopFeed:()=>c});var s=i(331635),r=i(327813),o=i(876922),a=i(132028),n=i(348882),d=i(900209);class c{async init(e){this.feed=this.topVideosProvider.createList({ref:"clips",...n.FETCH_QUERY}),await Promise.all([this.feed.fetch(),...this.transformers.map((t=>t.init(e)))])}async fetchNext(){await(this.feed?.fetch())}fetchBefore(){return Promise.resolve()}get ids(){return this.transformers.reduce(((e,t)=>t.transformIds(e)),Array.from(this.feed?.ids.values()??[]))}get isLoadingBefore(){return!1}get isLoadingNext(){return Boolean(this.feed?.isLoading)}get emptyPlaceholder(){return this.feed?.error?"error":this.feed?.fullyLoaded?"empty":"none"}constructor(e,t,i){this.topVideosProvider=e,this.feedType="top",this.transformers=[t,i],(0,r.makeAutoObservable)(this)}}c=(0,s.__decorate)([a.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.ShortVideoFeedTopVideosProvider?Object:o.ShortVideoFeedTopVideosProvider,void 0===d.FirstClip?Object:d.FirstClip,void 0===d.DeletedClips?Object:d.DeletedClips])],c)},631780:(e,t,i)=>{i.d(t,{ClipsCompilationFeed:()=>c.ClipsCompilationFeed,ClipsEffectFeed:()=>h.ClipsEffectFeed,ClipsHashtagFeed:()=>o.ClipsHashtagFeed,ClipsMusicFeed:()=>a.ClipsMusicFeed,ClipsOwnerFeed:()=>r.ClipsOwnerFeed,ClipsPlaceFeed:()=>d.ClipsPlaceFeed,ClipsPlaylistFeed:()=>n.ClipsPlaylistFeed,ClipsTopFeed:()=>s.ClipsTopFeed});var s=i(196216),r=(i(710517),i(357136)),o=i(356691),a=i(496964),n=i(693421),d=i(264128),c=i(232716),h=i(755006)},56357:(e,t,i)=>{i.d(t,{DeletedClips:()=>a});var s=i(331635),r=i(509739),o=i(132028);class a{init(){return Promise.resolve()}transformIds(e){return e.filter((e=>!this.shortVideoDeleteService.isDeleted(e)))}constructor(e){this.shortVideoDeleteService=e}}a=(0,s.__decorate)([o.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===r.ShortVideoDeleteService?Object:r.ShortVideoDeleteService])],a)},448013:(e,t,i)=>{i.d(t,{FirstClip:()=>n});var s=i(331635),r=i(632520),o=i(132028),a=i(231450);class n{async init(e){if(e){const t=(0,a.getTrackCode)("search_track_code")||"";this.firstClip=e,await this.shortVideoVideosProvider.fetchAllFields(e,t)}}transformIds(e){return this.firstClip&&!e.includes(this.firstClip)?[this.firstClip,...e.filter((e=>e!==this.firstClip))]:e}constructor(e){this.shortVideoVideosProvider=e}}n=(0,s.__decorate)([o.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===r.ShortVideoVideosProvider?Object:r.ShortVideoVideosProvider])],n)},998943:(e,t,i)=>{i.d(t,{UnsubscribedClips:()=>a});var s=i(331635),r=i(132028),o=i(632520);class a{init(){return Promise.resolve()}transformIds(e){return e.filter((e=>this.shortVideoVideosProvider.get(e)?.owner?.isSubscribed))}constructor(e){this.shortVideoVideosProvider=e}}a=(0,s.__decorate)([r.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.ShortVideoVideosProvider?Object:o.ShortVideoVideosProvider])],a)},900209:(e,t,i)=>{i.d(t,{DeletedClips:()=>s.DeletedClips,FirstClip:()=>r.FirstClip,UnsubscribedClips:()=>o.UnsubscribedClips});var s=i(56357),r=i(448013),o=i(998943)},861794:(e,t,i)=>{i.d(t,{ClipsFeedModel:()=>r.ClipsFeedModel,ClipsTopFeed:()=>o.ClipsTopFeed,FETCH_QUERY:()=>s.FETCH_QUERY});var s=i(800811),r=i(161416),o=i(631780);i(425367)},425367:(e,t,i)=>{i.d(t,{getFeedObjectKey:()=>r,getFeedObjectRequestParams:()=>o,isValidFeedType:()=>n});var s=i(800811);function r(e){switch(e.feed){case"compilation":return`${e.feed}-${e.compilationId}`;case"effect":return`${e.feed}-${e.effectId}`;case"music":return`${e.feed}-${e.musicId}`;case"hashtag":return`${e.feed}-${e.hashtag}`;case"search":return`${e.feed}-${e.searchQuery}`;case"place":return`${e.feed}-${e.placeId}`;case"ownerFeed":case"postponed":return`${e.feed}-${e.ownerId}`;case"playlist":return`${e.feed}-${e.ownerId}-${e.playlistId}`;case"subscriptions":case"top":return`${e.feed}`;case"searchBlock":return`${e.feed}-${e.blockId}`;default:throw new Error(`${e.feed} does not support in getFeedObjectKey`)}}function o(e){switch(e.feed){case"compilation":return{filters:JSON.stringify({compilationId:e.compilationId}),...s.FETCH_QUERY};case"effect":return{filters:JSON.stringify({maskId:e.effectId}),...s.FETCH_QUERY};case"music":return{filters:JSON.stringify({audioId:e.musicId}),ref:"clip_grid",...s.FETCH_QUERY};case"hashtag":return{filters:JSON.stringify({tag:`#${e.hashtag}`}),...s.FETCH_QUERY};case"place":return{filters:JSON.stringify({placeId:e.placeId})};case"search":return{q:e.searchQuery??"",screen_ref:"search_clips_service",need_blocks:0};case"top":return{ref:"clips",...s.FETCH_QUERY};case"ownerFeed":return{owner_id:e.ownerId??0,...s.FETCH_QUERY,...e.trackCode?{track_code:e.trackCode}:{}};case"postponed":return{owner_id:e.ownerId??0,playlist:"scheduled",...s.FETCH_QUERY};case"subscriptions":return{filters:"clip",source_ids:"friends,groups,following",...s.FETCH_QUERY};case"playlist":return{owner_id:e.ownerId??0,playlist_id:e.playlistId??0,...s.FETCH_QUERY};case"searchBlock":return{count:s.FETCH_QUERY.count,block_id:e.blockId??""};default:throw new Error(`${e.feed} does not support in getFeedObjectRequestParams`)}}const a=new Set(["top","subscriptions","postponed","ownerFeed","playlist","compilation","hashtag","music","effect","place","search","searchBlock"]);function n(e){return!(!e||"string"!=typeof e)&&a.has(e)}},322089:(e,t,i)=>{i.d(t,{ClipsFeedModel:()=>s.ClipsFeedModel,ClipsPlayerSearchStatsService:()=>o.ClipsPlayerSearchStatsService,ClipsPlayerStatusModel:()=>r.ClipsPlayerStatusModel,ClipsPlayerVolumeModel:()=>r.ClipsPlayerVolumeModel,ClipsTopFeed:()=>s.ClipsTopFeed,FETCH_QUERY:()=>s.FETCH_QUERY});var s=i(861794),r=(i(419613),i(509975)),o=i(974097)},601284:(e,t,i)=>{var s=i(331635),r=i(327813),o=i(132028);class a{getValue(e){return this.ordMap.get(e)}setValue(e,t){this.ordMap.set(e,t)}clearValue(e){this.ordMap.delete(e)}constructor(){this.ordMap=new Map,(0,r.makeAutoObservable)(this)}}a=(0,s.__decorate)([o.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[])],a)},419613:(e,t,i)=>{i(601284)},266686:(e,t,i)=>{i.d(t,{ClipsPlayerStatusModel:()=>n});var s=i(331635),r=i(327813),o=i(132028),a=i(419678);class n{get volume(){return this.isMuted?0:this.clipsPlayerVolume.volume}constructor(e){this.clipsPlayerVolume=e,this.isPlaying=!0,this.isMuted=!0,this.setPlaying=e=>{this.isPlaying=e},this.togglePlay=()=>{this.isPlaying=!this.isPlaying},this.setMuted=e=>{this.isMuted=e},this.toggleMute=()=>{this.isMuted=!this.isMuted,this.isMuted||this.volume||this.setVolume(1)},this.setVolume=e=>{this.clipsPlayerVolume.setVolume(e),this.isMuted=0===e},(0,r.makeAutoObservable)(this)}}n=(0,s.__decorate)([o.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.ClipsPlayerVolumeModel?Object:a.ClipsPlayerVolumeModel])],n)},419678:(e,t,i)=>{i.d(t,{ClipsPlayerVolumeModel:()=>h});var s=i(331635),r=i(327813),o=i(132028),a=i(24516),n=i(510454),d=i(8520);const c="clips_volume";class h{get volume(){return this._volume}constructor(e,t){this.userEnv=e,this.localStorage=t,this._volume=Number(this.localStorage.getItem(c))||1,this.saveVolume=(0,d.debounce)((e=>{this.localStorage.setItem(c,e.toString())}),100),this.setVolume=e=>{this._volume=e,this.saveVolume(e)},(0,r.makeAutoObservable)(this)}}h=(0,s.__decorate)([o.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.UserEnv?Object:a.UserEnv,void 0===n.LocalStorage?Object:n.LocalStorage])],h)},509975:(e,t,i)=>{i.d(t,{ClipsPlayerStatusModel:()=>s.ClipsPlayerStatusModel,ClipsPlayerVolumeModel:()=>r.ClipsPlayerVolumeModel});var s=i(266686),r=i(419678)},413551:(e,t,i)=>{i.d(t,{UPLOAD_AUDIO_RIGHTS_LINK:()=>o,UPLOAD_AUTHOR_ADVICES_LINK:()=>r,UPLOAD_MAX_VIDEO_SIZE:()=>a});var s=i(225741);const r=`${s.VK_SITE_RELATIVE_URL}/@vkclips-web-publish`,o=`${s.VK_SITE_RELATIVE_URL}/@vkclips-copyrights-description`,a=8589934592},615382:(e,t,i)=>{i.d(t,{UPLOAD_AUDIO_RIGHTS_LINK:()=>r.UPLOAD_AUDIO_RIGHTS_LINK,UPLOAD_AUTHOR_ADVICES_LINK:()=>r.UPLOAD_AUTHOR_ADVICES_LINK,UPLOAD_MAX_VIDEO_SIZE:()=>r.UPLOAD_MAX_VIDEO_SIZE,UploadAudioSearchModel:()=>s.UploadAudioSearchModel});var s=i(502197),r=i(413551)},219359:(e,t,i)=>{i.d(t,{UploadAudioSearchModel:()=>d});var s=i(331635),r=i(327813),o=i(543116),a=i(132028),n=i(8520);class d{[a.init](){return this.audioClipsList.fetch({})}get audios(){return this.isSearch?this.audioClipsSearchList.items:this.audioClipsList.items}get isLoading(){return this.audioClipsSearchList.isLoading||this.audioClipsList.isLoading}resetQuery(){this.isSearch=!1,this.audioClipsSearchList.reset()}constructor(e,t){this.audioClipsListsProvider=e,this.props=t,this.searchQuery="",this.isSearch=!1,this.searchAudio=e=>{this.searchQuery=e,this.searchAudioDebounced(e)},this.searchAudioDebounced=(0,n.debounce)((e=>{e?((0,r.runInAction)((()=>{this.isSearch=!0})),this.audioClipsSearchList.fetch({query:e})):this.resetQuery()}),200),(0,r.makeAutoObservable)(this),this.audioClipsList=this.audioClipsListsProvider.createSearchList(),this.audioClipsSearchList=this.audioClipsListsProvider.createSearchList()}}d=(0,s.__decorate)([a.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.AudioClipsListsProvider?Object:o.AudioClipsListsProvider,void 0===a.Props?Object:a.Props])],d)},502197:(e,t,i)=>{i.d(t,{UploadAudioSearchModel:()=>s.UploadAudioSearchModel});var s=i(219359)},48887:(e,t,i)=>{i.d(t,{compilePath:()=>r});var s=i(365473);function r(e){return function(e){const t=e.map((e=>{if("object"==typeof e)return new RegExp("^(?:".concat(e.pattern,")$"))}));return i=>{let s="";for(let r=0;r<e.length;r++){const o=e[r];if("string"==typeof o){s+=o;continue}const a=i?i[o.name]:void 0,n="?"===o.modifier||"*"===o.modifier,d="*"===o.modifier||"+"===o.modifier;if(Array.isArray(a)){if(!d)throw new TypeError('Expected "'.concat(o.name.toString(),'" to not repeat, but got an array'));if(0===a.length){if(n)continue;throw new TypeError('Expected "'.concat(o.name.toString(),'" to not be empty'))}for(let e=0;e<a.length;e++){const i=a[e];if(!t[r]?.test(i))throw new TypeError('Expected all "'.concat(o.name.toString(),'" to match "').concat(o.pattern,'", but got "').concat(i,'"'));s+=o.prefix+i+o.suffix}continue}if("string"==typeof a||"number"==typeof a){const e=String(a);if(!t[r]?.test(e))throw new TypeError('Expected "'.concat(o.name.toString(),'" to match "').concat(o.pattern,'", but got "').concat(e,'"'));s+=o.prefix+e+o.suffix;continue}if(n)continue;const c=d?"an array":"a string";throw new TypeError('Expected "'.concat(o.name.toString(),'" to be ').concat(c))}return s}}((0,s.parsePath)(e))}},58493:(e,t,i)=>{i.d(t,{createLink:()=>r});var s=i(48887);function r(e,t,i,r){const o=function(e,t){const i=e.split(".");let s,r=t;do{const t=i.shift();if(!(t in r))throw Error(`Unknown path's segment "${t}" for route key "${e}"`);s=r[t],"routes"in s&&(r=s.routes)}while(i.length>0);return s}(t,e).path,a=i?(0,s.compilePath)(o)(i):o,n=r?new URLSearchParams((d=r,Object.fromEntries(Object.entries(d).map((([e,t])=>[e,t.toString()]))))).toString():"";var d;return`${a}${n?"?"+n:""}`}},298744:(e,t,i)=>{i.d(t,{TypedParamNumber:()=>s});i(308011),i(365473);Symbol("query param string type");const s=Symbol("query param number type")},227261:(e,t,i)=>{i.d(t,{getUrlToShortVideoStats:()=>r});var s=i(768035);function r(e){const{ownerId:t,id:i}=(0,s.parseRawId)(e);return`/clips_stats#owner_id=${t}&clip_id=${i}`}},735221:(e,t,i)=>{i.d(t,{createLink:()=>s.createLink,getUrlToShortVideoStats:()=>r.getUrlToShortVideoStats});var s=i(58493),r=(i(298744),i(813355),i(227261))},365473:(e,t,i)=>{function s(e){const t=function(e){const t=[];let i=0;for(;i<e.length;){const s=e[i];if("*"!==s&&"+"!==s&&"?"!==s)if("\\"!==s)if("{"!==s)if("}"!==s)if(":"!==s)if("("!==s)t.push({type:"CHAR",index:i,value:e[i++]});else{let s=1,r="",o=i+1;if("?"===e[o])throw new TypeError('Pattern cannot start with "?" at '.concat(o.toString()));for(;o<e.length;)if("\\"!==e[o]){if(")"===e[o]){if(s--,0===s){o++;break}}else if("("===e[o]&&(s++,"?"!==e[o+1]))throw new TypeError("Capturing groups are not allowed at ".concat(o.toString()));r+=e[o++]}else r+=e[o++]+e[o++];if(s)throw new TypeError("Unbalanced pattern at ".concat(i.toString()));if(!r)throw new TypeError("Missing pattern at ".concat(i.toString()));t.push({type:"PATTERN",index:i,value:r}),i=o}else{let s="",r=i+1;for(;r<e.length;){const t=e.charCodeAt(r);if(!(t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122||95===t))break;s+=e[r++]}if(!s)throw new TypeError("Missing parameter name at ".concat(i.toString()));t.push({type:"NAME",index:i,value:s}),i=r}else t.push({type:"CLOSE",index:i,value:e[i++]});else t.push({type:"OPEN",index:i,value:e[i++]});else t.push({type:"ESCAPED_CHAR",index:i++,value:e[i++]});else t.push({type:"MODIFIER",index:i,value:e[i++]})}return t.push({type:"END",index:i,value:""}),t}(e),i="[^".concat(function(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}("/#?"),"]+?");let s=[],r=0,o=0,a="";const n=function(e){if(o<t.length&&t[o].type===e)return t[o++].value},d=function(e){const i=n(e);if(void 0!==i)return i;const{type:s,index:r}=t[o];throw new TypeError("Unexpected ".concat(s," at ").concat(r.toString(),", expected ").concat(e))},c=function(){let e,t="";for(;e=n("CHAR")||n("ESCAPED_CHAR");)t+=e;return t};for(;o<t.length;){const e=n("CHAR"),t=n("NAME"),o=n("PATTERN");if(t||o){let d=e||"";"./".includes(d)&&(a+=d,d=""),a&&(s.push(a),a=""),s.push({name:t||r++,prefix:d,suffix:"",pattern:o||i,modifier:n("MODIFIER")||""});continue}const h=e||n("ESCAPED_CHAR");if(h){a+=h;continue}a&&(s.push(a),a="");if(n("OPEN")){const e=c(),t=n("NAME")||"",o=n("PATTERN")||"",a=c();d("CLOSE"),s.push({name:t||(o?r++:""),pattern:t&&!o?i:o,prefix:e,suffix:a,modifier:n("MODIFIER")||""})}else d("END")}return s}i.d(t,{parsePath:()=>s})},813355:(e,t,i)=>{i(298744)},640835:(e,t,i)=>{i.d(t,{getClipCover:()=>r});var s=i(8520);function r(e,t){return function(e,t,i){const r=e.filter((e=>!e.with_padding));return(0,s.getPhotoSize)(r.length?r:e,t,i)?.url}(e.covers&&e.covers.length?e.covers:e.first_frames??[],t.width,t.height)||""}},531499:(e,t,i)=>{i.d(t,{getClipIcon:()=>r});var s=i(425072);function r(e){return e&&s.ClipIcons.includes(e)?e:s.ClipIcons[0]}},595212:(e,t,i)=>{i.d(t,{SERVICE_ID:()=>s,getMarketCategory:()=>r});const s=12;function r(e){return e.parent?r(e.parent):e}},667984:(e,t,i)=>{i.d(t,{getClipCover:()=>s.getClipCover,getClipIcon:()=>o.getClipIcon,isLockedVideo:()=>r.isLockedVideo,isOzonProgram:()=>a.isOzonProgram,toRawIdOrUndefined:()=>n.toRawIdOrUndefined});var s=i(640835),r=i(48225),o=i(531499),a=(i(129535),i(980232)),n=i(520593)},48225:(e,t,i)=>{function s(e){return Boolean(e.owner?.isAdmin)&&Boolean(e.data.privacy?.view&&!function(e){return function(e,t){return!e.category||!t.length||t.includes(e.category)}(e,["all","any"])&&0===(e?.excluded_category?.length||0)&&0===(e?.lists?.allowed?.length||0)&&0===(e?.lists?.excluded?.length||0)&&0===(e?.owners?.allowed?.length||0)&&0===(e?.owners?.excluded?.length||0)}(e.data.privacy.view))}i.d(t,{isLockedVideo:()=>s})},980232:(e,t,i)=>{i.d(t,{isOzonProgram:()=>o});var s=i(831505),r=i(595212);function o(e){const t=e?.data.clickable_stickers?.items.find((e=>Boolean(e.market_item)));if(!t||!t.market_item)return!1;const i=t.market_item;return Boolean(i.item_type===s.MarketMarketItemTypeEnumNames.OZON&&t?.ads_label&&(0,r.getMarketCategory)(i.category).id!==r.SERVICE_ID&&e?.data.ord?.title)}},129535:(e,t,i)=>{i(8520),i(468073)},520593:(e,t,i)=>{i.d(t,{toRawIdOrUndefined:()=>o});var s=i(873900),r=i(768035);function o(e){try{if(!e||"string"!=typeof e)return;return(0,s.getIdentityRawIdOrUndefined)((0,r.parseRawId)(e))}catch{return}}},161493:(e,t,i)=>{i.d(t,{ClipPlayerWidget:()=>w});var s=i(474848),r=i(296540),o=i(425072),a=i(454154),n=i(822062),d=i(988418),c=i(783856),h=i(723723),l=i(194528),u=i(285056),p=i(344356),g=i(456921),m=i(132028),v=i(504117),_=i(389829),y=i(149333),S=i(667984),f=i(298732),b=i(608011),C=i(838586);const P=(0,g.observer)((function(){const e=(0,C.useClipPlayerWebModel)(),{title:t,video:i,cover:g,mode:m="contain",width:P,ratio:w,playing:V=!1,loop:A=!1,onVideoCurQualityChanged:k,onDurationChanged:I,onStalledChanged:E,onPositionChanged:O,onPlayingChanged:M,onPlaying:F,onPaused:T,onMutedChanged:R,onStarted:L,onLooped:D,onEnded:j,onVideoVolumeChanged:N,onVideoFormatChanged:U,onVideoBitrateChanged:B,onFirstBytes:G,onFirstFrame:x,onError:H,isControls:Q,isDeleted:$,isRestricted:W,hrefMore:q,onClick:K,togglePlay:Y,onMuteChanged:z,module:X="clips",videoRawId:J,borderRadius:Z,forceMuted:ee}=e.props.current,{clipPlayer:te,restriction:ie}=e,{activeVolume:se,videoIsEnded:re,videoIsMuted:oe,currentTime:ae,setVideoIsEnded:ne,muteButtonClick:de,volumeChange:ce,setCurrentTime:he,userEnv:le}=te,ue=(0,y.useLangs)(),pe=Boolean(J&&i?.restriction?.blur&&!ie.isRestrictionDisabled(J));(0,r.useEffect)((()=>{z?.(oe)}),[oe]);const ge=(0,r.useCallback)((e=>{ne(e),e&&V&&Y()}),[re]),me=()=>{J&&(ie.disableRestriction(J),!V&&Y())},ve=(0,r.useCallback)((e=>{O?.(e),he(e)}),[O]);return le.partConfigEnabled("clips_add_seized_restrictions_web")&&i?.restriction?.title?(0,s.jsx)(o.ClipRestricted,{width:P,ratio:w,cover:g,onClick:()=>K?.(ae),title:i?.restriction?.title,text:i?.restriction?.text,icon:(0,S.getClipIcon)(i?.restriction?.icon_name),blurred:pe,borderRadius:Z,size:"l","data-testid":`clips-restricted-${J}`,action:pe?(0,s.jsx)(a.Button,{size:"m",onClick:me,mode:"outline",appearance:"overlay","data-testid":"clips-carousel-placeholder-blur-button",children:i?.restriction?.button?.title}):void 0}):J&&i?.restriction?.blur&&!ie.isRestrictionDisabled(J)?(0,s.jsx)(n.ClipCard,{width:P,ratio:w,mode:m,cover:g,blurred:!0,borderRadius:Z,children:(0,s.jsx)(d.ClipControlsLayout,{onClick:()=>K?.(ae),noControls:!0,centerComponent:pe&&(0,s.jsx)(b.ClipPlayerRestrictionForBlurPlaceholder,{title:i.restriction.title,text:i.restriction.text,buttonText:i.restriction.button?.title,onClick:me})})}):(0,s.jsxs)(n.ClipCard,{width:P,ratio:w,mode:m,cover:g,borderRadius:Z,children:[(0,s.jsx)(c.Overlay,{centered:!0,children:i&&(0,s.jsx)(f.ClipsPlayer,{loop:A,muted:Boolean(oe||ee),volume:se,onVideoCurQualityChanged:k,onLooped:D,onStarted:L,onPlayingChanged:M,onPlaying:F,onPaused:T,onMutedChanged:R,onPositionChanged:ve,onStalledChanged:E,onVideoEndedChanged:ge,onDurationChanged:I,onEnded:j,onVideoVolumeChanged:N,onVideoFormatChanged:U,onVideoBitrateChanged:B,onFirstBytes:G,onFirstFrame:x,onError:H,playing:V,video:i,mode:m,module:X,platform:"web"})}),(0,s.jsx)(d.ClipControlsLayout,{onClick:()=>K?.(ae),noControls:!Q||re,title:t,playing:V,onMuteButtonClick:ee?void 0:de,onVolumeChange:ee?void 0:ce,volume:oe||ee?0:se,togglePlay:Y,hasGradient:re,unavailable:$||W,centerComponent:($||W||re)&&(0,s.jsxs)(s.Fragment,{children:[$&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.Icon56DeleteOutline,{className:(0,h.getColorClass)("color_icon_secondary")}),(0,s.jsx)(l.Spacing,{size:8}),(0,s.jsx)(u.Title,{level:"3",weight:"3",className:(0,h.getColorClass)("color_text_secondary"),children:(0,s.jsx)(p.Interpolate,{children:ue.getLang("video_feed_player_clip_deleted")})})]}),W&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(_.Icon56LockOutline,{className:(0,h.getColorClass)("color_icon_secondary")}),(0,s.jsx)(l.Spacing,{size:8}),(0,s.jsx)(u.Title,{level:"3",weight:"3",className:(0,h.getColorClass)("color_text_secondary"),children:(0,s.jsx)(p.Interpolate,{children:ue.getLang("video_clip_restriction_user_access")})})]}),re&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.Button,{mode:"secondary",appearance:"overlay",size:"l",href:q,children:ue.getLang("video_feed_player_clip_more")}),(0,s.jsx)(l.Spacing,{size:20}),(0,s.jsx)(a.Button,{mode:"link",appearance:"overlay",size:"l",onClick:()=>!V&&Y(),children:ue.getLang("video_feed_player_clip_repeat")})]})]})}),ee&&(0,s.jsx)(b.ClipForceMutedBanner,{text:ue.getLang("video_clip_sound_restriction_error"),buttonText:ue.getLang("video_clips_banner_close_btn")})]})})),w=(0,m.createWidget)(C.ClipPlayerWebModelProvider,P)},107726:(e,t,i)=>{i.d(t,{ClipForceMutedBanner:()=>c});var s=i(474848),r=i(782818),o=i(285056),a=i(454154),n=i(296540),d=i(561386);const c=({text:e,buttonText:t,buttonClick:i})=>{const[c,h]=(0,n.useState)(!0),l=(0,n.useCallback)((()=>{i?.(),h(!1)}),[i]);return c?(0,s.jsx)(r.StatusBanner,{className:d.default.root,before:null,header:(0,s.jsx)(o.Text,{children:e}),after:(0,s.jsx)(a.Button,{mode:"secondary_transparent",onClick:l,children:t})}):null}},590354:(e,t,i)=>{i.d(t,{ClipForceMutedBanner:()=>s.ClipForceMutedBanner});var s=i(107726)},756012:(e,t,i)=>{i.d(t,{ClipPlayerRestrictionForBlurPlaceholder:()=>h});var s=i(474848),r=i(15978),o=i(720836),a=i(723723),n=i(285056),d=i(454154),c=i(455548);const h=({title:e,text:t,buttonText:i,onClick:h})=>(0,s.jsx)(r.AppearanceProvider,{value:"dark",children:(0,s.jsx)(o.Placeholder,{icon:(0,s.jsx)(c.Icon56HideOutline,{className:(0,a.getColorClass)("color_icon_contrast")}),header:(0,s.jsx)(n.Title,{level:"2",weight:"2",className:(0,a.getColorClass)("color_text_contrast"),children:e}),action:i?(0,s.jsx)(d.Button,{size:"m",onClick:h,mode:"outline",appearance:"overlay","data-testid":"clips-carousel-placeholder-blur-button",children:i}):void 0,children:t&&e!==t&&(0,s.jsx)(n.Text,{className:(0,a.getColorClass)("color_text_contrast"),children:t})})})},339032:(e,t,i)=>{i.d(t,{ClipPlayerRestrictionForBlurPlaceholder:()=>s.ClipPlayerRestrictionForBlurPlaceholder});var s=i(756012)},608011:(e,t,i)=>{i.d(t,{ClipForceMutedBanner:()=>r.ClipForceMutedBanner,ClipPlayerRestrictionForBlurPlaceholder:()=>s.ClipPlayerRestrictionForBlurPlaceholder});var s=i(339032),r=i(590354)},842422:(e,t,i)=>{i.d(t,{ClipPlayerWidget:()=>s.ClipPlayerWidget});var s=i(161493);i(608011)},838586:(e,t,i)=>{i.d(t,{ClipPlayerWebModelProvider:()=>u,useClipPlayerWebModel:()=>l});var s=i(331635),r=i(327813),o=i(132028),a=i(681280),n=i(24516),d=i(348882),c=i(322089);class h{[o.update](){this.clipPlayer.setVideoMuted(Boolean(this.props.current.muted))}constructor(e,t,i,s){this.props=e,this.restriction=t,this.playerVolume=i,this.userEnv=s,this.clipPlayer=new d.ClipPlayerViewModel(this.props,this.playerVolume,this.userEnv),(0,r.makeAutoObservable)(this)}}h=(0,s.__decorate)([o.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.Props?Object:o.Props,void 0===a.ShortVideoRestrictions?Object:a.ShortVideoRestrictions,void 0===c.ClipsPlayerVolumeModel?Object:c.ClipsPlayerVolumeModel,void 0===n.UserEnv?Object:n.UserEnv])],h);const{useModel:l,Provider:u}=(0,o.createProvider)(h)},504935:(e,t,i)=>{i.d(t,{PrimaryAttachmentClipWrapper:()=>u});var s=i(474848),r=i(456921),o=i(132028),a=i(783856),n=i(965632),d=i(732079),c=i(70984),h=i(423462);const l=(0,r.observer)((function(){const{getPlayer:e,video:t,stats:i,props:{current:{ratio:r,headerHeight:o}}}=(0,c.useClipPlayerModel)();(0,h.useMute)();const l=(0,d.usePlayingStats)({stats:i,statsRef:n.ShortVideoPlayerStatsRef.FEED,video:t}),u=(0,h.useClipIntersection)(o);return r?(0,s.jsx)("div",{ref:u,children:e(r,l)}):(0,s.jsx)(a.Overlay,{children:(0,s.jsx)("div",{ref:u,children:e("var(--primary-attachment-ratio, calc(9 / 16))",l)})})})),u=(0,o.createWidget)(c.ClipPlayerProvider,l)},423462:(e,t,i)=>{i.d(t,{useClipIntersection:()=>s.useClipIntersection,useMute:()=>r.useMute});var s=i(378898),r=i(171552)},378898:(e,t,i)=>{i.d(t,{useClipIntersection:()=>a});var s=i(8520),r=i(296540),o=i(70984);function a(e){const t=(0,r.useRef)(null),{autoplay:i,play:a,pause:n}=(0,o.useClipPlayerModel)();return(0,r.useEffect)((()=>{const r=(0,s.debounce)((()=>{if(!t.current)return;const s=t.current.getBoundingClientRect(),r=s.height/3,o=s.top+r,d=s.bottom-r;o>=e&&d<=window.innerHeight?i&&a():n()}),30);return document.addEventListener("scroll",r,{passive:!0}),i&&r(),()=>document.removeEventListener("scroll",r)}),[i]),t}},171552:(e,t,i)=>{i.d(t,{useMute:()=>o});var s=i(296540),r=i(70984);const o=()=>{const{playing:e,toggleMute:t}=(0,r.useClipPlayerModel)();(0,s.useEffect)((()=>{const i=e=>{"KeyM"===e.code&&t()};return e&&document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i)}}),[e,t])}},24037:(e,t,i)=>{i.d(t,{PrimaryAttachmentClipWrapper:()=>s.PrimaryAttachmentClipWrapper});var s=i(504935)},362004:(e,t,i)=>{i.d(t,{ClipPlayer:()=>u});var s=i(331635),r=i(327813),o=i(132028),a=i(768035),n=i(632520),d=i(130270),c=i(292202),h=i(33013),l=i(756314);class u{async[o.init](){this.postAuthorId=(0,a.parseRawId)(this.props.current.postId).ownerId,this.getAutoplaySettings(),this.fetchVideo()}async[o.destroy](){this.switchConnection.emit("stop"),this.accountInfoService.reset()}get mode(){if(!this.video)return"cover";const{width:e=0,height:t=0}=this.video.data;return t/e<=1?"contain":"cover"}async getAutoplaySettings(){const e=await this.accountInfoService.ensure({fields:["video_autoplay"]}),t=e?.settings?.find((e=>"video_autoplay"===e.name));this.autoplaySetting=Boolean(t?.value)}async fetchVideo(){this.isLoading=!0;try{await this.shortVideoVideosProvider.fetch({videos:this.props.current.videoRawId},{})}catch(e){(0,r.runInAction)((()=>{this.error=e}))}finally{this.isLoading=!1}}get video(){return this.shortVideoVideosProvider.get(this.props.current.videoRawId)}get cover(){return this.video?.data.covers&&(0,h.getVideoThumb)(this.video.data.covers,this.props.current.coverWidth)}get isRestricted(){return Boolean(this.video?.isRestricted)}get isRestrictedWithBlur(){return Boolean(this.video?.data.restriction?.blur)}get forceMuted(){return Boolean(this.video?.data?.is_muted)}get onClick(){if(!this.isRestricted)return e=>{this.props.current.onClick&&(this.pause(),this.props.current.onClick(e))}}get autoplay(){return this.autoplaySetting&&!this.isRestricted&&!this.isRestrictedWithBlur&&this.autoplayClip}constructor(e,t,i,s){this.shortVideoVideosProvider=e,this.accountInfoService=t,this.stats=i,this.props=s,this.autoplaySetting=!1,this.autoplayClip=!0,this.isLoading=!1,this.error=void 0,this.postAuthorId=0,this.playing=!1,this.muted=!0,this.getPlayer=(e,t)=>this.props.current.getPlayer({video:this.video?.data,isRestricted:this.isRestricted,cover:this.cover,onClick:this.onClick,muted:this.muted,onMuteChanged:this.onMuteChanged,playing:this.playing,togglePlay:this.togglePlay,ratio:e,mode:this.mode,isControls:!this.isRestricted,loop:!0,volume:1,videoRawId:this.props.current.videoRawId,forceMuted:this.forceMuted,...t}),this.play=()=>{this.playing||(this.playing=!0,this.switchConnection.emit("play",this.muted),this.props.current.pauseVideoPlayer?.())},this.pause=()=>{this.playing&&(this.playing=!1,this.switchConnection.emit("pause"))},this.togglePlay=()=>{this.playing?(this.pause(),this.autoplayClip=!1):this.play()},this.onMuteChanged=e=>{this.muted=e,this.switchConnection.emit(e?"mute":"unmute"),e||(this.autoplayClip=!1)},this.toggleMute=()=>{this.onMuteChanged(!this.muted)},(0,r.makeAutoObservable)(this),this.switchConnection=l.MediaPlayersSwitch.ensure(o.rootContainer).connect({resume:this.play,pause:this.pause,stop:this.pause})}}u=(0,s.__decorate)([o.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.ShortVideoVideosProvider?Object:n.ShortVideoVideosProvider,void 0===d.AccountInfoService?Object:d.AccountInfoService,void 0===c.ShortVideoStatsService?Object:c.ShortVideoStatsService,void 0===o.Props?Object:o.Props])],u)},70984:(e,t,i)=>{i.d(t,{ClipPlayerProvider:()=>o,useClipPlayerModel:()=>a});var s=i(132028),r=i(362004);const{Provider:o,useModel:a}=(0,s.createProvider)(r.ClipPlayer)},862420:(e,t,i)=>{i.d(t,{ClipPlayerWidget:()=>s.ClipPlayerWidget,PrimaryAttachmentClipWrapper:()=>r.PrimaryAttachmentClipWrapper});var s=i(842422),r=i(24037)},818298:(e,t,i)=>{function s(){const{width:e,height:t}=window.screen;return{width:e,height:t,orientation:window.screen.orientation.type}}i.d(t,{getScreenInfo:()=>s})},130270:(e,t,i)=>{i.d(t,{AccountInfoService:()=>d});var s=i(331635),r=i(327813),o=i(21632),a=i(955060),n=i(132028);class d{get isLoading(){return this._isLoading}async request(e,t){return this._isLoading=!0,this.abortController=new AbortController,this.accountApi[t?"getInfoWithPrefetch":"getInfo"](e,{signal:this.abortController?.signal})}async fetch(e={},t=!1){const i=this.fieldsToString(e.fields),s={fields:i};this.reset();try{const e=await this.request(s,t);return this.settingsMap.set(i,e),e}catch(e){const t=new Error("Fail to fetch account settings",{cause:e});this.errorLogger.log(t)}finally{this._isLoading=!1,this.requestMap.delete(i)}}async ensure(e={}){const t=this.fieldsToString(e.fields),i=this.requestMap.get(t);if(i)return i;const s=this.settingsMap.get(t);if(s)return s;const r=this.fetch(e);return this.requestMap.set(t,r),r}fieldsToString(e=[]){return e.sort().join(",")}reset(){this.settingsMap.clear(),this.requestMap.clear(),this._isLoading=!1,this.abortController?.abort()}constructor(e,t){this.accountApi=e,this.errorLogger=t,this.abortController=null,this._isLoading=!1,this.settingsMap=new Map,this.requestMap=new Map,(0,r.makeAutoObservable)(this)}}d=(0,s.__decorate)([n.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.AccountApi?Object:o.AccountApi,void 0===a.ErrorLogger?Object:a.ErrorLogger])],d)},504715:(e,t,i)=>{i.d(t,{GroupsFavoriteService:()=>c});var s=i(331635),r=i(327813),o=i(972573),a=i(132028),n=i(721162),d=i(831197);class c{getIsFavorite(e){return this.groupsStore.getGroup(e)?.is_favorite}add(e){this.addAction.run(e,e)}async _add(e){await this.faveApi.addPage({group_id:e});const t=this.groupsStore.getGroup(e);t&&(0,r.runInAction)((()=>{t.is_favorite=!0}))}remove(e){this.removeAction.run(e,e)}async _remove(e){await this.faveApi.removePage({group_id:e});const t=this.groupsStore.getGroup(e);t&&(0,r.runInAction)((()=>{t.is_favorite=!1}))}toggle(e){const t=this.getIsFavorite(e);if(void 0!==t)return t?this.remove(e):this.add(e)}getIsLoading(e){return this.addAction.getLoading(e)||this.removeAction.getLoading(e)}constructor(e,t){this.faveApi=e,this.groupsStore=t,this.addAction=new n.AsyncAction({action:this._add.bind(this)}),this.removeAction=new n.AsyncAction({action:this._remove.bind(this)}),(0,r.makeAutoObservable)(this)}}c=(0,s.__decorate)([a.scope.global(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.FaveApi?Object:o.FaveApi,void 0===d.GroupsStore?Object:d.GroupsStore])],c)},276289:(e,t,i)=>{i.d(t,{GroupsSubscribeService:()=>u});var s=i(331635),r=i(571355),o=i(962005),a=i(261491),n=i(831505),d=i(132028),c=i(327813),h=i(721162),l=i(831197);class u{getIsMember(e){return!!this.groupsStore.getGroup(e)?.is_member}async join(e){return this.joinAction.run(e,e.group_id)}async _join(e){const t=e.group_id,i=this.groupsStore.getGroup(t),s=i?.is_closed,o=i?.member_status===n.GroupsGroupFullMemberStatusEnumNames.INVITED;i&&(s!==n.GroupsGroupIsClosedEnumNames.PRIVATE||o?(await this.api.join(e),(0,c.runInAction)((()=>{this.leftGroupsData.set(t,!1),this.myTracker.sendTimespentEvent(r.MyTrackerActivityId.CommunitySubscribe),i.member_status=n.GroupsGroupFullMemberStatusEnumNames.MEMBER,s!==n.GroupsGroupIsClosedEnumNames.CLOSED||o?i.is_member=!0:i.member_status=n.GroupsGroupFullMemberStatusEnumNames.HAS_SENT_A_REQUEST}))):console.error("Trying to subscribe to a private group"))}async leave(e){return this.leaveAction.run(e,e.group_id)}async _leave(e){const t=e.group_id,i=this.groupsStore.getGroup(t);i&&(await this.api.leave(e),(0,c.runInAction)((()=>{i.is_member=!1,this.leftGroupsData.set(t,!0),i.member_status=n.GroupsGroupFullMemberStatusEnumNames.NOT_A_MEMBER})))}async toggle(e,t={}){const i=this.groupsStore.getGroup(e);if(!i)return;const s=i.is_member,r={group_id:e,...t};return i.is_closed&&!s&&i.member_status===n.GroupsGroupFullMemberStatusEnumNames.HAS_SENT_A_REQUEST||s?this.leave(r):this.join(r)}getIsLeftGroup(e){return!!this.leftGroupsData.get(e)}getIsJoinedGroup(e){return!1===this.leftGroupsData.get(e)}getIsLoading(e){return this.joinAction.getLoading(e)||this.leaveAction.getLoading(e)}getMemberStatus(e){return this.groupsStore.getGroup(e)?.member_status}getIsMemberOrSentRequest(e){return this.getIsMember(e)||this.getMemberStatus(e)===n.GroupsGroupFullMemberStatusEnumNames.HAS_SENT_A_REQUEST}constructor(e,t,i){this.api=e,this.myTracker=t,this.groupsStore=i,this.leftGroupsData=new Map,this.joinAction=new h.AsyncAction({action:this._join.bind(this)}),this.leaveAction=new h.AsyncAction({action:this._leave.bind(this)}),(0,c.makeAutoObservable)(this)}}u=(0,s.__decorate)([d.scope.global(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.GroupsApi?Object:o.GroupsApi,void 0===a.MyTrackerLegacy?Object:a.MyTrackerLegacy,void 0===l.GroupsStore?Object:l.GroupsStore])],u)},734773:(e,t,i)=>{i.d(t,{GroupsWallSubscribeService:()=>h});var s=i(331635),r=i(327813),o=i(229745),a=i(132028),n=i(468073),d=i(721162),c=i(831197);class h{getIsSubscribed(e){return this.groupsStore.getGroup(e)?.is_subscribed}async subscribe(e){this.subscribeAction.run(e,e)}async _subscribe(e){await this.wallApi.subscribe({owner_id:n.Ranges.convertGroupIdToOwnerId(e)});const t=this.groupsStore.getGroup(e);t&&(0,r.runInAction)((()=>{t.is_subscribed=!0}))}async unsubscribe(e){this.unsubscribeAction.run(e,e)}async _unsubscribe(e){await this.wallApi.unsubscribe({owner_id:n.Ranges.convertGroupIdToOwnerId(e)});const t=this.groupsStore.getGroup(e);t&&(0,r.runInAction)((()=>{t.is_subscribed=!1}))}toggle(e){const t=this.getIsSubscribed(e);if(void 0!==t)return t?this.unsubscribe(e):this.subscribe(e)}getIsLoading(e){return this.unsubscribeAction.getLoading(e)||this.subscribeAction.getLoading(e)}constructor(e,t){this.wallApi=e,this.groupsStore=t,this.subscribeAction=new d.AsyncAction({action:this._subscribe.bind(this)}),this.unsubscribeAction=new d.AsyncAction({action:this._unsubscribe.bind(this)}),(0,r.makeAutoObservable)(this)}}h=(0,s.__decorate)([a.scope.global(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.WallApi?Object:o.WallApi,void 0===c.GroupsStore?Object:c.GroupsStore])],h)},903723:(e,t,i)=>{i.d(t,{GroupsProvider:()=>g});var s=i(331635),r=i(327813),o=i(962005),a=i(24516),n=i(132028),d=i(662518),c=i(276289),h=i(504715),l=i(734773),u=i(46605),p=i(831197);class g{getGroup(e){return this.data.groupsMap.get("number"==typeof e?e:this.screenNameToIdMap[e])}createGroupFromApi({apiGroup:e,fields:t}){this.groupsStore.mergeGroup((0,d.mapApiGroupToEntity)(e));const{subscribeService:i,favoriteService:s,wallSubscribeService:o,storiesService:a}=this,{is_member:n,id:c,is_favorite:h,is_subscribed:l,has_unseen_stories:u,member_status:p,...g}=e,m=(0,r.makeAutoObservable)(Object.assign({id:c,fields:t,get is_member(){return i.getIsMember(this.id)},get is_favorite(){return s.getIsFavorite(this.id)},get is_subscribed(){return o.getIsSubscribed(this.id)},get has_unseen_stories(){return a.getHasUnseenStories(this.id)},get member_status(){return i.getMemberStatus(this.id)}},g));return this.data.groupsMap.set(m.id,m),m}async createGroup(e){const t=await this.groupsApi.create(e);return this.createGroupFromApi({apiGroup:t,fields:""})}async fetchGroupsByIds(e,t){const{groupIds:i,fields:s=[],...r}=e,o=this.fetchGroupsRequiredFields.concat(s).join(",");return((await this.groupsApi.getById({...r,group_ids:i.join(","),fields:o},t)).groups||[]).map((e=>this.createGroupFromApi({apiGroup:e,fields:o})))}async fetchGroupsExtended(e,{controller:t}={}){const i={...e,extended:1},s=this.userEnv.partConfigEnabled("web_settings_api_prefetch")?this.groupsApi.getWithPrefetch(i,{signal:t?.signal}):this.groupsApi.get(i,{signal:t?.signal}),r=await s,o=r.items.map((t=>this.createGroupFromApi({apiGroup:t,fields:e.fields??""})));return{...r,items:o}}async groupEdit(e,{controller:t}={}){const i=e.group_id,s=this.getGroup(i);if(!s)return null;await this.groupsApi.edit(e,{signal:t?.signal});const[r]=await this.fetchGroupsByIds({groupIds:[i],fields:s.fields.split(",")});return r}constructor(e,t,i,s,o,a,n){this.groupsApi=e,this.groupsStore=t,this.subscribeService=i,this.favoriteService=s,this.wallSubscribeService=o,this.storiesService=a,this.userEnv=n,this.fetchGroupsRequiredFields=["is_member","member_status","is_closed"],this.screenNameToIdMap={},this.data={groupsMap:new Map},(0,r.makeAutoObservable)(this)}}g=(0,s.__decorate)([n.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.GroupsApi?Object:o.GroupsApi,void 0===p.GroupsStore?Object:p.GroupsStore,void 0===c.GroupsSubscribeService?Object:c.GroupsSubscribeService,void 0===h.GroupsFavoriteService?Object:h.GroupsFavoriteService,void 0===l.GroupsWallSubscribeService?Object:l.GroupsWallSubscribeService,void 0===u.GroupsStoriesService?Object:u.GroupsStoriesService,void 0===a.UserEnv?Object:a.UserEnv])],g)},831197:(e,t,i)=>{i.d(t,{GroupsStore:()=>a});var s=i(331635),r=i(132028),o=i(327813);class a{getGroup(e){return this.data.groupsMap.get(e)}setGroup(e){this.data.groupsMap.set(e.id,e)}mergeGroup(e){const t=this.getGroup(e.id);t?Object.assign(t,e):this.setGroup(e)}constructor(){this.data={groupsMap:new Map},(0,o.makeAutoObservable)(this)}}a=(0,s.__decorate)([r.scope.global(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[])],a)},662518:(e,t,i)=>{function s(e){const{is_member:t,is_favorite:i,is_subscribed:s,...r}=e;return{...r,is_member:!!t,...void 0!==i&&{is_favorite:Boolean(i)},...void 0!==s&&{is_subscribed:Boolean(s)}}}i.d(t,{mapApiGroupToEntity:()=>s})},46605:(e,t,i)=>{i.d(t,{GroupsStoriesService:()=>h});var s=i(331635),r=i(132028),o=i(327813),a=i(988010),n=i(746310),d=i(831197),c=i(468073);class h{seenAllStories(e){if(!c.Ranges.isGroupId(e))return;const t=this.groupsStore.getGroup(c.Ranges.convertOwnerIdToGroupId(e));t&&(t.has_unseen_stories=!1)}dispose(){this.unsubscribeToAllStoriesSeen()}getHasUnseenStories(e){return this.groupsStore.getGroup(e)?.has_unseen_stories}async restore(e){const{items:t}=await this.storiesApi.get({owner_id:c.Ranges.convertGroupIdToOwnerId(e)}),i=t.some((e=>Boolean(e.has_unseen)));t.length>0&&t[0].stories&&this.stories.set(e,t[0].stories);const s=this.groupsStore.getGroup(e);s&&(0,o.runInAction)((()=>{s.has_unseen_stories=i}))}getStories(e){return this.stories.get(e)??null}constructor(e,t,i){this.externalEvents=e,this.storiesApi=t,this.groupsStore=i,this.stories=new Map,this.unsubscribeToAllStoriesSeen=this.externalEvents.subscribeToAllStoriesSeen((e=>this.seenAllStories(e))),(0,o.makeAutoObservable)(this)}}h=(0,s.__decorate)([r.scope.global(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.ExternalEvents?Object:a.ExternalEvents,void 0===n.StoriesApi?Object:n.StoriesApi,void 0===d.GroupsStore?Object:d.GroupsStore])],h)},721162:(e,t,i)=>{i.d(t,{AsyncAction:()=>r});var s=i(327813);class r{async run(e,t){if(this.loadings.get(t))return this.loadings.get(t);try{this.loadings.set(t,this.action(e)),await this.loadings.get(t)}catch(e){this.errorBoundary(e)}finally{(0,s.runInAction)((()=>{this.loadings.set(t,null)}))}}getLoading(e){return!!this.loadings.get(e)}constructor({action:e,errorBoundary:t}){this.loadings=new Map,this.action=e,this.errorBoundary=t||(e=>console.error(e)),(0,s.makeAutoObservable)(this)}}},110343:(e,t,i)=>{i.d(t,{GET_CHALLENGE_COUNTERS_MAX_RETRIES:()=>s,GET_SHORT_VIDEOS_LIST_MAX_RETRIES:()=>r,SHORT_VIDEO_FETCH_GROUP_FIELDS:()=>a,SHORT_VIDEO_FETCH_OWNER_FIELDS:()=>n,SHORT_VIDEO_FETCH_USER_FIELDS:()=>o});const s=2,r=3,o=["photo_50","photo_100","photo_200","photo_400","is_nft","about","description","followers_count","is_closed","verified","screen_name","friend_status","is_subscribed","followers_count","blacklisted","domain","sex","can_write_private_message","first_name_gen","last_name_gen","first_name_acc"],a=["photo_50","photo_100","photo_200","photo_400","is_nft_photo","description","verified","screen_name","admin_level","member_status","members_count","is_subscribed","is_closed","is_member","ban_info","can_message"],n=Array.from(new Set([...o,...a]))},474436:(e,t,i)=>{i.d(t,{ShortVideoFeedNewsVideosProvider:()=>u});var s=i(331635),r=i(882044),o=i(765905),a=i(327813),n=i(132028),d=i(632520),c=i(914492),h=i(845758),l=i(340514);class u{async fetch(e){const{items:t,groups:i,profiles:s,next_from:r}=await this.feedApi.getNewsFeed(e),o=t.flatMap((e=>e?.clip?.items)).filter(Boolean);let n=[];if(o.length){const t=(await this.videoApi.get({videos:o.map(l.getRawIdFromVideo).join(","),fields:e.fields})).items.reduce(((e,t)=>Object.assign(e,{[(0,l.getRawIdFromVideo)(t)]:t})),{});n=o.map((e=>({...e,...t[(0,l.getRawIdFromVideo)(e)]})))}return(0,a.runInAction)((()=>{n.forEach((e=>this.shortVideoVideosProvider.addVideoFromApi(e))),i?.forEach((e=>this.shortVideoOwnersProvider.addGroupFromApi(e))),s?.forEach((e=>this.shortVideoOwnersProvider.addOwnerFromApi(e)))})),{items:n,next_from:r,count:0}}createList(e){return new h.ShortVideoFeed(e,{request:this.fetch.bind(this)})}constructor(e,t,i,s){this.videoApi=e,this.feedApi=t,this.shortVideoOwnersProvider=i,this.shortVideoVideosProvider=s,(0,a.makeAutoObservable)(this)}}u=(0,s.__decorate)([n.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===r.VideoApi?Object:r.VideoApi,void 0===o.FeedApi?Object:o.FeedApi,void 0===c.ShortVideoOwnersProvider?Object:c.ShortVideoOwnersProvider,void 0===d.ShortVideoVideosProvider?Object:d.ShortVideoVideosProvider])],u)},338454:(e,t,i)=>{i.d(t,{ShortVideoFeedOwnerVideosProvider:()=>h});var s=i(331635),r=i(413206),o=i(132028),a=i(327813),n=i(632520),d=i(914492),c=i(845758);class h{async fetch(e){const t=await this.shortVideosApi.getOwnerVideos(e);return(0,a.runInAction)((()=>{t.items.forEach((e=>this.shortVideoVideosProvider.addVideoFromApi(e))),t.groups?.forEach((e=>this.shortVideoOwnersProvider.addGroupFromApi(e))),t.profiles?.forEach((e=>this.shortVideoOwnersProvider.addOwnerFromApi(e)))})),t}createList(e){return new c.ShortVideoFeed(e,{request:this.fetch.bind(this)})}constructor(e,t,i){this.shortVideosApi=e,this.shortVideoOwnersProvider=t,this.shortVideoVideosProvider=i,(0,a.makeAutoObservable)(this)}}h=(0,s.__decorate)([o.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===r.ShortVideoApi?Object:r.ShortVideoApi,void 0===d.ShortVideoOwnersProvider?Object:d.ShortVideoOwnersProvider,void 0===n.ShortVideoVideosProvider?Object:n.ShortVideoVideosProvider])],h)},989066:(e,t,i)=>{i.d(t,{ShortVideoFeedSearchCatalogProvider:()=>p});var s=i(331635),r=i(327813),o=i(132028),a=i(603025),n=i(873900),d=i(24516),c=i(52016),h=i(845758),l=i(632520),u=i(914492);class p{async fetch(e){try{const{block:t,videos:i,groups:s,profiles:o}=await this.catalogApi.getBlockItems({...e,count:e.start_from?e.count:this.initialRequestCount});if(!t?.videos_ids||!i)return{count:0,items:[]};(0,r.runInAction)((()=>{i.forEach((e=>this.shortVideoVideosProvider.addVideoFromApi(e))),s?.forEach((e=>this.shortVideoOwnersProvider.addGroupFromApi(e))),o?.forEach((e=>this.shortVideoOwnersProvider.addOwnerFromApi(e)))}));const a=t.videos_ids.map(((e,t)=>i[t]&&e===(0,n.getIdentityRawId)({id:i[t].id??0,ownerId:i[t].owner_id??0})?i[t]:i.find((t=>e===(0,n.getIdentityRawId)({id:t.id??0,ownerId:t.owner_id??0}))))).filter((e=>Boolean(e)));return{items:a,count:a.length,next_from:t.next_from}}catch(e){if((0,a.isApiError)(e)&&104===e.error.error_code)return{count:0,items:[]};throw e}}createList(e){return new h.ShortVideoFeed(e,{request:this.fetch.bind(this)})}constructor(e,t,i,s){this.userEnv=e,this.catalogApi=t,this.shortVideoOwnersProvider=i,this.shortVideoVideosProvider=s,this.initialRequestCount=this.userEnv.partConfigEnabled("search_clips_block_count_min")?30:50,(0,r.makeAutoObservable)(this)}}p=(0,s.__decorate)([o.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===d.UserEnv?Object:d.UserEnv,void 0===c.CatalogApi?Object:c.CatalogApi,void 0===u.ShortVideoOwnersProvider?Object:u.ShortVideoOwnersProvider,void 0===l.ShortVideoVideosProvider?Object:l.ShortVideoVideosProvider])],p)},534871:(e,t,i)=>{i.d(t,{ShortVideoFeedSearchVideosProvider:()=>u});var s=i(331635),r=i(413206),o=i(52016),a=i(327813),n=i(132028),d=i(632520),c=i(914492),h=i(845758),l=i(110343);class u{async fetch(e){return this.sectionId&&e.start_from?this.fetchSection({start_from:e.start_from,section_id:this.sectionId}):this.fetchCatalog(e)}async fetchCatalog(e){const t=await this.catalogApi.getShortVideoSearch(e),i=t.catalog?.sections?.[0].blocks?.filter((e=>"videos"===e.data_type));if(!i?.[0]?.videos_ids)throw new Error("No videos_ids in catalog search");const s=await this.shortVideoVideosProvider.fetch({videos:i[0].videos_ids.join(","),fields:l.SHORT_VIDEO_FETCH_OWNER_FIELDS.join(","),extended:1});return(0,a.runInAction)((()=>{this.sectionId=t.catalog?.sections?.[0].id??""})),{items:s.items,next_from:t.catalog?.sections[0].next_from,count:s.count}}async fetchSection(e){const t=await this.catalogApi.getSection(e),i=t.section?.blocks?.filter((e=>"videos"===e.data_type));if(!i?.[0]?.videos_ids)throw new Error("No videos_ids in catalog section");const s=await this.shortVideoVideosProvider.fetch({videos:i[0].videos_ids.join(","),fields:l.SHORT_VIDEO_FETCH_OWNER_FIELDS.join(","),extended:1});return{items:s.items,next_from:t.section?.next_from??"",count:s.count}}createList(e){return new h.ShortVideoFeed(e,{request:this.fetch.bind(this)})}constructor(e,t,i,s){this.shortVideosApi=e,this.catalogApi=t,this.shortVideoOwnersProvider=i,this.shortVideoVideosProvider=s,this.sectionId="",(0,a.makeAutoObservable)(this)}}u=(0,s.__decorate)([n.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===r.ShortVideoApi?Object:r.ShortVideoApi,void 0===o.CatalogApi?Object:o.CatalogApi,void 0===c.ShortVideoOwnersProvider?Object:c.ShortVideoOwnersProvider,void 0===d.ShortVideoVideosProvider?Object:d.ShortVideoVideosProvider])],u)},876922:(e,t,i)=>{i.d(t,{ShortVideoFeedTopVideosProvider:()=>h});var s=i(331635),r=i(413206),o=i(327813),a=i(132028),n=i(632520),d=i(914492),c=i(845758);class h{async fetch(e){const t=await this.shortVideosApi.getTopVideos(e);return(0,o.runInAction)((()=>{t.items.forEach((e=>this.shortVideoVideosProvider.addVideoFromApi(e))),t.groups?.forEach((e=>this.shortVideoOwnersProvider.addGroupFromApi(e))),t.profiles?.forEach((e=>this.shortVideoOwnersProvider.addOwnerFromApi(e)))})),t}createList(e){return new c.ShortVideoFeed(e,{request:this.fetch.bind(this)})}constructor(e,t,i){this.shortVideosApi=e,this.shortVideoOwnersProvider=t,this.shortVideoVideosProvider=i,(0,o.makeAutoObservable)(this)}}h=(0,s.__decorate)([a.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===r.ShortVideoApi?Object:r.ShortVideoApi,void 0===d.ShortVideoOwnersProvider?Object:d.ShortVideoOwnersProvider,void 0===n.ShortVideoVideosProvider?Object:n.ShortVideoVideosProvider])],h)},845758:(e,t,i)=>{i.d(t,{ShortVideoFeed:()=>a});var s=i(327813),r=i(110343),o=i(340514);class a{reset(){this.abortController?.abort(),this.resetState()}resetState(){this.ids.clear(),this.isLoading=!1,this.fullyLoaded=!1,this.nextFrom="",this.abortController=null}async request(e){this.isLoading=!0,this.abortController=new AbortController;try{const t=await this.provider.request({...e,...this.nextFrom?{start_from:this.nextFrom}:{}},{signal:this.abortController.signal});return(0,s.runInAction)((()=>{this.isLoading=!1,this.abortController=null,this.nextFrom=t.next_from??"",this.count=t.count,this.fullyLoaded=!Boolean(t.next_from),t.items.map(o.getRawIdFromVideo).forEach((e=>this.ids.add(e)))})),this.retryIfNeeded(t)}catch(e){throw(0,s.runInAction)((()=>{this.isLoading=!1,this.abortController=null,this.error=e})),e}}async fetch(){if(!this.isLoading&&!this.fullyLoaded)return this.request(this.requestParams)}async retryIfNeeded(e){return!e.items.length&&this.retryCount<r.GET_SHORT_VIDEOS_LIST_MAX_RETRIES?((0,s.runInAction)((()=>{this.retryCount=e.next_from?1:this.retryCount+1})),await this.fetch()):((0,s.runInAction)((()=>{this.retryCount=0})),e)}constructor(e,t){this.requestParams=e,this.provider=t,this.abortController=null,this.nextFrom="",this.retryCount=0,this.ids=new Set,this.count=0,this.isLoading=!1,this.fullyLoaded=!1,this.error=null,(0,s.makeAutoObservable)(this)}}},340514:(e,t,i)=>{i.d(t,{getRawIdFromVideo:()=>r});var s=i(873900);const r=e=>(0,s.getIdentityRawId)({id:e.id??0,ownerId:e.owner_id??0})},92424:(e,t,i)=>{i.d(t,{ShortVideoOwnerCountersService:()=>h});var s=i(331635),r=i(327813),o=i(132028),a=i(33305),n=i(468073),d=i(488709),c=i(962005);class h{addCountersFromApi(e){if(e.counters){const{clips_followers:t,clips_views:i,clips_likes:s}=e.counters,r=(0,a.isOwnerUser)(e)?e.id:n.Ranges.convertGroupIdToOwnerId(e.id);this.countersMap.set(r,{clips_followers:t,clips_views:i,clips_likes:s})}}get(e){return this.countersMap.get(e)}isPending(e){return this.pendingSet.has(e)}async ensure(e){if(!this.countersMap.get(e)&&!this.pendingSet.has(e)){this.pendingSet.add(e);try{if(n.Ranges.isUserId(e)){(await this.usersApi.get({user_ids:`${e}`,fields:"counters"})).map((e=>this.addCountersFromApi(e)))}else{const t=await this.groupsApi.getById({group_ids:`${n.Ranges.convertOwnerIdToGroupId(e)}`,fields:"counters"});t.groups?.map((e=>this.addCountersFromApi(e)))}}finally{(0,r.runInAction)((()=>{this.pendingSet.delete(e)}))}}}constructor(e,t){this.usersApi=e,this.groupsApi=t,this.countersMap=new Map,this.pendingSet=new Set,(0,r.makeAutoObservable)(this)}}h=(0,s.__decorate)([o.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===d.UsersApi?Object:d.UsersApi,void 0===c.GroupsApi?Object:c.GroupsApi])],h)},914492:(e,t,i)=>{i.d(t,{ShortVideoOwnersProvider:()=>C});var s=i(331635),r=i(327813),o=i(831505),a=i(132028),n=i(603025),d=i(468073),c=i(488709),h=i(962005),l=i(21632),u=i(951652),p=i(24516),g=i(903723),m=i(276289),v=i(317245),_=i(89933),y=i(110343),S=i(863671),f=i(464527),b=i(92424);class C{addOwnerFromApi(e){const t=e.id,i=new v.ShortVideoUserOwner(t,e,this.usersSubscribeService,this.authService);this.ownersMap.set(t,i),e.screen_name&&this.ownersByScreenNameMap.set(e.screen_name,i),e.friend_status&&this.usersSubscribeService.setSubscriptionStatus(t,e.friend_status),this.ownerCountersService.addCountersFromApi(e)}addGroupFromApi(e){const t=d.Ranges.convertGroupIdToOwnerId(e.id),i=new _.ShortVideoGroupOwner(t,e,this.groupsSubscribeService);this.groupsProvider.createGroupFromApi({apiGroup:e,fields:""}),this.ownersMap.set(t,i),e.screen_name&&this.ownersByScreenNameMap.set(e.screen_name,i),this.ownerCountersService.addCountersFromApi(e)}async ensure(e){const t=this.get(e);return t||this.isError(e)?t:this.fetch(e)}async fetch(e){if(this.userEnv.partConfigEnabled("clips_use_screenname_resolver"))try{this.pendingSet.add(e),this.errorMap.delete(e);const t="string"==typeof e?await this.resolveScreenName(e):this.resolveOwnerId(e);if(!t)return;switch(t.entityType){case"user":await this.fetchUser(t.entityId);break;case"group":await this.fetchGroup(t.entityId)}return this.get(e)}catch(t){throw(0,r.runInAction)((()=>{this.errorMap.set(e,t)})),new Error("Error fetch owner",{cause:t})}finally{(0,r.runInAction)((()=>{this.pendingSet.delete(e)}))}try{return this.pendingSet.add(e),this.errorMap.delete(e),"number"==typeof e?d.Ranges.isGroupId(e)?await this.fetchGroupOld(e):await this.fetchUserOld(e):await Promise.all([this.fetchUserOld(e),this.fetchGroupOld(e)]),(0,r.runInAction)((()=>{this.pendingSet.delete(e)})),this.get(e)}catch(t){throw(0,r.runInAction)((()=>{this.pendingSet.delete(e),this.errorMap.set(e,t)})),new Error("Error fetch owner",{cause:t})}}get(e){return"string"==typeof e?this.ownersByScreenNameMap.get(e):this.ownersMap.get(e)}isPending(e){return Boolean(this.pendingSet.has(e))}isError(e){return Boolean(this.errorMap.get(e))}async fetchUserOld(e){const t=await this.usersApi.get({user_ids:`${e}`,fields:y.SHORT_VIDEO_FETCH_USER_FIELDS.join(",")});(0,r.runInAction)((()=>{t.forEach((e=>this.addOwnerFromApi(e)))}))}async fetchUser(e){const t=await this.usersApi.get({user_ids:`${e}`,fields:y.SHORT_VIDEO_FETCH_USER_FIELDS.join(",")});(0,r.runInAction)((()=>{t.forEach((e=>this.addOwnerFromApi(e)))}))}async fetchGroupOld(e){try{const t=await this.groupsApi.getById({group_ids:"number"==typeof e?`${d.Ranges.convertOwnerIdToGroupId(e)}`:e,fields:y.SHORT_VIDEO_FETCH_GROUP_FIELDS.join(",")});(0,r.runInAction)((()=>{t.groups?.forEach((e=>this.addGroupFromApi(e)))}))}catch(t){if(!("string"==typeof e&&t instanceof Error&&(0,n.isApiError)(t)&&t.error.error_code===o.API_ERROR_PARAM))throw new Error("Error fetch group",{cause:t})}}async fetchGroup(e){const t=await this.groupsApi.getById({group_ids:e.toString(),fields:y.SHORT_VIDEO_FETCH_GROUP_FIELDS.join(",")});(0,r.runInAction)((()=>{t.groups?.forEach((e=>this.addGroupFromApi(e)))}))}async updateDescription(e,t){d.Ranges.isGroupId(e)?(await this.groupsProvider.groupEdit({group_id:d.Ranges.convertOwnerIdToGroupId(e),description:t}),await(this.userEnv.partConfigEnabled("clips_use_screenname_resolver")?this.fetchGroup(e):this.fetchGroupOld(e))):(await this.accountApi.saveInfo({about:t}),await(this.userEnv.partConfigEnabled("clips_use_screenname_resolver")?this.fetchUser(e):this.fetchUserOld(e)))}async resolveScreenName(e){const t=await this.screenNameResolver.ensureMatch({screenName:e,screenTypes:["user","group"]});return t&&{entityId:t.entityId,entityType:t.screenType}}resolveOwnerId(e){return d.Ranges.isGroupId(e)?{entityId:d.Ranges.convertOwnerIdToGroupId(e),entityType:"group"}:{entityId:e,entityType:"user"}}constructor(e,t,i,s,o,a,n,d,c,h){this.groupsProvider=e,this.groupsSubscribeService=t,this.usersSubscribeService=i,this.usersApi=s,this.groupsApi=o,this.accountApi=a,this.authService=n,this.screenNameResolver=d,this.userEnv=c,this.ownerCountersService=h,this.ownersMap=new Map,this.ownersByScreenNameMap=new Map,this.pendingSet=new Set,this.errorMap=new Map,(0,r.makeAutoObservable)(this)}}C=(0,s.__decorate)([a.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g.GroupsProvider?Object:g.GroupsProvider,void 0===m.GroupsSubscribeService?Object:m.GroupsSubscribeService,void 0===S.UserSubscribeService?Object:S.UserSubscribeService,void 0===c.UsersApi?Object:c.UsersApi,void 0===h.GroupsApi?Object:h.GroupsApi,void 0===l.AccountApi?Object:l.AccountApi,void 0===u.AuthService?Object:u.AuthService,void 0===f.ScreenNameResolver?Object:f.ScreenNameResolver,void 0===p.UserEnv?Object:p.UserEnv,void 0===b.ShortVideoOwnerCountersService?Object:b.ShortVideoOwnerCountersService])],C)},89933:(e,t,i)=>{i.d(t,{ShortVideoGroupOwner:()=>o});var s=i(327813),r=i(831505);class o{get isSubscribed(){switch(this.groupsSubscribeService.getMemberStatus(this.data.id)){case r.GroupsGroupFullMemberStatusEnumNames.MEMBER:case r.GroupsGroupFullMemberStatusEnumNames.HAS_SENT_A_REQUEST:return!0;default:return!1}}get isPendingSubscription(){return this.groupsSubscribeService.getIsLoading(this.data.id)}async subscribe(){return await this.groupsSubscribeService.join({group_id:this.data.id}),!0}async unsubscribe(){return await this.groupsSubscribeService.leave({group_id:this.data.id}),!0}get name(){return this.data.name??""}get screenName(){return this.data.screen_name||`club${this.data.id}`}get isAdmin(){return this.data.admin_level===r.GroupsGroupAdminLevelEnumNames.ADMINISTRATOR}get followersCount(){return this.data.members_count??0}get canSubscribe(){return!Boolean(this.data.is_closed)}get description(){return this.data.description??""}constructor(e,t,i){this.ownerId=e,this.data=t,this.groupsSubscribeService=i,(0,s.makeAutoObservable)(this)}}},317245:(e,t,i)=>{i.d(t,{ShortVideoUserOwner:()=>r});var s=i(327813);class r{get isSubscribed(){return this.usersSubscribeService.getIsSubscribed(this.data.id)}get isPendingSubscription(){return this.usersSubscribeService.getIsLoading(this.data.id)}async subscribe(){return await this.usersSubscribeService.subscribe({user_id:this.data.id}),!0}async unsubscribe(){return await this.usersSubscribeService.unsubscribe({user_id:this.data.id}),!0}get name(){return[this.data.first_name,this.data.last_name].filter(Boolean).join(" ").trim()}get screenName(){return this.data.screen_name||`id${this.data.id}`}get isAdmin(){return this.data.id===this.authService.userId}get followersCount(){return this.data.followers_count??0}get canSubscribe(){return this.data.id!==this.authService.userId}get description(){return this.data.about??""}constructor(e,t,i,r){this.ownerId=e,this.data=t,this.usersSubscribeService=i,this.authService=r,(0,s.makeAutoObservable)(this)}}},681280:(e,t,i)=>{i.d(t,{ShortVideoRestrictions:()=>l});var s=i(331635),r=i(327813),o=i(951652),a=i(24516),n=i(132028),d=i(67914),c=i(616491),h=i(591245);class l{isRestrictionDisabled(e){return this.restrictionsDisabledLocally||this.removedRestrictionsList.has(e)||this.restrictionsStorage.hasVideo(e)}setResetTimer(e){this.timer=setTimeout((()=>{const e=this.restrictionsStorage.getTimestamp();e&&"Invalid Date"!==new Date(e).toString()&&this.reset()}),e)}syncLocalStorage(){const e=this.restrictionsStorage.getTimestamp(),t=this.restrictionsStorage.getVideoIds();if(!e)return 0!==t.length?this.reset():void 0;if("Invalid Date"===new Date(e).toString())return this.reset();const i=e+h.ONE_DAY_IN_MS-Date.now();if(i<0)return this.reset();this.setResetTimer(i);for(const e of t)this.removedRestrictionsList.add(e);t.length>=h.COUNT_OF_REQUIRED_RESTRICTIONS&&(this.restrictionsDisabledLocally=!0)}reset(){this.restrictionsStorage.reset(),this.removedRestrictionsList.clear(),this.restrictionsDisabledLocally=!1}constructor(e,t,i,s){this.restrictionsStorage=e,this.restrictionsSynchronization=t,this.authService=i,this.userEnv=s,this.removedRestrictionsList=new Set,this.timer=null,this.restrictionsDisabledLocally=!1,this.disableRestriction=async e=>{const t=this.restrictionsStorage.getVideoIds();if(!t.includes(e))if(this.authService.isAuthorized){t.length||(this.restrictionsStorage.setTimestamp(Date.now()),this.setResetTimer(h.ONE_DAY_IN_MS)),this.restrictionsStorage.addVideoId(e);this.restrictionsStorage.getVideoIds().length>=h.COUNT_OF_REQUIRED_RESTRICTIONS&&!this.restrictionsDisabledLocally&&(await this.restrictionsSynchronization.disableRestriction(e),(0,r.runInAction)((()=>{this.restrictionsDisabledLocally=!0})));(0,r.runInAction)((()=>{this.removedRestrictionsList.add(e)}))}else this.removedRestrictionsList.add(e)},(0,r.makeAutoObservable)(this),this.syncLocalStorage()}}l=(0,s.__decorate)([n.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===d.ShortVideoRestrictionsStorage?Object:d.ShortVideoRestrictionsStorage,void 0===c.ShortVideoRestrictionsSynchronization?Object:c.ShortVideoRestrictionsSynchronization,void 0===o.AuthService?Object:o.AuthService,void 0===a.UserEnv?Object:a.UserEnv])],l)},591245:(e,t,i)=>{i.d(t,{COUNT_OF_REQUIRED_RESTRICTIONS:()=>r,ONE_DAY_IN_MS:()=>s});const s=864e5,r=3},67914:(e,t,i)=>{i.d(t,{ShortVideoRestrictionsStorage:()=>d});var s=i(331635),r=i(327813),o=i(132028),a=i(510454),n=i(951652);class d{getVideoIds(){return JSON.parse(this.storage.getItem(this.idsKey)??"[]")}addVideoId(e){const t=this.getVideoIds();t.includes(e)||(t.push(e),this.storage.setItem(this.idsKey,JSON.stringify(t)))}hasVideo(e){return this.getVideoIds().includes(e)}setTimestamp(e){this.storage.setItem(this.timestampKey,String(e))}getTimestamp(){const e=this.storage.getItem(this.timestampKey);return e?Number(e):void 0}reset(){this.storage.removeItem(this.idsKey),this.storage.removeItem(this.timestampKey)}get idsKey(){return`clips-restrictions-ids-${String(this.authService.userId)}`}get timestampKey(){return`clips-restrictions-timestamp-${String(this.authService.userId)}`}constructor(e,t){this.storage=e,this.authService=t,(0,r.makeAutoObservable)(this)}}d=(0,s.__decorate)([o.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.LocalStorage?Object:a.LocalStorage,void 0===n.AuthService?Object:n.AuthService])],d)},616491:(e,t,i)=>{i.d(t,{ShortVideoRestrictionsSynchronization:()=>n});var s=i(331635),r=i(132028),o=i(882044),a=i(768035);class n{async disableRestriction(e){const{id:t,ownerId:i}=(0,a.parseRawId)(e);return this.videoApi.agreeDisclaimer({owner_id:i,video_id:t})}constructor(e){this.videoApi=e}}n=(0,s.__decorate)([r.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.VideoApi?Object:o.VideoApi])],n)},291566:(e,t,i)=>{i.d(t,{ShortVideoStatsTokenService:()=>h});var s=i(331635),r=i(132028),o=i(882044),a=i(510454),n=i(627876),d=i(327813);const c="short_video_auth_token";class h{saveToStorage(e){this.localStorage.setItem(c,e)}getFromStorage(){return this.localStorage.getItem(c)}async getFromApi({refresh:e=!1}={}){const t={force_refresh:e?1:0},i=await this.videoApi.getStatsToken(t);if(i)return this.saveToStorage(i.token),i.token}async getToken(e={}){return e.refresh?await this.getFromApi(e):this.getFromStorage()??await this.getFromApi(e)}async trackOneStatError(e){const t=e instanceof Error?e.name:String(e);this.statlog.send({name:"video_player_insignificant_network_error",value:"onestat",keys:[t]})}constructor(e,t,i){this.videoApi=e,this.localStorage=t,this.statlog=i,(0,d.makeAutoObservable)(this)}}h=(0,s.__decorate)([r.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.VideoApi?Object:o.VideoApi,void 0===a.LocalStorage?Object:a.LocalStorage,void 0===n.Statlog?Object:n.Statlog])],h)},677767:(e,t,i)=>{i.d(t,{DAU:()=>d});var s=i(331635),r=i(132028),o=i(571355),a=i(749216),n=i(327813);class d{increment(e){this.myTracker.ensureActivityCounter({activityId:e,timespentType:"screen",strict:!0}).increment()}viewEvent(){this.increment(o.MyTrackerActivityId.ClipViewDAU)}publishEvent(){this.increment(o.MyTrackerActivityId.ClipPublishDAU)}effectiveActiveUserEvent(e){e&&(0,n.runInAction)((()=>{this.viewedIds.add(e),!this.effectiveActiveUserEventSent&&this.viewedIds.size>=3&&(this.increment(o.MyTrackerActivityId.ClipViewScrollDAU),this.effectiveActiveUserEventSent=!0)}))}constructor(e){this.myTracker=e,this.viewedIds=new Set,this.effectiveActiveUserEventSent=!1,(0,n.makeAutoObservable)(this)}}d=(0,s.__decorate)([r.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.MyTracker?Object:a.MyTracker])],d)},327646:(e,t,i)=>{i.d(t,{ShortVideoPlayerStatsHandlersStore:()=>n});var s=i(327813),r=i(818298),o=i(965632),a=i(985132);class n{get statEventData(){return this.video?{context:this.context,e:"video_event",eventType:o.ShortVideoStatEventType.VIDEO,ov_id:this.video.data.ov_id??"",ref:this.statsRef,track_code:this.video.data.track_code??"",ts:Math.trunc(Date.now()/1e3),video_id:this.video.rawId}:null}get statPlayData(){if(!this.video||!this.isPlaying||this.isVideoEnded)return null;const e=(0,r.getScreenInfo)();return{autoplay:this.autoplay?1:0,bitrate:this.videoMeta.videoBitrate??0,context:this.context,e:"video_play",eventType:o.ShortVideoStatEventType.PLAY,media_provider:this.videoMeta.videoFormat,ov_id:this.video.data.ov_id??"",player_type:this.playerType,quality:"auto",ref:this.statsRef,speed:"normal",stall_count:this.videoStalled.stalledCount??0,stall_duration:this.videoStalled.stalledDuration??0,track_code:this.video.data.track_code??"",ts:Math.trunc(Date.now()/1e3),video_id:this.video.rawId,volume:this.isMuted?0:100,is_sub_enabled:0,cur_quality:(0,a.corePlayerQualityToStatsQuality)(this.videoMeta.curVideoQuality)||"unknown",screen_orientation:e.orientation.includes("portrait")?"portrait":"landscape",screen_pixels_h:e.height,screen_pixels_w:e.width,is_portrait_only:0,is_traffic_economy:0,network_type:"unknown",screen_crop:"unknown",screen_dpi:0,source:"clips"}}get timeSpentTracker(){return"inline"===this.playerType?this.timespent.playing:this.timespent.fullScreen}get playerHandlers(){return{onStalledChanged:this.onStalledChanged,onVideoCurQualityChanged:this.onVideoCurQualityChanged,onDurationChanged:this.onDurationChanged,onPositionChanged:this.onPositionChanged,onVideoFormatChanged:this.onVideoFormatChanged,onVideoBitrateChanged:this.onVideoBitrateChanged,onFirstBytes:this.onFirstBytes,onFirstFrame:this.onFirstFrame,onStarted:this.onStarted,onEnded:this.onEnded,onPlaying:this.onPlaying,onPaused:this.onPaused,onMutedChanged:this.onMutedChanged,onError:this.onError}}constructor(e,t=!0,i,r="carousel",n,d,c){this.video=e,this.autoplay=t,this.statsRef=i,this.playerType=r,this.track=n,this.dau=d,this.timespent=c,this.isMuted=!0,this.isPlaying=!1,this.lastTrackedPositions=[],this.isVideoEnded=!1,this.context="",this.bufferedEvents=[],this.videoStalled={stalledCount:0,stalledDuration:0},this.stalledInterval=null,this.videoMeta={},this.onFirstBytes=e=>{this.statEventData&&this.bufferedEvents.push({...this.statEventData,event:"first_bytes",value:e})},this.onFirstFrame=e=>{this.statEventData&&this.bufferedEvents.push({...this.statEventData,event:"first_frame",value:e})},this.onStarted=()=>{this.onPlaying(),this.statPlayData&&(this.track.trackEvents([...this.bufferedEvents,{...this.statPlayData,position:"start",position_sec:0}]),this.bufferedEvents=[])},this.onPlaying=()=>{this.isPlaying||(this.isPlaying=!0,this.timeSpentTracker.start())},this.onPaused=()=>{this.isPlaying&&(this.isPlaying=!1,this.timeSpentTracker.end())},this.onMutedChanged=e=>{this.isMuted=e},this.onPositionChanged=e=>{if(this.statPlayData&&void 0!==e&&void 0!==this.videoMeta.videoDuration){const t=(0,a.secondsPositionToTrackPositions)(e,this.videoMeta.videoDuration);if(!t.length||t.length===this.lastTrackedPositions.length)return;const i=t.filter((e=>!this.lastTrackedPositions.includes(e)));i.length&&this.track.trackEvents(i.map((t=>Object.assign({},this.statPlayData,{position:t,position_sec:Math.trunc(e)})))),this.lastTrackedPositions=[...t]}},this.onEnded=()=>{this.isVideoEnded||(this.videoMeta.videoDuration&&this.onPositionChanged(this.videoMeta.videoDuration),this.dau.viewEvent()),this.isVideoEnded=!0},this.onStalledChanged=e=>{e?(this.videoStalled.stalledCount+=1,this.stalledInterval=setInterval((()=>{this.videoStalled.stalledDuration+=1}),1e3)):this.stalledInterval&&clearInterval(this.stalledInterval)},this.onVideoCurQualityChanged=e=>{this.videoMeta.curVideoQuality=e},this.onDurationChanged=e=>{this.videoMeta.videoDuration=e},this.onVideoFormatChanged=e=>{this.videoMeta.videoFormat=e},this.onVideoBitrateChanged=e=>{this.videoMeta.videoBitrate=e?1e3*e:void 0},this.onError=(e,t)=>{this.video&&this.track.trackEvents([{eventType:o.ShortVideoStatEventType.VIDEO_ERROR,ref:"clips",host:t,provider:this.videoMeta.videoFormat??"",code:e.id,quality:(0,a.corePlayerQualityToStatsQuality)(this.videoMeta.curVideoQuality),is_auto_quality:1}])},this.context=this.statsRef===o.ShortVideoPlayerStatsRef.OWNER&&this.video?`profile:${this.video.data.owner_id}`:i,(0,s.makeAutoObservable)(this)}}},292202:(e,t,i)=>{i.d(t,{ShortVideoStatsService:()=>h});var s=i(331635),r=i(132028),o=i(327813),a=i(327646),n=i(677767),d=i(720118),c=i(472086);class h{getPlayerStatsHandlersStore(e,t){let i=this.playerStatsHandlersStoreMap.get(e);if(!i){const{video:s,autoplay:r,statsRef:o,playerType:n}=t;i=new a.ShortVideoPlayerStatsHandlersStore(s,r,o,n,this.track,this.dau,this.timespent),this.playerStatsHandlersStoreMap.set(e,i)}return i}resetPlayerStatsHandlersStore(e){this.playerStatsHandlersStoreMap.delete(e)}constructor(e,t,i){this.dau=e,this.timespent=t,this.track=i,this.playerStatsHandlersStoreMap=new Map,(0,o.makeAutoObservable)(this)}}h=(0,s.__decorate)([r.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.DAU?Object:n.DAU,void 0===d.Timespent?Object:d.Timespent,void 0===c.Track?Object:c.Track])],h)},720118:(e,t,i)=>{i.d(t,{Timespent:()=>c});var s=i(331635),r=i(132028),o=i(327813),a=i(168018),n=i(262853),d=i(469291);class c{constructor(e,t,i){this.playing=e,this.section=t,this.fullScreen=i,(0,o.makeAutoObservable)(this)}}c=(0,s.__decorate)([r.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.PlayingTimespent?Object:a.PlayingTimespent,void 0===n.SectionTimespent?Object:n.SectionTimespent,void 0===d.FullScreenTimespent?Object:d.FullScreenTimespent])],c)},472086:(e,t,i)=>{i.d(t,{Track:()=>h});var s=i(331635),r=i(132028),o=i(327813),a=i(995340),n=i(951652),d=i(627876),c=i(965632);class h{apiTrackEvents(e){return this.statsApi.trackEvents({events:JSON.stringify(e)})}videoErrorEvents(e){e.forEach((e=>{this.statLog.send({name:"video_player_error",value:e})}))}constructor(e,t,i){this.statsApi=e,this.authService=t,this.statLog=i,this.trackEvents=e=>{if(!this.authService.isAuthorized)return;const t=e.filter((({eventType:e})=>[c.ShortVideoStatEventType.PLAY,c.ShortVideoStatEventType.VIDEO].includes(e)));t.length&&this.apiTrackEvents(t);const i=e.filter((({eventType:e})=>[c.ShortVideoStatEventType.VIDEO_ERROR].includes(e)));i.length&&this.videoErrorEvents(i)},(0,o.makeAutoObservable)(this)}}h=(0,s.__decorate)([r.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.StatsApi?Object:a.StatsApi,void 0===n.AuthService?Object:n.AuthService,void 0===d.Statlog?Object:d.Statlog])],h)},59443:(e,t,i)=>{i.d(t,{BaseTimespent:()=>r});var s=i(327813);class r{start(){this.statTypes.forEach((e=>this.timespentCollector.start(e)))}end(){this.statTypes.forEach((e=>this.timespentCollector.end(e)))}constructor(e,t){this.timespentCollector=e,this.statTypes=t,(0,s.makeObservable)(this)}}},469291:(e,t,i)=>{i.d(t,{FullScreenTimespent:()=>n});var s=i(331635),r=i(132028),o=i(59443),a=i(314629);class n extends o.BaseTimespent{constructor(e){super(e,[a.StatTimespentType.SHORT_VIDEO_PLAYING_FULL_SCREEN,a.StatTimespentType.SHORT_VIDEO_PLAYING])}}n=(0,s.__decorate)([r.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.TimespentService?Object:a.TimespentService])],n)},168018:(e,t,i)=>{i.d(t,{PlayingTimespent:()=>n});var s=i(331635),r=i(132028),o=i(59443),a=i(314629);class n extends o.BaseTimespent{constructor(e){super(e,[a.StatTimespentType.SHORT_VIDEO_PLAYING])}}n=(0,s.__decorate)([r.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.TimespentService?Object:a.TimespentService])],n)},262853:(e,t,i)=>{i.d(t,{SectionTimespent:()=>n});var s=i(331635),r=i(132028),o=i(59443),a=i(314629);class n extends o.BaseTimespent{constructor(e){super(e,[a.StatTimespentType.SHORT_VIDEO_SECTION])}}n=(0,s.__decorate)([r.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.TimespentService?Object:a.TimespentService])],n)},314629:(e,t,i)=>{i.d(t,{StatTimespentType:()=>d,TimespentService:()=>h});var s=i(331635),r=i(132028),o=i(571355),a=i(749216),n=i(327813),d=function(e){return e.SHORT_VIDEO_PLAYING="shortVideoPlayingTimespent",e.SHORT_VIDEO_SECTION="shortVideoSectionTimespent",e.SHORT_VIDEO_PLAYING_FULL_SCREEN="shortVideoPlayingFullScreenTimespent",e}({});const c={shortVideoPlayingTimespent:o.MyTrackerActivityId.ClipView,shortVideoPlayingFullScreenTimespent:o.MyTrackerActivityId.ClipViewFullScreen,shortVideoSectionTimespent:o.MyTrackerActivityId.ClipSection};class h{getCounter(e){return this.myTracker.ensureActivityCounter({activityId:c[e],timespentType:"screen",strict:!1})}start(e){this.getCounter(e).startTimespent()}end(e){this.getCounter(e).stopTimespent()}constructor(e){this.myTracker=e,(0,n.makeAutoObservable)(this)}}h=(0,s.__decorate)([r.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.MyTracker?Object:a.MyTracker])],h)},965632:(e,t,i)=>{i.d(t,{ShortVideoPlayerStatsRef:()=>r,ShortVideoStatEventType:()=>s,VideoQuality:()=>o});var s=function(e){return e.VIDEO="videoEvent",e.PLAY="playEvent",e.VIDEO_ERROR="video_error",e}({}),r=function(e){return e.TOP="clips_top",e.SUBSCRIPTIONS="clips_subscription",e.OWNER="clips_owner",e.FEED="feed",e.VIDEO="video",e.UNKNOWN="unknown",e}({}),o=function(e){return e.Q_144P="144p",e.Q_240P="240p",e.Q_360P="360p",e.Q_480P="480p",e.Q_720P="720p",e.Q_1080P="1080p",e.Q_1440P="1440p",e.Q_2160P="2160p",e.Q_4320P="4320p",e}({})},985132:(e,t,i)=>{i.d(t,{corePlayerQualityToStatsQuality:()=>a,secondsPositionToTrackPositions:()=>r});var s=i(965632);function r(e,t){const i=e/t*100,s=[];return e>=3&&s.push("3s"),e>=10&&s.push("10s"),i>=25&&s.push("25"),i>=50&&s.push("50"),i>=75&&s.push("75"),i>=95&&s.push("95"),i>=100&&s.push("100"),s}const o={[s.VideoQuality.Q_144P]:"144",[s.VideoQuality.Q_240P]:"240",[s.VideoQuality.Q_360P]:"360",[s.VideoQuality.Q_480P]:"480",[s.VideoQuality.Q_720P]:"720",[s.VideoQuality.Q_1080P]:"1080",[s.VideoQuality.Q_1440P]:"1440",[s.VideoQuality.Q_2160P]:"2160",[s.VideoQuality.Q_4320P]:"4320"};function a(e){return e&&o[e]?o[e]:0}},564616:(e,t,i)=>{i.d(t,{AudioClipsProvider:()=>o});var s=i(327813),r=i(222012);class o{getAudioClip(e){return this.data.audioClipsMap.get(e)}createAudioClipFromApi(e){const t=new r.AudioClip(e);return this.data.audioClipsMap.set(t.rawId,t),t}constructor(){this.data={audioClipsMap:new Map},(0,s.makeAutoObservable)(this)}}},222012:(e,t,i)=>{i.d(t,{AudioClip:()=>o});var s=i(327813),r=i(873900);class o{get rawId(){const{id:e,owner_id:t}=this.data;return(0,r.getIdentityRawId)({id:e,ownerId:t})}constructor(e){this.data=e,(0,s.makeAutoObservable)(this)}}},543116:(e,t,i)=>{i.d(t,{AudioClipsListsProvider:()=>c});var s=i(331635),r=i(327813),o=i(52016),a=i(132028),n=i(564616),d=i(42006);class c{createSearchList(){return new d.AudioClipsSearchList(this.audioClipsProvider,this.catalogApi)}constructor(e,t){this.audioClipsProvider=e,this.catalogApi=t,(0,r.makeAutoObservable)(this)}}c=(0,s.__decorate)([a.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.AudioClipsProvider?Object:n.AudioClipsProvider,void 0===o.CatalogApi?Object:o.CatalogApi])],c)},42006:(e,t,i)=>{i.d(t,{AudioClipsSearchList:()=>r});var s=i(327813);class r{get count(){return this.ids.length}get items(){const e=[];for(const t of this.ids){const i=this.audioClipsProvider.getAudioClip(t);if(!i)return e;e.push(i)}return e}reset(){this.abortController?.abort(),this.resetState()}resetState(){this.ids=[],this.isLoading=!1,this.initialLoad=!1,this.abortController=null}async request(e,t){const i=await this.catalogApi[e.query?"getAudioClipsSearch":"getAudioClips"]({query:e.query,need_blocks:1},{signal:t.signal}),s=i.short_video_audios?"short_video_audios":"audios";return{items:i[s]?.map((e=>this.audioClipsProvider.createAudioClipFromApi(e)))||[]}}async fetch(e){this.abortController&&this.abortController.abort(),this.resetState(),this.isLoading=!0,this.initialLoad||(this.initialLoad=!0),this.abortController=new AbortController;const t=await this.request(e,this.abortController);this.handleResponse(t)}handleResponse(e){this.ids=e.items.map((e=>e.rawId)),this.isLoading=!1,this.abortController=null}constructor(e,t){this.audioClipsProvider=e,this.catalogApi=t,this.ids=[],this.abortController=null,this.initialLoad=!1,this.isLoading=!1,(0,s.makeAutoObservable)(this)}}},509739:(e,t,i)=>{i.d(t,{ShortVideoDeleteService:()=>h});var s=i(331635),r=i(327813),o=i(132028),a=i(882044),n=i(413206),d=i(24516),c=i(768035);class h{get useShortVideoMethod(){return this.userEnv.partConfigEnabled("clips_use_short_video_methods_delete_restore")}isPending(e){return this.pendingSet.has(e)}isDeleted(e){return this.deletedSet.has(e)}getDeletedClips(){return Array.from(this.deletedSet.values())}async delete(e){if(this.isPending(e))return!1;try{const{id:t,ownerId:i}=(0,c.parseRawId)(e);this.pendingSet.add(e);const s=Boolean(this.useShortVideoMethod?await this.shortVideoApi.delete({video_id:t,owner_id:i}):await this.videoApi.delete({video_id:t,owner_id:i}));return(0,r.runInAction)((()=>{s&&this.deletedSet.add(e),this.pendingSet.delete(e)})),s}catch(t){throw(0,r.runInAction)((()=>{this.pendingSet.delete(e)})),new Error("Cannot delete video",{cause:t})}}async restore(e){if(this.isPending(e))return!1;try{const{id:t,ownerId:i}=(0,c.parseRawId)(e);this.pendingSet.add(e);const s=Boolean(this.useShortVideoMethod?await this.shortVideoApi.restore({short_video_raw_id:e}):await this.videoApi.restore({video_id:t,owner_id:i}));return(0,r.runInAction)((()=>{s&&this.deletedSet.delete(e),this.pendingSet.delete(e)})),s}catch(t){throw(0,r.runInAction)((()=>{this.pendingSet.delete(e)})),new Error("Cannot restore video",{cause:t})}}constructor(e,t,i){this.videoApi=e,this.shortVideoApi=t,this.userEnv=i,this.deletedSet=new Set,this.pendingSet=new Set,(0,r.makeAutoObservable)(this)}}h=(0,s.__decorate)([o.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.VideoApi?Object:a.VideoApi,void 0===n.ShortVideoApi?Object:n.ShortVideoApi,void 0===d.UserEnv?Object:d.UserEnv])],h)},905683:(e,t,i)=>{i.d(t,{ShortVideoLikeService:()=>h});var s=i(331635),r=i(132028),o=i(873900),a=i(768035),n=i(327813),d=i(413206),c=i(813682);class h{setValuesFromVideo(e){const t=(0,o.getIdentityRawId)({id:e.id??0,ownerId:e.owner_id??0});this.likesMap.set(t,{count:e.likes?.count??0,userLikes:Boolean(e.likes?.user_likes)}),e.track_code&&this.trackCodeMap.set(t,e.track_code)}isPending(e){return this.pendingSet.has(e)}getLikes(e){return this.likesMap.get(e)}isNotInterested(e){return this.notInterestedSet.has(e)}async setLike(e){if(!this.isPending(e))try{const{id:t,ownerId:i}=(0,a.parseRawId)(e);this.pendingSet.add(e);const s=await this.likesApi.add({type:"video",owner_id:i,item_id:t,track_code:this.getTrackCode(e)});(0,n.runInAction)((()=>{this.likesMap.set(e,{count:s.likes,userLikes:!0}),this.pendingSet.delete(e)})),this.isNotInterested(e)&&await this.resetNotInterested(e)}catch(t){throw(0,n.runInAction)((()=>{this.pendingSet.delete(e)})),new Error("Cannot like clip",{cause:t})}}async setDislike(e){if(!this.isPending(e))try{const{id:t,ownerId:i}=(0,a.parseRawId)(e);this.pendingSet.add(e);const s=await this.likesApi.delete({type:"video",owner_id:i,item_id:t,track_code:this.getTrackCode(e)});(0,n.runInAction)((()=>{this.likesMap.set(e,{count:s.likes,userLikes:!1}),this.pendingSet.delete(e)}))}catch(t){throw(0,n.runInAction)((()=>{this.pendingSet.delete(e)})),new Error("Cannot dislike clip",{cause:t})}}toggleLike(e){return this.getLikes(e)?.userLikes?this.setDislike(e):this.setLike(e)}async setNotInterested(e){if(this.isPending(e)||this.notInterestedSet.has(e))return!1;try{const{id:t,ownerId:i}=(0,a.parseRawId)(e);this.pendingSet.add(e);const s=await this.shortVideoApi.notInterested({video_id:t,owner_id:i,track_code:this.getTrackCode(e)});return(0,n.runInAction)((()=>{this.pendingSet.delete(e),this.notInterestedSet.add(e)})),this.likesMap.get(e)?.userLikes&&await this.setDislike(e),Boolean(s)}catch(t){throw(0,n.runInAction)((()=>{this.pendingSet.delete(e)})),new Error("Cannot mark clip as not interested",{cause:t})}}async resetNotInterested(e){if(this.isPending(e)||!this.notInterestedSet.has(e))return!1;try{const{id:t,ownerId:i}=(0,a.parseRawId)(e);this.pendingSet.add(e);const s=await this.shortVideoApi.notInterested({video_id:t,owner_id:i,unset:1,track_code:this.getTrackCode(e)});return(0,n.runInAction)((()=>{this.pendingSet.delete(e),this.notInterestedSet.delete(e)})),Boolean(s)}catch(t){throw(0,n.runInAction)((()=>{this.pendingSet.delete(e)})),new Error("Cannot unmark clip as not interested",{cause:t})}}toggleNotInterested(e){return this.isNotInterested(e)?this.resetNotInterested(e):this.setNotInterested(e)}getTrackCode(e){return this.trackCodeMap.get(e)??""}constructor(e,t){this.shortVideoApi=e,this.likesApi=t,this.pendingSet=new Set,this.likesMap=new Map,this.notInterestedSet=new Set,this.trackCodeMap=new Map,(0,n.makeAutoObservable)(this)}}h=(0,s.__decorate)([r.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===d.ShortVideoApi?Object:d.ShortVideoApi,void 0===c.LikesApi?Object:c.LikesApi])],h)},632520:(e,t,i)=>{i.d(t,{ShortVideoVideosProvider:()=>m});var s=i(331635),r=i(132028),o=i(327813),a=i(873900),n=i(882044),d=i(413206),c=i(692464),h=i(991665),l=i(914492),u=i(509739),p=i(905683),g=i(110343);class m{addVideoFromApi(e){const t=new c.ShortVideoVideo((0,h.mapVideoToShortVideoVideo)(e),this.shortVideoOwnersProvider,this.shortVideoDeleteService);this.videoMap.set(t.rawId,t),this.shortVideoLikeService.setValuesFromVideo(e)}isPending(e){return this.pendingSet.has(e)}isError(e){return this.errorMap.has(e)}get(e){return this.videoMap.get(e)}async fetch(e,t){const i=e.videos?.split(",")??[];try{i.forEach((e=>this.pendingSet.add(e)));const s=await this.videoApi.get(e,t);return(0,o.runInAction)((()=>{s.items.map((e=>this.addVideoFromApi(e))),s.profiles?.map((e=>this.shortVideoOwnersProvider.addOwnerFromApi(e))),s.groups?.map((e=>this.shortVideoOwnersProvider.addGroupFromApi(e)))})),s}catch(e){throw(0,o.runInAction)((()=>{i.forEach((t=>this.errorMap.set(t,e)))})),new Error("Fetch video failed",{cause:e})}finally{(0,o.runInAction)((()=>{i.forEach((e=>this.pendingSet.delete(e)))}))}}async fetchAllFields(e,t){return this.fetch({videos:`${e}`,fields:g.SHORT_VIDEO_FETCH_OWNER_FIELDS.join(","),extended:1,track_code:t})}async update(e,t){const i=(0,a.getIdentityRawId)({id:e.video_id,ownerId:e.owner_id});try{this.pendingSet.add(i),await this.shortVideoApi.edit(e,t)}finally{this.pendingSet.delete(i)}}constructor(e,t,i,s,r){this.shortVideoOwnersProvider=e,this.videoApi=t,this.shortVideoApi=i,this.shortVideoDeleteService=s,this.shortVideoLikeService=r,this.videoMap=new Map,this.pendingSet=new Set,this.errorMap=new Map,(0,o.makeAutoObservable)(this)}}m=(0,s.__decorate)([r.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l.ShortVideoOwnersProvider?Object:l.ShortVideoOwnersProvider,void 0===n.VideoApi?Object:n.VideoApi,void 0===d.ShortVideoApi?Object:d.ShortVideoApi,void 0===u.ShortVideoDeleteService?Object:u.ShortVideoDeleteService,void 0===p.ShortVideoLikeService?Object:p.ShortVideoLikeService])],m)},692464:(e,t,i)=>{i.d(t,{ShortVideoVideo:()=>a});var s=i(327813),r=i(873900),o=i(609108);class a{get rawId(){return(0,r.getIdentityRawId)({id:this.data.id,ownerId:this.data.owner_id})}get isDeleted(){return this.shortVideoDeleteService.isDeleted(this.rawId)}get isRestricted(){return Boolean(this.data._content_restricted)}get isPendingDelete(){return this.shortVideoDeleteService.isPending(this.rawId)}get owner(){return this.shortVideoOwnersProvider.get(this.data.owner_id)}constructor(e,t,i){this.data=e,this.shortVideoOwnersProvider=t,this.shortVideoDeleteService=i,this.badges=new o.ShortVideoDataBadges(e),(0,s.makeAutoObservable)(this)}}},609108:(e,t,i)=>{i.d(t,{ShortVideoDataBadges:()=>a});var s=i(327813),r=i(873900),o=i(915204);class a{get clickableStickers(){return this.video.clickable_stickers?.items??[]}get availableOnlyForOwner(){return Boolean("only_me"===this.video.privacy?.view.category)}get marketItem(){const e=this.clickableStickers.find(o.isMarketItem);if(!e||!e.market_item)return;const t=e.market_item;return{...t,ads_label:e.ads_label,is_service:12===(0,o.getMarketCategory)(t.category).id}}get placeInfo(){return this.clickableStickers.find(o.isPlaceInfo)?.place_info}get duet(){const e=this.video.duet;if(e)return{...e,clip_id:(0,r.getIdentityRawIdOrUndefined)({ownerId:e.owner_id,id:e.video_id})}}get playlists(){return this.video.playlists??[]}get compilations(){return this.video.compilations??[]}get masks(){return this.video.masks??[]}get effects(){return this.video.effects??[]}constructor(e){this.video=e,(0,s.makeAutoObservable)(this)}}},915204:(e,t,i)=>{function s(e){return e.parent?s(e.parent):e}function r(e){return Boolean(e.market_item)}function o(e){return Boolean(e.place_info)}i.d(t,{getMarketCategory:()=>s,isMarketItem:()=>r,isPlaceInfo:()=>o})},991665:(e,t,i)=>{function s(e){const{id:t,owner_id:i,privacy_view:s,privacy_comment:r,views:o,comments:a,likes:n,reposts:d,is_subscribed:c,is_favorite:h,can_like:l,can_edit:u,can_delete:p,can_comment:g,can_repost:m,can_subscribe:v,can_download:_,track_code:y,need_mute:S,image:f,files:b,first_frame:C,timeline_thumbs:P,ov_id:w,date:V,description:A,duration:k,action_button:I,ord_info:E,published_at:O,restriction:M,short_video_info:F,width:T,height:R,ads_info:L,is_author:D,wall_post_id:j,processing:N,content_restricted:U}=e,{co_owners:B,audio:G,source_video:x,clickable_stickers:H,compilations:Q,effects:$,masks:W,duet:q,playlists:K}=F??{},Y={id:t??0,owner_id:i??0,is_muted:Boolean(S),united_video_id:Number(w),duration_seconds:k,description:A,track_code:y,width:T,height:R,covers:f,files:b,first_frames:C,timeline_thumbs:P,ov_id:w,is_author:D,wall_post_id:j,publish_timestamp:V,scheduled_timestamp:O,co_owners:B,audio:G,source_video:x,clickable_stickers:H,compilations:Q,effects:$,masks:W,duet:q,playlists:K,ord:E,ad:L,is_processing:Boolean(N),_content_restricted:U};var z;return Y.engagement={view_count:o,comment_count:a,repost_count:d?.count,like_count:n?.count,is_favorite:h,is_anon_liked:e.short_video_info?.anon_user_like_exists,is_liked:Boolean(n?.user_likes),is_reposted:Boolean(d?.user_reposted),is_subscribed:Boolean(c)},Y.access={can_delete:Boolean(p),can_comment:Boolean(g),can_like:Boolean(l),can_repost:Boolean(m),can_subscribe:Boolean(v),can_make_duet:Boolean(e.short_video_info?.can_make_duet),can_download:Boolean(_),can_edit:Boolean(u),forbid_edit_by_ad:Boolean(e.access_info?.edit_forbidden_reasons?.some((e=>"ad"===e.code)))},M&&(Y.restriction=function(e){return{...e,title:e?.title??"",blur:Boolean(e?.blur),button:"play"===e?.button?.action?e.button:void 0}}(M)),I&&(Y.action_button={object_id:(z=I).id,type:z.type,url:z.url,title:z.snippet?.title||z.snippet?.open_title||""}),s&&r&&(Y.privacy={view:s,comment:r}),Y}i.d(t,{mapVideoToShortVideoVideo:()=>s})},863671:(e,t,i)=>{i.d(t,{UserSubscribeService:()=>d});var s=i(331635),r=i(132028),o=i(831505),a=i(327813),n=i(208214);class d{getIsLoading(e){return this.loadings.has(e)}getSubscriptionStatus(e){return this.usersSubscriptionStatus.get(e)}getIsSubscribed(e){switch(this.getSubscriptionStatus(e)){case o.FriendsFriendStatusStatusEnumNames.IS_FRIEND:case o.FriendsFriendStatusStatusEnumNames.OUTCOMING_REQUEST:return!0;case o.FriendsFriendStatusStatusEnumNames.NOT_A_FRIEND:case o.FriendsFriendStatusStatusEnumNames.INCOMING_REQUEST:default:return!1}}setSubscriptionStatus(e,t){this.usersSubscriptionStatus.set(e,t)}async subscribe(e,t){if(this.getIsLoading(e.user_id))return;this.loadings.add(e.user_id);const i=await this.friendsApi.add(e,t);(0,a.runInAction)((()=>{switch(this.loadings.delete(e.user_id),i){case o.FriendsAddResponseEnumNames.SEND:case o.FriendsAddResponseEnumNames.RESEND:this.usersSubscriptionStatus.set(e.user_id,o.FriendsFriendStatusStatusEnumNames.OUTCOMING_REQUEST);break;case o.FriendsAddResponseEnumNames.APPROVED:this.usersSubscriptionStatus.set(e.user_id,o.FriendsFriendStatusStatusEnumNames.IS_FRIEND)}}))}async unsubscribe(e,t){if(this.getIsLoading(e.user_id))return;this.loadings.add(e.user_id);const{success:i}=await this.friendsApi.delete(e,t);return(0,a.runInAction)((()=>{this.loadings.delete(e.user_id),i&&this.usersSubscriptionStatus.set(e.user_id,o.FriendsFriendStatusStatusEnumNames.NOT_A_FRIEND)})),i}async toggleSubscription(e,t){return this.getIsSubscribed(e.user_id)?this.unsubscribe(e,t):this.subscribe(e,t)}constructor(e){this.friendsApi=e,this.loadings=new Set,this.usersSubscriptionStatus=new Map,(0,a.makeAutoObservable)(this)}}d=(0,s.__decorate)([r.scope.global(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.FriendsApi?Object:n.FriendsApi])],d)},979549:(e,t,i)=>{i.d(t,{VideoViewSegmentsService:()=>l});var s=i(331635),r=i(327813),o=i(951652),a=i(882044),n=i(831505),d=i(132028),c=i(603025),h=i(236737);class l{async send(e){if(this.authService.userId)try{return await this.videoApi.viewSegments(e)}catch(e){if(this.isVideoDeletedError(e))return n.VideoViewSegmentsResponseEnumNames.NOT_LOGGED;throw e}}isVideoDeletedError(e){return(0,c.isApiError)(e)&&e.error.error_code===n.API_ERROR_REQUEST&&e.error.error_msg.includes(h.VIDEO_NOT_FOUND)}constructor(e,t){this.authService=e,this.videoApi=t,(0,r.makeAutoObservable)(this)}}l=(0,s.__decorate)([d.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.AuthService?Object:o.AuthService,void 0===a.VideoApi?Object:a.VideoApi])],l)},236737:(e,t,i)=>{i.d(t,{VIDEO_NOT_FOUND:()=>s});const s="video not found"},261491:(e,t,i)=>{i.d(t,{MyTrackerLegacy:()=>a});var s=i(331635),r=i(951652),o=i(132028);class a{tmrPushRawEvent(e){"undefined"!=typeof window&&this.authService.userId&&!window.__dev&&(i._dG("_tmr",window._tmr||[]),window._tmr.push(e))}constructor(e){this.authService=e,this.counterId="2579437",this.sendTimespentEvent=e=>this.tmrPushRawEvent({id:this.counterId,type:"incrementEventTimespent",activity:e,userId:this.authService.userId})}}a=(0,s.__decorate)([o.scope.global(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===r.AuthService?Object:r.AuthService])],a)},52016:(e,t,i)=>{i.d(t,{CatalogApi:()=>a});var s=i(331635),r=i(641569),o=i(132028);class a extends r.ApiNamespace{get namespace(){return"catalog"}constructor(...e){super(...e),this.getSearchAll=this.makeMethod("getSearchAll"),this.getAudio=this.makeMethod("getAudio"),this.getAudioArtist=this.makeMethod("getAudioArtist"),this.getAudioCurator=this.makeMethod("getAudioCurator"),this.getAudioSearch=this.makeMethod("getAudioSearch"),this.getGroups=this.makeMethod("getGroups",!0),this.consumeBanner=this.makeMethod("consumeBanner"),this.getSearchGroups=this.makeMethod("getSearchGroups"),this.getVideo=this.makeMethod("getVideo"),this.getSection=this.makeMethod("getSection"),this.getGroupsCollection=this.makeMethod("getGroupsCollection"),this.getBlockItems=this.makeMethod("getBlockItems"),this.getClassifieds=this.makeMethod("getClassifieds"),this.getAudioClips=this.makeMethod("getAudioClips"),this.getAudioClipsSearch=this.makeMethod("getAudioClipsSearch"),this.replaceBlocks=this.makeMethod("replaceBlocks"),this.getShortVideoSearch=this.makeMethod("getShortVideoSearch"),this.getVideoShowcase=this.makeMethod("getVideoShowcase"),this.getVideoSearchSubscriptions=this.makeMethod("getVideoSearchSubscriptions"),this.getVideoSearchWeb2=this.makeMethod("getVideoSearchWeb2"),this.getVideoSearch=this.makeMethod("getVideoSearch"),this.getSearchGames=this.makeMethod("getSearchGames"),this.getSearchMarket=this.makeMethod("getSearchMarket"),this.getPeopleSearch=this.makeMethod("getPeopleSearch"),this.getPeopleSearchWithPrefetch=this.makeMethod("getPeopleSearch",!0),this.getOwnerVideosSearch=this.makeMethod("getOwnerVideosSearch"),this.getSearchMiniApps=this.makeMethod("getSearchMiniApps"),this.hideBlock=this.makeMethod("hideBlock")}}a=(0,s.__decorate)([o.scope.global()],a)},765905:(e,t,i)=>{i.d(t,{FeedApi:()=>a});var s=i(331635),r=i(641569),o=i(132028);class a extends r.ApiNamespace{get namespace(){return"newsfeed"}constructor(...e){super(...e),this.getNewsFeed=this.makeMethod("get"),this.getNewsFeedWithPrefetch=this.makeMethod("get",!0),this.ignoreItem=this.makeMethod("ignoreItem"),this.getBanned=this.makeMethod("getBanned"),this.deleteBan=this.makeMethod("deleteBan"),this.setFeedType=this.makeMethod("setFeedType"),this.unignoreItem=this.makeMethod("unignoreItem"),this.unsubscribe=this.makeMethod("unsubscribe"),this.getNewsFeedByType=this.makeMethod("getByType"),this.getNewsFeedByTypeWithPrefetch=this.makeMethod("getByType",!0),this.getLikesFeed=this.makeMethod("getLikesFeed")}}a=(0,s.__decorate)([o.scope.global()],a)},208214:(e,t,i)=>{i.d(t,{FriendsApi:()=>a});var s=i(331635),r=i(132028),o=i(641569);class a extends o.ApiNamespace{get namespace(){return"friends"}constructor(...e){super(...e),this.get=this.makeMethod("get"),this.getIds=this.makeMethod("get"),this.getUsers=(e,t)=>this.makeMethod("get")(e.fields?e:{...e,fields:"first_name"},t),this.getUsersWithPrefetch=(e,t)=>this.makeMethod("get",!0)(e.fields?e:{...e,fields:"first_name"},t),this.search=this.makeMethod("search"),this.getLists=this.makeMethod("getLists"),this.getListsWithPrefetch=this.makeMethod("getLists",!0),this.getFriendsDeletionSuggestions=this.makeMethod("getFriendsDeletionSuggestions"),this.getFriendsDeletionSuggestionsWithPrefetch=this.makeMethod("getFriendsDeletionSuggestions",!0),this.getOnlineExtended=(e,t)=>this.makeMethod("getOnline")({...e,extended:1},t),this.getOnlineExtendedWithPrefetch=(e,t)=>this.makeMethod("getOnline",!0)({...e,extended:1},t),this.getMutualTotalCount=(e,t)=>this.makeMethod("getMutual")({...e,need_common_count:1},t),this.getMutualTotalCountWithPrefetch=(e,t)=>this.makeMethod("getMutual",!0)({...e,need_common_count:1},t),this.getRequestsExtended=this.makeMethod("getRequests"),this.getRequestsExtendedWithPrefetch=this.makeMethod("getRequests",!0),this.getCounters=this.makeMethod("getCounters"),this.getCountersWithPrefetch=this.makeMethod("getCounters",!0),this.add=this.makeMethod("add"),this.delete=this.makeMethod("delete"),this.getRecommendations=this.makeMethod("getRecommendations"),this.getRecommendationsWithPrefetch=this.makeMethod("getRecommendations",!0),this.hideSuggestion=this.makeMethod("hideSuggestion"),this.requestsToSubscribers=this.makeMethod("requestsToSubscribers"),this.deleteSubscriber=this.makeMethod("deleteSubscriber")}}a=(0,s.__decorate)([r.scope.global()],a)},813682:(e,t,i)=>{i.d(t,{LikesApi:()=>a});var s=i(331635),r=i(132028),o=i(641569);class a extends o.ApiNamespace{get namespace(){return"likes"}constructor(...e){super(...e),this.add=this.makeMethod("add"),this.delete=this.makeMethod("delete"),this.getList=this.makeMethod("getList")}}a=(0,s.__decorate)([r.scope.global()],a)},413206:(e,t,i)=>{i.d(t,{ShortVideoApi:()=>a});var s=i(331635),r=i(132028),o=i(641569);class a extends o.ApiNamespace{get namespace(){return"shortVideo"}constructor(...e){super(...e),this.getOwnerVideos=this.makeMethod("getOwnerVideos"),this.getChallenge=this.makeMethod("getChallenge"),this.getClipCounters=this.makeMethod("getClipCounters"),this.create=this.makeMethod("create"),this.edit=this.makeMethod("edit"),this.publish=this.makeMethod("publish"),this.delete=this.makeMethod("delete"),this.restore=this.makeMethod("restore"),this.getTopVideos=this.makeMethod("getTopVideos"),this.sendPush=this.makeMethod("sendPush"),this.getGroupsForUploading=this.makeMethod("getGroupsForUploading"),this.notInterested=this.makeMethod("notInterested"),this.getPlaylists=this.makeMethod("getPlaylists"),this.addToPlaylist=this.makeMethod("addToPlaylist"),this.removeFromPlaylist=this.makeMethod("removeFromPlaylist"),this.getDownloadUrl=this.makeMethod("getDownloadUrl"),this.getTopTags=this.makeMethod("getTopTags"),this.getUserSettings=this.makeMethod("getUserSettings"),this.getThumbUploadUrl=this.makeMethod("getThumbUploadUrl"),this.saveUploadedThumb=this.makeMethod("saveUploadedThumb"),this.encodeProgress=this.makeMethod("encodeProgress")}}a=(0,s.__decorate)([r.scope.global()],a)},995340:(e,t,i)=>{i.d(t,{StatsApi:()=>a});var s=i(331635),r=i(132028),o=i(641569);class a extends o.ApiNamespace{get namespace(){return"stats"}constructor(...e){super(...e),this.trackEvents=this.makeMethod("trackEvents"),this.getBusinessCommunitySubscriptionPublicAnalytics=this.makeMethod("getBusinessCommunitySubscriptionPublicAnalytics")}}a=(0,s.__decorate)([r.scope.global()],a)},746310:(e,t,i)=>{i.d(t,{StoriesApi:()=>a});var s=i(331635),r=i(641569),o=i(132028);class a extends r.ApiNamespace{get namespace(){return"stories"}constructor(...e){super(...e),this.getWithPrefetch=this.makeMethod("get",!0),this.get=this.makeMethod("get"),this.getArchiveWithPrefetch=this.makeMethod("getArchive",!0),this.getArchive=this.makeMethod("getArchive"),this.getByAdsWithPrefetch=this.makeMethod("getByAds",!0),this.getByAds=this.makeMethod("getByAds"),this.getById=this.makeMethod("getById"),this.getByIdWithPrefetch=this.makeMethod("getById",!0),this.replies=this.makeMethod("getReplies"),this.repliesWithPrefetch=this.makeMethod("getReplies",!0),this.search=this.makeMethod("search"),this.searchWithPrefetch=this.makeMethod("search",!0),this.getDiscover=this.makeMethod("getDiscover"),this.getPhotoUploadServer=this.makeMethod("getPhotoUploadServer"),this.getVideoUploadServer=this.makeMethod("getVideoUploadServer"),this.getBackgrounds=this.makeMethod("getBackgrounds"),this.getWebConfig=this.makeMethod("getWebConfig"),this.markSeen=this.makeMethod("markSeen"),this.markSkipped=this.makeMethod("markSkipped"),this.save=this.makeMethod("save"),this.delete=this.makeMethod("delete")}}a=(0,s.__decorate)([o.scope.global()],a)},488709:(e,t,i)=>{i.d(t,{UsersApi:()=>a});var s=i(331635),r=i(641569),o=i(132028);class a extends r.ApiNamespace{get namespace(){return"users"}constructor(...e){super(...e),this.getWithPrefetch=this.makeMethod("get",!0),this.get=this.makeMethod("get"),this.getFollowers=this.makeMethod("getFollowers"),this.search=this.makeMethod("search"),this.getSubscriptions=this.makeMethod("getSubscriptions")}}a=(0,s.__decorate)([o.scope.global()],a)},229745:(e,t,i)=>{i.d(t,{WallApi:()=>a});var s=i(331635),r=i(641569),o=i(132028);class a extends r.ApiNamespace{get namespace(){return"wall"}constructor(...e){super(...e),this.get=this.makeMethod("get"),this.getPostById=this.makeMethod("getById"),this.acceptCoOwnership=this.makeMethod("acceptCoOwnership"),this.rejectCoOwnership=this.makeMethod("rejectCoOwnership"),this.parseAttachedLink=this.makeMethod("parseAttachedLink"),this.post=this.makeMethod("post"),this.subscribe=this.makeMethod("subscribe"),this.unsubscribe=this.makeMethod("unsubscribe"),this.getSubscriptions=this.makeMethod("getSubscriptions"),this.edit=this.makeMethod("edit"),this.getPostingSettings=this.makeMethod("getPostingSettings"),this.getCommentsExtended=this.makeMethod("getComments"),this.getCommentExtended=this.makeMethod("getComment"),this.reportPost=this.makeMethod("reportPost"),this.pin=this.makeMethod("pin"),this.unpin=this.makeMethod("unpin"),this.closeComments=this.makeMethod("closeComments"),this.openComments=this.makeMethod("openComments"),this.archive=this.makeMethod("archive"),this.reveal=this.makeMethod("reveal"),this.delete=this.makeMethod("delete"),this.restore=this.makeMethod("restore"),this.deleteComment=this.makeMethod("deleteComment"),this.restoreComment=this.makeMethod("restoreComment"),this.createComment=this.makeMethod("createComment"),this.editComment=this.makeMethod("editComment"),this.getCommentOrder=this.makeMethod("getCommentOrder")}}a=(0,s.__decorate)([o.scope.global()],a)},308011:(e,t,i)=>{i.d(t,{isNotEmptyQuery:()=>s});const s=".*[^ ].*"},33013:(e,t,i)=>{i.d(t,{getVideoThumb:()=>r});var s=i(8520);function r(e,t,i){const r=e.filter((e=>!e.with_padding)),o=i&&(0,s.isRetina)()?2:1,a=((0,s.isNumber)(t)?t:t.width||0)*o,n=((0,s.isNumber)(t)?0:t.height||0)*o;return(0,s.getPhotoSize)(r.length?r:e,a,n)?.url}},561386:(e,t,i)=>{i.d(t,{default:()=>s});const s={root:"ClipForceMutedBanner__root--BLo7d"}}}])}if("undefined"!=typeof window&&window.partConfigEnabled?.("static_loading_execute_errors"))try{e(),window.stManager?.done?.("dist/web/chunks/8321c9d1.37feed67.js")}catch(e){throw window.stManager?.fail?.("dist/web/chunks/8321c9d1.37feed67.js",e),e}else e(),"undefined"!=typeof window&&window.stManager?.done?.("dist/web/chunks/8321c9d1.37feed67.js");