function e(){"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[94283],{720357:(e,t,o)=>{o.d(t,{ExternalEvents:()=>r});class r{dispose(){}constructor(){this.listeners=[],this.send=(e,t)=>{for(const o of this.listeners)o(e,t)},this.subscribe=e=>(this.listeners.push(e),()=>{this.listeners=this.listeners.filter((t=>t!==e))})}}},52905:(e,t,o)=>{o.d(t,{API_VERSION:()=>r,BRIDGE_STAT_CALL_ARGUMENTS_MAX_LENGTH:()=>A,CLOSE_STATUS:()=>_,ERROR_CODES:()=>a,ERROR_REASONS:()=>n,ERROR_TYPES:()=>d,MAX_COUNT_OF_APP_INIT:()=>b,NFT_APP_ID:()=>p,ONE_TIME_DONUT_APP_ID:()=>g,ORD_APP_ID:()=>u,OZON_APP_ID:()=>v,PLATFORM:()=>s,PMC_PART_CONFIG_KEY_LONG_ID:()=>m,SITPOSTING_APP_ID:()=>h,TEXTLIVE_APPS:()=>c,VKPAY_APPS:()=>l,VKPAY_TRANSACTION_EVENT:()=>i,VK_CONNECT_EVENTS:()=>S,VK_CONNECT_SUPERAPPKIT_EVENT_TYPE:()=>R,VMOJI_CONSTRUCTOR_APP_ID:()=>E});const r="5.95",i="VKWebAppActionDone",s={WEB:"web",MOBILE_WEB:"mobile-web"},a={UNKNOWN:1,MISSING_PARAM:2,OLD_MISSING_PARAM:100,CONNECTION_LOST:3,USER_DENIED:4,INVALID_PARAMS:5,UNSUPPORTED_PLATFORM:6,REQUESTS_LIMIT_REACHED:10,ACCESS_DENIED:11,CUSTOM:13,NO_ADS:20},n={ACCESS_DENIED:"Access denied",UNSUPPORTED_PLATFORM:"Unsupported platform",UNSUPPORTED_ACTION:"Unsupported action",NATIVE_APP_IS_NOT_INSTALLED:"VK client is not installed on device",USER_NOT_A_PRIVATE_GROUP_MEMBER:"User is not a member of the given private group",UNKNOWN_ERROR:"Unknown error",CONNECTION_LOST:"Connection lost",NETWORK_ERROR:"Network error",USER_DENIED:"User denied",INVALID_PARAMS:"Invalid params",NO_ADS:"No ads",ADS_ALREADY_PLAYED:"Ads already played",VK_PAY_DISABLED:"This app can't use VK Pay",SCROLL_SUBSCRIBER_ALREADY_EXIST:"Scroll subscriber already exist",SUBSCRIPTION_IS_ALREADY_CANCELLED:"Subscription is in invalid status: subscription is already cancelled",SURVEY_INIT_IN_PROGRESS:"Survey init in progress",SURVEY_ALREADY_INIT:"Survey already init",SURVEY_NO_MATCH:"Survey no match",SURVEY_USER_CANCEL:"Survey user cancel",ALREADY_IN_PROGRESS:"Already in progress",USER_IS_NOT_GROUP_ADMIN:"Only group admins have access to group tokens",DEVICE_CANT_GET_GEODATA:"Device can't get geodata",USER_DIDNT_ALLOWED_ACTION:"User didn't allowed"},d={CLIENT:"client_error",API:"api_error",AUTH:"auth_error"},_=["success","failed"],l=[6217559,7131443],c=[7512376],u=51707812,p=51459963,h=7644481,E=7929683,g=51528700,v=51903384,S={VKWebAppAddToCommunity:"add_to_community",VKWebAppAddToCommunityPreload:"get_groups_list",VKWebAppAddToFavorites:"add_to_favorites",VKWebAppAddToFavoritesPreload:"already_added_to_favorites",VKWebAppAddToMenu:"add_to_menu",VKWebAppAddToMenuPreload:"is_in_left_menu",VKWebAppGetCommunityToken:"get_community_token",VKWebAppGetCommunityTokenPreload:"get_community_preload_settings",VKWebAppGetAuthToken:"get_auth_token",VKWebAppGetAuthTokenPreload:"get_auth_token_info",VKWebAppGetPhoneNumber:"get_phone_number",VKWebAppGetPhoneNumberPreload:"already_get_phone_number",VKWebAppGetEmail:"get_email",VKWebAppGetEmailPreload:"already_get_email",VKWebAppGetFriends:"get_friends",VKWebAppOpenApp:"open_app",VKWebAppSendPayload:"send_payload",VKWebAppSendToClient:"send_to_client",VKWebAppSendToClientPreload:"get_open_in_native_permission",VKWebAppShowOrderBox:"order",VKWebAppShowSubscriptionBox:"subscription",VKWebAppShowLeaderBoardBox:"show_leader_board",VKWebAppShowLinkCardBox:"show_link_card",VKWebAppShowNftPaymentBox:"show_nft_pay_box",VKWebAppShowInviteBox:"invite_friends",VKWebAppShowStoryBox:"story_box",VKWebAppShowRequestBox:"send_request",VKWebAppShowRequestBoxPreload:"request_box_preload",VKWebAppOpenArticleEditor:"open_article_edit",VKWebAppSubscribeStoryApp:"subscribe_story_app",VKWebAppClose:"close",VKWebAppGetSilentToken:"get_silent_token",VKWebAppOpenPayForm:"open_pay_form",VKWebAppAddToChat:"add_to_chat",VKWebAppTrackEvent:"track_event",VKWebAppCallStart:"call_start",VKWebAppCallJoin:"call_join",VKWebAppCallLeft:"call_left",VKWebAppCallFinished:"call_finished",VKWebAppCallGetStatus:"call_get_status",VKWebAppCallStartSharing:"call_start_sharing",VKWebAppCallStopSharing:"call_stop_sharing"},R="vk-sak-sdk",m="mini_apps_long_id",A=256,b=1},265658:(e,t,o)=>{o.d(t,{VKWebAppCustomMessage:()=>p});var r=o(939659),i=o(298077),s=o(290788),a=o(565703),n=o(889438),d=o(105330),_=o(540462),l=o(52905),c=o(837207);o._dG("VKWebAppCustomMessageExternalHandlers",window.VKWebAppCustomMessageExternalHandlers??{});const u=(0,n.getMessengerSharedState)().externalEvents;class p extends s.Handler{actionHandler(e){if(e.action&&e.payload){if(this.app.isTextliveApp){const t=window.Textlives?.onBridgeEvent(e);return void(t&&t.then(this.successHandler).catch(this.errorHandler))}if(this.app.appId===l.NFT_APP_ID)return this.handleSetNftAvatar(e),void this.successHandler({result:!0});if(this.app.appId===l.ORD_APP_ID)return this.handleSetOrdData(e),void this.successHandler({result:!0},(()=>{if((0,_.partConfigEnabled)("messages_enable_vk_web_app_custom_message_processing"))try{u.send(this.params.handlerName,e)}catch(e){console.error(e)}}));if(this.app.appId===l.VMOJI_CONSTRUCTOR_APP_ID)return this.handleOpenStickerPicker(e),void this.successHandler({result:!0});if(this.app.appId===l.OZON_APP_ID&&window.cur?.handleOzonAppCustomMessage&&"function"==typeof window.cur.handleOzonAppCustomMessage)return window.cur.handleOzonAppCustomMessage(e),void this.successHandler({result:!0});if(this.app.appId===l.ONE_TIME_DONUT_APP_ID){try{this.handleWithExternalHandlers(e)}catch(e){(0,i.logError)(e)}return void this.successHandler({result:!0})}}this.errorHandler("unknown error")}handleSetNftAvatar({action:e,payload:t}){"VKWebAppSetNFTAvatar"===e&&((0,d.isMvk)()?window.OwnerPhotoUpload2.setNftAvatar(t):window.ajax.post("al_page.php",{act:"owner_avatar_upload",oid:t?.oid},{onDone:(e,o)=>{window.handleVKBridgeSetNftAvatar(t,e,o)}}))}handleOpenStickerPicker({action:e,payload:t}){if("vmoji_character_recereate"!==e)return;const{promo:o,page:i}=t;o&&(0,a.isNewStickerPicker)()&&!(0,d.isMvk)()&&(window.StickerPickerViewer?.showLastPicker(r.ServicePackKey.VMOJI),i?.match("/preview")||window.stManager.add(window.jsc("web/vmoji.js")).then((()=>{window.Vmoji.showAddedToStickerSnackbar()})))}handleSetOrdData({action:e,payload:t}){"ord_data"===e&&t&&(0,c.getStore)().onOrdData({is_ad:t.isAd||!1,ord_pred_id:t.predId||"",erid:t.erId||""})}handleWithExternalHandlers(e){window.VKWebAppCustomMessageExternalHandlers[e.action]?.(e.payload)}constructor(e){super(e),this.params.handlerName="VKWebAppCustomMessage"}}},520637:(e,t,o)=>{o.d(t,{default:()=>i});var r=o(52905);const i=class{_errorStrucuture(e,t){let o={type:this.method,data:{error_type:this.type,error_data:{error_code:e}}};return this.type===r.ERROR_TYPES.API?(o.data.error_data.error_msg=t,this.data.request_params&&(o.data.error_data.request_params=this.data.request_params)):o.data.error_data.error_reason=t,this.data.request_id&&(o.data.request_id=this.data.request_id),this.data.description&&(o.data.error_data.error_description=this.data.description),o}getReadableMessage(){const{error_reason:e,error_msg:t,error_description:o}=this.selectErrorType().data.error_data;return e||t||o}selectErrorType(){if(!this.data.hasOwnProperty("code"))return this.data.hasOwnProperty("error_code")?this._errorStrucuture(this.data.error_code,this.data.error_msg||r.ERROR_REASONS.UNKNOWN_ERROR):this.data.error_msg&&"operation denied by user"===this.data.error_msg.toLowerCase()?this._errorStrucuture(r.ERROR_CODES.USER_DENIED,"User denied"):this._errorStrucuture(r.ERROR_CODES.UNKNOWN,this.data.reason||this.data.error_msg||r.ERROR_REASONS.UNKNOWN_ERROR);switch(this.data.code){case r.ERROR_CODES.MISSING_PARAM:return this._errorStrucuture(r.ERROR_CODES.MISSING_PARAM,this.data.reason||"Missing required params or wrong type of param");case r.ERROR_CODES.CONNECTION_LOST:return this._errorStrucuture(r.ERROR_CODES.CONNECTION_LOST,this.data.reason||r.ERROR_REASONS.CONNECTION_LOST);case r.ERROR_CODES.USER_DENIED:return this._errorStrucuture(r.ERROR_CODES.USER_DENIED,this.data.reason||r.ERROR_REASONS.USER_DENIED);case r.ERROR_CODES.INVALID_PARAMS:return this._errorStrucuture(r.ERROR_CODES.INVALID_PARAMS,this.data.reason||r.ERROR_REASONS.INVALID_PARAMS);case r.ERROR_CODES.ACCESS_DENIED:return this._errorStrucuture(r.ERROR_CODES.ACCESS_DENIED,this.data.reason||r.ERROR_REASONS.ACCESS_DENIED);case r.ERROR_CODES.CUSTOM:return this._errorStrucuture(r.ERROR_CODES.CUSTOM,this.data.reason||this.data.error_msg);case r.ERROR_CODES.REQUESTS_LIMIT_REACHED:return this._errorStrucuture(r.ERROR_CODES.REQUESTS_LIMIT_REACHED,"Requests limit reached");case r.ERROR_CODES.UNKNOWN:return this._errorStrucuture(r.ERROR_CODES.UNKNOWN,this.data.reason||r.ERROR_REASONS.UNKNOWN_ERROR);default:return this._errorStrucuture(this.data.code?this.data.code:r.ERROR_CODES.UNKNOWN,this.data.reason||this.data.error_msg||r.ERROR_REASONS.UNKNOWN_ERROR)}}constructor(e,t,o=r.ERROR_TYPES.CLIENT){this.data=t||{},this.method=e,this.type=o}}},494565:(e,t,o)=>{o.d(t,{destroyOpenedApp:()=>a,filterPostMessageOrigin:()=>d,getHostName:()=>s,isAllowedPostMessageOriginHost:()=>_,isVKPayApp:()=>n,objectToQuerystring:()=>i});var r=o(52905);const i=(e,t="?",o=!1)=>Object.keys(e).reduce(((r,i,s)=>[r,0===s?t:"&",encodeURIComponent(i),"=",o&&Array.isArray(e[i])?e[i].map(encodeURIComponent).join(","):encodeURIComponent(e[i])].join("")),""),s=e=>{const t=e.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);return null!=t&&t.length>2&&"string"==typeof t[2]&&t[2].length>0?t[2].toLowerCase():null},a=e=>{if(cur.vkAppQueue){const t=Object.keys(cur.vkAppQueue).filter((t=>~t.indexOf(e)));if(t.length>0){const e=t[0];cur.vkAppQueue[e].destroyView(),delete cur.vkAppQueue[e]}}},n=e=>r.VKPAY_APPS.includes(e);function d(e,t){const o=s(t),r=e.vkApp?e.vk_app_url:e.src,i=s(r);if(o!==i&&!_(e,o))throw Error(`Insecure method call from ${o}. Call must be from ${i}`);return!0}function _(e,t){if(!e.allowed_origin_regexp)return!1;return new RegExp(e.allowed_origin_regexp).test(t)}},290788:(e,t,o)=>{o.d(t,{Handler:()=>E});var r=o(914421),i=o(520637),s=o(234430),a=o(52905),n=o(105330),d=o(898848),_=o(314309),l=o(831505),c=o(540462),u=o(670053),p=o(534100),h=o(816980);class E{get successDescriptor(){return`${this.params.originalHandlerName||this.params.handlerName}Result`}get errorDescriptor(){return`${this.params.originalHandlerName||this.params.handlerName}Failed`}get previousCallsCount(){return this.app?.context?.getHandlerCallsCount(this.params.handlerName)-1||0}shouldLogStat(){return!(0,c.partConfigEnabled)("mini_apps_log_overridden_handlers")}shouldLogCallArgumentsInStat(){return(0,c.partConfigEnabled)("mini_apps_send_stat_arguments_bridge_events")&&Array.isArray(this.app?.bridgeMethodsToBeLogged)&&this.app.bridgeMethodsToBeLogged.includes(this.params.handlerName)}getEventHash(e=!1){const t=`${this.getEventName(e)}_hash`;return(0,u.getCurrentApp)()?.options[t]}getEventName(e=!1){const t=`${this.params.handlerName}${e?"Preload":""}`;return a.VK_CONNECT_EVENTS[t]}sendNetworkError(){this.errorHandler({code:a.ERROR_CODES.UNKNOWN,error_type:a.ERROR_TYPES.CLIENT,reason:a.ERROR_REASONS.UNKNOWN_ERROR})}sendConnectionLostError(){this.errorHandler({code:a.ERROR_CODES.CONNECTION_LOST,error_type:a.ERROR_TYPES.CLIENT,reason:a.ERROR_REASONS.CONNECTION_LOST})}sendUserDeniedError(){this.errorHandler({code:a.ERROR_CODES.USER_DENIED,error_type:a.ERROR_TYPES.CLIENT,reason:a.ERROR_REASONS.USER_DENIED})}handleApiError(e){const t=e?.error,o=t?.error_msg,r=t?.error_code;if(r)switch(r){case l.API_ERROR_ACCESS:this.errorHandler({code:a.ERROR_CODES.ACCESS_DENIED,error_type:a.ERROR_TYPES.CLIENT,reason:o});break;case l.API_ERROR_PARAM:this.errorHandler({code:a.ERROR_CODES.INVALID_PARAMS,error_type:a.ERROR_TYPES.CLIENT,reason:o});break;default:this.errorHandler({code:a.ERROR_CODES.CUSTOM,error_type:a.ERROR_TYPES.CLIENT,reason:o||a.ERROR_REASONS.UNKNOWN_ERROR})}else this.errorHandler({code:a.ERROR_CODES.CONNECTION_LOST,error_type:a.ERROR_TYPES.CLIENT,reason:o||a.ERROR_REASONS.UNKNOWN_ERROR})}sendCustomError(e){this.errorHandler({code:a.ERROR_CODES.CUSTOM,reason:e||a.ERROR_REASONS.UNKNOWN_ERROR})}checkParams(e,t){for(let o=0;o<t.length;o++){const{param:r,type:i,isRequired:s,extraChecks:n}=t[o];if(!e.hasOwnProperty(r)&&s)return this.errorHandler({code:a.ERROR_CODES.MISSING_PARAM,reason:`Missing required param "${r}"`}),!1;if(e.hasOwnProperty(r)&&typeof e[r]!==i)return this.errorHandler({code:a.ERROR_CODES.INVALID_PARAMS,reason:`Param "${r}" should be ${i}`},this.callback),!1;if(e.hasOwnProperty(r)&&n&&n.length>0)for(let t=0;t<n.length;t++)if(!n[t].check(e[r]))return this.errorHandler({code:a.ERROR_CODES.INVALID_PARAMS,reason:n[t].error(r)},this.callback),!1}return!0}actionHandler(e){return this.callApi?window.ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId,...e},{onDone:t=>{this.handleResponse(t,e,this.checkResponse)},onFail:e=>(this.errorHandler(e),!0)}):{}}checkResponse(e){1===e||0===e?this.successHandler(Boolean(e)):this.successHandler(e)}scopeStringToArray(e){return e?e.replace(/ /g,"").split(","):[]}denyUIAction(e){this.errorHandler({error_type:"client_error",code:a.ERROR_CODES.USER_DENIED},null),this.modal&&r.default.pop(this.modal)}allowUIAction(e){this.actionHandler(e),this.modal&&r.default.pop(this.modal)}createDenyUIAction(e){this.params.modal.cancelAction=void 0!==e?()=>this.denyUIAction(e):this.denyUIAction}createAllowUIAction(e){this.params.modal.allowAction=void 0!==e?()=>this.allowUIAction(e):this.allowUIAction}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(),this.modal=new s.UIAction({...this.params.modal,...e}),r.default.push(this.modal)}_enhanceBtnsWithActions(){this.params.modal.buttons?.forEach((e=>{"deny"===e.type?e.action=this.params.modal.cancelAction:e.action=this.params.modal.allowAction}))}setData(e,t,o=null){o&&(this.callback=o),e.request_id&&(this.params.request_id=e.request_id),this.params.modal||(this.params.modal={}),e.containerId&&(this.params.modal.containerId=e.containerId),e.pic&&(this.params.modal.pic=e.pic),this.app=t,this.shouldLogCallArgumentsInStat()&&(this.callArguments=e)}showBridgeModal(e,t){return(0,h.isSpaLaunch)()&&e.showModal?e.showModal(t):(0,p.showBridgeModalBox)(t)}handleResponse(e,t,o,r){try{const r=JSON.parse(e);r.hasOwnProperty("error")?this.errorHandler(r.error):o(r,t)}catch(e){r?r(e):this.errorHandler(e)}}handler(e,t,o){if(this.setData(e,t),this.callback=o,this.isWebOnly&&(0,n.isMvk)()||this.isMobileWebOnly&&!(0,n.isMvk)())return this.errorHandler({code:a.ERROR_CODES.UNSUPPORTED_PLATFORM,error_type:a.ERROR_TYPES.CLIENT,reason:a.ERROR_REASONS.UNSUPPORTED_PLATFORM});this.useUI?this.launchUI(e):this.useUI||this.actionHandler(e)}getAppWebviewUrl(){const e=(0,u.getCurrentApp)();return e?.url||e?.frame?.src||""}cleanCallArguments(e){const t=["request_id","handlerName","method","modal","containerId","pic"];for(const o of t)delete e[o];return e}getSerializedCallArguments(){if(!this.shouldLogCallArgumentsInStat()||!this.callArguments)return null;const e=this.cleanCallArguments({...this.callArguments});let t=JSON.stringify(e);return t.length>a.BRIDGE_STAT_CALL_ARGUMENTS_MAX_LENGTH&&(t=null),t}isPassedParameters(e){return(0,d.isObject)(e)}successHandler(e,t){if("function"==typeof t&&t(),this.isPassedParameters(e)||(e={result:e}),this.params.request_id&&(e.request_id=this.params.request_id),this.callback?.({type:this.successDescriptor,data:e},this.params.handlerName),(0,n.isMvk)()&&(0,u.getCurrentApp)()?.frame?.focus(),this.shouldLogStat()){const e=this.getSerializedCallArguments();_.bridgeEventItemStat.logEvent(this.getAppWebviewUrl(),this.app.appId,{event_type:this.params.handlerName,is_success:!0,...e?{call_arguments:e}:{}},void 0,this.app.vkApp.sessionUuid)}}errorHandler(e,t,o){"string"==typeof e&&(e={reason:e}),this.params.request_id&&e&&(e.request_id=this.params.request_id);const r=new i.default(this.errorDescriptor,e,o),s=r.selectErrorType();if("function"==typeof t&&t(s),this.callback?.(s),(0,n.isMvk)()&&(0,u.getCurrentApp)()?.frame?.focus(),this.shouldLogStat()){const e=this.getSerializedCallArguments();_.bridgeEventItemStat.logEvent(this.getAppWebviewUrl(),this.app.appId,{event_type:this.params.handlerName,is_success:!1,...e?{call_arguments:e}:{}},{error_type:r.type||a.ERROR_TYPES.CLIENT,error_code:r.data.code||a.ERROR_CODES.UNKNOWN},this.app.vkApp.sessionUuid,r.getReadableMessage())}}constructor(e={}){this.params={handlerName:"handler",method:"method",modal:{},...e},this.callApi=!0,this.useUI=!1,this.callback=null,this.modal=null,this.isWebOnly=!1,this.isMobileWebOnly=!1,this.callArguments=null,this.actionHandler=this.actionHandler.bind(this),this.errorHandler=this.errorHandler.bind(this),this.successHandler=this.successHandler.bind(this),this.denyUIAction=this.denyUIAction.bind(this),this.allowUIAction=this.allowUIAction.bind(this),this.checkResponse=this.checkResponse.bind(this),this.getSerializedCallArguments=this.getSerializedCallArguments.bind(this),window.cur.vkAppSuccessHandler=this.successHandler,window.cur.vkAppErrorHandler=this.errorHandler}}},310338:(e,t,o)=>{o.d(t,{VKWebAppCustomMessage:()=>r.VKWebAppCustomMessage,getStore:()=>i.getStore});var r=o(265658),i=o(837207)},837207:(e,t,o)=>{o.d(t,{getStore:()=>a});var r=o(558137),i=o(32489);function s(){return{onOrdData:(0,i.createDomain)("APPS_CONNECT/VKWebAppCustomMessage").createEvent()}}function a(){return(0,r.makeSharedState)("static/js/modules/shared/apps_connect/handlers/VKWebAppCustomMessage/store.ts",s,{version:0})()}},565703:(e,t,o)=>{o.d(t,{STICKERS_CONFDATA_KEY:()=>i,isNewStickerPicker:()=>s,isPromoVmojiCounterEnabled:()=>n,isUGCStickersEnabled:()=>a});var r=o(540462),i=function(e){return e.UGC="stickers.ugc",e.PROMO_VMOJI_COUNTER="vmoji.promo.avatar_suggestion.promo_counter",e.NEW_STICKER_PICKER="new_sticker_picker",e}({});function s(){return(0,r.partConfigEnabled)("new_sticker_picker")}function a(){return(0,r.partConfigEnabled)("stickers.ugc")}function n(){return(0,r.partConfigEnabled)("vmoji.promo.avatar_suggestion.promo_counter")}},352986:(e,t,o)=>{o.d(t,{ACCEPT_THUMB_FILES:()=>A,DEFAULT_VIDEO_GROUPS_PRIVACY:()=>c,DEFAULT_VIDEO_PRIVACY:()=>l,ENCODE_ATTEMPTS:()=>N,EUsersPrivacyCategories:()=>u,GROUPS_PRIVACY_BY_LINK:()=>_,GROUPS_PRIVACY_LIST:()=>h,MAX_COUNT_REQUEST_TO_ENCODE_PROGRESS:()=>m,MAX_LENGTH_OF_DESCRIPTION:()=>R,MAX_LENGTH_OF_TITLE:()=>S,MAX_SUBTITLES_COUNT:()=>E,PREVIEW_COLUMN_WIDTH:()=>d,SUBTITLES_INPUT_ACCEPT:()=>g,TAB_NAME_TO_VIDEO_PUBLISH_ACTION_EVENT_TYPE_MAPPER:()=>C,THUMB_HEIGHT:()=>O,THUMB_WIDTH:()=>b,UPLOAD_PATHNAME:()=>a,UPLOAD_SDK_SETTINGS:()=>v,USERS_PRIVACY_LIST:()=>p,VIDEO_LAZY_LOAD_PLAYLISTS_IN_UPLOADER:()=>I,YANDEX_DISK_ORIGIN:()=>n});var r=o(395846),i=o(210986),s=o(317216);const a=`${(0,o(856289).getVideoPrefix)("backSlash")}upload`,n="https://disk.yandex.ru",d=319,_=3,l=[0,1,[0],[]],c=[1,1,[1],[]];var u=function(e){return e[e.all=0]="all",e[e.friends=1]="friends",e[e.friendsOfFriends=2]="friendsOfFriends",e[e.onlyMe=3]="onlyMe",e[e.allExcept=4]="allExcept",e[e.someFriends=5]="someFriends",e[e.someFriendLists=6]="someFriendLists",e[e.byLink=8]="byLink",e}({});const p=[{alias:"all",value:0},{alias:"by_link",value:8},{alias:"friends_of_friends",value:2},{alias:"friends",value:1},{alias:"only_me",value:3},{alias:"all_except",value:4},{alias:"some_friends",value:5},{alias:"some_friend_lists",value:6}];const h=[{alias:"all",value:0},{alias:"members",value:1},{alias:"editors",value:2},{alias:"by_link",value:3},{alias:"nobody",value:4},{alias:"donut",value:5},{alias:"not_published",value:-1}],E=5,g=".srt",v={chunkSize:r.VIDEO_UPLOAD_CHUNK_SIZE,threadNumber:r.VIDEO_UPLOAD_FILE_THREAD_NUMBER,maxRetryNumber:r.VIDEO_UPLOAD_CHUNK_MAX_RETRY_NUMBER,debugMode:window.videoUploadSdkConfig&&!0===window.videoUploadSdkConfig.debugMode},S=128,R=5e3,m=18,A=".jpg,.jpeg,.png",b=142,O=80,N=4,C={[i.TabType.Information]:s.VideoPublishActionEventTypes.EVENT_TYPE_GO_TO_INFORMATION,[i.TabType.Additional]:s.VideoPublishActionEventTypes.EVENT_TYPE_GO_TO_ADDITIONAL,[i.TabType.Publication]:s.VideoPublishActionEventTypes.EVENT_TYPE_GO_TO_PUBLICATION},I="video_lazy_load_playlists_in_uploader"},210986:(e,t,o)=>{o.d(t,{EditSubtitleAction:()=>i,TabType:()=>r});var r=function(e){return e.Information="Information",e.Additional="Additional",e.Publication="Publication",e}({}),i=function(e){return e.Remove="remove",e.EditLang="edit_lang",e.SetDefault="set_default",e}({})},72966:(e,t,o)=>{o.d(t,{checkFileParams:()=>q,filterBatchedEditVideoResponse:()=>j,filterBatchedPublishVideoRejectedResponse:()=>W,filterBatchedPublishVideoResponse:()=>K,filterRejectedResponse:()=>F,filterRejectedResponseWithErrorSubcode:()=>G,getBatchedRequestsResponsesMapper:()=>x,getEncodeProgressTimeoutValue:()=>X,getExitConfirmInfo:()=>w,getFormattedOrdData:()=>C,getMyVideosUrl:()=>M,getPlaylistOption:()=>y,getPrivacyLabel:()=>L,getResponseForCurrentVideo:()=>V,getUploadFormId:()=>N,getValidVideoFiles:()=>f,getVideoEditParams:()=>B,getVideoPrivacyKey:()=>P,getVideoPublishParams:()=>H,hasUnpublishedVideos:()=>$,isAbortApiError:()=>A,isSuccessfulVideoDeletingResponseForCurrentVideo:()=>U,ordMiniAppOpen:()=>I,parsePrivacyNewFormatToOld:()=>D,parsePrivacyOldFormatToNew:()=>k,shouldDisableDate:()=>T,showNotification:()=>Y,videoUploadLogEvent:()=>b});var r=o(60411),i=o(866467),s=o(636576),a=o(889369),n=o(272880),d=o(782399),_=o(538522),l=o(615650),c=o(352986),u=o(664331),p=o(395846),h=o(856289),E=o(172479),g=o(898848),v=o(807978),S=o(540462),R=o(652547),m=o(248812);const A=e=>e&&(0,d.isNetworkError)(e)&&(0,u.isRequestAbortError)(e.error),b=(e,t)=>{let o;"boolean"==typeof t&&(o=t?"on":"off"),(0,s.statlogsValueEvent)("video_upload_page","",e,o)},O=(e=!0)=>{const t=e?"visible":"hidden",o=e?"1":"0",r=document.getElementById("box_layer_bg"),i=document.getElementById("box_layer_wrap");i&&r&&(i.style.visibility=t,r.style.visibility=t,i.style.opacity=o)},N=e=>e.fileObject?(0,_.joinRawId)({ownerId:e.fileObject.owner_id||0,itemId:e.fileObject.video_id||0}):e.externalFileObject?String(e.externalFileObject.extraData):"",C=e=>JSON.stringify({is_ads:e.is_ad,advertisers:[{ord_pred_id:e.ord_pred_id,er_id:e.erid}]}),I=(e,t,o,s=!0,a)=>{const n={edit:!1,options:{noLocChange:1,skipBoxesHide:1,hideBackButton:1,hideCloseButton:1,noClickHide:1,onLoaded:()=>{const e=document.querySelector(".app_actions_menu_wrap");e&&(e.style.display="none"),window.wkcur.onFail=O,window.wkcur.onHide=()=>{O(),window.cur.onExternalAppDone=null,window.wkcur.onFail=null,window.wkcur.onHide=null},window.cur.onExternalAppDone=()=>{window?.WkView.hide(!1,!0)},O(!1)},onFail:()=>O()},isSnackbar:!1};(0,r.handleOrdMiniappOpen)(e,(e=>{e&&(t(e),e.is_ad?o((0,i.getLang)("video_clip_ads_from_author_added")):o((0,i.getLang)("video_clip_ads_from_author_empty")),O()),s&&b("onAddAdvertisement")}),n,a)},T=e=>{const t=new Date,o=new Date;return t.setDate(t.getDate()-1),o.setFullYear(o.getFullYear()+1),(0,a.isAfter)(e,o)||(0,n.isBefore)(e,t)},y=e=>({label:e.title,value:e.id,preview:e.image?.[0]?.url||"",privacy:"all"!==e.privacy?.category}),f=e=>{const t=new DataTransfer;if(e?.length)for(let o=0;o<e.length;o++){const r=e.item(o);r&&(0,l.checkFileType)(r,p.SHORT_VIDEO_UPLOAD_EXTS)&&t.items.add(r)}return t.files},w=({notUploadedVideosCount:e=0,unsavedVideosCount:t=0,unsavedPostponedVideosCount:o=0,externalVideosCount:r=0,notUploadedClipCount:s=0,unsavedClipCount:a=0,unsavedClipPostponedCount:n=0,publishedNotUploadedVideosCount:d=0})=>{let _="",l="",c=(0,i.getLang)("video_publish_btn"),u=(0,i.getLang)("video_upload_come_back_later");return 1!==e||1!==r||t||o?r>1&&e===r&&!t&&!o?(_=(0,i.getLang)("video_upload_publish_video"),l=(0,i.getLang)("video_upload_cancel_externals_uploading"),u=(0,i.getLang)("global_cancel")):d?(_=(0,i.getLang)("video_uploader_page_exit_title"),l=(0,i.getLang)("video_uploader_page_exit_message"),c=(0,i.getLang)("video_uploader_leave"),u=(0,i.getLang)("global_cancel")):e&&e!==r||s?(_=(0,i.getLang)("video_upload_cancel_uploading"),l=(0,i.getLang)("video_upload_cancel_uploading_exit"),c=(0,i.getLang)("video_upload_interrupt_and_exit"),u=(0,i.getLang)("global_cancel")):t&&!o&&a&&!n?(_=(0,i.getLang)("video_upload_publish_video"),l=(0,i.getLang)("video_upload_publish_video_clip_text")):!t&&o&&!a&&n?(_=(0,i.getLang)("video_upload_schedule_publication"),l=(0,i.getLang)("video_upload_schedule_publication_video_clip_text"),c=(0,i.getLang)("video_upload_schedule_post")):(t||o)&&(a||n)?(_=(0,i.getLang)("video_upload_publish_video"),l=(0,i.getLang)("video_upload_publish_many_video_clip_text")):1!==t||o?1!==o||t?o>1&&!t?(_=(0,i.getLang)("video_upload_schedule_publications"),l=(0,i.getLang)("video_upload_schedule_publications_text"),c=(0,i.getLang)("video_upload_schedule_publications_btn")):o||t||r?(_=(0,i.getLang)("video_upload_publish_video"),l=(0,i.getLang)("video_upload_publish_many_videos_text")):a?(_=(0,i.getLang)("video_upload_publish_clip"),l=(0,i.getLang)("video_upload_publish_clip_text"),u=(0,i.getLang)("global_cancel")):a||1!==n?!a&&n>1&&(_=(0,i.getLang)("video_upload_schedule_publications"),l=(0,i.getLang)("video_upload_schedule_publications_text"),c=(0,i.getLang)("video_upload_schedule_publications_btn"),u=(0,i.getLang)("global_cancel")):(_=(0,i.getLang)("video_upload_schedule_publication"),l=(0,i.getLang)("video_upload_schedule_publication_modal_text"),c=(0,i.getLang)("video_upload_schedule_post"),u=(0,i.getLang)("global_cancel")):(_=(0,i.getLang)("video_upload_schedule_publication"),l=(0,i.getLang)("video_upload_schedule_publication_modal_text"),c=(0,i.getLang)("video_upload_schedule_post")):(_=(0,i.getLang)("video_upload_publish_video"),l=(0,i.getLang)("video_upload_publish_video_modal_text")):(_=(0,i.getLang)("video_upload_publish_video"),l=(0,i.getLang)("video_upload_cancel_external_uploading"),u=(0,i.getLang)("global_cancel")),{title:_,text:l,primaryBtn:c,secondaryBtn:u}},P=(e,t="",o="")=>t+[e.ownerId,e.fileObject?.video_id??e.externalFileObject?.extraData??0,o].filter(Boolean).join("_"),L=e=>{switch(e){case"all":return(0,i.getLang)("privacy_options_all_users");case"members":return(0,S.partConfigEnabled)("video_channel_rename")?(0,i.getLang)("video_privacy_group_for_channel_members"):(0,i.getLang)("video_privacy_group_for_members");case"editors":return(0,i.getLang)("video_privacy_group_for_editors");case"by_link":return(0,i.getLang)("video_privacy_group_by_link");case"donut":return(0,i.getLang)("video_privacy_group_for_donut");case"friends":return(0,i.getLang)("privacy_options_friends_only");case"friends_of_friends":return(0,i.getLang)("privacy_options_friends_and_friends");case"only_me":return(0,i.getLang)("privacy_options_only_me");case"nobody":return(0,i.getLang)("privacy_options_nobody");case"all_except":return(0,i.getLang)("privacy_options_advanced_settings");case"some_friends":return(0,i.getLang)("privacy_options_some_friends");case"some_friend_lists":return(0,i.getLang)("privacy_options_some_friend_lists");case"best_friends":return(0,i.getLang)("video_clips_privacy_options_best_friends_only");default:return""}},k=(e,t)=>{const o=(window.Privacy.getValue(e)||"").split("_");if(1===o.length)return t.find((e=>String(e.value)===o[0]))?.alias||"";if(2===o.length)return Number(o[0])+1===c.EUsersPrivacyCategories.someFriendLists?o[1].split(",").map((e=>`list${e}`)).join(","):o[1];if(4===o.length){const e=o[3].split(",").map((e=>Number(e)<0?`-list${Math.abs(Number(e))}`:String(-e))).join(",");if("0"===o[1]){return`${o[2].split(",").map((e=>Number(e)<0?`list${Math.abs(Number(e))}`:e)).join(",")},${e}`}return`${t.find((e=>String(e.value)===o[2]))?.alias||""},${e}`}return""},D=(e,t)=>{const o=e.owners?.allowed||[],r=e.owners?.excluded||[],i=e.lists?.allowed?.map((e=>-e))||[],s=e.lists?.excluded?.map((e=>-e))||[],a=e.category;if(a&&"list28"!==a){const e=String(t.find((e=>e.alias===a))?.value||0);return r.length||s.length?[c.EUsersPrivacyCategories.allExcept,1,[e],s.concat(r)]:[e,1,[e],[]]}return r.length||s.length?[c.EUsersPrivacyCategories.allExcept,0,i.concat(o),s.concat(r)]:o.length?[String(c.EUsersPrivacyCategories.someFriends),0,o,[]]:i.length?[String(c.EUsersPrivacyCategories.someFriendLists),0,i,[]]:["0",1,["0"],[]]},V=(e,t)=>{const o=t?.fileObject;if(!t||!o)return!1;const r=o.owner_id,i=o.video_id;if(!r||!i)return!1;return e[(0,_.joinRawId)({ownerId:r,itemId:i})]},M=(e,t)=>{const o="group"===e?.type||"page"===e?.type||"event"===e?.type,r=(0,E.getOwnerUrl)(e,(0,h.getOwnerVideosPageBasePath)());return e?.id&&t?o?`${r}/${t}`:[r,new URLSearchParams({section:t}).toString()].join("?"):r},U=(e,t)=>{const o=V(e,t);return o&&"fulfilled"===o?.status&&1===o?.value},x=(e,t)=>t.reduce(((t,o,r)=>{const i=e[r];if(i&&"owner_id"in i&&"number"==typeof i.owner_id&&"video_id"in i&&"number"==typeof i.video_id){const e=(0,_.joinRawId)({ownerId:i.owner_id,itemId:i.video_id});return{...t,[e]:{...o,query:i}}}return t}),{}),K=({uploadData:e},t)=>{const o=V(t,e);return o&&"fulfilled"===o?.status&&!!o?.value?.video},W=({uploadData:e},t)=>{const o=V(t,e);if(!o||"rejected"!==o?.status)return!1;const{error:r}=o?.reason;return r&&"error_subcode"in r&&-1!==Number(r.error_subcode)},j=({uploadData:e},t)=>{const o=V(t,e);if(!o||"fulfilled"!==o.status)return!1;const r=o?.value;return!!r.success},H=({uploadData:e,title:t,description:o,isRepeat:r,publishDate:i,ordInfo:s,selectedThumb:a,uploadedThumb:n,isHideAutoSubs:d,actionLink:l,actionLinkError:c,isPublishOnWall:u,checkContentId:p,privacyVideoList:h,privacyCommentsList:E,clipsForVideo:g,donutSelectedLevelId:S})=>{const R=e?.fileName||"",m={owner_id:Number(e?.fileObject?.owner_id),video_id:Number(e?.fileObject?.video_id),title:t,description:o,repeat:r?1:0,hide_auto_subs:d?1:0,add_to_wall:u?1:0,file_ext:R.match(/\.([^.]+)$/)?.[1],check_content_id:p?1:0,donut_level_id:S??void 0};!c&&l&&(m.action_link=l,b("onLinkInVideo")),i&&(m.publish_at=Math.floor(i.getTime()/v.SECOND)),a&&(m.thumb_id=String(a),a===n?.photo_id&&(m.thumb_id=(0,_.joinRawId)({ownerId:a,itemId:Number(n?.photo_owner_id)}),m.thumb_hash=n.photo_hash)),s&&(m.ord_info=C(s)),window.nav?.objLoc?.ocl&&(m.ocl=1),e&&(m.privacy_video=k(P(e,"video"),h),m.privacy_video_comments=k(P(e,"videocomm"),E));const A=g.map((e=>(0,_.joinRawId)({itemId:Number(e.id),ownerId:Number(e.owner_id)})));return m.attach_short_videos=A.join(","),b(o.length?"onSaveWithDesc":"onSaveVideo"),m},B=({uploadData:e,title:t,description:o,isRepeat:r,publishDate:i,ordInfo:s,selectedThumb:a,uploadedThumb:n,isHideAutoSubs:d,actionLink:l,isPublished:c,savedVideo:u,isExternal:p,privacyVideoList:h,privacyCommentsList:E,actionLinkError:g})=>{const S={owner_id:u?.owner_id?u.owner_id:Number(e?.fileObject?.owner_id),video_id:u?.id?u.id:Number(e?.fileObject?.video_id),name:t,desc:o};return p||(S.repeat=r?1:0,S.hide_auto_subs=d?1:0,a&&(S.thumb_id=String(a),a===n?.photo_id&&(S.thumb_id=(0,_.joinRawId)({ownerId:a,itemId:Number(n?.photo_owner_id)}),S.thumb_hash=n.photo_hash)),c||(S.publish_date=Math.floor((i?i.getTime():Date.now())/v.SECOND)),!g&&l&&(S.action_link=l,b("onLinkInVideo"))),s&&(S.ord_info=C(s)),c&&e&&(S.privacy_view=k(P(e,"video"),h),S.privacy_comment=k(P(e,"videocomm"),E)),b(o.length?"onSaveWithDesc":"onSaveVideo"),S},F=({uploadData:e},t)=>{const o=V(t,e);return o&&"rejected"===o?.status},G=({uploadData:e},t)=>{const o=V(t,e);if(!o||"rejected"!==o?.status)return!1;const{error:r}=o?.reason;return r&&"error_subcode"in r&&-1!==Number(r.error_subcode)},Y=({fileType:e,ownerType:t,groupName:o,amount:r})=>{if(!("Notifier"in window)||!("showEvent"in window.Notifier))return;const s=(({ownerType:e,groupName:t,amount:o})=>{if("multiple"===o)return"user"===e?(0,i.getLang)("global_video_uploader_success_videos_publication_notification_for_user"):t?(0,i.langReplace)((0,i.getLang)("global_video_uploader_success_videos_publication_notification_for_community"),{name:t}):void 0})({ownerType:t,groupName:o,amount:r})??(({fileType:e,ownerType:t,groupName:o})=>{if("video"===e)return"user"===t?(0,i.getLang)("global_video_uploader_success_video_publication_notification_for_user"):o?(0,i.langReplace)((0,i.getLang)("global_video_uploader_success_video_publication_notification_for_community"),{name:o}):void 0})({fileType:e,ownerType:t,groupName:o})??(({fileType:e,ownerType:t,groupName:o})=>{if("clip"===e)return"user"===t?(0,i.getLang)("global_video_uploader_success_clip_publication_notification_for_user"):o?(0,i.langReplace)((0,i.getLang)("global_video_uploader_success_clip_publication_notification_for_community"),{name:o}):void 0})({fileType:e,ownerType:t,groupName:o})??"";window.Notifier.showEvent({type:"done_box",preventHideByClick:!0,text:`<div style="min-height: 32px; display: flex; align-items: center;"><div className="notifier_snackbar_text">${(0,g.clean)(s)}</div></div>`,avatar_custom_content:(0,m.getIcon24CheckCircleOutline)().icon,tooltipHandler:e=>{e.classList.add("notifier_snackbar_with_custom_before"),e.classList.add("notifier_snackbar_type_ok")}})},$=e=>e.unsavedClipCount>0||e.unsavedVideosCount>0||e.externalVideosCount>0||e.notUploadedClipCount>0||e.notUploadedVideosCount>0||e.unsavedClipPostponedCount>0||e.unsavedPostponedVideosCount>0||e.publishedNotUploadedVideosCount>0;async function q(e,t){const o=await(0,l.getVideoMetadata)(e),r=(0,S.getConfigValue)("short_video_publish_video_to_clips_duration_min")??R.CLIP_MIN_LIMIT,i=(0,S.getConfigValue)("short_video_publish_video_to_clips_duration_max")??R.CLIP_MAX_LIMIT;return{hasMetadata:!!o&&"duration"in o&&"height"in o&&"width"in o,isVideoAsClip:!t?.is_closed&&(null!==o&&o.duration<i&&o.duration>r&&o.height>=o.width)}}const X=(e=0,t=1)=>(Math.floor(e/c.MAX_COUNT_REQUEST_TO_ENCODE_PROGRESS)+Math.ceil(t/c.MAX_COUNT_REQUEST_TO_ENCODE_PROGRESS))*v.SECOND*2},60411:(e,t,o)=>{o.d(t,{handleOrdMiniappOpen:()=>_});var r=o(494565),i=o(52905),s=o(866467),a=o(310338),n=o(432465),d=o(545537);const _=(e,t,o,_)=>{const l=_?{...e,service:_}:e,c=l?(0,r.objectToQuerystring)(l,"#"):"",u=(0,a.getStore)().onOrdData.watch((r=>{o?.isSnackbar&&(r?.is_ad&&!e?.is_ad?(0,n.showSnackbar)({text:(0,s.getLang)("global_ads_wall_post_ord_mark_as_ads_added"),timeout:3e3,type:"ok28"}):!r?.is_ad&&e?.is_ad&&(0,n.showSnackbar)({text:(0,s.getLang)("global_ads_wall_post_ord_mark_as_ads_removed"),timeout:3e3,type:"loudspeaker28"})),t(r,o?.ref),u()}));o=o||{};const p={...o,options:{...o.options||{}}},{onDestroy:h,onLoaded:E}=p.options;p.options.asBox?p.options.onDestroy=(...e)=>{h?.(...e),u()}:p.options.onLoaded=(...e)=>{E?.(...e),(0,d.addWkViewHideQueue)((()=>u()))},window.showWiki?.({w:`app${i.ORD_APP_ID}${c}`},p?.edit,p?.ev,p?.options)}},777446:(e,t,o)=>{o.d(t,{curBox:()=>r.curBox,showDoneBox:()=>r.showDoneBox});var r=o(246429)},889438:(e,t,o)=>{o.d(t,{getMessengerSharedState:()=>r.getMessengerSharedState});var r=o(408223)},408223:(e,t,o)=>{o.d(t,{getMessengerSharedState:()=>i});var r=o(720357);const i=(0,o(558137).makeSharedState)("vkcom-messenger::web",(()=>({externalEvents:new r.ExternalEvents})),{version:0})},247418:(e,t,o)=>{o.d(t,{showNewOrReplacePopout:()=>s});var r=o(876229),i=o(777446);function s({onSubmitReplace:e,onSubmitNew:t,lang:o}){(0,r.showFastBoxModal)({title:o.getLang("video_editor_popout_new_or_replace_header"),text:o.getLang("video_editor_popout_new_or_replace_lock_text"),yesButtonLabel:o.getLang("global_save"),onYesButtonClick:()=>{(0,i.curBox)().hide(),e()},noButtonLabel:o.getLang("video_editor_popout_new_or_replace_save"),onNoButtonClick:()=>{(0,i.curBox)().hide(),t()}})}},762797:(e,t,o)=>{o.d(t,{showSaveFailedPopout:()=>a});var r=o(876229),i=o(289475),s=o(777446);function a(e){const{getLang:t}=e;(0,r.showFastBoxModal)({title:t("video_editor_popout_save_failed_header"),text:(0,i.partConfigEnabled)("video_new_editor_page")?t("video_new_editor_popout_save_failed_text"):t("video_editor_popout_save_failed_text"),yesButtonLabel:t("video_editor_popout_save_failed_got_it"),onYesButtonClick:()=>{(0,s.curBox)().hide()}})}},244632:(e,t,o)=>{o.d(t,{showNewOrReplacePopout:()=>r.showNewOrReplacePopout,showSaveFailedPopout:()=>i.showSaveFailedPopout});var r=o(247418),i=o(762797)},876229:(e,t,o)=>{o.d(t,{showFastBoxModal:()=>h});var r=o(474848),i=o(296540),s=o(454154),a=o(694244),n=o(782174),d=o(63614),_=o(908242),l=o(149333),c=o(604743);const u=450,p=({title:e,text:t,yesButtonLabel:o,onYesButtonClick:c,noButtonLabel:p,onNoButtonClick:h,refreshCoordinates:E,onClose:g})=>{const v=(0,l.useLangs)();(0,i.useEffect)((()=>{E()}),[]);const S=(0,i.useMemo)((()=>{const e=[];return p&&h&&e.push((0,r.jsx)(s.Button,{mode:"tertiary",size:"m",onClick:h,children:p},"button-cancel")),o&&c&&e.push((0,r.jsx)(s.Button,{mode:"primary",size:"m",onClick:c,children:o},"button-save")),e}),[o,c,p,h]);return(0,r.jsxs)(a.ModalBox,{maxWidth:u,children:[(0,r.jsx)(n.ModalHeader,{onClose:g,closeAriaLabel:v.getLang("global_close"),centered:!0,children:e}),(0,r.jsx)(d.ModalBody,{insetLevel:2,children:t}),(0,r.jsx)(_.ModalFooter,{actions:S})]})};function h(e){return(0,c.showMessageBoxModal)((t=>(0,r.jsx)(p,{...t,...e})),{width:u})}},998654:(e,t,o)=>{o.d(t,{CANVAS_THUMBNAILS_ID:()=>c,DEFAULT_PREVIEW_SELECTED_FRAGMENT:()=>N,EEntryPointName:()=>A,EditorMode:()=>I,FRAGMENT_BORDER_RADIUS:()=>v,FRAGMENT_BORDER_WIDTH:()=>g,FRAGMENT_DURATION_MIN:()=>m,FRAGMENT_EPSILON:()=>R,FRAGMENT_SPLIT_INC:()=>S,FRAGMENT_WIDTH_MIN:()=>E,FragmentDraggingType:()=>T,MAX_PREVIEW_SELECTED_FRAGMENT:()=>O,MIN_PREVIEW_SELECTED_FRAGMENT:()=>b,SCROLL_MINIMAL_WIDTH:()=>p,SEGMENTS_TIMELINE_COUNT:()=>h,SNACKBAR_TIMEOUT:()=>C,TIMELINE_CANVAS_PADDING:()=>n,TIMELINE_CANVAS_WIDTH_FULLSCREEN:()=>s,TIMELINE_CANVAS_WIDTH_WINDOWED:()=>a,TIMELINE_MAX_ZOOM_LEVEL:()=>_,TIMELINE_MIN_ZOOM_LEVEL:()=>d,TIMELINE_SCROLL_USER_INTERACTION_TIMEOUT:()=>l,TIME_MARKER_POINTS_COUNT:()=>u,VIDEO_EDITOR_MODAL_HEIGHT_WINDOWED:()=>i});var r=o(502940);const i=650,s=window.innerWidth,a=724,n=12,d=1,_=5,l=10*r.millisecondsInSecond,c="canvasThumbnails",u=4,p=50,h=5,E=40,g=2,v=8,S=1e-8,R=1e-4,m=.1-S;var A=function(e){return e.VideoUpload="video_upload",e.VideoEdit="video_edit",e.VideoToClip="video_to_clip",e.VideoAsClipVideoUpload="video_as_clip_video_upload",e}({});const b=1,O=179,N=60,C=1e4;var I=function(e){return e.Preview="preview",e.Edit="edit",e}({}),T=function(e){return e.Right="right",e.Left="left",e.Middle="middle",e}({})},191792:(e,t,o)=>{o.d(t,{EEntryPointName:()=>r.EEntryPointName,StatsService:()=>i.StatsService,getVideoEditorModalModule:()=>a,showNewOrReplacePopout:()=>s.showNewOrReplacePopout,showSaveFailedPopout:()=>s.showSaveFailedPopout});var r=o(998654),i=o(284177),s=o(244632);function a(){return Promise.all([o.e(91498),o.e(89631),o.e(50524),o.e(37897),o.e(99370),o.e("langs/web/VideoEditorModal")]).then(o.bind(o,687301))}},284177:(e,t,o)=>{o.d(t,{StatsService:()=>s});var r=o(517401),i=o(70515);class s{init(e){this.video=e}sendOpenVideoEditorStats(){const e=i.VideoPublishActionEventTypes.EVENT_TYPE_OPEN_VIDEO_EDITOR;this.sendVideoPublishStats(e)}sendCutVideoStats(){const e=i.VideoPublishActionEventTypes.EVENT_TYPE_CUT_VIDEO;this.sendVideoPublishStats(e)}sendSaveEditedVideoStats(e){const t=e?i.VideoPublishActionEventTypes.EVENT_TYPE_SAVE_EDITED_VIDEO_AS_NEW:i.VideoPublishActionEventTypes.EVENT_TYPE_SAVE_EDITED_VIDEO;this.sendVideoPublishStats(t)}sendVideoPublishStats(e){!this.sendedEvents.has(e)&&this.video?.owner_id&&this.video?.id&&(r.videoPublishStatsCollector.logEvent({event_type:e,video_owner_id:this.video.owner_id,video_id:this.video.id}),this.sendedEvents.add(e))}sendCreateClipStats(){const e=i.VideoCreateClipActionEventTypes.EVENT_TYPE_CREATE_CLIP;this.sendVideoCreateClipStats(e)}sendCreateClipCutStats(e){const t=e?i.VideoCreateClipActionEventTypes.EVENT_TYPE_CREATE_CLIP_CUT_CROP:i.VideoCreateClipActionEventTypes.EVENT_TYPE_CREATE_CLIP_CUT;this.sendVideoCreateClipStats(t)}sendCreateClipCancelStats(){const e=i.VideoCreateClipActionEventTypes.EVENT_TYPE_CREATE_CLIP_CANCEL;this.sendVideoCreateClipStats(e)}sendCreateClipCancelSubmitStats(e){const t=e?i.VideoCreateClipActionEventTypes.EVENT_TYPE_CREATE_CLIP_CANCEL_YES:i.VideoCreateClipActionEventTypes.EVENT_TYPE_CREATE_CLIP_CANCEL_NO;this.sendVideoCreateClipStats(t)}sendVideoCreateClipStats(e){!this.sendedEvents.has(e)&&this.video?.owner_id&&this.video?.id&&(r.videoCreateClipStatsCollector.logEvent({event_type:e,video_owner_id:this.video.owner_id,video_id:this.video.id}),this.sendedEvents.add(e))}dispose(){this.video=null,this.sendedEvents=new Set}constructor(){this.sendedEvents=new Set,this.video=null}}},879168:(e,t,o)=>{o.d(t,{Atom:()=>r});class r{set(e,{notify:t=!0}={}){t&&this.base.notify(this.key)}getKey(){return`${this.base.options.storeName}-${this.key}`}constructor({key:e,base:t}){this.key=e,this.base=t}}},98184:(e,t,o)=>{o.d(t,{Store:()=>r});class r{subscribe(e,t){const o=this.getListeners(t);return o.add(e),()=>{o.delete(e)}}notify(e,t){this.getListeners(t).forEach((t=>{t(e)}))}refresh(){try{localStorage.setItem(this.key,""),localStorage.removeItem(this.key)}catch{}}destroy(){this.listeners.clear(),this.syncListeners.clear(),r.instances.delete(this.key)}get key(){const{dbName:e,storeName:t,version:o}=this.options;return`${e}-v${o}-${t}`}getListeners(e){return e?this.syncListeners:this.listeners}constructor(e){this.listeners=new Set,this.syncListeners=new Set,this.options=e,r.instances.set(this.key,this)}}r.instances=new Map,window.addEventListener("storage",(({key:e,newValue:t})=>{if(!e||null===t)return;const o=r.instances.get(e);o?.notify()}))},100596:(e,t,o)=>{o.d(t,{SyncAtom:()=>s,SyncAtomType:()=>i});var r=o(879168),i=function(e){return e.OBJECT="object",e.STRING="string",e.NUMBER="number",e.BOOLEAN="boolean",e.STRING_NUMBER="string_number",e}({});class s extends r.Atom{get(){const e=this.getKey();try{let t=localStorage.getItem(e);if(!t)return null;switch(this.type){case"object":try{t=JSON.parse(t)}catch{return null}break;case"number":t=Number(t)||0;break;case"string_number":t=Number(t)||t;break;case"boolean":t=Boolean(Number(t))}return t}catch(t){return console.log(`${e}: Ошибка чтения данных из хранилища`),console.log(t),this.cache||null}}set(e,t){const o=this.getKey();let r;switch(this.type){case"object":r=JSON.stringify(e);break;case"boolean":r=String(Number(e));break;default:r=String(e)}try{localStorage.setItem(o,r)}catch(t){console.log(`${o}: Не удалось записать данные в хранилище`),console.log(t),this.cache=e}super.set(e,t)}delete(){const e=this.getKey();try{delete this.cache,localStorage.removeItem(e)}catch(t){console.log(`${e}: Ошибка удаления ключа из хранилища`),console.log(t)}}getKey(){return`${this.base.key}-${this.key}`}constructor(e){super(e);const{base:t,type:o}=e;this.base=t,this.type=o}}},724361:(e,t,o)=>{o.d(t,{createSyncStore:()=>a});var r=o(98184),i=o(100596);class s extends r.Store{createAtom(e,t){return new i.SyncAtom({key:e,type:t,base:this})}constructor(e){super(e)}}function a(e){return new s(e)}},523901:(e,t,o)=>{o.d(t,{PackContext:()=>_});var r=o(434518),i=o(763812),s=(0,i._)("_options"),a=(0,i._)("_pack"),n=(0,i._)("_product"),d=(0,i._)("_stockItem");class _{get rawData(){return(0,r._)(this,a)[a]||(0,r._)(this,d)[d]||(0,r._)(this,n)[n]}get isPack(){return Boolean((0,r._)(this,a)[a])}get isProduct(){return Boolean((0,r._)(this,n)[n])}get isStockItem(){return Boolean((0,r._)(this,d)[d])}get isStoreItem(){return this.isProduct||this.isStockItem}get stockItem(){return(0,r._)(this,d)[d]}get id(){const e=(0,r._)(this,s)[s]?.redefine?.id;if(void 0!==e)return e;const t=(0,r._)(this,n)[n]?.id;return void 0!==t?t:(0,r._)(this,a)[a]?.id}setHint(e){return(0,r._)(this,s)[s]?((0,r._)(this,s)[s].hint=e,this):this}get hintId(){return(0,r._)(this,s)[s]?.hint?.id}get hintWidth(){return(0,r._)(this,s)[s]?.hint?.width}get index(){return(0,r._)(this,s)[s]?.index}get referrer(){return(0,r._)(this,s)[s]?.referrer}get tooltip(){return(0,r._)(this,s)[s]?.tooltip}get title(){return(0,r._)(this,s)[s]?.redefine?.title||(0,r._)(this,n)[n]?.title||""}get stickers(){return(0,r._)(this,s)[s]?.redefine?.stickers||(0,r._)(this,a)[a]?.stickers||(0,r._)(this,n)[n]?.stickers}get baseId(){return(0,r._)(this,n)[n]?.base_id}get isStyle(){return void 0!==this.baseId}get hasStyles(){return Boolean(this.styleIds?.length)}get styleIds(){return(0,r._)(this,n)[n]?.style_ids}get canGift(){return Boolean((0,r._)(this,d)[d]?.can_gift)}get vmojiAvatar(){return(0,r._)(this,n)[n]?.vmoji_avatar}get isVmoji(){return Boolean(this.vmojiAvatar||(0,r._)(this,n)[n]?.is_vmoji)}get isPopup(){return(0,r._)(this,n)[n]?.is_popup}get isNew(){return(0,r._)(this,n)[n]?.is_new}get previews(){return(0,r._)(this,n)[n]?.previews}constructor({pack:e,...t}){Object.defineProperty(this,s,{writable:!0,value:void 0}),Object.defineProperty(this,a,{writable:!0,value:void 0}),Object.defineProperty(this,n,{writable:!0,value:void 0}),Object.defineProperty(this,d,{writable:!0,value:void 0}),(0,r._)(this,s)[s]=t,e&&("product"in e?((0,r._)(this,d)[d]=e,(0,r._)(this,n)[n]=e.product):"id"in e&&"type"in e?(0,r._)(this,n)[n]=e:(0,r._)(this,a)[a]=e)}}},348385:(e,t,o)=>{o.d(t,{$api:()=>d,APIGate:()=>_,changeAPIOptions:()=>n});var r=o(32489),i=o(293721),s=o(175325),a=o(990490);const n=s.stickersEmojiKeyboard.createEvent(),d=s.stickersEmojiKeyboard.createStore(new a.API({})).on(n,((e,{api:t})=>t)),_=(0,i.createGate)();(0,r.forward)({from:_.state,to:n})},175325:(e,t,o)=>{o.d(t,{stickersEmojiKeyboard:()=>r});const r=(0,o(32489).createDomain)()},720112:(e,t,o)=>{o.d(t,{$favoriteStickers:()=>s,setFavoriteStickers:()=>i});var r=o(175325);const i=r.stickersEmojiKeyboard.createEvent(),s=r.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},460543:(e,t,o)=>{o.d(t,{$hasAvatar:()=>s,setHasAvatar:()=>i});var r=o(175325);const i=r.stickersEmojiKeyboard.createEvent(),s=r.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},939659:(e,t,o)=>{o.d(t,{$packs:()=>h,ServicePackKey:()=>p});var r=o(32489),i=o(270634),s=o(969102),a=o(853262),n=o(460543),d=o(432726),_=o(649179),l=o(409875),c=o(720112),u=o(523901),p=function(e){return e[e.FAVORITE=-1]="FAVORITE",e[e.RECENT=-2]="RECENT",e[e.VMOJI=-3]="VMOJI",e[e.UGC=-4]="UGC",e[e.PHOTO_EDITOR=-5]="PHOTO_EDITOR",e}({});const h=(0,r.combine)(s.$ugcInfo,a.$ugcPacks,d.$stockItems,_.$recentStickers,l.$photoEditorStickers,c.$favoriteStickers,n.$hasAvatar,((e,t,o,r,s,a,n)=>{const d=new Map;let _=[];const l=new Map;let c=0;if(!o||!r||!a||i.$context.getState()===i.CONTEXT.PHOTO_EDITOR&&!s)return{};s?.length&&(d.set(-5,new u.PackContext({index:c,referrer:"keyboard",redefine:{id:-5,stickers:s}})),_.push(-5),c++),a.length&&(d.set(-1,new u.PackContext({index:c,referrer:"favourite",redefine:{id:-1,title:"stickers_picker_favorite",stickers:a}})),_.push(-1),c++),r.length&&(d.set(-2,new u.PackContext({index:c,referrer:"recent",redefine:{id:-2,title:"stickers_picker_recently_used",stickers:r}})),_.push(-2),c++);-1!==o?.findIndex((({product:{vmoji_avatar:e}})=>void 0!==e))||n||(d.set(-3,new u.PackContext({index:c,referrer:"keyboard",redefine:{id:-3,title:"stickers_picker_vmoji"}})),_.push(-3),c++);const p=t?.[0],h=e?.can_edit,E=p?.stickers?.length,g=e?.show_keyboard_onboarding&&h;if(!e?.is_keyboard_hidden&&(E||g)){const e=new u.PackContext({pack:p,index:c,referrer:"keyboard",tooltip:{header:"stickers_picker_ugc_tooltip_title",text:"stickers_picker_ugc_tooltip_description"},redefine:{id:-4,title:"stickers_picker_ugc"}});h&&e.setHint({id:"stickers:ugc_keyboard_onboarding_tooltip",width:176}),d.set(-4,e),_.push(-4),c++}return o.forEach((e=>{const{product:{id:t,vmoji_avatar:o}}=e;if(d.set(t,new u.PackContext({index:c,referrer:"keyboard",pack:e})),o){let e=l.get(o.id);e||(e=_.push([])-1,l.set(o.id,e));const r=_[e];Array.isArray(r)&&r.push(t)}else _.push(t);c++})),{packs:d,packsGroups:_}}))},432726:(e,t,o)=>{o.d(t,{$stockItems:()=>s,setStockItems:()=>i});var r=o(175325);const i=r.stickersEmojiKeyboard.createEvent(),s=r.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},409875:(e,t,o)=>{o.d(t,{$photoEditorStickers:()=>s,setPhotoEditorStickers:()=>i});var r=o(175325);const i=r.stickersEmojiKeyboard.createEvent(),s=r.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},649179:(e,t,o)=>{o.d(t,{$recentStickers:()=>s,setRecentStickers:()=>i});var r=o(175325);const i=r.stickersEmojiKeyboard.createEvent(),s=r.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},969102:(e,t,o)=>{o.d(t,{$ugcInfo:()=>l,reloadUGCInfo:()=>d,setUGCInfo:()=>n});var r=o(32489),i=o(348385),s=o(175325),a=o(579924);const n=s.stickersEmojiKeyboard.createEvent(),d=s.stickersEmojiKeyboard.createEvent(),_=s.stickersEmojiKeyboard.createEffect((e=>e.cache.ugcInfo.get().catch((()=>null)))),l=s.stickersEmojiKeyboard.createStore(null).on(n,((e,t)=>t)).on(_.doneData,((e,t)=>t)).on(a.submitUGCReportFx.doneData,(()=>null));(0,r.sample)({clock:d,source:i.$api,target:_})},853262:(e,t,o)=>{o.d(t,{$ugcPacks:()=>a,setUGCPacks:()=>s});var r=o(175325),i=o(579924);const s=r.stickersEmojiKeyboard.createEvent(),a=r.stickersEmojiKeyboard.createStore(null).on(s,((e,t)=>t)).on(i.submitUGCReportFx.doneData,(()=>null))},579924:(e,t,o)=>{o.d(t,{submitUGCReport:()=>a,submitUGCReportFx:()=>n});var r=o(32489),i=o(348385),s=o(175325);const a=s.stickersEmojiKeyboard.createEvent(),n=s.stickersEmojiKeyboard.createEffect((e=>{e.cache.clearUGC()}));(0,r.sample)({clock:a,source:i.$api,target:n})},528079:(e,t,o)=>{o.d(t,{$userEnv:()=>s,setUserEnv:()=>i});var r=o(175325);const i=r.stickersEmojiKeyboard.createEvent(),s=r.stickersEmojiKeyboard.createStore({}).on(i,((e,t)=>t))},94701:(e,t,o)=>{o.d(t,{Icon12Cancel:()=>s});var r=o(474848),i=(o(296540),o(506447));const s=e=>(0,r.jsx)(i.SvgIconRootV2,{viewBox:"0 0 12 12",width:12,height:12,vkuiIconId:"cancel_12",vkuiAttrs:{fill:"none"},vkuiProps:e,children:(0,r.jsx)("path",{fill:"currentColor",d:"M3.525 2.464a.75.75 0 0 0-1.06 1.061L4.938 6 2.464 8.475a.75.75 0 1 0 1.061 1.06L6 7.062l2.475 2.475a.75.75 0 0 0 1.06-1.061L7.062 6l2.475-2.475a.75.75 0 1 0-1.061-1.06L6 4.938z"})})}}])}if("undefined"!=typeof window&&window.partConfigEnabled?.("static_loading_execute_errors"))try{e(),window.stManager?.done?.("dist/web/chunks/17c58358.c910a952.js")}catch(e){throw window.stManager?.fail?.("dist/web/chunks/17c58358.c910a952.js",e),e}else e(),"undefined"!=typeof window&&window.stManager?.done?.("dist/web/chunks/17c58358.c910a952.js");