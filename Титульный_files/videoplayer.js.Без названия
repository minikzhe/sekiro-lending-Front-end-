!function(){if(window.VK||(window.VK={}),VK.VideoPlayer)return;const e=["state","volume","muted","time","duration","quality"];var t={INITED:"inited",TIMEUPDATE:"timeupdate",VOLUMECHANGE:"volumechange",QUALITYCHANGE:"qualitychange",STARTED:"started",RESUMED:"resumed",PAUSED:"paused",SEEKED:"seeked",ENDED:"ended",ERROR:"error",ADSTARTED:"adStarted",ADCOMPLETED:"adCompleted",AUTOPLAY_SOUND_PROHIBITED:"autoplaySoundProhibited"},n={UNINITED:"uninited",UNSTARTED:"unstarted",PLAYING:"playing",PAUSED:"paused",ENDED:"ended",ERROR:"error"};function o(e){return/^(https?:)?\/\/([a-zA-Z0-9\-_.]+\.)?vk(video)?\.(com|ru)\/video_e(xt|mbed)\.php\?/.test(e)}VK.VideoPlayer=function(i){if(!o(i.src))throw Error("iframe src is not a VK embed");if(!/[?&]js_api=/.test(i.src))throw Error("iframe src js_api param is missing");var a={state:n.UNINITED,volume:1,muted:!1,time:0,duration:0,quality:0},u={},r=[],s="*";return window.addEventListener("message",d),c({method:"init"}),{play:function(){c({method:"play"})},pause:function(){c({method:"pause"})},seek:function(e){c({method:"seek",time:e})},seekLive:function(){c({method:"seekLive"})},setVolume:function(e){c({method:"set_volume",volume:e}),a.volume=e,a.muted=!1},getVolume:function(){return a.volume},getQuality:function(){return a.quality},getCurrentTime:function(){return a.time},getDuration:function(){return a.duration},mute:function(){c({method:"mute"}),a.muted=!0},unmute:function(){c({method:"unmute"}),a.muted=!1},isMuted:function(){return a.muted},getState:function(){return a.state},on:function(e,t){u[e]=u[e]||[],u[e].push(t)},off:function(e,t){const n=u[e]?u[e].indexOf(t):-1;n>-1&&u[e].splice(n,1)},destroy:function(){window.removeEventListener("message",d),u={}}};function d(e){if(e.source===i.contentWindow){"*"===s&&o(i.src)&&(s=e.origin),Object.assign(a,e.data||{});var n=e.data.event;switch(n){case t.INITED:E(n,{videoId:e.data.videoId}),function(){for(;r.length;){c(r.shift())}}();break;case t.PAUSED:case t.ENDED:case t.ERROR:a.state=n,E(n);break;case t.STARTED:case t.RESUMED:case t.TIMEUPDATE:case t.VOLUMECHANGE:case t.QUALITYCHANGE:case t.AUTOPLAY_SOUND_PROHIBITED:case t.SEEKED:E(n);break;case t.ADSTARTED:case t.ADCOMPLETED:E(n,{section:e.data.section})}}}function c(e){a.state!==n.UNINITED||"init"===e.method?i.contentWindow.postMessage(e,s):r.push(e)}function E(t,n={}){var o=function(t={}){var n=t;for(var o in e){const t=e[o];n[t]=a[t]}return n}(n);(u[t]||[]).forEach((function(e){if("function"==typeof e)try{e(o)}catch(e){console.error(e)}}))}},VK.VideoPlayer.Events=t,VK.VideoPlayer.States=n}();