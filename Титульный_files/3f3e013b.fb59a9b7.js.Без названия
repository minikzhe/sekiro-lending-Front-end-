function e(){"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[13070],{897976:(e,t,i)=>{i.d(t,{constructConfig:()=>d,constructSources:()=>l,constructVideoData:()=>u});var r=i(317929),a=i(1100),s=i(807978),n=i(540462);const o={"144p":"mp4_144","240p":"mp4_240","360p":"mp4_360","480p":"mp4_480","720p":"mp4_720","1080p":"mp4_1080","1440p":"mp4_1440","2160p":"mp4_2160"};function l({files:e,live_settings:t}){const i={};let a=t?.playback_duration??t?.max_rewind_duration;a&&(a*=s.SECOND);const l=(0,n.partConfigEnabled)("video_player_support_new_live_links")&&Boolean(t),u=(0,n.partConfigEnabled)("video_player_support_new_live_links")&&!a;if(!e)return i;const d={};for(const[t,i]of Object.entries(o))i in e&&(d[t]=e[i]);return Object.keys(d).length>0?i.MPEG=d:e.src&&(i.MPEG={"Invariant quality":e.src}),e.dash_sep&&(i[r.VideoFormat.DASH_SEP]={type:"url",url:e.dash_sep}),e.dash_webm&&(i[r.VideoFormat.DASH_WEBM]={type:"url",url:e.dash_webm}),e.dash_webm_av1&&(i[r.VideoFormat.DASH_WEBM_AV1]={type:"url",url:e.dash_webm_av1}),e.dash_streams&&(i[r.VideoFormat.DASH_STREAMS]={type:"url",url:e.dash_streams}),e.cmaf&&(i[r.VideoFormat.DASH_LIVE_CMAF]={type:"url",url:e.cmaf}),e.hls&&!l&&(i[r.VideoFormat.HLS]={type:"url",url:e.hls}),e.dash_live&&u&&(i[r.VideoFormat.DASH_LIVE]={type:"url",url:e.dash_live}),!e.dash_live_playback||u&&e.dash_live||(i[r.VideoFormat.DASH_LIVE]={type:"url",url:e.dash_live_playback}),e.hls_live&&u&&(i[r.VideoFormat.HLS_LIVE]={type:"url",url:e.hls_live}),!e.hls_live_playback||u&&e.hls_live||(i[r.VideoFormat.HLS_LIVE]={type:"url",url:e.hls_live_playback,maxSeekBackTime:a}),e.dash_ondemand&&(i[r.VideoFormat.DASH_ONDEMAND]={type:"url",url:e.dash_ondemand}),e.hls_ondemand&&(i[r.VideoFormat.HLS_ONDEMAND]={type:"url",url:e.hls_ondemand}),e.hls_live_ondemand&&(i[r.VideoFormat.HLS_LIVE_CMAF]={type:"url",url:e.hls_live_ondemand,maxSeekBackTime:a}),e.ws&&(i[r.VideoFormat.WEB_RTC_LIVE]={type:"url",url:e.ws}),i}function u(e){const t=l(e),i={status:e.live_status,startTime:e.live_start_time},r=e.image?.sort(((e,t)=>e.height-t.height))??[],a=r.find((({height:e})=>e>500))??r.at(-1),s=e.restriction?{restriction:e.restriction}:{};return{...Object.keys(t).length>0?{sources:t}:{live:i},title:e.title??"",thumbUrl:a?.url,unitedVideoId:parseInt(e.ov_id??"0",10),duration:e.duration??0,videoEpisodes:e.episodes?.map((({time:e,text:t})=>({time:e??0,text:t??""}))),previewThumbsData:e.timeline_thumbs?{countPerImage:e.timeline_thumbs.count_per_image??1,countPerRow:e.timeline_thumbs.count_per_row??1,countTotal:e.timeline_thumbs.count_total??1,frameHeight:e.timeline_thumbs.frame_height??0,frameWidth:e.timeline_thumbs.frame_width??0,frequency:e.timeline_thumbs.frequency??1,isUV:e.timeline_thumbs.is_uv??!1,links:e.timeline_thumbs.links??[]}:void 0,subtitles:e.subtitles?.filter((e=>Boolean(e.url))).map((({is_auto:e,title:t,lang:i,manifest_name:r,url:a,storage_index:s})=>({isAuto:e,id:[t,i,s].filter(Boolean).join("_"),language:i,label:r,url:a}))),...s}}function d(e,t){const i=e.map((e=>u(e))),r=e[0],s={videos:i??[]};return t&&(s.interactiveData={...t,videoLoader:async(e,i)=>{const r=t?.accessKeysMap||{};return d((await(0,a.fetchVideo)(parseInt(e,10),parseInt(i,10),r[i]||"")).items)}}),r?.album_id&&(s.albumId=r.album_id.toString(10)),r?.uv_stats_place&&(s.statPlace=r.uv_stats_place),r?.track_code&&(s.statTrackCode=r.track_code),2===r?.can_download&&(s.canDownload=!0),r?.files?.failover_host&&(s.failoverHosts=[r?.files?.failover_host]),r?.restriction?.mute_info_link&&(s.isAudioDisabled=Boolean(r?.restriction?.mute_info_link)),r?.volume_multiplier&&(s.volumeMultiplier=r?.volume_multiplier),s}},1100:(e,t,i)=>{i.d(t,{fetchVideo:()=>s});var r=i(538522),a=i(805658);const s=async(e,t,i,s={})=>(0,a.apiWithPrefetch)("video.get",{owner_id:e,videos:(0,r.joinRawId)({ownerId:e,itemId:t,externalId:i}),extended:1,...s})},773439:(e,t,i)=>{i.d(t,{ChromecastState:()=>Gi,HttpConnectionType:()=>Ki,Observable:()=>u.Observable,PlaybackState:()=>Wi,Player:()=>vl,PredefinedQualityLimits:()=>Zi,SDK_VERSION:()=>gl,Subscription:()=>u.Subscription,Surface:()=>Yi,VERSION:()=>Hi,VideoFormat:()=>Qi,VideoQuality:()=>u.VideoQuality,clientChecker:()=>Fr,isMobile:()=>Er});var r,a,s,n,o,l,u=i(819705),d=Object.create,c=Object.defineProperty,h=Object.getOwnPropertyDescriptor,p=Object.getOwnPropertyNames,f=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty,v=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),g=(e,t,i)=>(i=null!=e?d(f(e)):{},((e,t,i,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of p(t))!m.call(e,a)&&a!==i&&c(e,a,{get:()=>t[a],enumerable:!(r=h(t,a))||r.enumerable});return e})(!t&&e&&e.__esModule?i:c(i,"default",{value:e,enumerable:!0}),e)),b=v(((e,t)=>{var i=function(e){return e&&e.Math===Math&&e};t.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof global&&global)||i("object"==typeof e&&e)||function(){return this}()||Function("return this")()})),y=v(((e,t)=>{t.exports=function(e){try{return!!e()}catch{return!0}}})),w=v(((e,t)=>{var i=y();t.exports=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))})),S=v(((e,t)=>{var i=w(),r=Function.prototype,a=r.apply,s=r.call;t.exports="object"==typeof Reflect&&Reflect.apply||(i?s.bind(a):function(){return s.apply(a,arguments)})})),x=v(((e,t)=>{var i=w(),r=Function.prototype,a=r.call,s=i&&r.bind.bind(a,a);t.exports=i?s:function(e){return function(){return a.apply(e,arguments)}}})),$=v(((e,t)=>{var i=x(),r=i({}.toString),a=i("".slice);t.exports=function(e){return a(r(e),8,-1)}})),_=v(((e,t)=>{var i=$(),r=x();t.exports=function(e){if("Function"===i(e))return r(e)}})),k=v(((e,t)=>{var i="object"==typeof document&&document.all;t.exports=typeof i>"u"&&void 0!==i?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}})),T=v(((e,t)=>{var i=y();t.exports=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))})),C=v(((e,t)=>{var i=w(),r=Function.prototype.call;t.exports=i?r.bind(r):function(){return r.apply(r,arguments)}})),E=v((e=>{var t={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,r=i&&!t.call({1:2},1);e.f=r?function(e){var t=i(this,e);return!!t&&t.enumerable}:t})),A=v(((e,t)=>{t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}})),L=v(((e,t)=>{var i=x(),r=y(),a=$(),s=Object,n=i("".split);t.exports=r((function(){return!s("z").propertyIsEnumerable(0)}))?function(e){return"String"===a(e)?n(e,""):s(e)}:s})),P=v(((e,t)=>{t.exports=function(e){return null==e}})),M=v(((e,t)=>{var i=P(),r=TypeError;t.exports=function(e){if(i(e))throw new r("Can't call method on "+e);return e}})),I=v(((e,t)=>{var i=L(),r=M();t.exports=function(e){return i(r(e))}})),R=v(((e,t)=>{var i=k();t.exports=function(e){return"object"==typeof e?null!==e:i(e)}})),V=v(((e,t)=>{t.exports={}})),N=v(((e,t)=>{var i=V(),r=b(),a=k(),s=function(e){return a(e)?e:void 0};t.exports=function(e,t){return arguments.length<2?s(i[e])||s(r[e]):i[e]&&i[e][t]||r[e]&&r[e][t]}})),B=v(((e,t)=>{var i=x();t.exports=i({}.isPrototypeOf)})),D=v(((e,t)=>{var i=b().navigator,r=i&&i.userAgent;t.exports=r?String(r):""})),O=v(((e,t)=>{var i,r,a=b(),s=D(),n=a.process,o=a.Deno,l=n&&n.versions||o&&o.version,u=l&&l.v8;u&&(r=(i=u.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!r&&s&&((!(i=s.match(/Edge\/(\d+)/))||i[1]>=74)&&((i=s.match(/Chrome\/(\d+)/))&&(r=+i[1]))),t.exports=r})),F=v(((e,t)=>{var i=O(),r=y(),a=b().String;t.exports=!!Object.getOwnPropertySymbols&&!r((function(){var e=Symbol("symbol detection");return!a(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41}))})),j=v(((e,t)=>{var i=F();t.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator})),z=v(((e,t)=>{var i=N(),r=k(),a=B(),s=j(),n=Object;t.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return r(t)&&a(t.prototype,n(e))}})),U=v(((e,t)=>{var i=String;t.exports=function(e){try{return i(e)}catch{return"Object"}}})),q=v(((e,t)=>{var i=k(),r=U(),a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not a function")}})),H=v(((e,t)=>{var i=q(),r=P();t.exports=function(e,t){var a=e[t];return r(a)?void 0:i(a)}})),W=v(((e,t)=>{var i=C(),r=k(),a=R(),s=TypeError;t.exports=function(e,t){var n,o;if("string"===t&&r(n=e.toString)&&!a(o=i(n,e))||r(n=e.valueOf)&&!a(o=i(n,e))||"string"!==t&&r(n=e.toString)&&!a(o=i(n,e)))return o;throw new s("Can't convert object to primitive value")}})),Q=v(((e,t)=>{t.exports=!0})),G=v(((e,t)=>{var i=b(),r=Object.defineProperty;t.exports=function(e,t){try{r(i,e,{value:t,configurable:!0,writable:!0})}catch{i[e]=t}return t}})),K=v(((e,t)=>{var i=Q(),r=b(),a=G(),s="__core-js_shared__",n=t.exports=r[s]||a(s,{});(n.versions||(n.versions=[])).push({version:"3.38.0",mode:i?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),Y=v(((e,t)=>{var i=K();t.exports=function(e,t){return i[e]||(i[e]=t||{})}})),Z=v(((e,t)=>{var i=M(),r=Object;t.exports=function(e){return r(i(e))}})),X=v(((e,t)=>{var i=x(),r=Z(),a=i({}.hasOwnProperty);t.exports=Object.hasOwn||function(e,t){return a(r(e),t)}})),J=v(((e,t)=>{var i=x(),r=0,a=Math.random(),s=i(1..toString);t.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++r+a,36)}})),ee=v(((e,t)=>{var i=b(),r=Y(),a=X(),s=J(),n=F(),o=j(),l=i.Symbol,u=r("wks"),d=o?l.for||l:l&&l.withoutSetter||s;t.exports=function(e){return a(u,e)||(u[e]=n&&a(l,e)?l[e]:d("Symbol."+e)),u[e]}})),te=v(((e,t)=>{var i=C(),r=R(),a=z(),s=H(),n=W(),o=ee(),l=TypeError,u=o("toPrimitive");t.exports=function(e,t){if(!r(e)||a(e))return e;var o,d=s(e,u);if(d){if(void 0===t&&(t="default"),o=i(d,e,t),!r(o)||a(o))return o;throw new l("Can't convert object to primitive value")}return void 0===t&&(t="number"),n(e,t)}})),ie=v(((e,t)=>{var i=te(),r=z();t.exports=function(e){var t=i(e,"string");return r(t)?t:t+""}})),re=v(((e,t)=>{var i=b(),r=R(),a=i.document,s=r(a)&&r(a.createElement);t.exports=function(e){return s?a.createElement(e):{}}})),ae=v(((e,t)=>{var i=T(),r=y(),a=re();t.exports=!i&&!r((function(){return 7!==Object.defineProperty(a("div"),"a",{get:function(){return 7}}).a}))})),se=v((e=>{var t=T(),i=C(),r=E(),a=A(),s=I(),n=ie(),o=X(),l=ae(),u=Object.getOwnPropertyDescriptor;e.f=t?u:function(e,t){if(e=s(e),t=n(t),l)try{return u(e,t)}catch{}if(o(e,t))return a(!i(r.f,e,t),e[t])}})),ne=v(((e,t)=>{var i=y(),r=k(),a=/#|\.prototype\./,s=function(e,t){var a=o[n(e)];return a===u||a!==l&&(r(t)?i(t):!!t)},n=s.normalize=function(e){return String(e).replace(a,".").toLowerCase()},o=s.data={},l=s.NATIVE="N",u=s.POLYFILL="P";t.exports=s})),oe=v(((e,t)=>{var i=_(),r=q(),a=w(),s=i(i.bind);t.exports=function(e,t){return r(e),void 0===t?e:a?s(e,t):function(){return e.apply(t,arguments)}}})),le=v(((e,t)=>{var i=T(),r=y();t.exports=i&&r((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))})),ue=v(((e,t)=>{var i=R(),r=String,a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not an object")}})),de=v((e=>{var t=T(),i=ae(),r=le(),a=ue(),s=ie(),n=TypeError,o=Object.defineProperty,l=Object.getOwnPropertyDescriptor,u="enumerable",d="configurable",c="writable";e.f=t?r?function(e,t,i){if(a(e),t=s(t),a(i),"function"==typeof e&&"prototype"===t&&"value"in i&&c in i&&!i[c]){var r=l(e,t);r&&r[c]&&(e[t]=i.value,i={configurable:d in i?i[d]:r[d],enumerable:u in i?i[u]:r[u],writable:!1})}return o(e,t,i)}:o:function(e,t,r){if(a(e),t=s(t),a(r),i)try{return o(e,t,r)}catch{}if("get"in r||"set"in r)throw new n("Accessors not supported");return"value"in r&&(e[t]=r.value),e}})),ce=v(((e,t)=>{var i=T(),r=de(),a=A();t.exports=i?function(e,t,i){return r.f(e,t,a(1,i))}:function(e,t,i){return e[t]=i,e}})),he=v(((e,t)=>{var i=b(),r=S(),a=_(),s=k(),n=se().f,o=ne(),l=V(),u=oe(),d=ce(),c=X();K();var h=function(e){var t=function(i,a,s){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,a)}return new e(i,a,s)}return r(e,this,arguments)};return t.prototype=e.prototype,t};t.exports=function(e,t){var r,p,f,m,v,g,b,y,w,S=e.target,x=e.global,$=e.stat,_=e.proto,k=x?i:$?i[S]:i[S]&&i[S].prototype,T=x?l:l[S]||d(l,S,{})[S],C=T.prototype;for(m in t)p=!(r=o(x?m:S+($?".":"#")+m,e.forced))&&k&&c(k,m),g=T[m],p&&(e.dontCallGetSet?b=(w=n(k,m))&&w.value:b=k[m]),v=p&&b?b:t[m],(r||_||typeof g!=typeof v)&&(y=e.bind&&p?u(v,i):e.wrap&&p?h(v):_&&s(v)?a(v):v,(e.sham||v&&v.sham||g&&g.sham)&&d(y,"sham",!0),d(T,m,y),_&&(c(l,f=S+"Prototype")||d(l,f,{}),d(l[f],m,v),e.real&&C&&(r||!C[m])&&d(C,m,v)))}})),pe=v(((e,t)=>{var i=Math.ceil,r=Math.floor;t.exports=Math.trunc||function(e){var t=+e;return(t>0?r:i)(t)}})),fe=v(((e,t)=>{var i=pe();t.exports=function(e){var t=+e;return t!=t||0===t?0:i(t)}})),me=v(((e,t)=>{var i=fe(),r=Math.max,a=Math.min;t.exports=function(e,t){var s=i(e);return s<0?r(s+t,0):a(s,t)}})),ve=v(((e,t)=>{var i=fe(),r=Math.min;t.exports=function(e){var t=i(e);return t>0?r(t,9007199254740991):0}})),ge=v(((e,t)=>{var i=ve();t.exports=function(e){return i(e.length)}})),be=v(((e,t)=>{var i=I(),r=me(),a=ge(),s=function(e){return function(t,s,n){var o=i(t),l=a(o);if(0===l)return!e&&-1;var u,d=r(n,l);if(e&&s!=s){for(;l>d;)if((u=o[d++])!=u)return!0}else for(;l>d;d++)if((e||d in o)&&o[d]===s)return e||d||0;return!e&&-1}};t.exports={includes:s(!0),indexOf:s(!1)}})),ye=v(((e,t)=>{t.exports=function(){}})),we=v((()=>{var e=he(),t=be().includes,i=y(),r=ye();e({target:"Array",proto:!0,forced:i((function(){return!Array(1).includes()}))},{includes:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),r("includes")})),Se=v(((e,t)=>{var i=N();t.exports=i})),xe=v(((e,t)=>{we();var i=Se();t.exports=i("Array","includes")})),$e=v(((e,t)=>{var i=xe();t.exports=i})),_e=v(((e,t)=>{var i=$e();t.exports=i})),ke=v(((e,t)=>{var i=Y(),r=J(),a=i("keys");t.exports=function(e){return a[e]||(a[e]=r(e))}})),Te=v(((e,t)=>{var i=y();t.exports=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))})),Ce=v(((e,t)=>{var i=X(),r=k(),a=Z(),s=ke(),n=Te(),o=s("IE_PROTO"),l=Object,u=l.prototype;t.exports=n?l.getPrototypeOf:function(e){var t=a(e);if(i(t,o))return t[o];var s=t.constructor;return r(s)&&t instanceof s?s.prototype:t instanceof l?u:null}})),Ee=v(((e,t)=>{t.exports={}})),Ae=v(((e,t)=>{var i=x(),r=X(),a=I(),s=be().indexOf,n=Ee(),o=i([].push);t.exports=function(e,t){var i,l=a(e),u=0,d=[];for(i in l)!r(n,i)&&r(l,i)&&o(d,i);for(;t.length>u;)r(l,i=t[u++])&&(~s(d,i)||o(d,i));return d}})),Le=v(((e,t)=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]})),Pe=v(((e,t)=>{var i=Ae(),r=Le();t.exports=Object.keys||function(e){return i(e,r)}})),Me=v(((e,t)=>{var i=T(),r=y(),a=x(),s=Ce(),n=Pe(),o=I(),l=a(E().f),u=a([].push),d=i&&r((function(){var e=Object.create(null);return e[2]=2,!l(e,2)})),c=function(e){return function(t){for(var r,a=o(t),c=n(a),h=d&&null===s(a),p=c.length,f=0,m=[];p>f;)r=c[f++],(!i||(h?r in a:l(a,r)))&&u(m,e?[r,a[r]]:a[r]);return m}};t.exports={entries:c(!0),values:c(!1)}})),Ie=v((()=>{var e=he(),t=Me().entries;e({target:"Object",stat:!0},{entries:function(e){return t(e)}})})),Re=v(((e,t)=>{Ie();var i=V();t.exports=i.Object.entries})),Ve=v(((e,t)=>{var i=Re();t.exports=i})),Ne=v(((e,t)=>{var i=Ve();t.exports=i})),Be=v(((e,t)=>{t.exports={}})),De=v(((e,t)=>{var i=b(),r=k(),a=i.WeakMap;t.exports=r(a)&&/native code/.test(String(a))})),Oe=v(((e,t)=>{var i,r,a,s,n,o=De(),l=b(),u=R(),d=ce(),c=X(),h=K(),p=ke(),f=Ee(),m="Object already initialized",v=l.TypeError,g=l.WeakMap;o||h.state?((s=h.state||(h.state=new g)).get=s.get,s.has=s.has,s.set=s.set,i=function(e,t){if(s.has(e))throw new v(m);return t.facade=e,s.set(e,t),t},r=function(e){return s.get(e)||{}},a=function(e){return s.has(e)}):(f[n=p("state")]=!0,i=function(e,t){if(c(e,n))throw new v(m);return t.facade=e,d(e,n,t),t},r=function(e){return c(e,n)?e[n]:{}},a=function(e){return c(e,n)}),t.exports={set:i,get:r,has:a,enforce:function(e){return a(e)?r(e):i(e,{})},getterFor:function(e){return function(t){var i;if(!u(t)||(i=r(t)).type!==e)throw new v("Incompatible receiver, "+e+" required");return i}}}})),Fe=v(((e,t)=>{var i=T(),r=X(),a=Function.prototype,s=i&&Object.getOwnPropertyDescriptor,n=r(a,"name"),o=n&&"something"===function(){}.name,l=n&&(!i||i&&s(a,"name").configurable);t.exports={EXISTS:n,PROPER:o,CONFIGURABLE:l}})),je=v((e=>{var t=T(),i=le(),r=de(),a=ue(),s=I(),n=Pe();e.f=t&&!i?Object.defineProperties:function(e,t){a(e);for(var i,o=s(t),l=n(t),u=l.length,d=0;u>d;)r.f(e,i=l[d++],o[i]);return e}})),ze=v(((e,t)=>{var i=N();t.exports=i("document","documentElement")})),Ue=v(((e,t)=>{var i,r=ue(),a=je(),s=Le(),n=Ee(),o=ze(),l=re(),u=ke(),d="prototype",c="script",h=u("IE_PROTO"),p=function(){},f=function(e){return"<"+c+">"+e+"</"+c+">"},m=function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t},v=function(){try{i=new ActiveXObject("htmlfile")}catch{}v=typeof document<"u"?document.domain&&i?m(i):function(){var e,t=l("iframe"),i="java"+c+":";return t.style.display="none",o.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(f("document.F=Object")),e.close(),e.F}():m(i);for(var e=s.length;e--;)delete v[d][s[e]];return v()};n[h]=!0,t.exports=Object.create||function(e,t){var i;return null!==e?(p[d]=r(e),i=new p,p[d]=null,i[h]=e):i=v(),void 0===t?i:a.f(i,t)}})),qe=v(((e,t)=>{var i=ce();t.exports=function(e,t,r,a){return a&&a.enumerable?e[t]=r:i(e,t,r),e}})),He=v(((e,t)=>{var i,r,a,s=y(),n=k(),o=R(),l=Ue(),u=Ce(),d=qe(),c=ee(),h=Q(),p=c("iterator"),f=!1;[].keys&&("next"in(a=[].keys())?(r=u(u(a)))!==Object.prototype&&(i=r):f=!0),!o(i)||s((function(){var e={};return i[p].call(e)!==e}))?i={}:h&&(i=l(i)),n(i[p])||d(i,p,(function(){return this})),t.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:f}})),We=v(((e,t)=>{var i={};i[ee()("toStringTag")]="z",t.exports="[object z]"===String(i)})),Qe=v(((e,t)=>{var i=We(),r=k(),a=$(),s=ee()("toStringTag"),n=Object,o="Arguments"===a(function(){return arguments}());t.exports=i?a:function(e){var t,i,l;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch{}}(t=n(e),s))?i:o?a(t):"Object"===(l=a(t))&&r(t.callee)?"Arguments":l}})),Ge=v(((e,t)=>{var i=We(),r=Qe();t.exports=i?{}.toString:function(){return"[object "+r(this)+"]"}})),Ke=v(((e,t)=>{var i=We(),r=de().f,a=ce(),s=X(),n=Ge(),o=ee()("toStringTag");t.exports=function(e,t,l,u){var d=l?e:e&&e.prototype;d&&(s(d,o)||r(d,o,{configurable:!0,value:t}),u&&!i&&a(d,"toString",n))}})),Ye=v(((e,t)=>{var i=He().IteratorPrototype,r=Ue(),a=A(),s=Ke(),n=Be(),o=function(){return this};t.exports=function(e,t,l,u){var d=t+" Iterator";return e.prototype=r(i,{next:a(+!u,l)}),s(e,d,!1,!0),n[d]=o,e}})),Ze=v(((e,t)=>{var i=x(),r=q();t.exports=function(e,t,a){try{return i(r(Object.getOwnPropertyDescriptor(e,t)[a]))}catch{}}})),Xe=v(((e,t)=>{var i=R();t.exports=function(e){return i(e)||null===e}})),Je=v(((e,t)=>{var i=Xe(),r=String,a=TypeError;t.exports=function(e){if(i(e))return e;throw new a("Can't set "+r(e)+" as a prototype")}})),et=v(((e,t)=>{var i=Ze(),r=R(),a=M(),s=Je();t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=i(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(i,n){return a(i),s(n),r(i)&&(t?e(i,n):i.__proto__=n),i}}():void 0)})),tt=v(((e,t)=>{var i=he(),r=C(),a=Q(),s=Fe(),n=k(),o=Ye(),l=Ce(),u=et(),d=Ke(),c=ce(),h=qe(),p=ee(),f=Be(),m=He(),v=s.PROPER,g=s.CONFIGURABLE,b=m.IteratorPrototype,y=m.BUGGY_SAFARI_ITERATORS,w=p("iterator"),S="keys",x="values",$="entries",_=function(){return this};t.exports=function(e,t,s,p,m,k,T){o(s,t,p);var C,E,A,L=function(e){if(e===m&&V)return V;if(!y&&e&&e in I)return I[e];switch(e){case S:case x:case $:return function(){return new s(this,e)}}return function(){return new s(this)}},P=t+" Iterator",M=!1,I=e.prototype,R=I[w]||I["@@iterator"]||m&&I[m],V=!y&&R||L(m),N="Array"===t&&I.entries||R;if(N&&((C=l(N.call(new e)))!==Object.prototype&&C.next&&(!a&&l(C)!==b&&(u?u(C,b):n(C[w])||h(C,w,_)),d(C,P,!0,!0),a&&(f[P]=_))),v&&m===x&&R&&R.name!==x&&(!a&&g?c(I,"name",x):(M=!0,V=function(){return r(R,this)})),m)if(E={values:L(x),keys:k?V:L(S),entries:L($)},T)for(A in E)(y||M||!(A in I))&&h(I,A,E[A]);else i({target:t,proto:!0,forced:y||M},E);return(!a||T)&&I[w]!==V&&h(I,w,V,{name:m}),f[t]=V,E}})),it=v(((e,t)=>{t.exports=function(e,t){return{value:e,done:t}}})),rt=v(((e,t)=>{var i=I(),r=ye(),a=Be(),s=Oe(),n=de().f,o=tt(),l=it(),u=Q(),d=T(),c="Array Iterator",h=s.set,p=s.getterFor(c);t.exports=o(Array,"Array",(function(e,t){h(this,{type:c,target:i(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=void 0,l(void 0,!0);switch(e.kind){case"keys":return l(i,!1);case"values":return l(t[i],!1)}return l([i,t[i]],!1)}),"values");var f=a.Arguments=a.Array;if(r("keys"),r("values"),r("entries"),!u&&d&&"values"!==f.name)try{n(f,"name",{value:"values"})}catch{}})),at=v(((e,t)=>{var i=ee(),r=Be(),a=i("iterator"),s=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||s[a]===e)}})),st=v(((e,t)=>{var i=Qe(),r=H(),a=P(),s=Be(),n=ee()("iterator");t.exports=function(e){if(!a(e))return r(e,n)||r(e,"@@iterator")||s[i(e)]}})),nt=v(((e,t)=>{var i=C(),r=q(),a=ue(),s=U(),n=st(),o=TypeError;t.exports=function(e,t){var l=arguments.length<2?n(e):t;if(r(l))return a(i(l,e));throw new o(s(e)+" is not iterable")}})),ot=v(((e,t)=>{var i=C(),r=ue(),a=H();t.exports=function(e,t,s){var n,o;r(e);try{if(!(n=a(e,"return"))){if("throw"===t)throw s;return s}n=i(n,e)}catch(e){o=!0,n=e}if("throw"===t)throw s;if(o)throw n;return r(n),s}})),lt=v(((e,t)=>{var i=oe(),r=C(),a=ue(),s=U(),n=at(),o=ge(),l=B(),u=nt(),d=st(),c=ot(),h=TypeError,p=function(e,t){this.stopped=e,this.result=t},f=p.prototype;t.exports=function(e,t,m){var v,g,b,y,w,S,x,$=m&&m.that,_=!(!m||!m.AS_ENTRIES),k=!(!m||!m.IS_RECORD),T=!(!m||!m.IS_ITERATOR),C=!(!m||!m.INTERRUPTED),E=i(t,$),A=function(e){return v&&c(v,"normal",e),new p(!0,e)},L=function(e){return _?(a(e),C?E(e[0],e[1],A):E(e[0],e[1])):C?E(e,A):E(e)};if(k)v=e.iterator;else if(T)v=e;else{if(!(g=d(e)))throw new h(s(e)+" is not iterable");if(n(g)){for(b=0,y=o(e);y>b;b++)if((w=L(e[b]))&&l(f,w))return w;return new p(!1)}v=u(e,g)}for(S=k?e.next:v.next;!(x=r(S,v)).done;){try{w=L(x.value)}catch(e){c(v,"throw",e)}if("object"==typeof w&&w&&l(f,w))return w}return new p(!1)}})),ut=v(((e,t)=>{var i=T(),r=de(),a=A();t.exports=function(e,t,s){i?r.f(e,t,a(0,s)):e[t]=s}})),dt=v((()=>{var e=he(),t=lt(),i=ut();e({target:"Object",stat:!0},{fromEntries:function(e){var r={};return t(e,(function(e,t){i(r,e,t)}),{AS_ENTRIES:!0}),r}})})),ct=v(((e,t)=>{rt(),dt();var i=V();t.exports=i.Object.fromEntries})),ht=v(((e,t)=>{t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}})),pt=v((()=>{rt();var e,t=ht(),i=b(),r=Ke(),a=Be();for(e in t)r(i[e],e),a[e]=a.Array})),ft=v(((e,t)=>{var i=ct();pt(),t.exports=i})),mt=v(((e,t)=>{var i=ft();t.exports=i})),vt=v((()=>{})),gt=v(((e,t)=>{var i=b(),r=D(),a=$(),s=function(e){return r.slice(0,e.length)===e};t.exports=s("Bun/")?"BUN":s("Cloudflare-Workers")?"CLOUDFLARE":s("Deno/")?"DENO":s("Node.js/")?"NODE":i.Bun&&"string"==typeof Bun.version?"BUN":i.Deno&&"object"==typeof Deno.version?"DENO":"process"===a(i.process)?"NODE":i.window&&i.document?"BROWSER":"REST"})),bt=v(((e,t)=>{var i=gt();t.exports="NODE"===i})),yt=v(((e,t)=>{var i=de();t.exports=function(e,t,r){return i.f(e,t,r)}})),wt=v(((e,t)=>{var i=N(),r=yt(),a=ee(),s=T(),n=a("species");t.exports=function(e){var t=i(e);s&&t&&!t[n]&&r(t,n,{configurable:!0,get:function(){return this}})}})),St=v(((e,t)=>{var i=B(),r=TypeError;t.exports=function(e,t){if(i(t,e))return e;throw new r("Incorrect invocation")}})),xt=v(((e,t)=>{var i=x(),r=k(),a=K(),s=i(Function.toString);r(a.inspectSource)||(a.inspectSource=function(e){return s(e)}),t.exports=a.inspectSource})),$t=v(((e,t)=>{var i=x(),r=y(),a=k(),s=Qe(),n=N(),o=xt(),l=function(){},u=n("Reflect","construct"),d=/^\s*(?:class|function)\b/,c=i(d.exec),h=!d.test(l),p=function(e){if(!a(e))return!1;try{return u(l,[],e),!0}catch{return!1}},f=function(e){if(!a(e))return!1;switch(s(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return h||!!c(d,o(e))}catch{return!0}};f.sham=!0,t.exports=!u||r((function(){var e;return p(p.call)||!p(Object)||!p((function(){e=!0}))||e}))?f:p})),_t=v(((e,t)=>{var i=$t(),r=U(),a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not a constructor")}})),kt=v(((e,t)=>{var i=ue(),r=_t(),a=P(),s=ee()("species");t.exports=function(e,t){var n,o=i(e).constructor;return void 0===o||a(n=i(o)[s])?t:r(n)}})),Tt=v(((e,t)=>{var i=x();t.exports=i([].slice)})),Ct=v(((e,t)=>{var i=TypeError;t.exports=function(e,t){if(e<t)throw new i("Not enough arguments");return e}})),Et=v(((e,t)=>{var i=D();t.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(i)})),At=v(((e,t)=>{var i,r,a,s,n=b(),o=S(),l=oe(),u=k(),d=X(),c=y(),h=ze(),p=Tt(),f=re(),m=Ct(),v=Et(),g=bt(),w=n.setImmediate,x=n.clearImmediate,$=n.process,_=n.Dispatch,T=n.Function,C=n.MessageChannel,E=n.String,A=0,L={},P="onreadystatechange";c((function(){i=n.location}));var M=function(e){if(d(L,e)){var t=L[e];delete L[e],t()}},I=function(e){return function(){M(e)}},R=function(e){M(e.data)},V=function(e){n.postMessage(E(e),i.protocol+"//"+i.host)};(!w||!x)&&(w=function(e){m(arguments.length,1);var t=u(e)?e:T(e),i=p(arguments,1);return L[++A]=function(){o(t,void 0,i)},r(A),A},x=function(e){delete L[e]},g?r=function(e){$.nextTick(I(e))}:_&&_.now?r=function(e){_.now(I(e))}:C&&!v?(s=(a=new C).port2,a.port1.onmessage=R,r=l(s.postMessage,s)):n.addEventListener&&u(n.postMessage)&&!n.importScripts&&i&&"file:"!==i.protocol&&!c(V)?(r=V,n.addEventListener("message",R,!1)):r=P in f("script")?function(e){h.appendChild(f("script"))[P]=function(){h.removeChild(this),M(e)}}:function(e){setTimeout(I(e),0)}),t.exports={set:w,clear:x}})),Lt=v(((e,t)=>{var i=b(),r=T(),a=Object.getOwnPropertyDescriptor;t.exports=function(e){if(!r)return i[e];var t=a(i,e);return t&&t.value}})),Pt=v(((e,t)=>{var i=function(){this.head=null,this.tail=null};i.prototype={add:function(e){var t={item:e,next:null},i=this.tail;i?i.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}},t.exports=i})),Mt=v(((e,t)=>{var i=D();t.exports=/ipad|iphone|ipod/i.test(i)&&typeof Pebble<"u"})),It=v(((e,t)=>{var i=D();t.exports=/web0s(?!.*chrome)/i.test(i)})),Rt=v(((e,t)=>{var i,r,a,s,n,o,l,u=b(),d=Lt(),c=oe(),h=At().set,p=Pt(),f=Et(),m=Mt(),v=It(),g=bt(),y=u.MutationObserver||u.WebKitMutationObserver,w=u.document,S=u.process,x=u.Promise,$=d("queueMicrotask");$||(o=new p,l=function(){var e,t;for(g&&(e=S.domain)&&e.exit();t=o.get();)try{t()}catch(e){throw o.head&&i(),e}e&&e.enter()},f||g||v||!y||!w?!m&&x&&x.resolve?((s=x.resolve(void 0)).constructor=x,n=c(s.then,s),i=function(){n(l)}):g?i=function(){S.nextTick(l)}:(h=c(h,u),i=function(){h(l)}):(r=!0,a=w.createTextNode(""),new y(l).observe(a,{characterData:!0}),i=function(){a.data=r=!r}),$=function(e){o.head||i(),o.add(e)}),t.exports=$})),Vt=v(((e,t)=>{t.exports=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch{}}})),Nt=v(((e,t)=>{t.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}})),Bt=v(((e,t)=>{var i=b();t.exports=i.Promise})),Dt=v(((e,t)=>{var i=b(),r=Bt(),a=k(),s=ne(),n=xt(),o=ee(),l=gt(),u=Q(),d=O(),c=r&&r.prototype,h=o("species"),p=!1,f=a(i.PromiseRejectionEvent),m=s("Promise",(function(){var e=n(r),t=e!==String(r);if(!t&&66===d||u&&(!c.catch||!c.finally))return!0;if(!d||d<51||!/native code/.test(e)){var i=new r((function(e){e(1)})),a=function(e){e((function(){}),(function(){}))};if((i.constructor={})[h]=a,!(p=i.then((function(){}))instanceof a))return!0}return!(t||"BROWSER"!==l&&"DENO"!==l||f)}));t.exports={CONSTRUCTOR:m,REJECTION_EVENT:f,SUBCLASSING:p}})),Ot=v(((e,t)=>{var i=q(),r=TypeError,a=function(e){var t,a;this.promise=new e((function(e,i){if(void 0!==t||void 0!==a)throw new r("Bad Promise constructor");t=e,a=i})),this.resolve=i(t),this.reject=i(a)};t.exports.f=function(e){return new a(e)}})),Ft=v((()=>{var e,t,i,r=he(),a=Q(),s=bt(),n=b(),o=C(),l=qe(),u=et(),d=Ke(),c=wt(),h=q(),p=k(),f=R(),m=St(),v=kt(),g=At().set,y=Rt(),w=Vt(),S=Nt(),x=Pt(),$=Oe(),_=Bt(),T=Dt(),E=Ot(),A="Promise",L=T.CONSTRUCTOR,P=T.REJECTION_EVENT,M=T.SUBCLASSING,I=$.getterFor(A),V=$.set,N=_&&_.prototype,B=_,D=N,O=n.TypeError,F=n.document,j=n.process,z=E.f,U=z,H=!!(F&&F.createEvent&&n.dispatchEvent),W="unhandledrejection",G=function(e){var t;return!(!f(e)||!p(t=e.then))&&t},K=function(e,t){var i,r,a,s=t.value,n=1===t.state,l=n?e.ok:e.fail,u=e.resolve,d=e.reject,c=e.domain;try{l?(n||(2===t.rejection&&ee(t),t.rejection=1),!0===l?i=s:(c&&c.enter(),i=l(s),c&&(c.exit(),a=!0)),i===e.promise?d(new O("Promise-chain cycle")):(r=G(i))?o(r,i,u,d):u(i)):d(s)}catch(e){c&&!a&&c.exit(),d(e)}},Y=function(e,t){e.notified||(e.notified=!0,y((function(){for(var i,r=e.reactions;i=r.get();)K(i,e);e.notified=!1,t&&!e.rejection&&X(e)})))},Z=function(e,t,i){var r,a;H?((r=F.createEvent("Event")).promise=t,r.reason=i,r.initEvent(e,!1,!0),n.dispatchEvent(r)):r={promise:t,reason:i},!P&&(a=n["on"+e])?a(r):e===W&&w("Unhandled promise rejection",i)},X=function(e){o(g,n,(function(){var t,i=e.facade,r=e.value;if(J(e)&&(t=S((function(){s?j.emit("unhandledRejection",r,i):Z(W,i,r)})),e.rejection=s||J(e)?2:1,t.error))throw t.value}))},J=function(e){return 1!==e.rejection&&!e.parent},ee=function(e){o(g,n,(function(){var t=e.facade;s?j.emit("rejectionHandled",t):Z("rejectionhandled",t,e.value)}))},te=function(e,t,i){return function(r){e(t,r,i)}},ie=function(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,Y(e,!0))},re=function(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw new O("Promise can't be resolved itself");var r=G(t);r?y((function(){var i={done:!1};try{o(r,t,te(re,i,e),te(ie,i,e))}catch(t){ie(i,t,e)}})):(e.value=t,e.state=1,Y(e,!1))}catch(t){ie({done:!1},t,e)}}};if(L&&(D=(B=function(t){m(this,D),h(t),o(e,this);var i=I(this);try{t(te(re,i),te(ie,i))}catch(e){ie(i,e)}}).prototype,(e=function(e){V(this,{type:A,done:!1,notified:!1,parent:!1,reactions:new x,rejection:!1,state:0,value:void 0})}).prototype=l(D,"then",(function(e,t){var i=I(this),r=z(v(this,B));return i.parent=!0,r.ok=!p(e)||e,r.fail=p(t)&&t,r.domain=s?j.domain:void 0,0===i.state?i.reactions.add(r):y((function(){K(r,i)})),r.promise})),t=function(){var t=new e,i=I(t);this.promise=t,this.resolve=te(re,i),this.reject=te(ie,i)},E.f=z=function(e){return e===B||undefined===e?new t(e):U(e)},!a&&p(_)&&N!==Object.prototype)){i=N.then,M||l(N,"then",(function(e,t){var r=this;return new B((function(e,t){o(i,r,e,t)})).then(e,t)}),{unsafe:!0});try{delete N.constructor}catch{}u&&u(N,D)}r({global:!0,constructor:!0,wrap:!0,forced:L},{Promise:B}),d(B,A,!1,!0),c(A)})),jt=v(((e,t)=>{var i,r,a=ee()("iterator"),s=!1;try{i=0,(r={next:function(){return{done:!!i++}},return:function(){s=!0}})[a]=function(){return this},Array.from(r,(function(){throw 2}))}catch{}t.exports=function(e,t){try{if(!t&&!s)return!1}catch{return!1}var i=!1;try{var r={};r[a]=function(){return{next:function(){return{done:i=!0}}}},e(r)}catch{}return i}})),zt=v(((e,t)=>{var i=Bt(),r=jt(),a=Dt().CONSTRUCTOR;t.exports=a||!r((function(e){i.all(e).then(void 0,(function(){}))}))})),Ut=v((()=>{var e=he(),t=C(),i=q(),r=Ot(),a=Nt(),s=lt();e({target:"Promise",stat:!0,forced:zt()},{all:function(e){var n=this,o=r.f(n),l=o.resolve,u=o.reject,d=a((function(){var r=i(n.resolve),a=[],o=0,d=1;s(e,(function(e){var i=o++,s=!1;d++,t(r,n,e).then((function(e){s||(s=!0,a[i]=e,--d||l(a))}),u)})),--d||l(a)}));return d.error&&u(d.value),o.promise}})})),qt=v((()=>{var e,t=he(),i=Q(),r=Dt().CONSTRUCTOR,a=Bt(),s=N(),n=k(),o=qe(),l=a&&a.prototype;t({target:"Promise",proto:!0,forced:r,real:!0},{catch:function(e){return this.then(void 0,e)}}),!i&&n(a)&&(e=s("Promise").prototype.catch,l.catch!==e&&o(l,"catch",e,{unsafe:!0}))})),Ht=v((()=>{var e=he(),t=C(),i=q(),r=Ot(),a=Nt(),s=lt();e({target:"Promise",stat:!0,forced:zt()},{race:function(e){var n=this,o=r.f(n),l=o.reject,u=a((function(){var r=i(n.resolve);s(e,(function(e){t(r,n,e).then(o.resolve,l)}))}));return u.error&&l(u.value),o.promise}})})),Wt=v((()=>{var e=he(),t=Ot();e({target:"Promise",stat:!0,forced:Dt().CONSTRUCTOR},{reject:function(e){var i=t.f(this);return(0,i.reject)(e),i.promise}})})),Qt=v(((e,t)=>{var i=ue(),r=R(),a=Ot();t.exports=function(e,t){if(i(e),r(t)&&t.constructor===e)return t;var s=a.f(e);return(0,s.resolve)(t),s.promise}})),Gt=v((()=>{var e=he(),t=N(),i=Q(),r=Bt(),a=Dt().CONSTRUCTOR,s=Qt(),n=t("Promise"),o=i&&!a;e({target:"Promise",stat:!0,forced:i||a},{resolve:function(e){return s(o&&this===n?r:this,e)}})})),Kt=v((()=>{Ft(),Ut(),qt(),Ht(),Wt(),Gt()})),Yt=v((()=>{var e,t=he(),i=Q(),r=Bt(),a=y(),s=N(),n=k(),o=kt(),l=Qt(),u=qe(),d=r&&r.prototype;t({target:"Promise",proto:!0,real:!0,forced:!!r&&a((function(){d.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=o(this,s("Promise")),i=n(e);return this.then(i?function(i){return l(t,e()).then((function(){return i}))}:e,i?function(i){return l(t,e()).then((function(){throw i}))}:e)}}),!i&&n(r)&&(e=s("Promise").prototype.finally,d.finally!==e&&u(d,"finally",e,{unsafe:!0}))})),Zt=v(((e,t)=>{vt(),Kt(),Yt();var i=Se();t.exports=i("Promise","finally")})),Xt=v(((e,t)=>{var i=Zt();t.exports=i})),Jt=v(((e,t)=>{var i=Xt();t.exports=i})),ei=v((()=>{var e=he(),t=Me().values;e({target:"Object",stat:!0},{values:function(e){return t(e)}})})),ti=v(((e,t)=>{ei();var i=V();t.exports=i.Object.values})),ii=v(((e,t)=>{var i=ti();t.exports=i})),ri=v(((e,t)=>{var i=ii();t.exports=i})),ai=v((()=>{var e=he(),t=Z(),i=ge(),r=fe(),a=ye();e({target:"Array",proto:!0},{at:function(e){var a=t(this),s=i(a),n=r(e),o=n>=0?n:s+n;return o<0||o>=s?void 0:a[o]}}),a("at")})),si=v(((e,t)=>{ai();var i=Se();t.exports=i("Array","at")})),ni=v(((e,t)=>{var i=si();t.exports=i})),oi=v(((e,t)=>{var i=ni();t.exports=i})),li=v(((e,t)=>{var i=$();t.exports=Array.isArray||function(e){return"Array"===i(e)}})),ui=v(((e,t)=>{var i=TypeError;t.exports=function(e){if(e>9007199254740991)throw i("Maximum allowed index exceeded");return e}})),di=v(((e,t)=>{var i=li(),r=ge(),a=ui(),s=oe(),n=function(e,t,o,l,u,d,c,h){for(var p,f,m=u,v=0,g=!!c&&s(c,h);v<l;)v in o&&(p=g?g(o[v],v,t):o[v],d>0&&i(p)?(f=r(p),m=n(e,t,p,f,m,d-1)-1):(a(m+1),e[m]=p),m++),v++;return m};t.exports=n})),ci=v(((e,t)=>{var i=li(),r=$t(),a=R(),s=ee()("species"),n=Array;t.exports=function(e){var t;return i(e)&&(t=e.constructor,r(t)&&(t===n||i(t.prototype))?t=void 0:a(t)&&(null===(t=t[s])&&(t=void 0))),void 0===t?n:t}})),hi=v(((e,t)=>{var i=ci();t.exports=function(e,t){return new(i(e))(0===t?0:t)}})),pi=v((()=>{var e=he(),t=di(),i=q(),r=Z(),a=ge(),s=hi();e({target:"Array",proto:!0},{flatMap:function(e){var n,o=r(this),l=a(o);return i(e),(n=s(o,0)).length=t(n,o,o,l,0,1,e,arguments.length>1?arguments[1]:void 0),n}})})),fi=v((()=>{ye()("flatMap")})),mi=v(((e,t)=>{pi(),fi();var i=Se();t.exports=i("Array","flatMap")})),vi=v(((e,t)=>{var i=mi();t.exports=i})),gi=v(((e,t)=>{var i=vi();t.exports=i})),bi=v(((e,t)=>{var i=Qe(),r=String;t.exports=function(e){if("Symbol"===i(e))throw new TypeError("Cannot convert a Symbol value to a string");return r(e)}})),yi=v(((e,t)=>{t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"})),wi=v(((e,t)=>{var i=x(),r=M(),a=bi(),s=yi(),n=i("".replace),o=RegExp("^["+s+"]+"),l=RegExp("(^|[^"+s+"])["+s+"]+$"),u=function(e){return function(t){var i=a(r(t));return 1&e&&(i=n(i,o,"")),2&e&&(i=n(i,l,"$1")),i}};t.exports={start:u(1),end:u(2),trim:u(3)}})),Si=v(((e,t)=>{var i=Fe().PROPER,r=y(),a=yi();t.exports=function(e){return r((function(){return!!a[e]()||"​᠎"!=="​᠎"[e]()||i&&a[e].name!==e}))}})),xi=v(((e,t)=>{var i=wi().start,r=Si();t.exports=r("trimStart")?function(){return i(this)}:"".trimStart})),$i=v((()=>{var e=he(),t=xi();e({target:"String",proto:!0,name:"trimStart",forced:"".trimLeft!==t},{trimLeft:t})})),_i=v((()=>{$i();var e=he(),t=xi();e({target:"String",proto:!0,name:"trimStart",forced:"".trimStart!==t},{trimStart:t})})),ki=v(((e,t)=>{_i();var i=Se();t.exports=i("String","trimLeft")})),Ti=v(((e,t)=>{var i=ki();t.exports=i})),Ci=v(((e,t)=>{var i=Ti();t.exports=i})),Ei=v((()=>{})),Ai=v((()=>{})),Li=v(((e,t)=>{var i=R(),r=$(),a=ee()("match");t.exports=function(e){var t;return i(e)&&(void 0!==(t=e[a])?!!t:"RegExp"===r(e))}})),Pi=v(((e,t)=>{var i=ue();t.exports=function(){var e=i(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}})),Mi=v(((e,t)=>{var i=C(),r=X(),a=B(),s=Pi(),n=RegExp.prototype;t.exports=function(e){var t=e.flags;return void 0!==t||"flags"in n||r(e,"flags")||!a(n,e)?t:i(s,e)}})),Ii=v(((e,t)=>{var i=x(),r=Z(),a=Math.floor,s=i("".charAt),n=i("".replace),o=i("".slice),l=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,u=/\$([$&'`]|\d{1,2})/g;t.exports=function(e,t,i,d,c,h){var p=i+e.length,f=d.length,m=u;return void 0!==c&&(c=r(c),m=l),n(h,m,(function(r,n){var l;switch(s(n,0)){case"$":return"$";case"&":return e;case"`":return o(t,0,i);case"'":return o(t,p);case"<":l=c[o(n,1,-1)];break;default:var u=+n;if(0===u)return r;if(u>f){var h=a(u/10);return 0===h?r:h<=f?void 0===d[h-1]?s(n,1):d[h-1]+s(n,1):r}l=d[u-1]}return void 0===l?"":l}))}})),Ri=v((()=>{var e=he(),t=C(),i=x(),r=M(),a=k(),s=P(),n=Li(),o=bi(),l=H(),u=Mi(),d=Ii(),c=ee(),h=Q(),p=c("replace"),f=TypeError,m=i("".indexOf),v=i("".replace),g=i("".slice),b=Math.max;e({target:"String",proto:!0},{replaceAll:function(e,i){var c,y,w,S,x,$,_,k,T,C,E=r(this),A=0,L="";if(!s(e)){if((c=n(e))&&(y=o(r(u(e))),!~m(y,"g")))throw new f("`.replaceAll` does not allow non-global regexes");if(w=l(e,p))return t(w,e,E,i);if(h&&c)return v(o(E),e,i)}for(S=o(E),x=o(e),($=a(i))||(i=o(i)),_=x.length,k=b(1,_),T=m(S,x);-1!==T;)C=$?o(i(x,T,S)):d(x,S,T,[],void 0,i),L+=g(S,A,T)+C,A=T+_,T=T+k>S.length?-1:m(S,x,T+k);return A<S.length&&(L+=g(S,A)),L}})})),Vi=v(((e,t)=>{Ei(),Ai(),Ri();var i=Se();t.exports=i("String","replaceAll")})),Ni=v(((e,t)=>{var i=Vi();t.exports=i})),Bi=v(((e,t)=>{var i=Ni();t.exports=i})),Di=v(((e,t)=>{var i=fe(),r=bi(),a=M(),s=RangeError;t.exports=function(e){var t=r(a(this)),n="",o=i(e);if(o<0||o===1/0)throw new s("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(n+=t);return n}})),Oi=v(((e,t)=>{var i=x(),r=ve(),a=bi(),s=Di(),n=M(),o=i(s),l=i("".slice),u=Math.ceil,d=function(e){return function(t,i,s){var d,c,h=a(n(t)),p=r(i),f=h.length,m=void 0===s?" ":a(s);return p<=f||""===m?h:((c=o(m,u((d=p-f)/m.length))).length>d&&(c=l(c,0,d)),e?h+c:c+h)}};t.exports={start:d(!1),end:d(!0)}})),Fi=v(((e,t)=>{var i=D();t.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(i)})),ji=v((()=>{var e=he(),t=Oi().start;e({target:"String",proto:!0,forced:Fi()},{padStart:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),zi=v(((e,t)=>{ji();var i=Se();t.exports=i("String","padStart")})),Ui=v(((e,t)=>{var i=zi();t.exports=i})),qi=v(((e,t)=>{var i=Ui();t.exports=i})),Hi="2.0.132",Wi=((s=Wi||{}).STOPPED="stopped",s.READY="ready",s.PLAYING="playing",s.PAUSED="paused",s),Qi=((a=Qi||{}).MPEG="MPEG",a.DASH="DASH",a.DASH_SEP="DASH_SEP",a.DASH_SEP_VK="DASH_SEP",a.DASH_WEBM="DASH_WEBM",a.DASH_WEBM_AV1="DASH_WEBM_AV1",a.DASH_STREAMS="DASH_STREAMS",a.DASH_WEBM_VK="DASH_WEBM",a.DASH_ONDEMAND="DASH_ONDEMAND",a.DASH_ONDEMAND_VK="DASH_ONDEMAND",a.DASH_LIVE="DASH_LIVE",a.DASH_LIVE_CMAF="DASH_LIVE_CMAF",a.DASH_LIVE_WEBM="DASH_LIVE_WEBM",a.HLS="HLS",a.HLS_ONDEMAND="HLS_ONDEMAND",a.HLS_JS="HLS",a.HLS_LIVE="HLS_LIVE",a.HLS_LIVE_CMAF="HLS_LIVE_CMAF",a.WEB_RTC_LIVE="WEB_RTC_LIVE",a),Gi=(e=>(e.NOT_AVAILABLE="NOT_AVAILABLE",e.AVAILABLE="AVAILABLE",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e))(Gi||{}),Ki=((n=Ki||{}).HTTP1="http1",n.HTTP2="http2",n.QUIC="quic",n),Yi=((o=Yi||{}).NONE="none",o.INLINE="inline",o.FULLSCREEN="fullscreen",o.SECOND_SCREEN="second_screen",o.PIP="pip",o.INVISIBLE="invisible",o),Zi=(e=>(e.TRAFFIC_SAVING="traffic_saving",e.HIGH_QUALITY="high_quality",e.UNKNOWN="unknown",e))(Zi||{}),Xi=g(_e(),1),Ji=class{connect(){cast.framework.CastContext.getInstance()?.requestSession()}disconnect(){cast.framework.CastContext.getInstance()?.getCurrentSession()?.endSession(!0)}stopMedia(){return new Promise(((e,t)=>{cast.framework.CastContext.getInstance()?.getCurrentSession()?.getMediaSession()?.stop(new chrome.cast.media.StopRequest,e,t)}))}toggleConnection(){(0,u.isNonNullable)(this.connection$.getValue())?this.disconnect():this.connect()}setVolume(e){let t=this.connection$.getValue();(0,u.isNullable)(t)||(t.remotePlayer.volumeLevel=e,t.remotePlayerController.setVolumeLevel())}setMuted(e){let t=this.connection$.getValue();(0,u.isNullable)(t)||e!==t.remotePlayer.isMuted&&t.remotePlayerController.muteOrUnmute()}destroy(){this.isDestroyed=!0,this.subscription.unsubscribe()}initListeners(){let e=new cast.framework.RemotePlayer,t=new cast.framework.RemotePlayerController(e),i=cast.framework.CastContext.getInstance();this.subscription.add((0,u.fromEvent)(i,cast.framework.CastContextEventType.SESSION_STATE_CHANGED).subscribe((e=>{switch(e.sessionState){case cast.framework.SessionState.SESSION_STARTED:case cast.framework.SessionState.SESSION_STARTING:case cast.framework.SessionState.SESSION_RESUMED:this.contentId=i.getCurrentSession()?.getMediaSession()?.media?.contentId;break;case cast.framework.SessionState.NO_SESSION:case cast.framework.SessionState.SESSION_ENDING:case cast.framework.SessionState.SESSION_ENDED:case cast.framework.SessionState.SESSION_START_FAILED:this.contentId=void 0;break;default:return(0,u.assertNever)(e.sessionState)}}))).add((0,u.merge)((0,u.fromEvent)(i,cast.framework.CastContextEventType.CAST_STATE_CHANGED).pipe((0,u.tap)((e=>{this.log({message:`[cast.framework.RemotePlayerEventType.CAST_STATE_CHANGED]: ${JSON.stringify(e)}`})})),(0,u.map)((e=>e.castState))),(0,u.observableFrom)([i.getCastState()])).pipe((0,u.filterChanged)(),(0,u.map)(er),(0,u.tap)((e=>{this.log({message:`realCastState$: ${e}`})}))).subscribe(this.realCastState$)).add(this.realCastState$.subscribe((r=>{let a="CONNECTED"===r,s=(0,u.isNonNullable)(this.connection$.getValue());if(a&&!s){let r=i.getCurrentSession();(0,u.assertNonNullable)(r);let a=r.getCastDevice(),s=r.getMediaSession()?.media?.contentId;((0,u.isNullable)(s)||s===this.contentId)&&(this.log({message:"connection created"}),this.connection$.next({remotePlayer:e,remotePlayerController:t,session:r,castDevice:a}))}else!a&&s&&(this.log({message:"connection destroyed"}),this.connection$.next(void 0));this.castState$.next("CONNECTED"===r?(0,u.isNonNullable)(this.connection$.getValue())?"CONNECTED":"AVAILABLE":r)})))}initializeCastApi(){let e,t,i;try{e=cast.framework.CastContext.getInstance(),t=chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,i=chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}catch{return}try{e.setOptions({receiverApplicationId:this.params.receiverApplicationId??t,autoJoinPolicy:i}),this.initListeners()}catch(e){this.errorEvent$.next({id:"ChromecastInitializer",category:u.ErrorCategory.EXTERNAL_API,message:"[initializeCastApi] failed",thrown:e})}}constructor(e){this.connection$=new u.ValueSubject(void 0),this.castState$=new u.ValueSubject("NOT_AVAILABLE"),this.errorEvent$=new u.Subject,this.realCastState$=new u.ValueSubject("NOT_AVAILABLE"),this.subscription=new u.Subscription,this.isDestroyed=!1,this.params=e,this.log=this.params.dependencies.logger.createComponentLog("ChromecastInitializer");let t="chrome"in window;if(this.log({message:`[constructor] receiverApplicationId: ${this.params.receiverApplicationId}, isDisabled: ${this.params.isDisabled}, isSupported: ${t}`}),e.isDisabled||!t)return;let r=(0,u.isNonNullable)(window.chrome?.cast),a=!!window.__onGCastApiAvailable;var s;r?this.initializeCastApi():(i._dG("__onGCastApiAvailable",(e=>{delete window.__onGCastApiAvailable,e&&!this.isDestroyed&&this.initializeCastApi()})),a||(s="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",new Promise(((e,t)=>{let i=document.createElement("script");i.setAttribute("src",s),i.onload=()=>e(),i.onerror=e=>t(e),document.body.appendChild(i)}))).catch((()=>this.errorEvent$.next({id:"ChromecastLoading",category:u.ErrorCategory.NETWORK,message:"Script loading failed!"}))))}},er=e=>{switch(e){case cast.framework.CastState.NO_DEVICES_AVAILABLE:return"NOT_AVAILABLE";case cast.framework.CastState.NOT_CONNECTED:return"AVAILABLE";case cast.framework.CastState.CONNECTING:return"CONNECTING";case cast.framework.CastState.CONNECTED:return"CONNECTED";default:return(0,u.assertNever)(e)}},tr=g(_e(),1),ir=g(Ne(),1),rr=g(mt(),1),ar=g(Jt(),1),sr=(e,t=0,i=0)=>{switch(i){case 0:return e.replace("_offset_p",0===t?"":"_"+t.toFixed(0));case 1:{if(0===t)return e;let i=new URL(e);return i.searchParams.append("playback_shift",t.toFixed(0)),i.toString()}case 2:{let i=new URL(e);return i.searchParams.get("offset_p")||0!==t?(i.searchParams.set("offset_p",t.toFixed(0)),i.toString()):e}default:(0,u.assertNever)(i)}return e},nr=(e,t)=>{switch(t){case 0:return NaN;case 1:{let t=new URL(e);return Number(t.searchParams.get("playback_shift"))}case 2:{let t=new URL(e);return Number(t.searchParams.get("offset_p")??0)}default:(0,u.assertNever)(t)}},or=(e,t,i=!1)=>{let r=e.getTransition();(i||!r||r.to===t)&&e.setState(t)},lr=class{setState(e){let t=this.transition,i=this.state;this.transition=void 0,this.prevState=i,this.state=e,t?t.to===e?this.transitionEnded$.next(t):this.forceChanged$.next({from:t.from,to:e,canceledTransition:t}):this.forceChanged$.next({from:i,to:e,canceledTransition:t})}startTransitionTo(e){let t=this.transition,i=this.state;i===e||(0,u.isNonNullable)(t)&&t.to===e||(this.prevState=i,this.state=e,t?(this.transition={from:t.from,to:e,canceledTransition:t},this.transitionUpdated$.next(this.transition)):(this.transition={from:i,to:e},this.transitionStarted$.next(this.transition)))}getTransition(){return this.transition}getState(){return this.state}getPrevState(){return this.prevState}constructor(e){this.transitionStarted$=new u.Subject,this.transitionEnded$=new u.Subject,this.transitionUpdated$=new u.Subject,this.forceChanged$=new u.Subject,this.stateChangeStarted$=(0,u.merge)(this.transitionStarted$,this.transitionUpdated$),this.stateChangeEnded$=(0,u.merge)(this.transitionEnded$,this.forceChanged$),this.state=e,this.prevState=void 0}},ur=class{destroy(){this.log({message:"[destroy]"}),this.subscription.unsubscribe()}subscribe(){this.subscription.add(this.loadMediaTimeoutSubscription);let e=new u.Subscription;this.subscription.add(e),this.subscription.add((0,u.merge)(this.videoState.stateChangeStarted$.pipe((0,u.map)((e=>`stateChangeStarted$ ${JSON.stringify(e)}`))),this.videoState.stateChangeEnded$.pipe((0,u.map)((e=>`stateChangeEnded$ ${JSON.stringify(e)}`)))).subscribe((e=>this.log({message:`[videoState] ${e}`}))));let t=(e,t)=>this.subscription.add(e.subscribe(t));if(this.params.output.isLive$.getValue())this.params.output.position$.next(0),this.params.output.duration$.next(0);else{let t=new u.Subject;e.add(t.pipe((0,u.debounce)(500)).subscribe((()=>{this.params.output.seekedEvent$.next()})));let i=NaN;e.add((0,u.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED).subscribe((e=>{this.logRemoteEvent(e);let r=e.value;this.params.output.position$.next(r),("applying"===this.params.desiredState.seekState.getState().state||Math.abs(r-i)>5)&&t.next(r),i=r}))),e.add((0,u.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.DURATION_CHANGED).subscribe((e=>{this.logRemoteEvent(e),this.params.output.duration$.next(e.value)})))}t((0,u.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.IS_MEDIA_LOADED_CHANGED),(t=>{this.logRemoteEvent(t),t.value?this.handleRemoteReady():(this.handleRemoteStop(),e.unsubscribe())})),t((0,u.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED),(e=>{this.logRemoteEvent(e),e.value?this.handleRemotePause():this.handleRemotePlay()})),t((0,u.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED),(e=>{this.logRemoteEvent(e);let{remotePlayer:t}=this.params.connection,i=e.value,r=this.params.output.isBuffering$.getValue(),a=i===chrome.cast.media.PlayerState.BUFFERING;switch(r!==a&&this.params.output.isBuffering$.next(a),i){case chrome.cast.media.PlayerState.IDLE:!this.params.output.isLive$.getValue()&&t.duration-t.currentTime<5&&this.params.output.endedEvent$.next(),this.handleRemoteStop(),or(this.params.desiredState.playbackState,"stopped");break;case chrome.cast.media.PlayerState.PAUSED:this.handleRemotePause();break;case chrome.cast.media.PlayerState.PLAYING:this.handleRemotePlay();break;case chrome.cast.media.PlayerState.BUFFERING:break;default:(0,u.assertNever)(i)}})),t((0,u.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED),(e=>{this.logRemoteEvent(e),this.handleRemoteVolumeChange({volume:e.value})})),t((0,u.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED),(e=>{this.logRemoteEvent(e),this.handleRemoteVolumeChange({muted:e.value})})),t((0,u.merge)(this.params.desiredState.playbackState.stateChangeStarted$,this.params.desiredState.seekState.stateChangeEnded$,this.videoState.stateChangeEnded$,(0,u.observableFrom)(["init"])).pipe((0,u.debounce)(0)),this.syncPlayback)}restoreSession(e){this.log({message:"restoreSession"});let{remotePlayer:t}=this.params.connection;if(e.playerState!==chrome.cast.media.PlayerState.IDLE){t.isPaused?(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused")):(this.videoState.setState("playing"),or(this.params.desiredState.playbackState,"playing"));let e=this.params.output.isLive$.getValue();this.params.output.duration$.next(e?0:t.duration),this.params.output.position$.next(e?0:t.currentTime),this.params.desiredState.seekState.setState({state:"none"})}}prepare(){let e=this.params.format;this.log({message:`[prepare] format: ${e}`});let t=this.createMediaInfo(e),i=this.createLoadRequest(t);this.loadMedia(i)}handleRemotePause(){let e=this.videoState.getState();("paused"===this.videoState.getTransition()?.to||"playing"===e)&&(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused"))}handleRemotePlay(){let e=this.videoState.getState();("playing"===this.videoState.getTransition()?.to||"paused"===e)&&(this.videoState.setState("playing"),or(this.params.desiredState.playbackState,"playing"))}handleRemoteReady(){"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready"),"ready"===this.params.desiredState.playbackState.getTransition()?.to&&or(this.params.desiredState.playbackState,"ready")}handleRemoteStop(){"stopped"!==this.videoState.getState()&&this.videoState.setState("stopped")}handleRemoteVolumeChange(e){let t=this.params.output.volume$.getValue(),i={volume:e.volume??t.volume,muted:e.muted??t.muted};(i.volume!==t.volume||i.muted!=i.muted)&&this.params.output.volume$.next(i)}seek(e){this.params.output.willSeekEvent$.next();let{remotePlayer:t,remotePlayerController:i}=this.params.connection;t.currentTime=e,i.seek()}stop(){let{remotePlayerController:e}=this.params.connection;e.stop()}createMediaInfo(e){let t,i,r,a=this.params.source;switch(e){case"MPEG":{let s=a[e];(0,u.assertNonNullable)(s);let n=(0,u.getHighestQuality)(Object.keys(s));(0,u.assertNonNullable)(n);let o=s[n];(0,u.assertNonNullable)(o),t=o,i="video/mp4",r=chrome.cast.media.StreamType.BUFFERED;break}case"HLS":case"HLS_ONDEMAND":{let s=a[e];(0,u.assertNonNullable)(s),t=s.url,i="application/x-mpegurl",r=chrome.cast.media.StreamType.BUFFERED;break}case"DASH_SEP":case"DASH_ONDEMAND":case"DASH_WEBM":case"DASH_WEBM_AV1":case"DASH_STREAMS":{let s=a[e];(0,u.assertNonNullable)(s),t=s.url,i="application/dash+xml",r=chrome.cast.media.StreamType.BUFFERED;break}case"DASH_LIVE_CMAF":{let s=a[e];(0,u.assertNonNullable)(s),t=s.url,i="application/dash+xml",r=chrome.cast.media.StreamType.LIVE;break}case"HLS_LIVE":case"HLS_LIVE_CMAF":{let s=a[e];(0,u.assertNonNullable)(s),t=sr(s.url),i="application/x-mpegurl",r=chrome.cast.media.StreamType.LIVE;break}case"DASH_LIVE":case"WEB_RTC_LIVE":{let e="Unsupported format for Chromecast",t=new Error(e);throw this.params.output.error$.next({id:"ChromecastProvider.createMediaInfo()",category:u.ErrorCategory.VIDEO_PIPELINE,message:e,thrown:t}),t}case"DASH":case"DASH_LIVE_WEBM":throw new Error(`${e} is no longer supported`);default:return(0,u.assertNever)(e)}let s=new chrome.cast.media.MediaInfo(this.params.meta.videoId??t,i);s.contentUrl=t,s.streamType=r,s.metadata=new chrome.cast.media.GenericMediaMetadata;let{title:n,subtitle:o}=this.params.meta;return(0,u.isNonNullable)(n)&&(s.metadata.title=n),(0,u.isNonNullable)(o)&&(s.metadata.subtitle=o),s}createLoadRequest(e){let t=new chrome.cast.media.LoadRequest(e);t.autoplay=!1;let i=this.params.desiredState.seekState.getState();return"applying"===i.state||"requested"===i.state?t.currentTime=this.params.output.isLive$.getValue()?0:i.position/1e3:t.currentTime=0,t}loadMedia(e){let t=this.params.connection.session.loadMedia(e),i=new Promise(((e,t)=>{this.loadMediaTimeoutSubscription.add((0,u.timeout)(7e3).subscribe((()=>t("timeout(7000)"))))}));(0,ar.default)(Promise.race([t,i]).then((()=>{this.log({message:`[loadMedia] completed, format: ${this.params.format}`}),"applying"===this.params.desiredState.seekState.getState().state&&this.params.output.seekedEvent$.next(),this.handleRemoteReady()}),(e=>{let t=`[prepare] loadMedia failed, format: ${this.params.format}, reason: ${e}`;this.log({message:t}),this.params.output.error$.next({id:"ChromecastProvider.loadMedia",category:u.ErrorCategory.VIDEO_PIPELINE,message:t,thrown:e})})),(()=>{this.loadMediaTimeoutSubscription.unsubscribe()}))}logRemoteEvent(e){this.log({message:`[remoteEvent] ${JSON.stringify(e)}`})}constructor(e){this.subscription=new u.Subscription,this.loadMediaTimeoutSubscription=new u.Subscription,this.videoState=new lr("stopped"),this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.videoState.getTransition(),i=this.params.desiredState.playbackState.getState(),r=this.params.desiredState.playbackState.getTransition(),a=this.params.desiredState.seekState.getState();if(this.log({message:`[syncPlayback] videoState: ${e}; videoTransition: ${JSON.stringify(t)}; desiredPlaybackState: ${i}; desiredPlaybackStateTransition: ${this.params.desiredState.playbackState.getTransition()}; seekState: ${JSON.stringify(a)};`}),"stopped"!==i){if(!t){if("paused"!==r?.to&&"requested"===a.state&&"stopped"!==e)return void this.seek(a.position/1e3);switch(i){case"ready":switch(e){case"playing":case"paused":case"ready":break;case"stopped":this.videoState.startTransitionTo("ready"),this.prepare();break;default:(0,u.assertNever)(e)}break;case"playing":switch(e){case"playing":break;case"paused":case"ready":this.videoState.startTransitionTo("playing"),this.params.connection.remotePlayerController.playOrPause();break;case"stopped":this.videoState.startTransitionTo("ready"),this.prepare();break;default:(0,u.assertNever)(e)}break;case"paused":switch(e){case"playing":this.videoState.startTransitionTo("paused"),this.params.connection.remotePlayerController.playOrPause();break;case"paused":break;case"ready":this.videoState.startTransitionTo("paused"),this.videoState.setState("paused");break;case"stopped":this.videoState.startTransitionTo("ready"),this.prepare();break;default:(0,u.assertNever)(e)}break;default:(0,u.assertNever)(i)}}}else"stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.stop())},this.params=e,this.log=this.params.dependencies.logger.createComponentLog("ChromecastProvider"),this.log({message:`constructor, format: ${e.format}`}),this.params.output.isLive$.next((e=>{switch(e){case"MPEG":case"DASH":case"DASH_SEP":case"DASH_ONDEMAND":case"DASH_WEBM":case"DASH_WEBM_AV1":case"DASH_STREAMS":case"HLS":case"HLS_ONDEMAND":return!1;case"DASH_LIVE":case"DASH_LIVE_CMAF":case"HLS_LIVE":case"HLS_LIVE_CMAF":case"DASH_LIVE_WEBM":case"WEB_RTC_LIVE":return!0;default:return(0,u.assertNever)(e)}})(e.format)),this.params.output.isAudioAvailable$.next(!0),this.handleRemoteVolumeChange({volume:this.params.connection.remotePlayer.volumeLevel,muted:this.params.connection.remotePlayer.isMuted});let t=this.params.connection.session.getMediaSession();t&&this.restoreSession(t),this.subscribe()}},dr=g(_e(),1),cr=window.WeakMap?new WeakMap:new class{get(e){return e.hasAttribute(this.attribute)}set(e,t){e.toggleAttribute(this.attribute,t)}delete(e){e.removeAttribute(this.attribute)}constructor(){this.attribute="data-pool-reused"}},hr=window.WeakMap?new WeakMap:new Map,pr=(e,{audioVideoSyncRate:t,disableYandexPiP:i})=>{let r=e.querySelector("video"),a=!!r;r?(0,u.clearVideoElement)(r):(r=document.createElement("video"),e.appendChild(r)),cr.set(r,a);let s=new u.Subscription;return s.add(((e,t=20)=>{let i=0;return(0,u.fromEvent)(e,"ratechange").subscribe((r=>{i++,i>=t&&(e.currentTime=e.currentTime,i=0)}))})(r,t)),hr.set(r,s),r.setAttribute("crossorigin","anonymous"),r.setAttribute("playsinline","playsinline"),i&&r.setAttribute("x-yandex-pip","false"),r.controls=!1,r.setAttribute("poster","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="),r},fr=e=>{hr.get(e)?.unsubscribe(),hr.delete(e);let t=cr.get(e);cr.delete(e),t?(0,u.clearVideoElement)(e):(e=>{try{e.pause(),e.playbackRate=0,(0,u.clearVideoElement)(e),e.remove()}catch(e){console.error(e)}})(e)},mr=g(ri(),1),vr=(e,t,i,{equal:r=(e,t)=>e===t,changed$:a,onError:s}={})=>{let n=e.getState(),o=t(),l=(0,u.isNullable)(a),d=new u.Subscription;return a&&d.add(a.subscribe((t=>{let i=e.getState();r(t,i)&&e.setState(t)}),s)),r(o,n)||(i(n),l&&e.setState(n)),d.add(e.stateChangeStarted$.subscribe((t=>{i(t.to),l&&e.setState(t.to)}),s)),d},gr=(e,t,i)=>vr(t,(()=>e.loop),(t=>{(0,u.isNonNullable)(t)&&(e.loop=t)}),{onError:i}),br=(e,t,i,r)=>vr(t,(()=>({muted:e.muted,volume:e.volume})),(t=>{(0,u.isNonNullable)(t)&&(e.muted=t.muted,e.volume=t.volume)}),{equal:(e,t)=>e===t||e?.muted===t?.muted&&e?.volume===t?.volume,changed$:i,onError:r}),yr=(e,t,i,r)=>vr(t,(()=>e.playbackRate),(t=>{(0,u.isNonNullable)(t)&&(e.playbackRate=t)}),{changed$:i,onError:r}),wr=vr,Sr=(e,t)=>{if(e.id===t)return!0;let[i,r,a]=t.split("|");return e.language===r&&e.label===a},xr=class e{connect(e,t,i){this.video=e,this.cueSettings=t.textTrackCuesSettings,this.subscribe();let r=e=>{this.error$.next({id:"TextTracksManager",category:u.ErrorCategory.WTF,message:"Generic HtmlVideoTextTrackManager error",thrown:e})};this.subscription.add(this.available$.subscribe(i.availableTextTracks$)),this.subscription.add(this.current$.subscribe(i.currentTextTrack$)),this.subscription.add(this.error$.subscribe(i.error$)),this.subscription.add(wr(t.internalTextTracks,(()=>(0,mr.default)(this.internalTracks)),(e=>{(0,u.isNonNullable)(e)&&this.setInternal(e)}),{equal:(e,t)=>(0,u.isNonNullable)(e)&&(0,u.isNonNullable)(t)&&e.length===t.length&&e.every((({id:e},i)=>e===t[i].id)),changed$:this.available$.pipe((0,u.map)((e=>e.filter((({type:e})=>"internal"===e))))),onError:r})),this.subscription.add(wr(t.externalTextTracks,(()=>(0,mr.default)(this.externalTracks)),(e=>{(0,u.isNonNullable)(e)&&this.setExternal(e)}),{equal:(e,t)=>(0,u.isNonNullable)(e)&&(0,u.isNonNullable)(t)&&e.length===t.length&&e.every((({id:e},i)=>e===t[i].id)),changed$:this.available$.pipe((0,u.map)((e=>e.filter((({type:e})=>"external"===e))))),onError:r})),this.subscription.add(wr(t.currentTextTrack,(()=>{if(this.video)return;let e=this.htmlTextTracksAsArray().find((({mode:e})=>"showing"===e));return e&&this.htmlTextTrackToITextTrack(e).id}),(e=>this.select(e)),{changed$:this.current$,onError:r})),this.subscription.add(wr(t.textTrackCuesSettings,(()=>({})),(()=>{if(this.video)for(let e of this.htmlTextTracksAsArray())this.applyCueSettings(e.cues),this.applyCueSettings(e.activeCues)})))}subscribe(){(0,u.assertNonNullable)(this.video);let{textTracks:e}=this.video;this.subscription.add((0,u.fromEvent)(e,"addtrack").subscribe((()=>{let e=this.current$.getValue();e&&this.select(e)}))),this.subscription.add((0,u.merge)((0,u.fromEvent)(e,"addtrack"),(0,u.fromEvent)(e,"removetrack"),(0,u.observableFrom)(["init"])).pipe((0,u.map)((()=>this.htmlTextTracksAsArray().map((e=>this.htmlTextTrackToITextTrack(e))))),(0,u.filterChanged)(((e,t)=>e.length===t.length&&e.every((({id:e},i)=>e===t[i].id))))).subscribe(this.available$)),this.subscription.add((0,u.merge)((0,u.fromEvent)(e,"change"),(0,u.observableFrom)(["init"])).pipe((0,u.map)((()=>this.htmlTextTracksAsArray().find((({mode:e})=>"showing"===e)))),(0,u.map)((e=>e&&this.htmlTextTrackToITextTrack(e).id)),(0,u.filterChanged)()).subscribe(this.current$));let t=e=>this.applyCueSettings(e.target?.activeCues??null);this.subscription.add((0,u.fromEvent)(e,"addtrack").subscribe((e=>{e.track?.addEventListener("cuechange",t);let i=e=>{let t=e.target?.cues??null;t&&t.length&&(this.applyCueSettings(e.target?.cues??null),e.target?.removeEventListener("cuechange",i))};e.track?.addEventListener("cuechange",i)}))),this.subscription.add((0,u.fromEvent)(e,"removetrack").subscribe((e=>{e.track?.removeEventListener("cuechange",t)})))}applyCueSettings(e){if(!e||!e.length)return;let t=this.cueSettings.getState();for(let i of Array.from(e)){let e=i;(0,u.isNonNullable)(t.align)&&(e.align=t.align),(0,u.isNonNullable)(t.position)&&(e.position=t.position),(0,u.isNonNullable)(t.size)&&(e.size=t.size),(0,u.isNonNullable)(t.line)&&(e.line=t.line)}}htmlTextTracksAsArray(t=!1){(0,u.assertNonNullable)(this.video);let i=[...this.video.textTracks];return t?i:i.filter(e.isHealthyTrack)}htmlTextTrackToITextTrack(e){let{language:t,label:i}=e,r=e.id?e.id:(e=>["__",e.language,e.label].join("|"))(e),a=this.externalTracks.has(r),s=(a?this.externalTracks.get(r)?.isAuto:this.internalTracks.get(r)?.isAuto)??r.includes("auto");return a?{id:r,type:"external",isAuto:s,language:t,label:i,url:this.externalTracks.get(r)?.url}:{id:r,type:"internal",isAuto:s,language:t,label:i,url:this.internalTracks.get(r)?.url}}static isHealthyTrack(e){return!("metadata"===e.kind||e.groupId||""===e.id&&""===e.label&&""===e.language)}setExternal(e){this.internalTracks.size>0&&Array.from(this.internalTracks).forEach((([,e])=>this.detach(e))),e.filter((({id:e})=>!this.externalTracks.has(e))).forEach((e=>this.attach(e))),Array.from(this.externalTracks).filter((([t])=>!e.find((e=>e.id===t)))).forEach((([,e])=>this.detach(e)))}setInternal(e){let t=[...this.externalTracks];e.filter((({id:e,language:i,isAuto:r})=>!this.internalTracks.has(e)&&!t.some((([,e])=>e.language===i&&e.isAuto===r)))).forEach((e=>this.attach(e))),Array.from(this.internalTracks).filter((([t])=>!e.find((e=>e.id===t)))).forEach((([,e])=>this.detach(e)))}select(e){(0,u.assertNonNullable)(this.video);for(let e of this.htmlTextTracksAsArray(!0))e.mode="showing";for(let t of this.htmlTextTracksAsArray(!0))((0,u.isNullable)(e)||!Sr(t,e))&&(t.mode="disabled")}destroy(){if(this.subscription.unsubscribe(),this.video)for(let e of Array.from(this.video.getElementsByTagName("track"))){let t=e.getAttribute("id");t&&this.externalTracks.has(t)&&this.video.removeChild(e)}this.externalTracks.clear()}attach(e){(0,u.assertNonNullable)(this.video);let t=document.createElement("track");this.baseURL?t.setAttribute("src",new URL(e.url,this.baseURL).toString()):t.setAttribute("src",e.url),t.setAttribute("id",e.id),e.label&&t.setAttribute("label",e.label),e.language&&t.setAttribute("srclang",e.language),"external"===e.type?this.externalTracks.set(e.id,e):"internal"===e.type&&this.internalTracks.set(e.id,e),this.video.appendChild(t)}detach(e){(0,u.assertNonNullable)(this.video);let t=Array.prototype.find.call(this.video.getElementsByTagName("track"),(t=>t.getAttribute("id")===e.id));t&&this.video.removeChild(t),"external"===e.type?this.externalTracks.delete(e.id):"internal"===e.type&&this.internalTracks.delete(e.id)}constructor(e){this.available$=new u.Subject,this.current$=new u.ValueSubject(void 0),this.error$=new u.Subject,this.subscription=new u.Subscription,this.externalTracks=new Map,this.internalTracks=new Map,this.baseURL=e}},$r=class{getTotalPausedTime(){return this.pausedTime+this.getCurrentPausedTime()}getCurrentPausedTime(){return this.pauseTimestamp>0?Date.now()-this.pauseTimestamp:0}getStreamOffset(){return this.streamOffset}getTotalOffset(){return this.getTotalPausedTime()+this.streamOffset}pause(){0===this.pauseTimestamp&&(this.pauseTimestamp=Date.now())}resume(){this.pauseTimestamp>0&&(this.pausedTime+=this.getCurrentPausedTime(),this.pauseTimestamp=0)}resetTo(e,t=!1){this.streamOffset=e,this.pauseTimestamp=0,this.pausedTime=0,t&&this.pause()}constructor(){this.pausedTime=0,this.streamOffset=0,this.pauseTimestamp=0}},_r=e=>{let t=e;for(;!(t instanceof Document||t instanceof ShadowRoot||null===t);)t=t?.parentNode;return t??void 0},kr=e=>{let t=_r(e);return!(!t||!t.fullscreenElement||t.fullscreenElement!==e)},Tr=class{get current(){return this._current}get isYandex(){return"Yandex"===this.current}get isSafari(){return"Safari"===this.current}get isSamsungBrowser(){return"SamsungBrowser"===this.current}get safariVersion(){return this._safariVersion}detect(){let{userAgent:e}=navigator;try{let t=/yabrowser/i.test(e)?"Yandex":void 0,i=/samsungbrowser/i.test(e)?"SamsungBrowser":void 0,r=/chrome|crios/i.test(e)?"Chrome":void 0,a=/chromium/i.test(e)?"Chromium":void 0,s=/firefox|fxios/i.test(e)?"Firefox":void 0,n=/webkit|safari|khtml/i.test(e)?"Safari":void 0,o=/opr\//i.test(e)?"Opera":void 0,l=/edg/i.test(e)?"Edge":void 0;this._current=t||i||s||o||l||r||a||n||"Rest"}catch(e){console.error(e)}this.isSafari&&this.detectSafariVersion()}detectSafariVersion(){try{let{userAgent:e}=window.navigator,t=e.match(/Version\/(\d+)/);if(!t)return;let i=t[1],r=parseInt(i,10);if(isNaN(r))return;this._safariVersion=r}catch(e){console.error(e)}}},Cr=g(_e(),1),Er=()=>/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(navigator.appVersion??navigator.userAgent)||navigator?.userAgentData?.mobile,Ar=class{get current(){return this._current}get isIOS(){return"iOS"===this._highEntropyValues.platform||(0,Cr.default)(["iPhone","iPad","iPod"],this.current)}get isMac(){return"macOS"===this._highEntropyValues.platform||"Mac"===this.current}get isApple(){return this.isIOS||this.isMac}get isIphoneOrOldIpad(){if(!this.isApple||!this._displayChecker.isTouch)return!1;let e="iPad"===this.current||this._displayChecker.width>700,t=this._iosVersion;return!e||e&&!!t&&t<16}get isAndroid(){return"Android"===this._highEntropyValues.platform||"Android"===this.current}get isMobile(){return this._highEntropyValues.mobile||this._isMobile}get iOSVersion(){return this._iosVersion}detect(){let{userAgent:e}=navigator;try{this._isMobile=Er()}catch(e){console.error(e)}this.detectDevice(e),this.detectHighEntropyValues(),this.isIOS&&this.detectIOSVersion()}async detectHighEntropyValues(){let{userAgentData:e}=navigator;if(e?.getHighEntropyValues){let t=await e.getHighEntropyValues(["architecture","bitness","brands","mobile","platform","formFactor","model","platformVersion","wow64"]);this._highEntropyValues=t}}detectDevice(e){try{let t=/android/i.test(e)?"Android":void 0,i=/iphone/i.test(e)?"iPhone":void 0,r=/ipad/i.test(e)?"iPad":void 0,a=/ipod/i.test(e)?"iPod":void 0,s=/mac/i.test(e)?"Mac":void 0,n=/webOS|BlackBerry|IEMobile|Opera Mini/i.test(e)?"RestMobile":void 0;this._current=t||i||r||a||n||s||"Desktop"}catch(e){console.error(e)}}detectIOSVersion(){try{if(this._highEntropyValues.platformVersion){let e=this._highEntropyValues.platformVersion.split(".").slice(0,2).join("."),t=parseFloat(e);return void(this._iosVersion=t)}let{userAgent:e}=window.navigator,t=e.match(/OS (\d+(_\d+)?)/i);if(!t)return;let i=t[1].replace(/_/g,".");if(!i)return;let r=parseFloat(i);if(isNaN(r))return;this._iosVersion=r}catch(e){console.error(e)}}constructor(e){this._highEntropyValues={},this._displayChecker=e}},Lr=class{get isTouch(){return"number"==typeof this._maxTouchPoints?this._maxTouchPoints>1:"ontouchstart"in window}get maxTouchPoints(){return this._maxTouchPoints}get height(){return this._height}get width(){return this._width}get screenHeight(){return this._screenHeight}get screenWidth(){return this._screenWidth}get pixelRatio(){return this._pixelRatio}get isHDR(){return this._isHdr}get colorDepth(){return this._colorDepth}detect(){let{maxTouchPoints:e}=navigator;try{this._maxTouchPoints=e??0,this._isHdr=!!matchMedia("(dynamic-range: high)")?.matches,this._colorDepth=screen.colorDepth}catch(e){console.error(e)}try{this._pixelRatio=window.devicePixelRatio||1,this._height=screen.height,this._width=screen.width,this._height=screen.height,this._screenHeight=this._height*this._pixelRatio,this._screenWidth=this._width*this._pixelRatio}catch(e){console.error(e)}}},Pr=()=>window.ManagedMediaSource||window.MediaSource,Mr=()=>!(!window.ManagedMediaSource||!window.ManagedSourceBuffer?.prototype?.appendBuffer),Ir=()=>window.ManagedMediaSource?new ManagedMediaSource:new MediaSource,Rr=document.createElement("video"),Vr='video/webm; codecs="vp09.00.10.08"',Nr='video/webm; codecs="av01.0.00M.08"';(async()=>{if(!window.navigator.mediaCapabilities)return;let e={type:"media-source",video:{contentType:"video/webm",width:1280,height:720,bitrate:1e6,framerate:30}},[t,i]=await Promise.all([window.navigator.mediaCapabilities.decodingInfo({...e,video:{...e.video,contentType:Nr}}),window.navigator.mediaCapabilities.decodingInfo({...e,video:{...e.video,contentType:Vr}})]);l={DASH_WEBM_AV1:t,DASH_WEBM:i}})().catch((e=>{console.log(Rr),console.error(e)}));var Br=class{get protocols(){return this._protocols}get containers(){return this._containers}get codecs(){return this._codecs}get webmDecodingInfo(){return l}get supportedCodecs(){return Object.keys(this._codecs).filter((e=>this._codecs[e]))}get nativeHlsSupported(){return this._nativeHlsSupported}detect(){this._video=document.createElement("video");try{this._protocols={mms:Mr(),mse:!(!window.MediaSource||!window.SourceBuffer?.prototype?.appendBuffer),hls:!(!this._video.canPlayType?.("application/x-mpegurl")&&!this._video.canPlayType?.("vnd.apple.mpegURL")),webrtc:!!window.RTCPeerConnection,ws:!!window.WebSocket},this._containers={mp4:!!this._video.canPlayType?.("video/mp4"),webm:!!this._video.canPlayType?.("video/webm"),cmaf:!0};let e=!!Pr()?.isTypeSupported?.('video/mp4; codecs="avc1.42000a,mp4a.40.2"'),t=!!Pr()?.isTypeSupported?.('video/mp4; codecs="hev1.1.6.L93.B0"'),i=!!Pr()?.isTypeSupported?.('audio/mp4; codecs="mp4a.40.2"');this._codecs={h264:e,h265:t,vp9:!!Pr()?.isTypeSupported?.(Vr),av1:!!Pr()?.isTypeSupported?.(Nr),aac:i,opus:!!Pr()?.isTypeSupported?.('audio/webm; codecs="opus"'),mpeg:(e||t)&&i},this._nativeHlsSupported=this._protocols.hls&&this._containers.mp4}catch(e){console.error(e)}this.destroyVideoElement()}destroyVideoElement(){if(!this._video)return;if(this._video.pause(),this._video.currentTime=0,this._video.removeAttribute("src"),this._video.src="",this._video.load(),this._video.remove)return this._video.remove(),void(this._video=null);this._video.parentNode&&this._video.parentNode.removeChild(this._video);let e=this._video.cloneNode(!1);this._video.parentNode?.replaceChild(e,this._video),this._video=null}constructor(e,t){this._deviceChecker=e,this._browserChecker=t}},Dr="audio/mpeg",Or=class{supportMp3(){return this._codecs.mp3&&this._containers.mpeg}detect(){this._audio=document.createElement("audio");try{this._containers={mpeg:!!this._audio.canPlayType?.(Dr)},this._codecs={mp3:!!Pr()?.isTypeSupported?.(Dr)}}catch(e){console.error(e)}this.destroyAudioElement()}destroyAudioElement(){if(!this._audio)return;if(this._audio.pause(),this._audio.currentTime=0,this._audio.removeAttribute("src"),this._audio.src="",this._audio.load(),this._audio.remove)return this._audio.remove(),void(this._audio=null);this._audio.parentNode&&this._audio.parentNode.removeChild(this._audio);let e=this._audio.cloneNode(!1);this._audio.parentNode?.replaceChild(e,this._audio),this._audio=null}},Fr=new class{get display(){return this._displayChecker}get device(){return this._deviceChecker}get browser(){return this._browserChecker}get video(){return this._videoChecker}get audio(){return this._audioChecker}async detect(){this._displayChecker.detect(),this._deviceChecker.detect(),this._browserChecker.detect(),this._videoChecker.detect(),this._audioChecker.detect(),this.isInited$.next(!0)}constructor(){this.isInited$=new u.ValueSubject(!1),this._displayChecker=new Lr,this._deviceChecker=new Ar(this._displayChecker),this._browserChecker=new Tr,this._videoChecker=new Br(this._deviceChecker,this._browserChecker),this._audioChecker=new Or,this.detect()}},jr=e=>{let t,i=t=>(0,u.fromEvent)(e,t).pipe((0,u.mapTo)(void 0)),r=new u.Subscription,a=(0,u.merge)((0,u.fromEvent)(e,"progress"),(0,u.fromEvent)(e,"timeupdate")).pipe((0,u.map)((()=>((e,t,i=3)=>{let r=0,a=0;for(let s=0;s<e.length;s++){let n=e.start(s),o=e.end(s);if(n<=t&&t<=o){if(r=n,a=o,!i)return{from:r,to:a};for(let t=s-1;t>=0;t--)e.end(t)+i>=r&&(r=e.start(t));for(let t=s+1;t<e.length;t++)e.start(t)-i<=a&&(a=e.end(t))}}return{from:r,to:a}})(e.buffered,e.currentTime)))),s=Fr.browser.isSafari?(0,u.combine)({play:i("play").pipe((0,u.once)()),playing:i("playing")}).pipe((0,u.mapTo)(void 0)):i("playing"),n=(0,u.fromEvent)(e,"volumechange").pipe((0,u.map)((()=>({muted:e.muted,volume:e.volume})))),o=(0,u.fromEvent)(e,"ratechange").pipe((0,u.map)((()=>e.playbackRate))),l=(0,u.fromEvent)(e,"error").pipe((0,u.filter)((()=>!(!e.error&&!e.played.length))),(0,u.map)((()=>{let t=e.error;return{id:t?`MediaError#${t.code}`:"HtmlVideoError",category:u.ErrorCategory.VIDEO_PIPELINE,message:t?t.message:"Error event from HTML video element",thrown:e.error??void 0}}))),d=(0,u.fromEvent)(e,"timeupdate").pipe((0,u.map)((()=>e.currentTime))),c=new u.Subject;r.add((0,u.merge)(...["waiting","seeking","seeked","timeupdate"].map((t=>(0,u.fromEvent)(e,t)))).subscribe((i=>{let r=e.currentTime;e.loop&&(0,u.isNonNullable)(t)&&(0,u.isNonNullable)(r)&&t>=e.duration-.3&&r<=.3&&c.next(t),t=r})));let h=i("pause").pipe((0,u.filter)((()=>!e.error&&t!==e.duration))),p=(0,u.fromEvent)(e,"enterpictureinpicture"),f=(0,u.fromEvent)(e,"leavepictureinpicture"),m=new u.ValueSubject((e=>{let t=_r(e);return!(!t||!t.pictureInPictureElement||t.pictureInPictureElement!==e)})(e));r.add(p.subscribe((()=>m.next(!0)))),r.add(f.subscribe((()=>m.next(!1))));let v=new u.ValueSubject(kr(e)),g=(0,u.fromEvent)(e,"fullscreenchange");r.add(g.pipe((0,u.map)((()=>kr(e)))).subscribe(v));let b=(0,u.fromEvent)(e,"timeupdate").pipe((0,u.map)((t=>e.duration-e.currentTime<.1))),y=(0,u.merge)(b.pipe((0,u.filter)((t=>!e.loop&&t))),(0,u.fromEvent)(e,"ended")).pipe((0,u.throttle)(1e3),(0,u.mapTo)(void 0)),w=(0,u.combine)({latestNativeEvent:(0,u.merge)(...["waiting","pause","canplay","play","canplaythrough","playing","seeking","seeked","ended"].map((t=>(0,u.fromEvent)(e,t)))),endedExpected:b}).pipe((0,u.map)((({endedExpected:t})=>t?e.readyState<2:e.readyState<3)),(0,u.filterChanged)());return{playing$:s,pause$:h,canplay$:i("canplay"),ended$:y,looped$:c,error$:l,seeked$:i("seeked"),seeking$:i("seeking"),progress$:i("progress"),loadStart$:i("loadstart"),loadedMetadata$:i("loadedmetadata"),loadedData$:i("loadeddata"),timeUpdate$:d,durationChange$:(0,u.fromEvent)(e,"durationchange").pipe((0,u.map)((()=>e.duration))),isBuffering$:w,currentBuffer$:a,volumeState$:n,playbackRateState$:o,inPiP$:m,inFullscreen$:v,enterPip$:p,leavePip$:f,destroy:()=>r.unsubscribe()}},zr=e=>{switch(e){case"mobile":return u.VideoQuality.Q_144P;case"lowest":return u.VideoQuality.Q_240P;case"low":return u.VideoQuality.Q_360P;case"sd":case"medium":return u.VideoQuality.Q_480P;case"hd":case"high":return u.VideoQuality.Q_720P;case"fullhd":case"full":return u.VideoQuality.Q_1080P;case"quadhd":case"quad":return u.VideoQuality.Q_1440P;case"ultrahd":case"ultra":return u.VideoQuality.Q_2160P}},Ur=g(oi(),1),qr=g(_e(),1),Hr=g(Ne(),1),Wr=!1,Qr={},Gr=e=>{e(Qr)},Kr=(e,t)=>{Wr&&(Qr.meta=Qr.meta??{},Qr.meta[e]=t)},Yr=class{next(e){if(!Wr)return;Qr.series=Qr.series??{};let t=Qr.series[this.name]??[];t.push([Date.now(),e]),Qr.series[this.name]=t}constructor(e){this.name=e}};function Zr(e,t,i){return e.max||e.min!==t?e.min||e.max!==i?"unknown":"traffic_saving":"high_quality"}function Xr(e,t,i){return!!e&&"high_quality"===Zr(e,t,i)}function Jr(e,t,i){return(0,u.isNullable)(e)||(0,u.isNonNullable)(e.min)&&(0,u.isNonNullable)(e.max)&&(0,u.isLower)(e.max,e.min)||(0,u.isNonNullable)(e.min)&&t&&(0,u.isHigher)(e.min,t)||(0,u.isNonNullable)(e.max)&&i&&(0,u.isLower)(e.max,i)}function ea({limits:e,highestAvailableHeight:t,lowestAvailableHeight:i}){return Jr({max:e?.max?(0,u.videoHeightToQuality)(e.max):void 0,min:e?.min?(0,u.videoHeightToQuality)(e.min):void 0},t?(0,u.videoHeightToQuality)(t):void 0,i?(0,u.videoHeightToQuality)(i):void 0)}var ta=new Yr("best_bitrate"),ia=(e,t,i)=>(t-i)*Math.pow(2,-10*e)+i,ra=e=>(t,i)=>e*(Number(t.bitrate)-Number(i.bitrate)),aa=class{recordSelection(e){this.history[e.id]=(0,u.now)()}recordSwitch(e){this.last=e}clear(){this.last=void 0,this.history={}}constructor(){this.history={}}},sa='Assertion "ABR Tracks is empty array" failed',na=new WeakMap,oa=new WeakMap,la=new WeakMap,ua=(e,t,i,r)=>{let a=[...t].sort(ra(1)),s=[...i].sort(ra(1)),n=s.filter((t=>!(0,u.isNonNullable)(t.bitrate)||!(0,u.isNonNullable)(e.bitrate)||e.bitrate/t.bitrate>r)),o=(0,Ur.default)(s,Math.round(s.length*a.indexOf(e)/(a.length+1)))??(0,Ur.default)(s,-1);return o&&(0,qr.default)(n,o)?o:n.length?(0,Ur.default)(n,-1):(0,Ur.default)(s,0)},da=(e,t,i,r)=>{let a=na.get(t);a||(a=[...t].sort(ra(1)),na.set(t,a));let s=na.get(i);s||(s=[...i].sort(ra(1)),na.set(i,s));let n=la.get(e);n||(n=s.filter((t=>!(0,u.isNonNullable)(t.bitrate)||!(0,u.isNonNullable)(e.bitrate)||e.bitrate/t.bitrate>r)),la.set(e,n));let o=(0,Ur.default)(s,Math.round(s.length*a.indexOf(e)/(a.length+1)))??(0,Ur.default)(s,-1);return o&&(0,qr.default)(n,o)?o:n.length?(0,Ur.default)(n,-1):(0,Ur.default)(s,0)},ca=e=>"quality"in e,ha=(e,t,i,r)=>{let a=(0,u.isNonNullable)(r?.last?.bitrate)&&(0,u.isNonNullable)(i?.bitrate)&&r.last.bitrate<i.bitrate?e.trackCooldownIncreaseQuality:e.trackCooldownDecreaseQuality,s=i&&r&&r.history[i.id]&&(0,u.now)()-r.history[i.id]<=a&&(!r.last||i.id!==r.last.id);if(i?.id&&r&&!s&&r.recordSelection(i),s&&r?.last){let e=r.last;return r?.recordSwitch(e),t({message:`\n    [last ${ca(e)?"video":"audio"} selected] ${ca(e)?e.quality:e.bitrate}\n    `}),e}return r?.recordSwitch(i),i},pa=({tuning:e,container:t,limits:i,panelSize:r})=>{let a=e.containerSizeFactor;if(r)return{containerSizeLimit:r,containerSizeFactor:a};if(e.usePixelRatio&&Fr.display.pixelRatio){let t=Fr.display.pixelRatio;if(e.pixelRatioMultiplier)a*=e.pixelRatioMultiplier*(t-1)+1;else{let i=e.pixelRatioLogBase,[r=0,s=0,n=0]=e.pixelRatioLogCoefficients,o=((e,t)=>Math.log(t)/Math.log(e))(i,r*t+s)+n;Number.isFinite(o)&&(a*=o)}}return Xr(i,e.highQualityLimit,e.trafficSavingLimit)&&(a*=2),{containerSizeLimit:e.limitByContainer&&t&&t.width>0&&t.height>0?{width:t.width*a,height:t.height*a}:void 0,containerSizeFactor:a}},fa=new WeakMap,ma=(e,{container:t,estimatedThroughput:i,tuning:r,limits:a,reserve:s=0,forwardBufferHealth:n,playbackRate:o,current:l,history:d,visible:c,droppedVideoMaxQualityLimit:h,stallsVideoMaxQualityLimit:p,stallsPredictedThroughput:f,abrLogger:m,panelSize:v})=>{(0,u.assertNotEmptyArray)(e,sa);let{containerSizeFactor:g,containerSizeLimit:b}=pa({container:t,tuning:r,limits:a,panelSize:v}),y=r.considerPlaybackRate&&(0,u.isNonNullable)(o)?o:1,w=fa.get(e);w||(w=e.filter((e=>!(0,u.isInvariantQuality)(e.quality))).sort(((e,t)=>(0,u.isHigher)(e.quality,t.quality)?-1:1)),fa.set(e,w));let S=(0,Ur.default)(w,-1)?.quality,x=(0,Ur.default)(w,0)?.quality,$=Jr(a,x,S),_=y*ia(n??.5,r.bitrateFactorAtEmptyBuffer,r.bitrateFactorAtFullBuffer),k={},T=null;for(let e of w){let t=!0;if(b)if(e.size)t=e.size.width<=b.width&&e.size.height<=b.height;else{let i=b&&(0,u.videoSizeToQuality)(b);t=!i||(0,u.isLowerOrEqual)(e.quality,i)}if(!t){k[e.quality]="FitsContainer";continue}let o=f||i,d=!((0,u.isNonNullable)(o)&&isFinite(o)&&(0,u.isNonNullable)(e.bitrate))||o-s>=e.bitrate*_,m=Xr(a,r.highQualityLimit,r.trafficSavingLimit)&&a?.min===e.quality;if(!d&&!m){k[e.quality]="FitsThroughput";continue}if(r.lazyQualitySwitch&&(0,u.isNonNullable)(r.minBufferToSwitchUp)&&l&&!(0,u.isInvariantQuality)(l.quality)&&(n??0)<r.minBufferToSwitchUp&&(0,u.isHigher)(e.quality,l.quality)){k[e.quality]="Buffer";continue}if(h&&(0,u.isHigherOrEqual)(e.quality,h)&&!m){k[e.quality]="DroppedFramesLimit";continue}if(p&&(0,u.isHigherOrEqual)(e.quality,p)&&!m){k[e.quality]="StallsLimit";continue}let v=$||((0,u.isNullable)(a?.max)||(0,u.isLowerOrEqual)(e.quality,a.max))&&((0,u.isNullable)(a?.min)||(0,u.isHigherOrEqual)(e.quality,a.min)),g=!((0,u.isNonNullable)(c)&&!c)||(0,u.isLowerOrEqual)(e.quality,r.backgroundVideoQualityLimit);v&&g?T||(T=e):k[e.quality]="FitsQualityLimits"}T&&T.bitrate&&ta.next(T.bitrate);let C=T??(0,Ur.default)(w,-1)??e[0],E=d?.last,A=ha(r,m,C,d);return(0,u.isNonNullable)(d)&&A.quality!==E?.quality&&m({message:`\n    [VIDEO TRACKS ABR]\n    [available video tracks]\n\t${e.map((e=>`{ id: ${e.id}, quality: ${e.quality}, bitrate: ${e.bitrate}, size: ${e.size?.width}:${e.size?.height} }`)).join("\n\t")}\n\n    [tuning]\n\t${(0,Hr.default)(r??{}).map((([e,t])=>`${e}: ${t}`)).join("\n\t")}\n\n    [limit params]\n    containerSizeFactor: ${g},\n    containerSizeLimit: ${b?.width??0} x ${b?.height??0},\n    estimatedThroughput: ${i},\n    stallsPredictedThroughput: ${f},\n    reserve: ${s},\n    playbackRate: ${o},\n    playbackRateFactor: ${y},\n    forwardBufferHealth: ${n},\n    bitrateFactor: ${_},\n    minBufferToSwitchUp: ${r.minBufferToSwitchUp},\n    droppedVideoMaxQualityLimit: ${h},\n    stallsVideoMaxQualityLimit: ${p},\n    limitsAreInvalid: ${$},\n    maxQualityLimit: ${a?.max},\n    minQualityLimit: ${a?.min},\n\n    [limited video tracks]\n    ${(0,Hr.default)(k).map((([e,t])=>`${e}: ${t}`)).join("\n\t")||"All tracks are available"}\n\n    [best video track] ${T?.quality}\n    [selected video track] ${A?.quality}\n    `}),A},va=(e,{container:t,estimatedThroughput:i,tuning:r,limits:a,reserve:s=0,forwardBufferHealth:n,playbackRate:o,current:l,history:d,visible:c,droppedVideoMaxQualityLimit:h,stallsVideoMaxQualityLimit:p,stallsPredictedThroughput:f,abrLogger:m,panelSize:v})=>{(0,u.assertNotEmptyArray)(e,sa);let{containerSizeFactor:g,containerSizeLimit:b}=pa({container:t,tuning:r,limits:a,panelSize:v}),y=r.considerPlaybackRate&&(0,u.isNonNullable)(o)?o:1,w=e.filter((e=>!(0,u.isInvariantQuality)(e.quality))).sort(((e,t)=>(0,u.isHigher)(e.quality,t.quality)?-1:1)),S=(0,Ur.default)(w,-1)?.quality,x=(0,Ur.default)(w,0)?.quality,$=Jr(a,x,S),_=y*ia(n??.5,r.bitrateFactorAtEmptyBuffer,r.bitrateFactorAtFullBuffer),k={},T=w.filter((e=>{let t=!0;if(b)if(e.size)t=e.size.width<=b.width&&e.size.height<=b.height;else{let i=b&&(0,u.videoSizeToQuality)(b);t=!i||(0,u.isLowerOrEqual)(e.quality,i)}if(!t)return k[e.quality]="FitsContainer",!1;let o=f||i,d=!((0,u.isNonNullable)(o)&&isFinite(o)&&(0,u.isNonNullable)(e.bitrate))||o-s>=e.bitrate*_,m=Xr(a,r.highQualityLimit,r.trafficSavingLimit)&&a?.min===e.quality;if(!d&&!m)return k[e.quality]="FitsThroughput",!1;if(r.lazyQualitySwitch&&(0,u.isNonNullable)(r.minBufferToSwitchUp)&&l&&!(0,u.isInvariantQuality)(l.quality)&&(n??0)<r.minBufferToSwitchUp&&(0,u.isHigher)(e.quality,l.quality))return k[e.quality]="Buffer",!1;if(h&&(0,u.isHigherOrEqual)(e.quality,h)&&!m)return k[e.quality]="DroppedFramesLimit",!1;if(p&&(0,u.isHigherOrEqual)(e.quality,p)&&!m)return k[e.quality]="StallsLimit",!1;let v=$||((0,u.isNullable)(a?.max)||(0,u.isLowerOrEqual)(e.quality,a.max))&&((0,u.isNullable)(a?.min)||(0,u.isHigherOrEqual)(e.quality,a.min)),g=!((0,u.isNonNullable)(c)&&!c)||(0,u.isLowerOrEqual)(e.quality,r.backgroundVideoQualityLimit);return!(!v||!g)||(k[e.quality]="FitsQualityLimits",!1)}))[0];T&&T.bitrate&&ta.next(T.bitrate);let C=T??(0,Ur.default)(w,-1)??e[0],E=d?.last,A=ha(r,m,C,d);return(0,u.isNonNullable)(d)&&A.quality!==E?.quality&&m({message:`\n    [VIDEO TRACKS ABR]\n    [available video tracks]\n\t${e.map((e=>`{ id: ${e.id}, quality: ${e.quality}, bitrate: ${e.bitrate}, size: ${e.size?.width}:${e.size?.height} }`)).join("\n\t")}\n\n    [tuning]\n\t${(0,Hr.default)(r??{}).map((([e,t])=>`${e}: ${t}`)).join("\n\t")}\n\n    [limit params]\n    containerSizeFactor: ${g},\n    containerSizeLimit: ${b?.width??0} x ${b?.height??0},\n    estimatedThroughput: ${i},\n    stallsPredictedThroughput: ${f},\n    reserve: ${s},\n    playbackRate: ${o},\n    playbackRateFactor: ${y},\n    forwardBufferHealth: ${n},\n    bitrateFactor: ${_},\n    minBufferToSwitchUp: ${r.minBufferToSwitchUp},\n    droppedVideoMaxQualityLimit: ${h},\n    stallsVideoMaxQualityLimit: ${p},\n    limitsAreInvalid: ${$},\n    maxQualityLimit: ${a?.max},\n    minQualityLimit: ${a?.min},\n\n    [limited video tracks]\n    ${(0,Hr.default)(k).map((([e,t])=>`${e}: ${t}`)).join("\n\t")||"All tracks are available"}\n\n    [best video track] ${T?.quality}\n    [selected video track] ${A?.quality}\n    `}),A},ga=(e,t,i,{estimatedThroughput:r,tuning:a,playbackRate:s,forwardBufferHealth:n,history:o,abrLogger:l,stallsPredictedThroughput:d})=>{(0,u.assertNotEmptyArray)(i,sa);let c=a.considerPlaybackRate&&(0,u.isNonNullable)(s)?s:1,h=[...i].sort(ra(-1)),p=e.bitrate;(0,u.assertNonNullable)(p);let f,m=c*ia(n??.5,a.bitrateAudioFactorAtEmptyBuffer,a.bitrateAudioFactorAtFullBuffer),v=ua(e,t,i,a.minVideoAudioRatio),g=d||r;(0,u.isNonNullable)(g)&&isFinite(g)&&(f=h.find((e=>!(!(0,u.isNonNullable)(e.bitrate)||!(0,u.isNonNullable)(v?.bitrate))&&(g-p>=e.bitrate*m&&e.bitrate>=v.bitrate)))),f||(f=v);let b=o?.last,y=f&&ha(a,l,f,o);return(0,u.isNonNullable)(o)&&y?.bitrate!==b?.bitrate&&l({message:`\n    [AUDIO TRACKS ABR]\n    [available audio tracks]\n\t${i.map((e=>`{ id: ${e.id}, bitrate: ${e.bitrate} }`)).join("\n\t")}\n\n    [tuning]\n\t${(0,Hr.default)(a??{}).map((([e,t])=>`${e}: ${t}`)).join("\n\t")}\n\n    [limit params]\n    estimatedThroughput: ${r},\n    stallsPredictedThroughput: ${d},\n    reserve: ${p},\n    playbackRate: ${s},\n    playbackRateFactor: ${c},\n    forwardBufferHealth: ${n},\n    bitrateFactor: ${m},\n    minBufferToSwitchUp: ${a.minBufferToSwitchUp},\n\n    [selected audio track] ${y?.id}\n    `}),y},ba=(e,t,i,{estimatedThroughput:r,tuning:a,playbackRate:s,forwardBufferHealth:n,history:o,abrLogger:l,stallsPredictedThroughput:d})=>{(0,u.assertNotEmptyArray)(i,sa);let c=a.considerPlaybackRate&&(0,u.isNonNullable)(s)?s:1,h=oa.get(i);h||(h=[...i].sort(ra(-1)),oa.set(i,h));let p=e.bitrate;(0,u.assertNonNullable)(p);let f,m=c*ia(n??.5,a.bitrateAudioFactorAtEmptyBuffer,a.bitrateAudioFactorAtFullBuffer),v=da(e,t,i,a.minVideoAudioRatio),g=d||r;(0,u.isNonNullable)(g)&&isFinite(g)&&(f=h.find((e=>!(!(0,u.isNonNullable)(e.bitrate)||!(0,u.isNonNullable)(v?.bitrate))&&(g-p>=e.bitrate*m&&e.bitrate>=v.bitrate)))),f||(f=v);let b=o?.last,y=f&&ha(a,l,f,o);return(0,u.isNonNullable)(o)&&y?.bitrate!==b?.bitrate&&l({message:`\n    [AUDIO TRACKS ABR]\n    [available audio tracks]\n\t${i.map((e=>`{ id: ${e.id}, bitrate: ${e.bitrate} }`)).join("\n\t")}\n\n    [tuning]\n\t${(0,Hr.default)(a??{}).map((([e,t])=>`${e}: ${t}`)).join("\n\t")}\n\n    [limit params]\n    estimatedThroughput: ${r},\n    stallsPredictedThroughput: ${d},\n    reserve: ${p},\n    playbackRate: ${s},\n    playbackRateFactor: ${c},\n    forwardBufferHealth: ${n},\n    bitrateFactor: ${m},\n    minBufferToSwitchUp: ${a.minBufferToSwitchUp},\n\n    [selected audio track] ${y?.id}\n    `}),y},ya=e=>new URL(e).hostname,wa=g(oi(),1),Sa=g(_e(),1),xa=e=>{if(e instanceof DOMException&&(0,Sa.default)(["Failed to load because no supported source was found.","The element has no supported sources."],e.message))throw e;return!(e instanceof DOMException&&(20===e.code||"AbortError"===e.name))},$a=async(e,t)=>{let i=e.muted;try{await e.play()}catch(r){if(!xa(r))return!1;if(t&&t(),i)return console.warn(r),!1;e.muted=!0;try{await e.play()}catch(t){return xa(t)&&(e.muted=!1,console.warn(t)),!1}}return!0},_a=g(ri(),1);function ka(){return(0,u.now)()}function Ta(e){return ka()-e}function Ca(e){let t=e.split("/"),i=t.slice(0,t.length-1).join("/"),r=/^([a-z]+:)?\/\//i;return{resolve:(e,t,a=!1)=>{(e=>r.test(e))(e)||(e.startsWith("/")||(e="/"+e),e=i+e);let s=e.indexOf("?")>-1?"&":"?";return a&&(e+=s+"lowLat=1",s="&"),t&&(e+=s+"_rnd="+Math.floor(999999999*Math.random())),e}}}function Ea(e,t,i,r){let a,s,n,o,l,d=window.XMLHttpRequest,c=!1,h=0,p=!1,f="arraybuffer",m=7e3,v=2e3,g=()=>{if(c)return;(0,u.assertNonNullable)(o);let e,t=Ta(o);if(t<v)return e=v-t,void setTimeout(g,e);v*=2,v>m&&(v=m),s&&s.abort(),s=new d,y()},b=()=>{if(!c){if(--h>=0)return g(),void(r&&r());c=!0,l&&l(),i&&i()}},y=()=>{o=ka(),s=new d,s.open("get",e);let i,r=0,h=0,m=()=>((0,u.assertNonNullable)(o),Math.max(o,Math.max(i||0,h||0)));if(a&&s.addEventListener("progress",(e=>{let t=ka();a.updateChunk&&e.loaded>r&&(a.updateChunk(m(),e.loaded-r),r=e.loaded,i=t)})),n&&(s.timeout=n,s.addEventListener("timeout",(()=>b()))),s.addEventListener("load",(()=>{if(c)return;(0,u.assertNonNullable)(s);let e=s.status;if(e>=200&&e<300){let{response:e,responseType:i}=s,n=e?.byteLength;if("number"==typeof n&&a){let e=n-r;e&&a.updateChunk&&a.updateChunk(m(),e)}"json"!==i||e&&(0,_a.default)(e).length?(l&&l(),t(e)):b()}else b()})),s.addEventListener("error",(()=>{b()})),p){let e=()=>{(0,u.assertNonNullable)(s),s.readyState===XMLHttpRequest.HEADERS_RECEIVED&&(h=ka(),s.removeEventListener("readystatechange",e))};s.addEventListener("readystatechange",e)}return s.responseType=f,s.send(),w},w={withBitrateReporting:e=>(a=e,w),withParallel:e=>(p=e,w),withJSONResponse:()=>(f="json",w),withRetryCount:e=>(h=e,w),withRetryInterval:(e,t)=>((0,u.isNonNullable)(e)&&(v=e),(0,u.isNonNullable)(t)&&(m=t),w),withTimeout:e=>(n=e,w),withFinally:e=>(l=e,w),send:y,abort:()=>{s&&(s.abort(),s=void 0),c=!0,l&&l()}};return w}var Aa=class{_updateRate(e){let t=.2;this.currentRate&&(e<.1*this.currentRate?t=.8:e<.5*this.currentRate?t=.5:e<.7*this.currentRate&&(t=.3)),e=Math.max(1,Math.min(e,104857600)),this.currentRate=this.currentRate?this.currentRate*(1-t)+e*t:e}_createInterval(e,t,i){return{start:e,end:t,bytes:i}}_doMergeIntervals(e,t){e.start=Math.min(t.start,e.start),e.end=Math.max(t.end,e.end),e.bytes+=t.bytes}_mergeIntervals(e,t){return e.start<=t.end&&t.start<=e.end&&(this._doMergeIntervals(e,t),!0)}_flushIntervals(){if(!this.intervals.length)return!1;let e=this.intervals[0].start,t=this.intervals[this.intervals.length-1].end-500;if(t-e>2e3){let i=0,r=0;for(;this.intervals.length>0;){let e=this.intervals[0];if(e.end<=t)i+=e.end-e.start,r+=e.bytes,this.intervals.splice(0,1);else{if(e.start>=t)break;{let a=t-e.start,s=e.end-e.start;i+=a;let n=e.bytes*a/s;r+=n,e.start=t,e.bytes-=n}}}if(r>0&&i>0){let a=8*r/(i/1e3);return this._updateRate(a),this.logger(`rate updated, new=${Math.round(a/1024)}K; average=${Math.round(this.currentRate/1024)}K bytes/ms=${Math.round(r)}/${Math.round(i)} interval=${Math.round(t-e)}`),!0}}return!1}_joinIntervals(){let e;do{e=!1;for(let t=0;t<this.intervals.length-1;++t)this._mergeIntervals(this.intervals[t],this.intervals[t+1])&&(this.intervals.splice(t+1,1),e=!0)}while(e)}addInterval(e,t,i){return this.intervals.push(this._createInterval(e,t,i)),this._joinIntervals(),this.intervals.length>100&&(this.logger(`too many intervals (${this.intervals.length}); will merge`,{type:"warn"}),this._doMergeIntervals(this.intervals[1],this.intervals[0]),this.intervals.splice(0,1)),this._flushIntervals()}getBitRate(){return this.currentRate}constructor(e){this.intervals=[],this.currentRate=0,this.logger=e}},La=g(ri(),1),Pa=class{limitCompleteCount(){let e;for(;(e=Object.keys(this.completeRequests)).length>this._getParallelRequestCount()+2;){let t=e[Math.floor(Math.random()*e.length)];this.logger(`Dropping completed request for url ${t}`,{type:"warn"}),delete this.completeRequests[t]}}_sendRequest(e,t){let i=ka(),r=i=>{delete this.activeRequests[t],this.limitCompleteCount(),this.completeRequests[t]=e,this._sendPending(),e._error=1,e._errorMsg=i,e._errorCB?e._errorCB(i):(this.limitCompleteCount(),this.completeRequests[t]=e)};e._request=Ea(t,(r=>{e._complete=1,e._responseData=r,e._downloadTime=ka()-i,delete this.activeRequests[t],this._sendPending(),e._cb?e._cb(r,e._downloadTime):(this.limitCompleteCount(),this.completeRequests[t]=e)}),(()=>r("error")),(()=>{e._retry=1,e._retryCB&&e._retryCB()})),e._request.withRetryCount(this.RETRY_COUNT).withTimeout(this.TIMEOUT).withBitrateReporting(this.BITRATE_ESTIMATOR).withParallel(this._getParallelRequestCount()>1).withFinally((()=>{e._finallyCB&&e._finallyCB()})),this.activeRequests[t]=e,e._request.send(),this.lastPrefetchStart=ka()}_getParallelRequestCount(){return Math.min(this.MAX_PARALLEL_REQUESTS,this.averageSegmentDuration<3e3?3:2)}_getPrefetchDelay(){return Math.max(100,Math.min(5e3,this.averageSegmentDuration/3))}_canSendPending(){let e=this._getParallelRequestCount(),t=ka();if(Object.keys(this.activeRequests).length>=e)return!1;let i=this._getPrefetchDelay()-(t-this.lastPrefetchStart);return this.throttleTimeout&&clearTimeout(this.throttleTimeout),!(i>0)||(this.throttleTimeout=window.setTimeout((()=>this._sendPending()),i),!1)}_sendPending(){for(;this._canSendPending();){let e=this.pendingQueue.pop();if(!e)return;this.activeRequests[e]||this.completeRequests[e]||(this.logger(`Submitting pending request url=${e}`),this._sendRequest({},e))}}_removeFromActive(e){delete this.completeRequests[e],delete this.activeRequests[e]}abortAll(){(0,La.default)(this.activeRequests).forEach((e=>{e&&e._request&&e._request.abort()})),this.activeRequests={},this.pendingQueue=[],this.completeRequests={}}requestData(e,t,i,r){let a={};return a.send=()=>{let s=this.activeRequests[e]||this.completeRequests[e];if(s)s._cb=t,s._errorCB=i,s._retryCB=r,s._finallyCB=a._finallyCB,s._error||s._complete?(this._removeFromActive(e),setTimeout((()=>{s._complete?(this.logger(`Requested url already prefetched, url=${e}`),t(s._responseData,s._downloadTime)):(this.logger(`Requested url already prefetched with error, url=${e}`),i(s._errorMsg)),a._finallyCB&&a._finallyCB()}),0)):this.logger(`Attached to active request, url=${e}`);else{let t=this.pendingQueue.indexOf(e);-1!==t&&this.pendingQueue.splice(t,1),this.logger(`Request not prefetched, starting new request, url=${e}${-1===t?"":"; removed pending"}`),this._sendRequest(a,e)}},a._cb=t,a._errorCB=i,a._retryCB=r,a.abort=function(){a.request&&a.request.abort()},a.withFinally=e=>(a._finallyCB=e,a),a}prefetch(e){this.activeRequests[e]||this.completeRequests[e]?this.logger(`Request already active for url=${e}`):(this.logger(`Added to pending queue; url=${e}`),this.pendingQueue.unshift(e),this._sendPending())}optimizeForSegDuration(e){this.averageSegmentDuration=e}constructor(e,t,i,r,a){this.pendingQueue=[],this.activeRequests={},this.completeRequests={},this.averageSegmentDuration=2e3,this.lastPrefetchStart=0,this.throttleTimeout=null,this.RETRY_COUNT=e,this.TIMEOUT=t,this.BITRATE_ESTIMATOR=i,this.MAX_PARALLEL_REQUESTS=r,this.logger=a}},Ma=1e4,Ia=class{attachSource(e){this.manifestUrl=e,this.urlResolver=Ca(e),this.bitrateSwitcher=this._initBitrateSwitcher(),this._initManifest()}setAutoQualityEnabled(e){this.autoQuality=e}setAutoQualityLimits(e){this.autoQualityLimits=e}switchByName(e){let t;for(let i=0;i<this.manifest.length;++i)if(t=this.manifest[i],t.name===e)return void this._switchToQuality(t)}catchUp(){this.rep&&this.rep.stop(),this.currentManifestEntry&&(this.paused=!1,this._initPlayerWith(this.currentManifestEntry),this._notifyBuffering(!0))}stop(){this.params.videoElement.pause(),this.rep&&(this.rep.stop(),this.rep=null)}pause(){this.paused=!0,this.params.videoElement.pause(),this.videoPlayStarted=!1,this._notifyBuffering(!1)}play(){this.paused=!1;let e=this.lowLatency&&this._getBufferSizeSec()>this.sourceJitter+5;this.rep&&!e?(this.bufferStates=[],this.videoPlayStarted=!1,this.shouldPlay()?this._playVideoElement():this._notifyBuffering(!0)):this.catchUp()}startPlay(e,t){this.autoQuality=t,this._initPlayerWith(e)}destroy(){this.destroyed=!0,this.rep&&(this.rep.stop(),this.rep=null),this.manifestRequest&&this.manifestRequest.abort(),this.manifestRefetchTimer&&(clearTimeout(this.manifestRefetchTimer),this.manifestRefetchTimer=void 0)}reinit(e){this.manifestUrl=e,this.urlResolver=Ca(e),this.catchUp()}_handleNetworkError(){this.params.logger("Fatal network error"),this.params.playerCallback({name:"error",type:"network"})}_retryCallback(){this.params.playerCallback({name:"retry"})}_getBufferSizeSec(){let e=this.params.videoElement,t=0,i=e.buffered.length;return 0!==i&&(t=e.buffered.end(i-1)-Math.max(e.currentTime,e.buffered.start(0))),t}_notifyBuffering(e){this.destroyed||(this.params.logger(`buffering: ${e}`),this.params.playerCallback({name:"buffering",isBuffering:e}),this.buffering=e)}_initVideo(){let{videoElement:e,logger:t}=this.params;e.addEventListener("error",(()=>{e.error&&!this.destroyed&&(t(`Video element error: ${e.error?.code}`),this.params.playerCallback({name:"error",type:"media"}))})),e.addEventListener("timeupdate",(()=>{let e=this._getBufferSizeSec();!this.paused&&e<.3?this.buffering||(this.buffering=!0,window.setTimeout((()=>{!this.paused&&this.buffering&&this._notifyBuffering(!0)}),1e3*(e+.1))):this.buffering&&this.videoPlayStarted&&this._notifyBuffering(!1)})),e.addEventListener("playing",(()=>{t("playing")})),e.addEventListener("stalled",(()=>this._fixupStall())),e.addEventListener("waiting",(()=>this._fixupStall()))}_fixupStall(){let e,{logger:t,videoElement:i}=this.params,r=i.buffered.length;0!==r&&!this.waitingForFirstBufferAfterSrcChange&&(e=i.buffered.start(r-1),i.currentTime<e&&(t("Fixup stall"),i.currentTime=e))}_selectQuality(e){let t,i,r,{videoElement:a}=this.params,s=a&&1.62*(Fr.display.pixelRatio||1)*a.offsetHeight||520;for(let a=0;a<this.manifest.length;++a){r=this.manifest[a];let{max:n,min:o}=this.autoQualityLimits||{};!ea({limits:this.autoQualityLimits,highestAvailableHeight:this.manifest[0].video.height,lowestAvailableHeight:(0,wa.default)(this.manifest,-1).video.height})&&(n&&r.video.height>n||o&&r.video.height<o)||(r.bitrate<e&&s>Math.min(r.video.height,r.video.width)?(!i||r.bitrate>i.bitrate)&&(i=r):(!t||t.bitrate>r.bitrate)&&(t=r))}return i||t}shouldPlay(){if(this.paused)return!1;let e=this._getBufferSizeSec()-Math.max(1,this.sourceJitter);return e>3||(0,u.isNonNullable)(this.downloadRate)&&(this.downloadRate>1.5&&e>2||this.downloadRate>2&&e>1)}_setVideoSrc(e,t){let{logger:i,videoElement:r,playerCallback:a}=this.params;this.mediaSource=new window.MediaSource,i("setting video src"),r.src=URL.createObjectURL(this.mediaSource),this.mediaSource.addEventListener("sourceopen",(()=>{this.mediaSource&&(this.sourceBuffer=this.mediaSource.addSourceBuffer(e.codecs),this.bufferStates=[],t())})),this.videoPlayStarted=!1,r.addEventListener("canplay",(()=>{this.shouldPlay()&&(this.videoPlayStarted=!0,this._playVideoElement())}));let s=()=>{!function(e,t,i){let r=(...a)=>{i.apply(null,a),e.removeEventListener(t,r)};e.addEventListener(t,r)}(r,"progress",(()=>{r.buffered.length?(r.currentTime=r.buffered.start(0),this.waitingForFirstBufferAfterSrcChange=!1,a({name:"playing"})):s()}))};this.waitingForFirstBufferAfterSrcChange=!0,s()}_initPlayerWith(e){this.bitrate=0,this.rep=0,this.sourceBuffer=0,this.bufferStates=[],this.filesFetcher&&this.filesFetcher.abortAll(),this.filesFetcher=new Pa(3,Ma,this.bitrateSwitcher,this.params.config.maxParallelRequests,this.params.logger),this._setVideoSrc(e,(()=>this._switchToQuality(e)))}_representation(e){let{logger:t,videoElement:i,playerCallback:r}=this.params,a=!1,s=null,n=null,o=null,l=null,d=!1,c=()=>{let e=a&&(!d||d===this.rep);return e||t("Not running!"),e},h=(e,t,i)=>{o&&o.abort(),o=Ea(this.urlResolver.resolve(e,!1),t,i,(()=>this._retryCallback())).withTimeout(Ma).withBitrateReporting(this.bitrateSwitcher).withRetryCount(3).withFinally((()=>{o=null})).send()},p=(e,t,i)=>{(0,u.assertNonNullable)(this.filesFetcher),n?.abort(),n=this.filesFetcher.requestData(this.urlResolver.resolve(e,!1),t,i,(()=>this._retryCallback())).withFinally((()=>{n=null})).send()},f=e=>{let r=i.playbackRate;i.playbackRate!==e&&(t(`Playback rate switch: ${r}=>${e}`),i.playbackRate=e)},m=e=>{this.lowLatency=e,t(`lowLatency changed to ${e}`),v()},v=()=>{if(this.lowLatency||this.params.config.isLiveCatchUpMode){let e=this._getBufferSizeSec();if(this.bufferStates.length<5)return void f(1);let i=ka()-1e4,r=0;for(let t=0;t<this.bufferStates.length;t++){let a=this.bufferStates[t];e=Math.min(e,a.buf),a.ts<i&&r++}this.bufferStates.splice(0,r),t(`update playback rate;  minBuffer=${e} drop=${r} jitter=${this.sourceJitter}`);let a=e-1;this.sourceJitter>=0?a-=this.sourceJitter/2:this.sourceJitter-=1,f(a>3?1.15:a>1?1.1:a>.3?1.05:1)}else f(1)},g=e=>{let i,a=()=>i&&i.start?i.start.length:0,s=e=>i.start[e]/1e3,n=e=>i.dur[e]/1e3,o=e=>i.fragIndex+e,d=(e,t)=>({chunkIdx:o(e),startTS:s(e),dur:n(e),discontinuity:t}),h=()=>{let e=0;if(i&&i.dur){let t=this.lowLatency?this.params.config.lowLatencyMinBuffer:this.params.config.minBuffer,r=this.lowLatency?this.params.config.lowLatencyMinBufferSegments:this.params.config.minBufferSegments,a=t;this.sourceJitter>1&&(a+=this.sourceJitter-1);let s=i.dur.length-1;for(;s>=0&&(a-=i.dur[s],!(a<=0));--s);e=Math.min(s,i.dur.length-1-r),e=Math.max(e,0)}return d(e,!0)},p=(e,t,i)=>{l&&l.abort(),l=Ea(this.urlResolver.resolve(e,!0,this.lowLatency),t,i,(()=>this._retryCallback())).withTimeout(Ma).withRetryCount(3).withFinally((()=>{l=null})).withJSONResponse().send()};return{seek:(t,n)=>{p(e,(e=>{if(!c())return;i=e;let o=!!i.lowLatency;o!==this.lowLatency&&m(o);let l=0;for(let e=0;e<i.dur.length;++e)l+=i.dur[e];l>0&&((0,u.assertNonNullable)(this.filesFetcher),this.filesFetcher.optimizeForSegDuration(l/i.dur.length)),r({name:"index",zeroTime:i.zeroTime,shiftDuration:i.shiftDuration}),this.sourceJitter=i.hasOwnProperty("jitter")?Math.min(10,Math.max(.01,i.jitter/1e3)):1,t((e=>{let t=a();if(!(t<=0)){if((0,u.isNonNullable)(e))for(let i=0;i<t;i++)if(s(i)>e)return d(i);return h()}})(n))}),(()=>this._handleNetworkError()))},nextChunk:e=>{let r=a(),s=e?e.chunkIdx+1:0,n=s-i.fragIndex;if(!(r<=0)){if(!e||n<0||n-r>10)return t(`Resync: offset=${n} bChunks=${r} chunk=`+JSON.stringify(e)),h();if(!(n>=r))return d(s-i.fragIndex,!1)}}}},b=()=>{a=!1,n&&n.abort(),o&&o.abort(),l&&l.abort(),(0,u.assertNonNullable)(this.filesFetcher),this.filesFetcher.abortAll()};return d={start:t=>{let i,r,n,o,d,f,m,{videoElement:y,logger:w}=this.params,S=g(e.jidxUrl),x=0,$=()=>{d&&(clearTimeout(d),d=void 0);let e=Math.max(500,1e3*(this._getBufferSizeSec()-this.sourceJitter-5)),t=x+e,i=ka(),r=Math.min(1e4,t-i);x=i;let a=()=>{l||c()&&S.seek((()=>{c()&&(x=ka(),_(),$())}))};r>0?d=window.setTimeout((()=>{this.paused?$():a()}),r):a()},_=()=>{let t;for(;t=S.nextChunk(o);)o=t,A(t);let i=S.nextChunk(n);if(i){if(n&&i.discontinuity)return w("Detected discontinuity; restarting playback"),void(this.paused?$():(b(),this._initPlayerWith(e)));E(i)}else $()},k=(e,t)=>{if(!c()||!this.sourceBuffer)return;let i,r,a,s=i=>{window.setTimeout((()=>{c()&&k(e,t)}),i)};if(this.sourceBuffer.updating)w("Source buffer is updating; delaying appendBuffer"),s(100);else{let n=ka(),o=y.currentTime;!this.paused&&y.buffered.length>1&&f===o&&n-m>500&&(w("Stall suspected; trying to fix"),this._fixupStall()),f!==o&&(f=o,m=n);let l=this._getBufferSizeSec();if(l>30)w(`Buffered ${l} seconds; delaying appendBuffer`),s(2e3);else try{this.sourceBuffer.appendBuffer(e),this.videoPlayStarted?(this.bufferStates.push({ts:n,buf:l}),v(),this.bufferStates.length>200&&this.bufferStates.shift()):this.shouldPlay()&&(this.videoPlayStarted=!0,this._playVideoElement()),t&&t()}catch(e){if("QuotaExceededError"!==e.name)throw e;w("QuotaExceededError; delaying appendBuffer"),a=this.sourceBuffer.buffered.length,0!==a&&(i=this.sourceBuffer.buffered.start(0),r=o,r-i>4&&this.sourceBuffer.remove(i,r-3)),s(1e3)}}},T=()=>{r&&i&&(w([`Appending chunk, sz=${r.byteLength}:`,JSON.stringify(n)]),k(r,(function(){r=null,_()})))},C=t=>e.fragUrlTemplate.replace("%%id%%",t.chunkIdx),E=e=>{c()&&p(C(e),((t,i)=>{if(c()){if(i/=1e3,r=t,n=e,s=e.startTS,i){let t=Math.min(10,e.dur/i);this.downloadRate=this.downloadRate?.7*this.downloadRate+.3*t:t}T()}}),(()=>this._handleNetworkError()))},A=e=>{c()&&((0,u.assertNonNullable)(this.filesFetcher),this.filesFetcher.prefetch(this.urlResolver.resolve(C(e),!1)))},L=t=>{c()&&(e.cachedHeader=t,k(t,(()=>{i=!0,T()})))};a=!0,S.seek((e=>{if(c()){if(x=ka(),!e)return void $();o=e,!(0,u.isNullable)(t)||e.startTS>t?E(e):(n=e,_())}}),t),e.cachedHeader?L(e.cachedHeader):h(e.headerUrl,L,(()=>this._handleNetworkError()))},stop:b,getTimestampSec:()=>s},d}_switchToQuality(e){let t,{logger:i,playerCallback:r}=this.params;e.bitrate!==this.bitrate&&(this.rep&&(t=this.rep.getTimestampSec(),(0,u.isNonNullable)(t)&&(t+=.1),this.rep.stop()),this.currentManifestEntry=e,this.rep=this._representation(e),i(`switch to quality: codecs=${e.codecs}; headerUrl=${e.headerUrl}; bitrate=${e.bitrate}`),this.bitrate=e.bitrate,(0,u.assertNonNullable)(this.bitrateSwitcher),this.bitrateSwitcher.notifySwitch(this.bitrate),this.rep.start(t),r({name:"qualitySwitch",quality:e}))}_qualityAvailable(e){return(0,u.isNonNullable)(this.manifest.find((t=>t.name===e)))}_initBitrateSwitcher(){let e,{logger:t,playerCallback:i}=this.params,r=e=>{if(!this.autoQuality)return;let i,r,a;this.currentManifestEntry&&this._qualityAvailable(this.currentManifestEntry.name)&&e<this.bitrate&&(r=this._getBufferSizeSec(),a=e/this.bitrate,r>10&&a>.8||r>15&&a>.5||r>20&&a>.3)?t(`Not switching: buffer=${Math.floor(r)}; bitrate=${this.bitrate}; newRate=${Math.floor(e)}`):(i=this._selectQuality(e),i?this._switchToQuality(i):t(`Could not find quality by bitrate ${e}`))},a=(e,t)=>{let r=ka();if(this.chunkRateEstimator.addInterval(e,r,t)){let a=this.chunkRateEstimator.getBitRate();return i({name:"bandwidth",size:t,duration:r-e,speed:a}),!0}},s=()=>{let e=this.chunkRateEstimator.getBitRate();return e?.85*e:0},n=-1/0,o=!0,l=()=>{let t=s();if(t&&e&&this.autoQuality){if(o&&t>e&&Ta(n)<3e4)return;r(t)}o=this.autoQuality};return{updateChunk:(e,t)=>{let i=a(e,t);return i&&l(),i},notifySwitch:t=>{let i=ka();t<e&&(n=i),e=t}}}_fetchManifest(e,t,i){this.manifestRequest=Ea(this.urlResolver.resolve(e,!0),t,i,(()=>this._retryCallback())).withJSONResponse().withTimeout(Ma).withRetryCount(this.params.config.manifestRetryMaxCount).withRetryInterval(this.params.config.manifestRetryInterval,this.params.config.manifestRetryMaxInterval).send().withFinally((()=>{this.manifestRequest=void 0}))}_playVideoElement(){let{videoElement:e}=this.params;$a(e,(()=>{this.soundProhibitedEvent$.next()})).then((e=>{e||(this.params.liveOffset.pause(),this.params.videoState.setState("paused"))}))}_handleManifestUpdate(e){let{logger:t,playerCallback:i,videoElement:r}=this.params;this.manifest=(e=>{let t=[];return e?.length?(e.forEach(((e,i)=>{e.video&&r.canPlayType(e.codecs).replace(/no/,"")&&window.MediaSource?.isTypeSupported?.(e.codecs)&&(e.index=i,t.push(e))})),t.sort((function(e,t){return e.video&&t.video?t.video.height-e.video.height:t.bitrate-e.bitrate})),t):(i({name:"error",type:"empty_manifest"}),[])})(e),t(`Valid manifest entries: ${this.manifest.length}/${e.length}`),i({name:"manifest",manifest:this.manifest})}_refetchManifest(e){this.destroyed||(this.manifestRefetchTimer&&clearTimeout(this.manifestRefetchTimer),this.manifestRefetchTimer=window.setTimeout((()=>{this._fetchManifest(e,(t=>{this.destroyed||(this._handleManifestUpdate(t),this._refetchManifest(e))}),(()=>this._refetchManifest(e)))}),6e4))}_initManifest(){this._fetchManifest(this.manifestUrl,(e=>{this.destroyed||(this._handleManifestUpdate(e),this._refetchManifest(this.manifestUrl))}),(()=>this._handleNetworkError()))}constructor(e){this.paused=!1,this.autoQuality=!0,this.autoQualityLimits=void 0,this.buffering=!0,this.destroyed=!1,this.videoPlayStarted=!1,this.lowLatency=!1,this.bitrate=0,this.manifest=[],this.sourceBuffer=0,this.bufferStates=[],this.sourceJitter=-1,this.waitingForFirstBufferAfterSrcChange=!1,this.params=e,this.soundProhibitedEvent$=new u.Subject,this.chunkRateEstimator=new Aa(this.params.logger),this._initVideo()}},Ra=g(Ne(),1),Va=class{connect(e){this.log=e.logger.createComponentLog("DroppedFramesManager"),this.video=e.video,this.isAuto=e.isAuto,this.tracks=e.tracks,this.droppedFramesChecker=e.droppedFramesChecker,this.subscription.add(e.playing$.subscribe((()=>this.playing=!0))),this.subscription.add(e.pause$.subscribe((()=>this.playing=!1))),this.isEnabled&&this.subscribe()}destroy(){this.currentTimer&&window.clearTimeout(this.currentTimer),this.subscription.unsubscribe()}get droppedVideoMaxQualityLimit(){return this.maxQualityLimit}subscribe(){this.subscription.add((0,u.fromEvent)(this.video,"resize").subscribe(this.handleChangeVideoQuality));let e=(0,u.interval)(this.droppedFramesChecker.checkTime).pipe((0,u.filter)((()=>this.playing)),(0,u.filter)((()=>{let e=!!this.isForceCheckCounter;return e&&(this.isForceCheckCounter-=1),!e}))),t=this.forceChecker$.pipe((0,u.debounce)(this.droppedFramesChecker.checkTime)),i=(0,u.merge)(e,t);this.subscription.add(i.subscribe(this.checkDroppedFrames))}onChangeQuality(e){this.currentQuality=e;let{totalVideoFrames:t,droppedVideoFrames:i}=this.video.getVideoPlaybackQuality();this.savePrevFrameCounts(t,i),this.isForceCheckCounter=this.droppedFramesChecker.tickCountAfterQualityChange,this.forceChecker$.next()}onDroopedVideoFramesLimitTrigger(){this.isAuto.getState()&&(this.log({message:`[onDroopedVideoFramesLimit]. maxQualityLimit: ${this.maxQualityLimit}`}),this.onDroopedVideoFramesLimit$.next())}getMaxQualityLimit(e){let t=(0,Ra.default)(this.limitCounts).filter((([,e])=>e>=this.droppedFramesChecker.countLimit)).sort((([e],[t])=>(0,u.isLower)(e,t)?-1:1))?.[0]?.[0];return e??t}get isEnabled(){return this.droppedFramesChecker.enabled&&this.isDroppedFramesCheckerSupport}get isDroppedFramesCheckerSupport(){return!!this.video&&"function"==typeof this.video.getVideoPlaybackQuality}savePrevFrameCounts(e,t){this.prevTotalVideoFrames=e,this.prevDroppedVideoFrames=t}constructor(){this.onDroopedVideoFramesLimit$=new u.Subject,this.subscription=new u.Subscription,this.playing=!1,this.tracks=[],this.forceChecker$=new u.Subject,this.isForceCheckCounter=0,this.prevTotalVideoFrames=0,this.prevDroppedVideoFrames=0,this.limitCounts={},this.handleChangeVideoQuality=()=>{let e=this.tracks.find((({size:e})=>e?.height===this.video.videoHeight&&e?.width===this.video.videoWidth));e&&!(0,u.isInvariantQuality)(e.quality)&&this.onChangeQuality(e.quality)},this.checkDroppedFrames=()=>{let{totalVideoFrames:e,droppedVideoFrames:t}=this.video.getVideoPlaybackQuality(),i=e-this.prevTotalVideoFrames,r=1-(i-(t-this.prevDroppedVideoFrames))/i;!isNaN(r)&&r>0&&this.log({message:`[dropped]. current dropped percent: ${r}, limit: ${this.droppedFramesChecker.percentLimit}`}),!isNaN(r)&&r>=this.droppedFramesChecker.percentLimit&&(0,u.isHigher)(this.currentQuality,this.droppedFramesChecker.minQualityBanLimit)&&(this.limitCounts[this.currentQuality]=(this.limitCounts[this.currentQuality]??0)+1,this.maxQualityLimit=this.getMaxQualityLimit(this.currentQuality),this.currentTimer&&window.clearTimeout(this.currentTimer),this.currentTimer=window.setTimeout((()=>this.maxQualityLimit=this.getMaxQualityLimit()),this.droppedFramesChecker.qualityUpWaitingTime),this.onDroopedVideoFramesLimitTrigger()),this.savePrevFrameCounts(e,t)}}},Na=()=>!!window.documentPictureInPicture?.window||!!document.pictureInPictureElement,Ba=(e,t)=>new u.Observable((i=>{if(!window.IntersectionObserver)return;let r=new IntersectionObserver(((e,t)=>{e.forEach((e=>i.next(e.isIntersecting||Na())))}),{root:null,...t});r.observe(e);let a=(0,u.fromEvent)(document,"visibilitychange").pipe((0,u.map)((e=>!document.hidden||Na()))).subscribe((e=>i.next(e)));return()=>{r.unobserve(e),a.unsubscribe()}})),Da=["paused","playing","ready"],Oa=["paused","playing","ready"],Fa=class{destroy(){this.subscription.unsubscribe(),this.textTracksManager.destroy(),this.droppedFramesManager.destroy(),this.dash.destroy(),this.params.output.element$.next(void 0),fr(this.video)}createLiveDashPlayer(){let e=new Ia({videoElement:this.video,videoState:this.videoState,liveOffset:this.liveOffset,config:{maxParallelRequests:this.params.config.maxParallelRequests,minBuffer:this.params.tuning.live.minBuffer,minBufferSegments:this.params.tuning.live.minBufferSegments,lowLatencyMinBuffer:this.params.tuning.live.lowLatencyMinBuffer,lowLatencyMinBufferSegments:this.params.tuning.live.lowLatencyMinBufferSegments,isLiveCatchUpMode:this.params.tuning.live.isLiveCatchUpMode,manifestRetryInterval:this.params.tuning.manifestRetryInterval,manifestRetryMaxInterval:this.params.tuning.manifestRetryMaxInterval,manifestRetryMaxCount:this.params.tuning.manifestRetryMaxCount},playerCallback:this._dashCb,logger:e=>{this.params.dependencies.logger.log({message:String(e),component:"LiveDashPlayer"})}});return e.pause(),e}prepare(){let e=this.representations$.getValue(),t=this.params.desiredState.videoTrack.getTransition()?.to??this.params.desiredState.videoTrack.getState(),i=this.params.desiredState.autoVideoTrackSwitching.getTransition()?.to??this.params.desiredState.autoVideoTrackSwitching.getState(),r=!i&&(0,u.isNonNullable)(t)?t:ma(e.map((({track:e})=>e)),{container:this.video.getBoundingClientRect(),panelSize:this.params.panelSize,estimatedThroughput:this.params.dependencies.throughputEstimator.throughput$.getValue(),tuning:this.params.tuning.autoTrackSelection,limits:this.params.desiredState.autoVideoTrackLimits.getState(),droppedVideoMaxQualityLimit:this.droppedFramesManager.droppedVideoMaxQualityLimit,abrLogger:this.params.dependencies.abrLogger}),a=r?.id,s=this.params.desiredState.videoTrack.getTransition(),n=this.params.desiredState.videoTrack.getState()?.id,o=this.params.desiredState.autoVideoTrackSwitching.getTransition();if(r&&(s||a!==n)&&this.setVideoTrack(r),o&&this.setAutoQuality(i),s||o||a!==n){let t=e.find((({track:e})=>e.id===a))?.representation;(0,u.assertNonNullable)(t,"Representations missing"),this.dash.startPlay(t,i)}}setVideoTrack(e){let t=this.representations$.getValue().find((({track:t})=>t.id===e.id))?.representation;(0,u.assertNonNullable)(t,`No such representation ${e.id}`),this.dash.switchByName(t.name),this.params.desiredState.videoTrack.setState(e)}setAutoQuality(e){this.dash.setAutoQualityEnabled(e),this.params.desiredState.autoVideoTrackSwitching.setState(e)}seek(e){this.log({message:`[seek] position: ${e}`}),this.params.output.willSeekEvent$.next();let t=this.params.desiredState.playbackState.getState(),i=this.videoState.getState(),r="paused"===t&&"paused"===i,a=-e,s=a<=this.maxSeekBackTime$.getValue()?a:0;this.params.output.position$.next(e/1e3),this.dash.reinit(sr(this.params.source.url,s)),r&&this.dash.pause(),this.liveOffset.resetTo(s,r)}constructor(e){this.subscription=new u.Subscription,this.videoState=new lr("stopped"),this.representations$=new u.ValueSubject([]),this.droppedFramesManager=new Va,this.maxSeekBackTime$=new u.ValueSubject(1/0),this.zeroTime$=new u.ValueSubject(void 0),this.liveOffset=new $r,this._dashCb=e=>{switch(e.name){case"buffering":{let t=e.isBuffering;this.params.output.isBuffering$.next(t);break}case"error":this.params.output.error$.next({id:`DashLiveProviderInternal:${e.type}`,category:u.ErrorCategory.WTF,message:"LiveDashPlayer reported error"});break;case"manifest":{let t=e.manifest,i=[];for(let e of t){let t=e.name??e.index.toString(10),r=zr(e.name)??(0,u.videoSizeToQuality)(e.video),a=e.bitrate/1e3,s={...e.video};if(!r)continue;let n={id:t,quality:r,bitrate:a,size:s};i.push({track:n,representation:e})}this.representations$.next(i),this.params.output.availableVideoTracks$.next(i.map((({track:e})=>e))),"manifest_ready"===this.videoState.getTransition()?.to&&this.videoState.setState("manifest_ready");break}case"qualitySwitch":{let t=e.quality,i=this.representations$.getValue().find((({representation:e})=>e===t))?.track;this.params.output.hostname$.next(new URL(t.headerUrl,this.params.source.url).hostname),(0,u.isNonNullable)(i)&&this.params.output.currentVideoTrack$.next(i);break}case"bandwidth":{let{size:t,duration:i}=e;this.params.dependencies.throughputEstimator.addRawSpeed(t,i);break}case"index":this.maxSeekBackTime$.next(e.shiftDuration||0),this.zeroTime$.next(e.zeroTime)}},this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.videoState.getTransition(),i=this.params.desiredState.playbackState.getState(),r=this.params.desiredState.playbackState.getTransition(),a=this.params.desiredState.seekState.getState();if(this.log({message:`[syncPlayback] videoState: ${e}; videoTransition: ${JSON.stringify(t)}; desiredPlaybackState: ${i}; seekState: ${JSON.stringify(a)};`}),"stopped"===i)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.dash.destroy(),this.video.removeAttribute("src"),this.video.load(),this.videoState.setState("stopped")));if(t)return;let s=this.params.desiredState.videoTrack.getTransition(),n=this.params.desiredState.autoVideoTrackSwitching.getTransition();if((0,dr.default)(Oa,e)&&(s||n))this.prepare();else if("paused"!==r?.to&&"requested"===a.state&&(0,dr.default)(Da,e))this.seek(a.position-this.liveOffset.getTotalPausedTime());else switch(e){case"stopped":return this.videoState.startTransitionTo("manifest_ready"),void this.dash.attachSource(sr(this.params.source.url));case"manifest_ready":this.videoState.startTransitionTo("ready"),this.prepare();break;case"ready":if("paused"===i)this.videoState.setState("paused");else if("playing"===i){this.videoState.startTransitionTo("playing");let e=r?.from;e&&"ready"===e&&this.dash.catchUp(),this.dash.play()}return;case"playing":return void("paused"===i&&(this.videoState.startTransitionTo("paused"),this.liveOffset.pause(),this.dash.pause()));case"paused":if("playing"===i)if(this.videoState.startTransitionTo("playing"),this.liveOffset.getTotalPausedTime()<this.params.config.maxPausedTime&&this.liveOffset.getTotalOffset()<this.maxSeekBackTime$.getValue())this.liveOffset.resume(),this.dash.play(),this.params.output.position$.next(-this.liveOffset.getTotalOffset()/1e3);else{let e=this.liveOffset.getTotalOffset();e>=this.maxSeekBackTime$.getValue()&&(e=0,this.liveOffset.resetTo(e)),this.liveOffset.resume(),this.params.output.position$.next(-e/1e3),this.dash.reinit(sr(this.params.source.url,e))}return;default:return(0,u.assertNever)(e)}},this.textTracksManager=new xr(e.source.url),this.params=e,this.log=this.params.dependencies.logger.createComponentLog("DashLiveProvider");let t=t=>{e.output.error$.next({id:"DashLiveProvider",category:u.ErrorCategory.WTF,message:"DashLiveProvider internal logic error",thrown:t})};this.subscription.add((0,u.merge)(this.videoState.stateChangeStarted$.pipe((0,u.map)((e=>({transition:e,type:"start"})))),this.videoState.stateChangeEnded$.pipe((0,u.map)((e=>({transition:e,type:"end"}))))).subscribe((({transition:e,type:t})=>{this.log({message:`[videoState change] ${t}: ${JSON.stringify(e)}`})}))),this.video=pr(e.container,e.tuning),this.params.output.element$.next(this.video),this.dash=this.createLiveDashPlayer(),this.subscription.add(this.dash.soundProhibitedEvent$.subscribe(this.params.output.soundProhibitedEvent$)),this.params.output.duration$.next(1/0),this.params.output.position$.next(0),this.params.output.isLive$.next(!0),this.params.output.canChangePlaybackSpeed$.next(!1),this.params.output.hostname$.next(ya(this.params.source.url)),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.textTracksManager.connect(this.video,this.params.desiredState,this.params.output);let i=jr(this.video);this.subscription.add((()=>i.destroy())),this.subscription.add(this.representations$.pipe((0,u.map)((e=>e.map((({track:e})=>e)))),(0,u.filter)((e=>!!e.length)),(0,u.once)()).subscribe((e=>this.droppedFramesManager.connect({logger:this.params.dependencies.logger,video:this.video,droppedFramesChecker:this.params.tuning.droppedFramesChecker,isAuto:this.params.desiredState.autoVideoTrackSwitching,playing$:i.playing$,pause$:i.pause$,tracks:e})))),this.subscription.add(i.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready")}),t)).add(i.pause$.subscribe((()=>{this.videoState.setState("paused")}),t)).add(i.playing$.subscribe((()=>{"applying"===this.params.desiredState.seekState.getState().state&&this.params.output.seekedEvent$.next(),this.videoState.setState("playing")}),t)).add(i.error$.subscribe(this.params.output.error$)).add(this.maxSeekBackTime$.pipe((0,u.filterChanged)(),(0,u.map)((e=>-e/1e3))).subscribe(this.params.output.duration$)).add((0,u.combine)({zeroTime:this.zeroTime$.pipe((0,u.filter)(u.isNonNullable)),position:i.timeUpdate$}).subscribe((({zeroTime:e,position:t})=>this.params.output.liveTime$.next(e+1e3*t)),t)).add(gr(this.video,this.params.desiredState.isLooped,t)).add(br(this.video,this.params.desiredState.volume,i.volumeState$,t)).add(i.volumeState$.subscribe(this.params.output.volume$,t)).add(yr(this.video,this.params.desiredState.playbackRate,i.playbackRateState$,t)).add(i.loadStart$.subscribe(this.params.output.firstBytesEvent$)).add(i.loadedMetadata$.subscribe(this.params.output.loadedMetadataEvent$)).add(i.playing$.subscribe(this.params.output.firstFrameEvent$)).add(i.canplay$.subscribe(this.params.output.canplay$)).add(i.inPiP$.subscribe(this.params.output.inPiP$)).add(i.inFullscreen$.subscribe(this.params.output.inFullscreen$)).add(Ba(this.video).subscribe(this.params.output.elementVisible$)).add(this.params.desiredState.autoVideoTrackLimits.stateChangeStarted$.subscribe((({to:{max:e,min:t}})=>{this.dash.setAutoQualityLimits({max:e&&(0,u.videoQualityToHeight)(e),min:t&&(0,u.videoQualityToHeight)(t)}),this.params.output.autoVideoTrackLimits$.next({max:e,min:t})}))).add(this.videoState.stateChangeEnded$.subscribe((e=>{switch(e.to){case"stopped":this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.desiredState.playbackState.setState("stopped");break;case"manifest_ready":case"ready":"ready"===this.params.desiredState.playbackState.getTransition()?.to&&this.params.desiredState.playbackState.setState("ready");break;case"paused":this.params.desiredState.playbackState.setState("paused");break;case"playing":this.params.desiredState.playbackState.setState("playing");break;default:return(0,u.assertNever)(e.to)}}),t)).add((0,u.merge)(e.desiredState.playbackState.stateChangeStarted$,e.desiredState.seekState.stateChangeEnded$,e.desiredState.videoTrack.stateChangeStarted$,e.desiredState.autoVideoTrackSwitching.stateChangeStarted$,this.videoState.stateChangeEnded$,this.droppedFramesManager.onDroopedVideoFramesLimit$,(0,u.observableFrom)(["init"])).pipe((0,u.debounce)(0)).subscribe(this.syncPlayback,t))}},ja=g(_e(),1),za=(e,t)=>{let i=0;for(let r=0;r<e.length;r++){let a=1e3*e.start(r),s=1e3*e.end(r);a<=t&&t<=s&&(i=s)}return Math.max(i-t,0)},Ua=class{addEventListener(e,t,i){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:i})}removeEventListener(e,t){if(!(e in this.listeners))return;let i=this.listeners[e];for(let e=0,r=i.length;e<r;e++)if(i[e].callback===t)return void i.splice(e,1)}dispatchEvent(e){if(!(e.type in this.listeners))return;let t=this.listeners[e.type].slice();for(let i=0,r=t.length;i<r;i++){let r=t[i];try{r.callback.call(this,e)}catch(e){Promise.resolve().then((()=>{throw e}))}r.options&&r.options.once&&this.removeEventListener(e.type,r.callback)}return!e.defaultPrevented}constructor(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}},qa=class extends Ua{toString(){return"[object AbortSignal]"}dispatchEvent(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}constructor(){super(),this.listeners||Ua.call(this),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(this,"reason",{value:void 0,writable:!0,configurable:!0})}},Ha=class{abort(e){let t;try{t=new Event("abort")}catch{typeof document<"u"?document.createEvent?(t=document.createEvent("Event"),t.initEvent("abort",!1,!1)):(t=document.createEventObject(),t.type="abort"):t={type:"abort",bubbles:!1,cancelable:!1}}let i=e;if(void 0===i)if(typeof document>"u")i=new Error("This operation was aborted"),i.name="AbortError";else try{i=new DOMException("signal is aborted without reason")}catch{i=new Error("This operation was aborted"),i.name="AbortError"}this.signal.reason=i,this.signal.dispatchEvent(t)}toString(){return"[object AbortController]"}constructor(){Object.defineProperty(this,"signal",{value:new qa,writable:!0,configurable:!0})}};function Wa(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}typeof Symbol<"u"&&Symbol.toStringTag&&(Ha.prototype[Symbol.toStringTag]="AbortController",qa.prototype[Symbol.toStringTag]="AbortSignal");var Qa=Wa({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}),Ga=Qa?function(e){"function"==typeof e&&(e={fetch:e});let{fetch:t,Request:i=t.Request,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:a=!1}=e;if(!Wa({fetch:t,Request:i,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:a}))return{fetch:t,Request:s};let s=i;(s&&!s.prototype.hasOwnProperty("signal")||a)&&(s=function(e,t){let r;t&&t.signal&&(r=t.signal,delete t.signal);let a=new i(e,t);return r&&Object.defineProperty(a,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),a},s.prototype=i.prototype);let n=t;return{fetch:(e,t)=>{let i=s&&s.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(i){let r;try{r=new DOMException("Aborted","AbortError")}catch{r=new Error("Aborted"),r.name="AbortError"}if(i.aborted)return Promise.reject(r);let a=new Promise(((e,t)=>{i.addEventListener("abort",(()=>t(r)),{once:!0})}));return t&&t.signal&&delete t.signal,Promise.race([a,n(e,t)])}return n(e,t)},Request:s}}({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}):void 0,Ka=Qa?Ga.fetch:window.fetch,Ya=(Qa?Ga.Request:window.Request,Qa?Ha:window.AbortController),Za=(Qa||window.AbortSignal,g(gi(),1)),Xa=g(Ci(),1),Ja=e=>{if(!e)return{id:"EmptyResponse",category:u.ErrorCategory.PARSER,message:"Empty response"};if(e.length<=2&&e.match(/^\d+$/))return{id:`UVError#${e}`,category:u.ErrorCategory.NETWORK,message:`UV Error ${e}`};let t=(0,Xa.default)(e).substring(0,100).toLowerCase();return t.startsWith("<!doctype")||t.startsWith("<html>")||t.startsWith("<body>")||t.startsWith("<head>")?{id:"UnexpectedHTML",category:u.ErrorCategory.NETWORK,message:"Received unexpected HTML, possibly a ISP block"}:t.startsWith("<?xml")?(new DOMParser).parseFromString(e,"text/xml").querySelector("parsererror")?{id:"InvalidXML",category:u.ErrorCategory.PARSER,message:"XML parsing error"}:{id:"XMLParserLogicError",category:u.ErrorCategory.PARSER,message:"Response is valid XML, but parser failed"}:void 0},es=(e,t,i=0)=>{for(let r=0;r<e.length;r++)if(1e3*e.start(r)-i<=t&&1e3*e.end(r)+i>t)return!0;return!1},ts=g(_e(),1),is=g(oi(),1),rs=g(gi(),1),as=e=>"function"==typeof e&&e?.toString().endsWith("{ [native code] }"),ss=!as(window.requestIdleCallback)||!as(window.cancelIdleCallback),ns=ss?(e,t={})=>{let i=t.timeout||1,r=performance.now();return window.setTimeout((()=>{e({get didTimeout(){return!t.timeout&&performance.now()-r-1>i},timeRemaining:()=>Math.max(0,performance.now()-r+1)})}),1)}:window.requestIdleCallback,os=ss?e=>window.clearTimeout(e):window.cancelIdleCallback,ls=g(Jt(),1),us=!1;try{us=Fr.browser.isSafari&&!!Fr.browser.safariVersion&&Fr.browser.safariVersion<=18}catch(e){console.error(e)}var ds=class{async append(e,t){return(!t||!t.aborted)&&new Promise((i=>{let r={operation:"append",data:e,signal:t,callback:i};this.queue.push(r),this.pull()}))}async remove(e,t,i){return(!i||!i.aborted)&&new Promise((r=>{let a={operation:"remove",from:e,to:t,signal:i,callback:r};this.queue.unshift(a),this.pull()}))}async abort(e){return new Promise((t=>{let i,r=e=>{this.abortRequested=!1,t(e)};i=us&&e?{operation:"safariAbort",init:e,callback:r}:{operation:"abort",callback:r};for(let{callback:e}of this.queue)e(!1);this.abortRequested=!0,i&&(this.queue=[i]),this.pull()}))}destroy(){this.destroyed=!0,this.buffer.removeEventListener("updateend",this.completeTask),this.queue=[],this.currentTask=null;try{this.buffer.abort()}catch(e){if(!(e instanceof DOMException&&"InvalidStateError"===e.name))throw e}}pull(){if((this.buffer.updating||this.currentTask||this.destroyed)&&!this.abortRequested)return;let e=this.queue.shift();if(!e)return;if(e.signal?.aborted)return e.callback(!1),void this.pull();this.currentTask=e;let{operation:t}=this.currentTask;try{this.execute(this.currentTask)}catch(e){e instanceof DOMException&&"QuotaExceededError"===e.name&&"append"===t?this.bufferFull$.next(this.currentTask.data.byteLength):e instanceof DOMException&&"InvalidStateError"===e.name||this.error$.next({id:`BufferTaskQueue:${t}`,category:u.ErrorCategory.VIDEO_PIPELINE,message:"Buffer operation failed",thrown:e}),this.currentTask.callback(!1),this.currentTask=null}this.currentTask&&"abort"===this.currentTask.operation&&this.completeTask()}execute(e){let{operation:t}=e;switch(t){case"append":this.buffer.appendBuffer(e.data);break;case"remove":this.buffer.remove(e.from/1e3,e.to/1e3);break;case"abort":this.buffer.abort();break;case"safariAbort":this.buffer.abort(),this.buffer.appendBuffer(e.init);break;default:(0,u.assertNever)(t)}}constructor(e){this.bufferFull$=new u.Subject,this.error$=new u.Subject,this.queue=[],this.currentTask=null,this.destroyed=!1,this.abortRequested=!1,this.completeTask=()=>{try{if(this.currentTask){let e=this.currentTask.signal?.aborted;this.currentTask.callback(!e),this.currentTask=null}this.queue.length&&this.pull()}catch(e){this.error$.next({id:"BufferTaskQueueUnknown",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Buffer appending or removal failed",thrown:e})}},this.buffer=e,this.buffer.addEventListener("updateend",this.completeTask)}},cs=e=>{let t=0;for(let i=0;i<e.length;i++)t+=e.end(i)-e.start(i);return 1e3*t},hs=class{get id(){return this.type}get size(){return this.size32}scanForBoxes(e){return this.boxParser.parse(e)}readString(e,t="ascii"){let i=new TextDecoder(t).decode(new DataView(this.source.buffer,this.source.byteOffset+this.cursor,e));return this.cursor+=e,i}readUint8(){let e=this.source.getUint8(this.cursor);return this.cursor+=1,e}readUint16(){let e=this.source.getUint16(this.cursor);return this.cursor+=2,e}readUint32(){let e=this.source.getUint32(this.cursor);return this.cursor+=4,e}readUint64(){let e=this.source.getBigInt64(this.cursor);return this.cursor+=8,e}constructor(e,t){this.cursor=0,this.source=e,this.boxParser=t,this.children=[];let i=this.readUint32();this.type=this.readString(4),this.size32=i<=e.buffer.byteLength-e.byteOffset?i:NaN;let r=this.size32?this.size32-8:void 0,a=e.byteOffset+this.cursor;this.size64=0,this.usertype=0,this.content=new DataView(e.buffer,a,r)}},ps=class extends hs{},fs=class extends hs{constructor(e,t){super(e,t);let i=this.readUint32();this.version=i>>>24,this.flags=16777215&i}},ms=class extends fs{get earliestPresentationTime(){return this.earliestPresentationTime32}get firstOffset(){return this.firstOffset32}constructor(e,t){super(e,t),this.segments=[],this.referenceId=this.readUint32(),this.timescale=this.readUint32(),this.earliestPresentationTime32=this.readUint32(),this.firstOffset32=this.readUint32(),this.earliestPresentationTime64=0,this.firstOffset64=0,this.referenceCount=65535&this.readUint32();for(let e=0;e<this.referenceCount;e++){let e=this.readUint32(),t=e>>>31,i=e<<1>>>1,r=this.readUint32();e=this.readUint32();let a=e>>>28,s=e<<3>>>3;this.segments.push({referenceType:t,referencedSize:i,subsegmentDuration:r,SAPType:a,SAPDeltaTime:s})}}},vs={ftyp:class extends hs{constructor(e,t){super(e,t),this.compatibleBrands=[],this.majorBrand=this.readString(4),this.minorVersion=this.readUint32();let i=this.size-this.cursor;for(;i;){let e=this.readString(4);this.compatibleBrands.push(e),i-=4}}},moov:class extends hs{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mvhd:class extends fs{constructor(e,t){super(e,t),this.creationTime=this.readUint32(),this.modificationTime=this.readUint32(),this.timescale=this.readUint32(),this.duration=this.readUint32(),this.rate=this.readUint32(),this.volume=this.readUint16()}},moof:class extends hs{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mdat:class extends hs{constructor(e,t){super(e,t),this.data=this.content}},sidx:ms,trak:class extends hs{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mdia:class extends hs{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mfhd:class extends fs{constructor(e,t){super(e,t),this.sequenceNumber=this.readUint32()}},tkhd:class extends fs{constructor(e,t){super(e,t),this.creationTime=this.readUint32(),this.modificationTime=this.readUint32(),this.trackId=this.readUint32(),this.cursor+=4,this.duration=this.readUint32(),this.cursor+=8,this.layer=this.readUint16(),this.alternateGroup=this.readUint16(),this.cursor+=2,this.cursor+=2,this.matrix=[[this.readUint32(),this.readUint32(),this.readUint32()],[this.readUint32(),this.readUint32(),this.readUint32()],[this.readUint32(),this.readUint32(),this.readUint32()]],this.width=this.readUint32(),this.height=this.readUint32()}},traf:class extends hs{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},tfhd:class extends fs{constructor(e,t){super(e,t),this.trackId=this.readUint32(),1&this.flags&&(this.baseDataOffset=this.readUint64()),2&this.flags&&(this.sampleDescriptionIndex=this.readUint32()),8&this.flags&&(this.defaultSampleDuration=this.readUint32()),16&this.flags&&(this.defaultSampleSize=this.readUint32()),32&this.flags&&(this.defaultSampleFlags=this.readUint32())}},tfdt:class extends fs{get baseMediaDecodeTime(){return 1===this.version?this.baseMediaDecodeTime64:this.baseMediaDecodeTime32}constructor(e,t){super(e,t),this.baseMediaDecodeTime32=0,this.baseMediaDecodeTime64=BigInt(0),1===this.version?this.baseMediaDecodeTime64=this.readUint64():this.baseMediaDecodeTime32=this.readUint32()}},trun:class extends fs{constructor(e,t){super(e,t),this.sampleDuration=[],this.sampleSize=[],this.sampleFlags=[],this.sampleCompositionTimeOffset=[],this.optionalFields=0,this.sampleCount=this.readUint32(),1&this.flags&&(this.dataOffset=this.readUint32()),4&this.flags&&(this.firstSampleFlags=this.readUint32());for(let e=0;e<this.sampleCount;e++)256&this.flags&&this.sampleDuration.push(this.readUint32()),512&this.flags&&this.sampleSize.push(this.readUint32()),1024&this.flags&&this.sampleFlags.push(this.readUint32()),2048&this.flags&&this.sampleCompositionTimeOffset.push(this.readUint32())}},minf:class extends hs{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},sv3d:class extends hs{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},st3d:class extends fs{constructor(e,t){switch(super(e,t),this.readUint8()){case 0:this.stereoMode=0;break;case 1:this.stereoMode=1;break;case 2:this.stereoMode=2;break;case 3:this.stereoMode=3;break;case 4:this.stereoMode=4}this.cursor+=1}},prhd:class extends fs{constructor(e,t){super(e,t),this.poseYawDegrees=this.readUint32(),this.posePitchDegrees=this.readUint32(),this.poseRollDegrees=this.readUint32()}},proj:class extends hs{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},equi:class extends fs{constructor(e,t){super(e,t),this.projectionBoundsTop=this.readUint32(),this.projectionBoundsBottom=this.readUint32(),this.projectionBoundsLeft=this.readUint32(),this.projectionBoundsRight=this.readUint32()}},uuid:class extends hs{constructor(e,t){super(e,t),this.ondemandPrefix="ondemandlivejson",this.ondemandDataReceivedKey="t-in",this.ondemandDataPreparedKey="t-out";let i=this.content.byteOffset,r=i+this.content.byteLength,a=new TextDecoder("ascii").decode(this.content.buffer.slice(i,r)).split(this.ondemandPrefix)[1],s=JSON.parse(a);this.serverDataReceivedTimestamp=s[this.ondemandDataReceivedKey],this.serverDataPreparedTime=s[this.ondemandDataPreparedKey]}},stbl:class extends hs{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},stsd:class extends fs{constructor(e,t){super(e,t),this.entryCount=this.readUint32(),this.children=this.scanForBoxes(new DataView(this.content.buffer,this.content.byteOffset+8,this.content.byteLength-8))}},avc1:class extends hs{constructor(e,t){super(e,t),this.children=this.scanForBoxes(new DataView(this.content.buffer,this.content.byteOffset+78,this.content.byteLength-78))}},unknown:ps},gs=class e{parse(e){let t=[],i=this.options.offset;for(;i<e.byteLength;)try{let r=new TextDecoder("ascii").decode(new DataView(e.buffer,e.byteOffset+i+4,4)),a=this.createBox(r,new DataView(e.buffer,e.byteOffset+i));if(!a.size)break;t.push(a),i+=a.size}catch{break}return t}createBox(t,i){let r=vs[t];return r?new r(i,new e):new ps(i,new e)}constructor(e={}){this.options={offset:0,...e}}},bs=class{indexBoxLevel(e){e.forEach((e=>{var t,i;(t=this.index)[i=e.type]??(t[i]=[]),this.index[e.type].push(e),e.children.length>0&&this.indexBoxLevel(e.children)}))}find(e){return this.index[e]&&this.index[e][0]?this.index[e][0]:null}findAll(e){return this.index[e]||[]}constructor(e){this.index={},this.indexBoxLevel(e)}},ys=new TextDecoder("ascii"),ws={validateData:e=>"ftyp"===ys.decode(new DataView(e.buffer,e.byteOffset+4,4)),parseInit:e=>{let t={is3dVideo:!1,stereoMode:0,projectionType:1,projectionData:{pose:{yaw:0,pitch:0,roll:0},bounds:{top:0,bottom:0,left:0,right:0}}},i=(new gs).parse(e),r=new bs(i);if(r.find("sv3d")){t.is3dVideo=!0;let e=r.find("st3d");e&&(t.stereoMode=e.stereoMode);let i=r.find("prhd");i&&(t.projectionData.pose.yaw=i.poseYawDegrees,t.projectionData.pose.pitch=i.posePitchDegrees,t.projectionData.pose.roll=i.poseRollDegrees);let a=r.find("equi");a&&(t.projectionData.bounds.top=a.projectionBoundsTop,t.projectionData.bounds.right=a.projectionBoundsRight,t.projectionData.bounds.bottom=a.projectionBoundsBottom,t.projectionData.bounds.left=a.projectionBoundsLeft)}return t},getIndexRange:()=>{},parseSegments:e=>{let t=new ms(e,new gs),i=t.earliestPresentationTime/t.timescale*1e3,r=e.byteOffset+e.byteLength+t.firstOffset;return t.segments.map((e=>{if(0!==e.referenceType)throw new Error("Unsupported multilevel sidx");let a=e.subsegmentDuration/t.timescale*1e3,s={status:"none",time:{from:i,to:i+a},byte:{from:r,to:r+e.referencedSize-1}};return i+=a,r+=e.referencedSize,s}))},parseFeedableSegmentChunk:(e,t)=>{let i=(new gs).parse(e),r=new bs(i),a=r.findAll("moof"),s=t?r.findAll("uuid"):r.findAll("mdat");if(!s.length||!a.length)return null;let n=a[0],o=s[s.length-1],l=n.source.byteOffset,u=o.source.byteOffset-n.source.byteOffset+o.size;return new DataView(e.buffer,l,u)},getChunkEndTime:(e,t)=>{let i=(new gs).parse(e),r=new bs(i).findAll("traf"),a=r[r.length-1].children.find((e=>"tfhd"===e.type)),s=r[r.length-1].children.find((e=>"tfdt"===e.type)),n=r[r.length-1].children.find((e=>"trun"===e.type)),o=0;return o=n.sampleDuration.length?n.sampleDuration.reduce(((e,t)=>e+t),0):a.defaultSampleDuration*n.sampleCount,(Number(s.baseMediaDecodeTime)+o)/t*1e3},getServerLatencyTimestamps:e=>{let t=(new gs).parse(e),i=new bs(t).findAll("uuid");return i.length?i[i.length-1]:{}},getTimescaleFromIndex:e=>{let t=(new gs).parse(e);return new bs(t).find("sidx")?.timescale}},Ss=g(_e(),1),xs={440786851:{type:"master"},17030:{type:"uint"},17143:{type:"uint"},17138:{type:"uint"},17139:{type:"uint"},17026:{type:"string"},17031:{type:"uint"},17029:{type:"uint"},236:{type:"binary"},408125543:{type:"master"},290298740:{type:"master"},19899:{type:"master"},21419:{type:"binary"},21420:{type:"uint"},357149030:{type:"master"},2807729:{type:"uint"},17545:{type:"float"},374648427:{type:"master"},174:{type:"master"},224:{type:"master"},30320:{type:"master"},30321:{type:"uint"},30322:{type:"master"},272869232:{type:"master"},524531317:{type:"master"},231:{type:"uint"},22612:{type:"master"},22743:{type:"uint"},167:{type:"uint"},171:{type:"uint"},163:{type:"binary"},160:{type:"master"},175:{type:"binary"},423732329:{type:"master"},307544935:{type:"master"},475249515:{type:"master"},187:{type:"master"},179:{type:"uint"},183:{type:"master"},247:{type:"uint"},241:{type:"uint"},240:{type:"uint"},178:{type:"uint"},21368:{type:"uint"},234:{type:"uint"},219:{type:"master"},150:{type:"uint"}},$s=e=>{let t=e.getUint8(0),i=0;128&t?i=1:64&t?i=2:32&t?i=3:16&t&&(i=4);let r=_s(e,i),a=r in xs,s=a?xs[r].type:"binary",n=e.getUint8(i),o=0;128&n?o=1:64&n?o=2:32&n?o=3:16&n?o=4:8&n?o=5:4&n?o=6:2&n?o=7:1&n&&(o=8);let l,u=new DataView(e.buffer,e.byteOffset+i+1,o-1),d=(n&255>>o)*2**(8*(o-1))+_s(u),c=i+o;return l=c+d>e.byteLength?new DataView(e.buffer,e.byteOffset+c):new DataView(e.buffer,e.byteOffset+c,d),{tag:a?r:"0x"+r.toString(16).toUpperCase(),type:s,tagHeaderSize:c,tagSize:c+d,value:l,valueSize:d}},_s=(e,t=e.byteLength)=>{switch(t){case 1:return e.getUint8(0);case 2:return e.getUint16(0);case 3:return 65536*e.getUint8(0)+e.getUint16(1);case 4:return e.getUint32(0);case 5:return e.getUint8(0)*2**32+e.getUint32(1);case 6:return e.getUint16(0)*2**32+e.getUint32(2);case 7:{let t=281474976710656*e.getUint8(0)+4294967296*e.getUint16(1)+e.getUint32(3);if(Number.isSafeInteger(t))return t}case 8:throw new ReferenceError("Int64 is not supported")}return 0},ks=(e,t)=>{switch(t){case"int":return e.getInt8(0);case"uint":return _s(e);case"float":return 4===e.byteLength?e.getFloat32(0):e.getFloat64(0);case"string":return new TextDecoder("ascii").decode(e);case"utf8":return new TextDecoder("utf-8").decode(e);case"date":return new Date(Date.UTC(2001,0)+e.getInt8(0)).getTime();case"master":case"binary":return e;default:(0,u.assertNever)(t)}},Ts=(e,t)=>{let i=0;for(;i<e.byteLength;){let r=new DataView(e.buffer,e.byteOffset+i),a=$s(r);if(!t(a))return;"master"===a.type&&Ts(a.value,t),i=a.value.byteOffset-e.byteOffset+a.valueSize}},Cs=[357149030,290298740,374648427,174,224,30320,30321,30322,272869232,524531317,475249515,423732329,307544935],Es=[231,22612,22743,167,171,163,160,175],As={validateData:e=>{if(440786851!==e.getUint32(0))return!1;let t,i,r,a=$s(e);return Ts(a.value,(({tag:e,type:a,value:s})=>(17143===e?t=ks(s,a):17026===e?i=ks(s,a):17029===e&&(r=ks(s,a)),!0))),(void 0===t||t<=1)&&void 0!==i&&"webm"===i&&(void 0===r||r<=2)},parseInit:e=>{let t,i,r,a,s,n,o=!1,l=!1,d=!1,c=!1;return Ts(e,(({tag:e,type:u,value:h,valueSize:p})=>{if(21419===e){let e=ks(h,u);n=_s(e)}else 21420!==e&&(n=void 0);return 408125543===e?(t=h.byteOffset,i=h.byteOffset+p):357149030===e?o=!0:290298740===e?l=!0:2807729===e?r=ks(h,u):17545===e?a=ks(h,u):21420===e&&475249515===n?s=ks(h,u):374648427===e?Ts(h,(({tag:e,type:t,value:i})=>30321!==e||(c=1===ks(i,t),!1))):o&&l&&(0,Ss.default)(Cs,e)&&(d=!0),!d})),(0,u.assertNonNullable)(t,"Failed to parse webm Segment start"),(0,u.assertNonNullable)(i,"Failed to parse webm Segment end"),(0,u.assertNonNullable)(a,"Failed to parse webm Segment duration"),r=r??1e6,{segmentStart:Math.round(t/1e9*r*1e3),segmentEnd:Math.round(i/1e9*r*1e3),timeScale:r,segmentDuration:Math.round(a/1e9*r*1e3),cuesSeekPosition:s,is3dVideo:c,stereoMode:0,projectionType:1,projectionData:{pose:{yaw:0,pitch:0,roll:0},bounds:{top:0,bottom:0,left:0,right:0}}}},getIndexRange:e=>{if((0,u.isNullable)(e.cuesSeekPosition))return;let t=e.segmentStart+e.cuesSeekPosition;return{from:t,to:t+1048576}},parseSegments:(e,t)=>{let i,r=!1,a=!1,s=e=>(0,u.isNonNullable)(e.time)&&(0,u.isNonNullable)(e.position),n=[];return Ts(e,(({tag:e,type:t,value:o})=>{switch(e){case 475249515:r=!0;break;case 187:i&&s(i)&&n.push(i),i={};break;case 179:i&&(i.time=ks(o,t));break;case 183:break;case 241:i&&(i.position=ks(o,t));break;default:r&&(0,Ss.default)(Cs,e)&&(a=!0)}return!(r&&a)})),i&&s(i)&&n.push(i),n.map(((e,i)=>{let{time:r,position:a}=e,s=n[i+1];return{status:"none",time:{from:r,to:s?s.time:t.segmentDuration},byte:{from:t.segmentStart+a,to:s?t.segmentStart+s.position-1:t.segmentEnd-1}}}))},parseFeedableSegmentChunk:e=>{let t=0,i=!1;try{Ts(e,(r=>524531317===r.tag?r.tagSize<=e.byteLength?(t=r.tagSize,!1):(t+=r.tagHeaderSize,!0):!!(0,Ss.default)(Es,r.tag)&&(t+r.tagSize<=e.byteLength&&(t+=r.tagSize,i||(i=(0,Ss.default)([163,160,175],r.tag))),!0)))}catch{}return t>0&&t<=e.byteLength&&i?new DataView(e.buffer,e.byteOffset,t):null}},Ls=e=>{let t=/^(.+)\/([^;]+)(?:;.*)?$/.exec(e);if(t){let[,e,i]=t;if("audio"===e||"video"===e)switch(i){case"webm":return As;case"mp4":return ws}}throw new ReferenceError(`Unsupported mime type ${e}`)},Ps=g(Bi(),1),Ms=g(Ne(),1),Is=g(qi(),1),Rs=g(oi(),1),Vs=g(ri(),1),Ns=g(_e(),1),Bs=e=>{let t=e.split("."),[i,...r]=t;if(!i)return!1;switch(i){case"av01":{let[e,t,i]=r;return!!(i&&parseInt(i,10)>8)}case"vp09":{let[e,t,i]=r;return!!(e&&parseInt(e,10)>=2&&i&&parseInt(i,10)>8)}case"avc1":{let e=r[0];if(!e||6!==e.length)return!1;let[t,i]=e.toUpperCase(),a=t+i;return(0,Ns.default)(["6E","7A","F4"],a)}}return!1},Ds=e=>{if(e.includes("/")){let t=e.split("/");return parseInt(t[0])/parseInt(t[1])}return parseFloat(e)},Os=e=>{try{let t=function(){let e="(?<extlang>(?:[a-z]{3}(?:-[a-z]{3}){0,2}))",t="x(?:-[a-z0-9]{1,8})+",i=`^(?:(?<langtag>\n    (?<language>(?:[a-z]{2,3}(?:-${e})?|[a-z]{4}|[a-z]{5,8}))\n    (-(?<script>[a-z]{4}))?\n    (-(?<region>(?:[a-z]{2}|[0-9]{3})))?\n    (?<variants>(?:-(?:[a-z0-9]{5,8}|[0-9][a-z0-9]{3}))*)\n    (?<extensions>(?:-[0-9a-wy-z](?:-[a-z0-9]{2,8})+)*)\n    (?:-(?<privateuse>(?:${t})))?\n  )|(?<privateuse2>${t}))$`.replace(/[\s\t\n]/g,"");return new RegExp(i,"i")}(),i=e.match(t),{groups:r}=i??{};if(r){let e={};if(r.extensions){let t=r.extensions.toLowerCase().match(/(?:[0-9a-wy-z](?:-[a-z0-9]{2,8})+)/g);Array.from(t||[]).forEach((t=>{e[t[0]]=t.slice(2)}))}let t=r.variants?.split(/-/).filter((e=>""!==e)),i={extlang:r.extlang,langtag:r.langtag,language:r.language,privateuse:r.privateuse||r.privateuse2,region:r.region,script:r.script,extensions:e,variants:t};return Object.keys(i).forEach((e=>{let t=i[e];(typeof t>"u"||""===t)&&delete i[e]})),i}return null}catch{return null}};var Fs=g(oi(),1),js=({id:e,width:t,height:i,bitrate:r,fps:a,quality:s,streamId:n})=>{let o=(s?zr(s):void 0)??(0,u.videoSizeToQuality)({width:t,height:i});return o&&{id:e,quality:o,bitrate:r,size:{width:t,height:i},fps:a,streamId:n}},zs=({id:e,bitrate:t})=>({id:e,bitrate:t}),Us=({language:e,label:t},{id:i,url:r,isAuto:a})=>({id:i,url:r,isAuto:a,type:"internal",language:e,label:t}),qs=({id:e,language:t,label:i,codecs:r,isDefault:a})=>({id:e,language:t,label:i,codec:(0,Fs.default)(r.split("."),0),isDefault:a}),Hs=({id:e,language:t,label:i,hdr:r,codecs:a})=>({id:e,language:t,hdr:r,label:i,codec:(0,Fs.default)(a.split("."),0)}),Ws=e=>"url"in e,Qs=e=>"template"===e.type,Gs=e=>e instanceof DOMException&&("AbortError"===e.name||20===e.code),Ks=e=>{if(!e?.startsWith("P"))return;let t=(e,t)=>{let i=e?parseFloat(e.replace(",",".")):NaN;return(isNaN(i)?0:i)*t},i=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/.exec(e),r="-"===i?.[1]?-1:1;return 24*t(i?.[5],r)*60*60*1e3+60*t(i?.[6],r)*60*1e3+60*t(i?.[7],r)*1e3+1e3*t(i?.[8],r)},Ys=(e,t)=>{let i=e;i=(0,Ps.default)(i,"$$","$");let r={RepresentationID:t.representationId,Number:t.segmentNumber,Bandwidth:t.bandwidth,Time:t.segmentTime};for(let[e,t]of(0,Ms.default)(r)){let r=new RegExp(`\\$${e}(?:%0(\\d+)d)?\\$`,"g");i=(0,Ps.default)(i,r,((e,i)=>(0,u.isNullable)(t)?e:(0,u.isNullable)(i)?t:(0,Is.default)(t,parseInt(i,10),"0")))}return i},Zs=(e,t)=>(0,u.isNonNullable)(e)&&(0,u.isNonNullable)(t)&&"open"===e.readyState&&function(e,t){for(let i=0;i<e.activeSourceBuffers.length;++i)if(e.activeSourceBuffers[i]===t)return!0;return!1}(e,t);var Xs=class{switchToWithPreviousAbort(e,t=!1){!Zs(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId||(this.switchAbortController.abort(),this.switchAbortController=new Ya,(0,u.abortable)(this.switchAbortController.signal,async function*(e,t=!1){this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,u.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),a=this.initData.get(e);if((0,u.isNullable)(a)||(0,u.isNullable)(r)?yield this.loadInit(i,"high",!1):a instanceof Promise&&(yield a),r=this.segments.get(e),(0,u.assertNonNullable)(r,"No segments for starting representation"),a=this.initData.get(e),a instanceof ArrayBuffer&&this.sourceBuffer&&Zs(this.mediaSource,this.sourceBuffer)){if(yield this.abort(),yield this.sourceBufferTaskQueue.append(a,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer();else{let t=this.getCurrentPosition();(0,u.isNonNullable)(t)&&!this.isLive&&(this.bufferLimit=this.forwardBufferTarget,yield this.pruneBuffer(t,1/0,!0)),this.downloadingRepresentationId=e,this.switchingToRepresentationId=void 0}this.maintain()}}.bind(this))(e,t))}warmUpMediaSource(){!(0,u.isNullable)(this.sourceBuffer)&&!this.sourceBuffer.updating&&(this.sourceBuffer.mode="segments")}async abort(){for(let e of this.activeSegments)this.abortSegment(e.segment);return this.activeSegments.clear(),this.downloadAbortController.abort(),this.downloadAbortController=new Ya,this.abortBuffer()}maintain(e=this.getCurrentPosition()){if((0,u.isNullable)(e)||(0,u.isNullable)(this.downloadingRepresentationId)||(0,u.isNullable)(this.playingRepresentationId)||(0,u.isNullable)(this.sourceBuffer)||!Zs(this.mediaSource,this.sourceBuffer)||(0,u.isNonNullable)(this.switchingToRepresentationId)||this.isSeekingLive)return;let t=this.representations.get(this.downloadingRepresentationId),i=this.segments.get(this.downloadingRepresentationId);if((0,u.assertNonNullable)(t,`No such representation ${this.downloadingRepresentationId}`),!i)return;let r=i.find((t=>e>=t.time.from&&e<t.time.to));(0,u.isNonNullable)(r)&&isFinite(r.time.from)&&isFinite(r.time.to)&&this.currentSegmentLength$.next(r?.time.to-r.time.from);let a=e;if(this.playingRepresentationId!==this.downloadingRepresentationId){let t=this.getForwardBufferDuration(e),i=r?r.time.to+100:-1/0;r&&r.time.to-e<this.tuning.dash.maxSegmentDurationLeftToSelectNextSegment&&t>=r.time.to-e+100&&(a=i)}if(isFinite(this.bufferLimit)&&cs(this.sourceBuffer.buffered)>=this.bufferLimit){let t=this.getForwardBufferDuration(e),i=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;return void this.pruneBuffer(e,1/0,t<i).catch((e=>{this.handleAsyncError(e,"pruneBuffer")}))}let s=[];if(!this.activeSegments.size&&(s=this.selectForwardBufferSegments(i,t.segmentReference.type,a),s.length)){let e="auto";if(this.tuning.dash.useFetchPriorityHints&&r)if((0,ts.default)(s,r))e="high";else{let t=(0,is.default)(s,0);t&&t.time.from-r.time.to>=this.forwardBufferTarget/2&&(e="low")}this.loadSegments(s,t,e).catch((e=>{this.handleAsyncError(e,"loadSegments")}))}(!this.preloadOnly&&!this.allInitsLoaded&&r&&"fed"===r.status&&!s.length&&this.getForwardBufferDuration(e)>3e3||this.isActiveLowLatency())&&this.loadNextInit();let n=(0,is.default)(i,-1);!this.isLive&&n&&(this.fullyBuffered$.next(n.time.to-e-this.getForwardBufferDuration(e)<100),this.onLastSegment$.next(e-n.time.from>0))}get lastDataObtainedTimestamp(){return this.lastDataObtainedTimestampMs}searchGaps(e,t){this.gaps=[];let i=0,r=this.isLive?this.liveInitialAdditionalOffset:0;for(let a of e)Math.trunc(a.time.from-i)>0&&this.gaps.push({representation:t.id,from:i,to:a.time.from+r}),i=a.time.to;(0,u.isNonNullable)(t.duration)&&t.duration-i>0&&!this.isLive&&this.gaps.push({representation:t.id,from:i,to:t.duration})}getActualLiveStartingSegments(e){let t=e.segments,i=this.isActiveLowLatency()?this.tuning.dashCmafLive.lowLatency.maxTargetOffset:this.tuning.dashCmafLive.maxActiveLiveOffset,r=[],a=0,s=t.length-1;do{r.unshift(t[s]),a+=t[s].time.to-t[s].time.from,s--}while(a<i&&s>=0);return this.liveInitialAdditionalOffset=a-i,this.isActiveLowLatency()?[r[0]]:r}getLiveSegmentsToLoadState(e){let t=(0,rs.default)(e?.streams[this.kind],(e=>e.representations)).find((e=>e.id===this.downloadingRepresentationId));if(!t)return;let i=this.segments.get(t.id);return i?.length?{from:i[0].time.from,to:i[i.length-1].time.to}:void 0}updateLive(e){let t=(0,rs.default)(e?.streams[this.kind],(e=>e.representations))??[];if(![...this.segments.values()].every((e=>!e.length)))for(let e of t){if(!e||!Qs(e.segmentReference))return;let t=e.segmentReference.segments.map((e=>({...e,status:"none",size:void 0}))),i=100,r=this.segments.get(e.id)??[],a=(0,is.default)(r,-1)?.time.to??0,s=t?.findIndex((e=>a>=e.time.from+i&&a<=e.time.to+i));if(-1===s){this.liveUpdateSegmentIndex=0;let t=this.getActualLiveStartingSegments(e.segmentReference);this.segments.set(e.id,t)}else{let i=t.slice(s+1);this.segments.set(e.id,[...r,...i])}}}proceedLowLatencyLive(){let e=this.downloadingRepresentationId;(0,u.assertNonNullable)(e);let t=this.segments.get(e);if(t?.length){let e=t[t.length-1];this.updateLowLatencyLiveIfNeeded(e)}}updateLowLatencyLiveIfNeeded(e){let t=0;for(let i of this.representations.values()){let r=i.segmentReference;if(!Qs(r))return;let a=this.segments.get(i.id)??[],s=a.find((t=>Math.floor(t.time.from)===Math.floor(e.time.from)));if(s&&!isFinite(s.time.to)&&(s.time.to=e.time.to,t=s.time.to-s.time.from),!a.find((t=>Math.floor(t.time.from)===Math.floor(e.time.to)))&&this.isActiveLowLatency()){let t=Math.round(e.time.to*r.timescale/1e3).toString(10),i=Ys(r.segmentTemplateUrl,{segmentTime:t});a.push({status:"none",time:{from:e.time.to,to:1/0},url:i})}}this.currentLowLatencySegmentLength$.next(t)}findSegmentStartTime(e){let t=this.switchingToRepresentationId??this.downloadingRepresentationId??this.playingRepresentationId;if(!t)return;let i=this.segments.get(t);return i?i.find((t=>t.time.from<=e&&t.time.to>=e))?.time.from??void 0:void 0}setTarget(e){this.forwardBufferTarget=e}setPreloadOnly(e){this.preloadOnly=e}destroy(){if(this.initData.clear(),this.segments.clear(),this.parsedInitData.clear(),this.representations.clear(),this.sourceBufferTaskQueue?.destroy(),this.gapDetectionIdleCallback&&os&&os(this.gapDetectionIdleCallback),this.initLoadIdleCallback&&os&&os(this.initLoadIdleCallback),this.subscription.unsubscribe(),this.sourceBuffer)try{this.mediaSource.removeSourceBuffer(this.sourceBuffer)}catch(e){if(!(e instanceof DOMException&&"NotFoundError"===e.name))throw e}this.sourceBuffer=null,this.downloadAbortController.abort(),this.switchAbortController.abort(),this.destroyAbortController.abort(),window.clearTimeout(this.loadByteRangeSegmentsTimeoutId)}selectForwardBufferSegments(e,t,i){return this.isLive?this.selectForwardBufferSegmentsLive(e,i):this.selectForwardBufferSegmentsRecord(e,t,i)}selectForwardBufferSegmentsLive(e,t){let i=e.findIndex((e=>t>=e.time.from&&t<e.time.to));return this.playingRepresentationId!==this.downloadingRepresentationId&&(this.liveUpdateSegmentIndex=i),this.liveUpdateSegmentIndex<e.length?e.slice(this.liveUpdateSegmentIndex++):[]}selectForwardBufferSegmentsRecord(e,t,i){let r=e.findIndex((({status:e,time:{from:t,to:r}},a)=>{let s=t>i||t<=i&&r>=i||0===a&&0===i,n=Math.min(this.forwardBufferTarget,this.bufferLimit),o=this.preloadOnly&&t<=i+n||r<=i+n;return("none"===e||"partially_ejected"===e&&s&&o&&this.sourceBuffer&&Zs(this.mediaSource,this.sourceBuffer)&&!(es(this.sourceBuffer.buffered,t)&&es(this.sourceBuffer.buffered,r)))&&s&&o}));if(-1===r)return[];if("byteRange"!==t)return e.slice(r,r+1);let a=e,s=0,n=0,o=[],l=this.preloadOnly?0:this.tuning.dash.segmentRequestSize,u=this.preloadOnly?this.forwardBufferTarget:0;for(let e=r;e<a.length&&(s<=l||n<=u);e++){let t=a[e];if(s+=t.byte.to+1-t.byte.from,n+=t.time.to+1-t.time.from,"none"!==t.status&&"partially_ejected"!==t.status)break;o.push(t)}return o}async loadSegments(e,t,i="auto"){Qs(t.segmentReference)?await this.loadTemplateSegment(e[0],t,i):await this.loadByteRangeSegments(e,t,i)}async loadTemplateSegment(e,t,i="auto"){e.status="downloading";let r={segment:e,loadedBytes:0,feedingBytes:0,fedBytes:0,representationId:t.id};this.activeSegments.add(r);let{range:a,url:s,signal:n,onProgress:o,onProgressTasks:l}=this.prepareTemplateFetchSegmentParams(e,t);this.failedDownloads&&n&&(await(0,u.abortable)(n,async function*(){let e=(0,u.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>setTimeout(t,e)))}.bind(this))(),n.aborted&&this.abortActiveSegments([e]));try{let e=await this.fetcher.fetch(s,{range:a,signal:n,onProgress:o,priority:i,isLowLatency:this.isActiveLowLatency()});if(this.lastDataObtainedTimestampMs=(0,u.now)(),!e)return;let d=new DataView(e),c=Ls(t.mime);if(!isFinite(r.segment.time.to)){let e=t.segmentReference.timescale;r.segment.time.to=c.getChunkEndTime(d,e)}o&&r.feedingBytes&&l?await Promise.all(l):await this.sourceBufferTaskQueue.append(d,n);let{serverDataReceivedTimestamp:h,serverDataPreparedTime:p}=c.getServerLatencyTimestamps(d);h&&p&&this.currentLiveSegmentServerLatency$.next(p-h),r.segment.status="downloaded",this.onSegmentFullyAppended(r,t.id),this.failedDownloads=0}catch(t){this.abortActiveSegments([e]),Gs(t)||(this.failedDownloads++,this.updateRepresentationsBaseUrlIfNeeded())}}updateRepresentationsBaseUrlIfNeeded(){if(!this.tuning.dash.enableBaseUrlSupport||!this.baseUrls.length||this.failedDownloads<=this.tuning.dash.maxSegmentRetryCount)return;this.baseUrlsIndex=(this.baseUrlsIndex+1)%this.baseUrls.length;let e=this.baseUrls[this.baseUrlsIndex];for(let t of this.representations.values())Qs(t.segmentReference)?t.segmentReference.baseUrl=e:t.segmentReference.url=e}async loadByteRangeSegments(e,t,i="auto"){if(!e.length)return;for(let i of e)i.status="downloading",this.activeSegments.add({segment:i,loadedBytes:0,feedingBytes:0,fedBytes:0,representationId:t.id});let{range:r,url:a,signal:s,onProgress:n}=this.prepareByteRangeFetchSegmentParams(e,t);this.failedDownloads&&s&&(await(0,u.abortable)(s,async function*(){let e=(0,u.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>{this.loadByteRangeSegmentsTimeoutId=window.setTimeout(t,e),(0,u.fromEvent)(window,"online").pipe((0,u.once)()).subscribe((()=>{t(),window.clearTimeout(this.loadByteRangeSegmentsTimeoutId)}))}))}.bind(this))(),s.aborted&&this.abortActiveSegments(e));try{await this.fetcher.fetch(a,{range:r,onProgress:n,signal:s,priority:i}),this.lastDataObtainedTimestampMs=(0,u.now)(),this.failedDownloads=0}catch(t){this.abortActiveSegments(e),Gs(t)||(this.failedDownloads++,this.updateRepresentationsBaseUrlIfNeeded())}}prepareByteRangeFetchSegmentParams(e,t){if(Qs(t.segmentReference))throw new Error("Representation is not byte range type");let i=t.segmentReference.url,r={from:(0,is.default)(e,0).byte.from,to:(0,is.default)(e,-1).byte.to},{signal:a}=this.downloadAbortController;return{url:i,range:r,signal:a,onProgress:async(e,i)=>{if(!a.aborted)try{this.lastDataObtainedTimestampMs=(0,u.now)(),await this.onSomeByteRangesDataLoaded({dataView:e,loaded:i,signal:a,onSegmentAppendFailed:()=>this.abort(),globalFrom:r?r.from:0,representationId:t.id})}catch(e){this.error$.next({id:"SegmentFeeding",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Error when feeding segments",thrown:e})}}}}prepareTemplateFetchSegmentParams(e,t){if(!Qs(t.segmentReference))throw new Error("Representation is not template type");let i=new URL(e.url,t.segmentReference.baseUrl);this.isActiveLowLatency()&&i.searchParams.set("low-latency","yes");let r=i.toString(),{signal:a}=this.downloadAbortController,s=[],n=this.isActiveLowLatency()||this.tuning.dash.enableSubSegmentBufferFeeding&&this.liveUpdateSegmentIndex<3?(e,i)=>{if(!a.aborted)try{this.lastDataObtainedTimestampMs=(0,u.now)();let r=this.onSomeTemplateDataLoaded({dataView:e,loaded:i,signal:a,onSegmentAppendFailed:()=>this.abort(),representationId:t.id});s.push(r)}catch(e){this.error$.next({id:"SegmentFeeding",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Error when feeding segments",thrown:e})}}:void 0;return{url:r,signal:a,onProgress:n,onProgressTasks:s}}abortActiveSegments(e){for(let t of this.activeSegments)(0,ts.default)(e,t.segment)&&this.abortSegment(t.segment)}async onSomeTemplateDataLoaded({dataView:e,representationId:t,loaded:i,onSegmentAppendFailed:r,signal:a}){if(!this.activeSegments.size||!Zs(this.mediaSource,this.sourceBuffer))return;let s=this.representations.get(t);if(s)for(let n of this.activeSegments){let{segment:o}=n;if(n.representationId===t){if(a.aborted){r();continue}if(n.loadedBytes=i,n.loadedBytes>n.feedingBytes){let t=new DataView(e.buffer,e.byteOffset+n.feedingBytes,n.loadedBytes-n.feedingBytes),i=Ls(s.mime).parseFeedableSegmentChunk(t,this.isLive);i?.byteLength&&(o.status="partially_fed",n.feedingBytes+=i.byteLength,await this.sourceBufferTaskQueue.append(i),n.fedBytes+=i.byteLength)}}}}async onSomeByteRangesDataLoaded({dataView:e,representationId:t,globalFrom:i,loaded:r,signal:a,onSegmentAppendFailed:s}){if(!this.activeSegments.size||!Zs(this.mediaSource,this.sourceBuffer))return;let n=this.representations.get(t);if(n)for(let o of this.activeSegments){let{segment:l}=o;if(o.representationId!==t)continue;if(a.aborted){await s();continue}let u=l.byte.from-i,d=l.byte.to-i,c=d-u+1,h=d<=r;if(!(u<r))continue;let p=Ls(n.mime);if("downloading"===l.status&&h){l.status="downloaded";let i=new DataView(e.buffer,e.byteOffset+u,c);await this.sourceBufferTaskQueue.append(i,a)&&!a.aborted?this.onSegmentFullyAppended(o,t):await s()}else if(this.tuning.dash.enableSubSegmentBufferFeeding&&("downloading"===l.status||"partially_fed"===l.status)&&(o.loadedBytes=Math.min(c,r-u),o.loadedBytes>o.feedingBytes)){let i=new DataView(e.buffer,e.byteOffset+u+o.feedingBytes,o.loadedBytes-o.feedingBytes),r=o.loadedBytes===c?i:p.parseFeedableSegmentChunk(i);r?.byteLength&&(l.status="partially_fed",o.feedingBytes+=r.byteLength,await this.sourceBufferTaskQueue.append(r,a)&&!a.aborted?(o.fedBytes+=r.byteLength,o.fedBytes===c&&this.onSegmentFullyAppended(o,t)):await s())}}}onSegmentFullyAppended(e,t){if(!(0,u.isNullable)(this.sourceBuffer)&&Zs(this.mediaSource,this.sourceBuffer)){!this.isLive&&Fr.browser.isSafari&&this.tuning.useSafariEndlessRequestBugfix&&(es(this.sourceBuffer.buffered,e.segment.time.from,100)&&es(this.sourceBuffer.buffered,e.segment.time.to,100)||this.error$.next({id:"EmptyAppendBuffer",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Browser stuck on empty result of adding segment to source buffer"})),this.playingRepresentationId=t,this.playingRepresentation$.next(this.playingRepresentationId),this.playingRepresentationInit$.next(this.parsedInitData.get(this.playingRepresentationId)),e.segment.status="fed",Ws(e.segment)&&(e.segment.size=e.fedBytes);for(let i of this.representations.values())if(i.id!==t)for(let t of this.segments.get(i.id)??[])"fed"===t.status&&Math.round(t.time.from)===Math.round(e.segment.time.from)&&Math.round(t.time.to)===Math.round(e.segment.time.to)&&(t.status="none");this.updateLowLatencyLiveIfNeeded(e.segment),this.activeSegments.delete(e),this.detectGapsWhenIdle(t,[e.segment])}}abortSegment(e){"partially_fed"===e.status?e.status="partially_ejected":"partially_ejected"!==e.status&&(e.status="none");for(let t of this.activeSegments.values())if(t.segment===e){this.activeSegments.delete(t);break}}loadNextInit(){if(this.allInitsLoaded||this.initLoadIdleCallback)return;let e=null,t=!1;for(let[i,r]of this.initData.entries()){t||(t=r instanceof Promise),null===r&&(e=i)}if(!e)return void(this.allInitsLoaded=!0);if(t)return;let i=this.representations.get(e);i&&(this.initLoadIdleCallback=ns((()=>(0,ls.default)(this.loadInit(i,"low",!1),(()=>this.initLoadIdleCallback=null)))))}async loadInit(e,t="auto",i=!1){let r=this.tuning.dash.useFetchPriorityHints?t:"auto",a=(!i&&this.failedDownloads>0?(0,u.abortable)(this.destroyAbortController.signal,async function*(){let e=(0,u.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>setTimeout(t,e)))}.bind(this))():Promise.resolve()).then((()=>this.fetcher.fetchRepresentation(e.segmentReference,Ls(e.mime),r))).then((async t=>{if(!t)return;let{init:i,dataView:r,segments:a}=t,s=r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);this.initData.set(e.id,s);let n=a;this.isLive&&Qs(e.segmentReference)&&(n=this.getActualLiveStartingSegments(e.segmentReference)),(!this.isLive||!this.segments.has(e.id))&&this.segments.set(e.id,n),i&&this.parsedInitData.set(e.id,i)})).then((()=>this.failedDownloads=0),(t=>{this.initData.set(e.id,null),i&&this.error$.next({id:"LoadInits",category:u.ErrorCategory.WTF,message:"loadInit threw",thrown:t})}));return this.initData.set(e.id,a),a}async dropBuffer(){for(let e of this.segments.values())for(let t of e)t.status="none";await this.pruneBuffer(0,1/0,!0)}async pruneBuffer(e,t,i=!1){if(!this.sourceBuffer||!Zs(this.mediaSource,this.sourceBuffer)||!this.playingRepresentationId||(0,u.isNullable)(e))return!1;let r=[],a=0,s=e=>{if(a>=t)return r;r.push({...e.time}),r=(e=>{e.sort(((e,t)=>e.from-t.from));let t=[e[0]];for(let i=1;i<e.length;i++){let{from:r,to:a}=e[i],s=t[t.length-1];s.to>=r?s.to=Math.max(s.to,a):t.push(e[i])}return t})(r);let i=Ws(e)?e.size??0:e.byte.to-e.byte.from;a+=i};for(let t of this.segments.values())for(let i of t){let t=i.time.to<=e-this.tuning.dash.bufferPruningSafeZone,r=i.time.from>=e+Math.min(this.forwardBufferTarget,this.bufferLimit);(t||r)&&"fed"===i.status&&s(i)}for(let e=0;e<this.sourceBuffer.buffered.length;e++){let t=1e3*this.sourceBuffer.buffered.start(e),i=1e3*this.sourceBuffer.buffered.end(e),r=0;for(let e of this.segments.values())for(let a of e)(0,ts.default)(["none","partially_ejected"],a.status)&&Math.round(a.time.from)<=Math.round(t)&&Math.round(a.time.to)>=Math.round(i)&&r++;if(r===this.segments.size){s({time:{from:t,to:i},url:"",status:"none"})}}if(r.length&&i){let t=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;for(let i of this.segments.values())for(let r of i)r.time.from>=e+t&&"fed"===r.status&&s(r)}return!!r.length&&(await Promise.all(r.map((e=>this.sourceBufferTaskQueue.remove(e.from,e.to))))).reduce(((e,t)=>e||t),!1)}async abortBuffer(){if(!this.sourceBuffer||!Zs(this.mediaSource,this.sourceBuffer))return!1;let e=this.playingRepresentationId&&this.initData.get(this.playingRepresentationId),t=e instanceof ArrayBuffer?e:void 0;return this.sourceBufferTaskQueue.abort(t)}getDebugBufferState(){if(this.sourceBuffer&&Zs(this.mediaSource,this.sourceBuffer)&&this.sourceBuffer.buffered.length)return{from:this.sourceBuffer.buffered.start(0),to:this.sourceBuffer.buffered.end(this.sourceBuffer.buffered.length-1)}}getForwardBufferDuration(e=this.getCurrentPosition()){return this.sourceBuffer&&Zs(this.mediaSource,this.sourceBuffer)&&this.sourceBuffer.buffered.length&&!(0,u.isNullable)(e)?za(this.sourceBuffer.buffered,e):0}detectGaps(e,t){if(this.sourceBuffer&&Zs(this.mediaSource,this.sourceBuffer)){if(this.tuning.useRefactoredSearchGap)for(let e=0;e<this.sourceBuffer.buffered.length;e++)this.gaps=this.gaps.filter((t=>this.sourceBuffer&&(Math.round(t.from)<Math.round(1e3*this.sourceBuffer.buffered.start(e))||Math.round(t.to)>Math.round(1e3*this.sourceBuffer.buffered.end(e)))));for(let i of t){let t={representation:e,from:i.time.from,to:i.time.to};for(let e=0;e<this.sourceBuffer.buffered.length;e++){let r=1e3*this.sourceBuffer.buffered.start(e),a=1e3*this.sourceBuffer.buffered.end(e);if(!(a<=i.time.from||r>=i.time.to)){if(r<=i.time.from&&a>=i.time.to){t=void 0;break}a>i.time.from&&a<i.time.to&&(t.from=a),r<i.time.to&&r>i.time.from&&(t.to=r)}}t&&t.to-t.from>1&&!this.gaps.some((e=>t&&e.from===t.from&&e.to===t.to))&&this.gaps.push(t)}}}detectGapsWhenIdle(e,t){if(!this.gapDetectionIdleCallback&&this.sourceBuffer&&Zs(this.mediaSource,this.sourceBuffer)){if(!this.tuning.useRefactoredSearchGap)for(let e=0;e<this.sourceBuffer.buffered.length;e++)this.gaps=this.gaps.filter((t=>this.sourceBuffer&&(Math.round(t.from)<Math.round(1e3*this.sourceBuffer.buffered.start(e))||Math.round(t.to)>Math.round(1e3*this.sourceBuffer.buffered.end(e)))));this.gapDetectionIdleCallback=ns((()=>{try{this.detectGaps(e,t)}catch(e){this.error$.next({id:"GapDetection",category:u.ErrorCategory.WTF,message:"detectGaps threw",thrown:e})}finally{this.gapDetectionIdleCallback=null}}))}}checkEjectedSegments(){if((0,u.isNullable)(this.sourceBuffer)||!Zs(this.mediaSource,this.sourceBuffer)||(0,u.isNullable)(this.playingRepresentationId))return;let e=[];for(let t=0;t<this.sourceBuffer.buffered.length;t++){let i=Math.floor(1e3*this.sourceBuffer.buffered.start(t)),r=Math.ceil(1e3*this.sourceBuffer.buffered.end(t));e.push({from:i,to:r})}let t=100;for(let i of this.segments.values())for(let r of i){let{status:i}=r;if("fed"!==i&&"partially_ejected"!==i)continue;let a=Math.floor(r.time.from),s=Math.ceil(r.time.to),n=e.some((e=>e.from-t<=a&&e.to+t>=s)),o=e.filter((e=>a>=e.from&&a<e.to-t||s>e.from+t&&s<=e.to));n||(1===o.length||this.gaps.some((e=>e.from===r.time.from||e.to===r.time.to))?r.status="partially_ejected":r.status="none")}}handleAsyncError(e,t){this.error$.next({id:t,category:u.ErrorCategory.VIDEO_PIPELINE,thrown:e,message:"Something went wrong"})}constructor(e,t,i,{fetcher:r,tuning:a,getCurrentPosition:s,isActiveLowLatency:n,compatibilityMode:o=!1,manifest:l}){this.currentLiveSegmentServerLatency$=new u.ValueSubject(0),this.currentLowLatencySegmentLength$=new u.ValueSubject(0),this.currentSegmentLength$=new u.ValueSubject(0),this.onLastSegment$=new u.ValueSubject(!1),this.fullyBuffered$=new u.ValueSubject(!1),this.playingRepresentation$=new u.ValueSubject(void 0),this.playingRepresentationInit$=new u.ValueSubject(void 0),this.error$=new u.Subject,this.gaps=[],this.subscription=new u.Subscription,this.allInitsLoaded=!1,this.activeSegments=new Set,this.downloadAbortController=new Ya,this.switchAbortController=new Ya,this.destroyAbortController=new Ya,this.bufferLimit=1/0,this.failedDownloads=0,this.baseUrls=[],this.baseUrlsIndex=0,this.isLive=!1,this.liveUpdateSegmentIndex=0,this.liveInitialAdditionalOffset=0,this.isSeekingLive=!1,this.index=0,this.lastDataObtainedTimestampMs=0,this.loadByteRangeSegmentsTimeoutId=0,this.startWith=(0,u.abortable)(this.destroyAbortController.signal,async function*(e){let t=this.representations.get(e);(0,u.assertNonNullable)(t,`Cannot find representation ${e}`),this.playingRepresentationId=e,this.downloadingRepresentationId=e,this.sourceBuffer=this.mediaSource.addSourceBuffer(`${t.mime}; codecs="${t.codecs}"`),this.sourceBufferTaskQueue=new ds(this.sourceBuffer),this.subscription.add((0,u.fromEvent)(this.sourceBuffer,"updateend").subscribe((()=>{this.checkEjectedSegments(),this.maintain()}),(e=>{let t,i=this.mediaSource.readyState;"open"!==i&&(t={id:`SegmentEjection_source_${i}`,category:u.ErrorCategory.VIDEO_PIPELINE,message:"Error when trying to clear segments ejected by browser",thrown:e}),t??(t={id:"SegmentEjection",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Error when trying to clear segments ejected by browser",thrown:e}),this.error$.next(t)}))),this.subscription.add((0,u.fromEvent)(this.sourceBuffer,"error").subscribe((()=>this.error$.next({id:"SourceBuffer",category:u.ErrorCategory.VIDEO_PIPELINE,message:"SourceBuffer Error event fired"})))),this.subscription.add(this.sourceBufferTaskQueue.bufferFull$.subscribe((e=>{let t=this.getCurrentPosition();if(!this.sourceBuffer||!t||!Zs(this.mediaSource,this.sourceBuffer))return;let i=Math.min(this.bufferLimit,.8*cs(this.sourceBuffer.buffered));this.bufferLimit=i;let r=this.getForwardBufferDuration(t),a=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;this.pruneBuffer(t,2*e,r<a).catch((e=>{this.handleAsyncError(e,"pruneBuffer")}))}))),this.subscription.add(this.sourceBufferTaskQueue.error$.subscribe((e=>this.error$.next(e)))),yield this.loadInit(t,"high",!0);let i=this.initData.get(t.id),r=this.segments.get(t.id),a=this.parsedInitData.get(t.id);(0,u.assertNonNullable)(i,"No init buffer for starting representation"),(0,u.assertNonNullable)(r,"No segments for starting representation"),i instanceof ArrayBuffer&&(this.searchGaps(r,t),yield this.sourceBufferTaskQueue.append(i,this.destroyAbortController.signal),this.playingRepresentation$.next(this.playingRepresentationId),this.playingRepresentationInit$.next(a))}.bind(this)),this.switchTo=(0,u.abortable)(this.destroyAbortController.signal,async function*(e,t=!1){if(!Zs(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId)return;this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,u.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),a=this.initData.get(e);if((0,u.isNullable)(a)||(0,u.isNullable)(r)?yield this.loadInit(i,"high",!1):a instanceof Promise&&(yield a),r=this.segments.get(e),(0,u.assertNonNullable)(r,"No segments for starting representation"),a=this.initData.get(e),a&&a instanceof ArrayBuffer&&this.sourceBuffer&&Zs(this.mediaSource,this.sourceBuffer)){if(yield this.abort(),yield this.sourceBufferTaskQueue.append(a,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer();else{let t=this.getCurrentPosition();(0,u.isNonNullable)(t)&&!this.isLive&&(this.bufferLimit=1/0,await this.pruneBuffer(t,1/0,!0)),this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e}this.maintain()}}.bind(this)),this.switchToOld=(0,u.abortable)(this.destroyAbortController.signal,async function*(e,t=!1){if(!Zs(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId)return;this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,u.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),a=this.initData.get(e);if((0,u.isNullable)(a)||(0,u.isNullable)(r)?yield this.loadInit(i,"high",!1):a instanceof Promise&&(yield a),r=this.segments.get(e),(0,u.assertNonNullable)(r,"No segments for starting representation"),a=this.initData.get(e),a&&a instanceof ArrayBuffer&&this.sourceBuffer&&Zs(this.mediaSource,this.sourceBuffer))if(yield this.abort(),yield this.sourceBufferTaskQueue.append(a,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer(),this.maintain();else{let t=this.getCurrentPosition();(0,u.isNonNullable)(t)&&(this.isLive||(this.bufferLimit=1/0,await this.pruneBuffer(t,1/0,!0)),this.maintain(t)),this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e}}.bind(this)),this.seekLive=(0,u.abortable)(this.destroyAbortController.signal,async function*(e){let t=(0,rs.default)(e,(e=>e.representations))??[];if(this.isSeekingLive=!0,!this.downloadingRepresentationId||!t)return;for(let e of this.representations.keys()){let i=t.find((t=>t.id===e));i&&this.representations.set(e,i);let r=this.representations.get(e);if(!r||!Qs(r.segmentReference))return;let a=this.getActualLiveStartingSegments(r.segmentReference);this.segments.set(r.id,a)}let i=this.switchingToRepresentationId??this.downloadingRepresentationId,r=this.representations.get(i);(0,u.assertNonNullable)(r);let a=this.segments.get(i);(0,u.assertNonNullable)(a,"No segments for starting representation");let s=this.initData.get(i);if((0,u.assertNonNullable)(s,"No init buffer for starting representation"),!(s instanceof ArrayBuffer))return;let n=this.getDebugBufferState();this.liveUpdateSegmentIndex=0,yield this.abort(),n&&(yield this.sourceBufferTaskQueue.remove(1e3*n.from,1e3*n.to,this.destroyAbortController.signal)),this.searchGaps(a,r),yield this.sourceBufferTaskQueue.append(s,this.destroyAbortController.signal),this.isSeekingLive=!1}.bind(this)),this.fetcher=r,this.tuning=a,this.compatibilityMode=o,this.forwardBufferTarget=a.dash.forwardBufferTargetAuto,this.getCurrentPosition=s,this.isActiveLowLatency=n,this.isLive=!!l?.live,this.baseUrls=l?.baseUrls??[],this.initData=new Map(i.map((e=>[e.id,null]))),this.segments=new Map,this.parsedInitData=new Map,this.representations=new Map(i.map((e=>[e.id,e]))),this.kind=e,this.mediaSource=t,this.sourceBuffer=null}},Js=e=>{let t=new URL(e);return t.searchParams.set("quic","1"),t.toString()},en=e=>{let t=e.get("X-Delivery-Type"),i=e.get("X-Reused");return{type:null===t?"http1":t??void 0,reused:null===i?void 0:{1:!0,0:!1}[i]??void 0}},tn=e=>{let t=new URL(e);return t.searchParams.set("enable-subtitles","yes"),t.toString()},rn=class{onHeadersReceived(e){let{type:t,reused:i}=en(e);this.lastConnectionType$.next(t),this.lastConnectionReused$.next(i)}async fetchRepresentation(e,t,i="auto"){let{type:r}=e;switch(r){case"byteRange":return await this.fetchByteRangeRepresentation(e,t,i)??null;case"template":return await this.fetchTemplateRepresentation(e,i)??null;default:(0,u.assertNever)(r)}}destroy(){this.abortAllController.abort(),this.subscription.unsubscribe(),this.tracer.end()}async doFetch(e,t){let i=await Ka(e,t);if(i.ok)return i;let r=await i.text(),a=parseInt(r);if(!isNaN(a))switch(a){case 1:this.recoverableError$.next({id:"VideoDataLinkExpiredError",message:"Video data links have expired",category:u.ErrorCategory.FATAL});break;case 8:this.recoverableError$.next({id:"VideoDataLinkBlockedForFloodError",message:"Url blocked for flood",category:u.ErrorCategory.FATAL});break;case 18:this.recoverableError$.next({id:"VideoDataLinkIllegalIpChangeError",message:"Client IP has changed",category:u.ErrorCategory.FATAL});break;case 21:this.recoverableError$.next({id:"VideoDataLinkIllegalHostChangeError",message:"Request HOST has changed",category:u.ErrorCategory.FATAL});break;default:this.error$.next({id:"GeneralVideoDataFetchError",message:`Generic video data fetch error (${a})`,category:u.ErrorCategory.FATAL})}}constructor({throughputEstimator:e,requestQuic:t,tracer:i,compatibilityMode:r=!1,useEnableSubtitlesParam:a=!1}){this.lastConnectionType$=new u.ValueSubject(void 0),this.lastConnectionReused$=new u.ValueSubject(void 0),this.lastRequestFirstBytes$=new u.ValueSubject(void 0),this.recoverableError$=new u.Subject,this.error$=new u.Subject,this.abortAllController=new Ya,this.subscription=new u.Subscription,this.fetchManifest=(0,u.abortable)(this.abortAllController.signal,async function*(e){let t=this.tracer.createComponentTracer("FetchManifest"),i=e;this.requestQuic&&(i=Js(i)),!this.compatibilityMode&&this.useEnableSubtitlesParam&&(i=tn(i));let r=yield this.doFetch(i,{signal:this.abortAllController.signal}).catch(an);return r?(t.log("success",(0,u.flattenObject)({url:i,message:"Request successfully executed"})),t.end(),this.onHeadersReceived(r.headers),r.text()):(t.error("error",(0,u.flattenObject)({url:i,message:"No data in request manifest"})),t.end(),null)}.bind(this)),this.fetch=(0,u.abortable)(this.abortAllController.signal,async function*(e,{rangeMethod:t=(this.compatibilityMode?0:1),range:i,onProgress:r,priority:a="auto",signal:s,measureThroughput:n=!0,isLowLatency:o=!1}={}){let l=e,d=new Headers,c=this.tracer.createComponentTracer("Fetch");if(i)switch(t){case 0:d.append("Range",`bytes=${i.from}-${i.to}`);break;case 1:{let e=new URL(l,location.href);e.searchParams.append("bytes",`${i.from}-${i.to}`),l=e.toString();break}default:(0,u.assertNever)(t)}this.requestQuic&&(l=Js(l));let h,p=this.abortAllController.signal;if(s){let e=new Ya;if(h=(0,u.merge)((0,u.fromEvent)(this.abortAllController.signal,"abort"),(0,u.fromEvent)(s,"abort")).subscribe((()=>{try{e.abort()}catch(e){an(e)}})),this.subscription.add(h),this.abortAllController.signal.aborted||s.aborted)try{e.abort()}catch(e){an(e)}p=e.signal}let f=(0,u.now)();c.log("startRequest",(0,u.flattenObject)({url:l,priority:a,rangeMethod:t,range:i,isLowLatency:o,requestStartedAt:f}));let m=yield this.doFetch(l,{priority:a,headers:d,signal:p}),v=(0,u.now)();if(!m)return c.error("error",{message:"No response in request"}),c.end(),h?.unsubscribe(),null;if(this.throughputEstimator?.addRawRtt(v-f),!m.ok||!m.body){h?.unsubscribe();let e=`Fetch error ${m.status}: ${m.statusText}`;return c.error("error",{message:e}),c.end(),Promise.reject(new Error(`Fetch error ${m.status}: ${m.statusText}`))}if(this.onHeadersReceived(m.headers),!r&&!n){h?.unsubscribe();let e=(0,u.now)(),t={requestStartedAt:f,requestEndedAt:e,duration:e-f};return c.log("endRequest",(0,u.flattenObject)(t)),c.end(),m.arrayBuffer()}let[g,b]=m.body.tee(),y=g.getReader();n&&this.throughputEstimator?.trackStream(b,o);let w=0,S=new Uint8Array(0),x=!1,$=e=>{h?.unsubscribe(),x=!0,an(e)},_=(0,u.abortable)(p,async function*({done:e,value:t}){if(0===w&&this.lastRequestFirstBytes$.next((0,u.now)()-f),p.aborted)h?.unsubscribe();else if(!e&&t){let e=new Uint8Array(S.length+t.length);e.set(S),e.set(t,S.length),S=e,w+=t.byteLength,r?.(new DataView(S.buffer),w),yield y?.read().then(_,$)}}.bind(this));yield y?.read().then(_,$),h?.unsubscribe();let k=(0,u.now)(),T={failed:x,requestStartedAt:f,requestEndedAt:k,duration:k-f};return x?(c.error("endRequest",(0,u.flattenObject)(T)),c.end(),null):(c.log("endRequest",(0,u.flattenObject)(T)),c.end(),S.buffer)}.bind(this)),this.fetchByteRangeRepresentation=(0,u.abortable)(this.abortAllController.signal,async function*(e,t,i){if("byteRange"!==e.type)return null;let r,a,{from:s,to:n}=e.initRange,o=s,l=n,u=!1;e.indexRange&&(r=e.indexRange.from,a=e.indexRange.to,u=n+1===r,u&&(o=Math.min(r,s),l=Math.max(a,n))),o=Math.min(o,0);let d=yield this.fetch(e.url,{range:{from:o,to:l},priority:i,measureThroughput:!1});if(!d)return null;let c=new DataView(d,s-o,n-o+1);if(!t.validateData(c))throw new Error("Invalid media file");let h,p=t.parseInit(c),f=e.indexRange??t.getIndexRange(p);if(!f)throw new ReferenceError("No way to load representation index");if(u)h=new DataView(d,f.from-o,f.to-f.from+1);else{let t=yield this.fetch(e.url,{range:f,priority:i,measureThroughput:!1});if(!t)return null;h=new DataView(t)}let m=t.parseSegments(h,p,f);return{init:p,dataView:new DataView(d),segments:m}}.bind(this)),this.fetchTemplateRepresentation=(0,u.abortable)(this.abortAllController.signal,async function*(e,t){if("template"!==e.type)return null;let i=new URL(e.initUrl,e.baseUrl).toString(),r=yield this.fetch(i,{priority:t,measureThroughput:!1});return r?{init:null,segments:e.segments.map((e=>({...e,status:"none",size:void 0}))),dataView:new DataView(r)}:null}.bind(this)),this.throughputEstimator=e,this.requestQuic=t,this.compatibilityMode=r,this.tracer=i.createComponentTracer("Fetcher"),this.useEnableSubtitlesParam=a}},an=e=>{if(!Gs(e))throw e},sn=(e,t,i)=>i*t+(1-i)*e,nn=(e,t)=>e.reduce(((e,t)=>e+t),0)/t,on=class{next(e){let t=0,i=0;for(let e=0;e<this.pastMeasures.length;e++)void 0!==this.pastMeasures[e]&&(t+=(this.pastMeasures[e]-this.smoothed)**2,i++);this.takenMeasures=i,t/=i;let r=Math.sqrt(t),a=this.smoothed+this.params.deviationFactor*r,s=this.smoothed-this.params.deviationFactor*r;this.pastMeasures[this.measuresCursor]=e,this.measuresCursor=(this.measuresCursor+1)%this.pastMeasures.length,this.rawSeries$.next(e),this.updateSmoothedValue(e),this.smoothed$.next(this.smoothed),this.smoothedSeries$.next(this.smoothed),!(this.smoothed>a||this.smoothed<s)&&((0,u.isNullable)(this.prevReported)||Math.abs(this.smoothed-this.prevReported)/this.prevReported>=this.params.changeThreshold)&&(this.prevReported=this.smoothed,this.debounced$.next(this.smoothed),this.reportedSeries$.next(this.smoothed))}constructor(e){this.prevReported=void 0,this.pastMeasures=[],this.takenMeasures=0,this.measuresCursor=0,this.params=e,this.pastMeasures=Array(e.deviationDepth),this.smoothed=this.prevReported=e.initial,this.smoothed$=new u.ValueSubject(e.initial),this.debounced$=new u.ValueSubject(e.initial);let t=e.label??"value"+Math.random().toString(16).substring(2,6);this.rawSeries$=new Yr(`raw_${t}`),this.smoothedSeries$=new Yr(`smoothed_${t}`),this.reportedSeries$=new Yr(`reported_${t}`),this.rawSeries$.next(e.initial),this.smoothedSeries$.next(e.initial),this.reportedSeries$.next(e.initial)}},ln=class extends on{updateSmoothedValue(e){this.slow=sn(this.slow,e,this.params.emaAlphaSlow),this.fast=sn(this.fast,e,this.params.emaAlphaFast);let t=this.params.fastDirection>0?Math.max:Math.min;this.smoothed=t(this.slow,this.fast)}constructor(e){super(e),this.slow=this.fast=e.initial}},un=class extends on{updateSmoothedValue(e){let t=nn(this.pastMeasures,this.takenMeasures);this.emaSmoothed=sn(this.emaSmoothed,e,this.params.emaAlpha);let i=((e,t,i,r)=>{let a=0,s=i,n=nn(e,t),o=t<r?t:r;for(let t=0;t<o;t++)e[s]>n?a++:a--,s=(e.length+s-1)%e.length;return Math.abs(a)===o})(this.pastMeasures,this.takenMeasures,this.measuresCursor-1,this.params.basisTrendChangeCount);this.smoothed=i?this.emaSmoothed:t}constructor(e){super(e),this.emaSmoothed=e.initial}},dn=class extends on{next(e){this.currentTopExtremumValue<=e?(this.currentTopExtremumValue=e,this.furtherValues=[]):this.furtherValues.length===this.extremumInterval?(super.next(this.currentTopExtremumValue),this.currentTopExtremumValue=e,this.furtherValues=[]):this.furtherValues.push(e)}updateSmoothedValue(e){this.smoothed=this.smoothed?sn(this.smoothed,e,this.params.emaAlpha):e}constructor(e){super(e),this.furtherValues=[],this.currentTopExtremumValue=0,this.extremumInterval=e.extremumInterval}},cn=class{static getSmoothedValue(e,t,i){return"TwoEma"===i.type?new ln({initial:e,emaAlphaSlow:i.emaAlphaSlow,emaAlphaFast:i.emaAlphaFast,changeThreshold:i.changeThreshold,fastDirection:t,deviationDepth:i.deviationDepth,deviationFactor:i.deviationFactor,label:"throughput"}):new un({initial:e,emaAlpha:i.emaAlpha,basisTrendChangeCount:i.basisTrendChangeCount,changeThreshold:i.changeThreshold,deviationDepth:i.deviationDepth,deviationFactor:i.deviationFactor,label:"throughput"})}static getLiveBufferSmoothedValue(e,t){return new dn({initial:e,label:"liveEdgeDelay",...t})}},hn=(e,t)=>{e&&e.playbackRate!==t&&(e.playbackRate=t)},pn=class e{updateLive(e){this.processStreams(e?.streams.text)}seekLive(e){this.processStreams(e)}maintain(e=this.getCurrentPosition()){if(!(0,u.isNullable)(e))for(let t of this.representations)for(let i of t){let t=i.segmentReference,r=t.segments.length,a=t.segments[0].time.from,s=t.segments[r-1].time.to;if(e<a||e>s)continue;let n=t.segments.find((t=>t.time.from<=e&&t.time.to>=e));!n||this.currentSegment?.time.from===n.time.from&&this.currentSegment.time.to===n.time.to||(this.currentSegment=n,this.currentRepresentation$.next({...i,label:"Live Text",language:"ru",isAuto:!0,url:new URL(n.url,t.baseUrl).toString()}))}}destroy(){this.currentRepresentation$.next(null),this.currentSegment=null,this.representations=[]}processStreams(t){for(let i of t??[]){let t=e.filterRepresentations(i.representations);if(t){this.representations[this.representationsCursor]=t,this.representationsCursor=(this.representationsCursor+1)%this.maxRepresentations;break}}}static isSupported(t){return!!t?.some((t=>e.filterRepresentations(t.representations)))}static filterRepresentations(e){return e?.filter((e=>"text"===e.kind&&"segmentReference"in e&&Qs(e.segmentReference)))}constructor(e,t){this.currentRepresentation$=new u.ValueSubject(null),this.maxRepresentations=4,this.representationsCursor=0,this.representations=[],this.currentSegment=null,this.getCurrentPosition=t.getCurrentPosition,this.processStreams(e)}},fn=g(oi(),1),mn=e=>{let{webmDecodingInfo:t}=Fr.video,i="DASH_WEBM",r="DASH_WEBM_AV1";switch(e){case"vp9":return[i,r];case"av1":return[r,i];case"none":return[];case"smooth":return t?t[r].smooth?[r,i]:t[i].smooth?[i,r]:[r,i]:[i,r];case"power_efficient":return t?t[r].powerEfficient?[r,i]:t[i].powerEfficient?[i,r]:[r,i]:[i,r];default:(0,u.assertNever)(e)}return[i,r]},vn=({webmCodec:e,androidPreferredFormat:t,preferMultiStream:i})=>{let r=[...i?["DASH_STREAMS"]:[],...mn(e),"DASH_SEP","DASH_ONDEMAND",...i?[]:["DASH_STREAMS"]],a=[...i?["DASH_STREAMS"]:[],"DASH_SEP","DASH_ONDEMAND",...i?[]:["DASH_STREAMS"]];if(Fr.device.isAndroid)switch(t){case"mpeg":return["MPEG",...r,"HLS","HLS_ONDEMAND"];case"hls":return["HLS","HLS_ONDEMAND",...r,"MPEG"];case"dash":return[...r,"HLS","HLS_ONDEMAND","MPEG"];case"dash_any_mpeg":return[...a,"MPEG",...mn(e),"HLS","HLS_ONDEMAND"];case"dash_any_webm":return[...mn(e),"MPEG",...a,"HLS","HLS_ONDEMAND"];case"dash_sep":return["DASH_SEP","MPEG",...mn(e),...a,"HLS","HLS_ONDEMAND"];default:(0,u.assertNever)(t)}return Fr.video.nativeHlsSupported,[...r,"HLS","HLS_ONDEMAND","MPEG"]},gn=({androidPreferredFormat:e,preferCMAF:t,preferWebRTC:i})=>{let r,a=t?["DASH_LIVE_CMAF","DASH_LIVE"]:["DASH_LIVE","DASH_LIVE_CMAF"],s=t?["HLS_LIVE_CMAF","HLS_LIVE"]:["HLS_LIVE","HLS_LIVE_CMAF"],n=[...a,...s],o=[...s,...a],l=Fr.device.isMac&&Fr.browser.isSafari;if(Fr.device.isAndroid)switch(e){case"dash":case"dash_any_mpeg":case"dash_any_webm":case"dash_sep":r=n;break;case"hls":case"mpeg":r=o;break;default:(0,u.assertNever)(e)}else r=Fr.video.nativeHlsSupported&&!l?o:l?t?["DASH_LIVE_CMAF","HLS_LIVE_CMAF","HLS_LIVE","DASH_LIVE"]:["HLS_LIVE","DASH_LIVE","DASH_LIVE_CMAF","HLS_LIVE_CMAF"]:n;return i?["WEB_RTC_LIVE",...r]:[...r,"WEB_RTC_LIVE"]},bn=e=>e?["HLS_LIVE","HLS_LIVE_CMAF","DASH_LIVE_CMAF"]:["DASH_WEBM","DASH_WEBM_AV1","DASH_SEP","DASH_ONDEMAND","HLS","HLS_ONDEMAND","MPEG"],yn=e=>{if(0===e.size)return;if(1===e.size){let t=e.values().next();return(0,fn.default)(t.value.split("."),0)}for(let t of e){let e=(0,fn.default)(t.split("."),0);if("opus"===e||"vp09"===e||"av01"===e)return e}let t=e.values().next();return(0,fn.default)(t.value.split("."),0)},wn=["timeupdate","progress","play","seeked","stalled","waiting"],Sn=["timeupdate","progress","loadeddata","playing","seeked"],xn=class{async seekLive(e){(0,u.assertNonNullable)(this.element);let t="active"!==this.liveStreamStatus$.getValue()?(0,u.now)()-this.liveStreamEndTimestamp:0,i=this.normolizeLiveOffset(e+t);this.isActiveLive$.next(0===i),this.manifestUrlString=sr(this.manifestUrlString,i,2),this.manifest=await this.updateManifest(),this.manifest&&(this.isJumpGapAfterSeekLive=!0,await(this.videoBufferManager?.seekLive(this.manifest.streams.video)),await(this.audioBufferManager?.seekLive(this.manifest.streams.audio)),this.liveTextManager?.seekLive(this.manifest.streams.text))}initBuffer(){(0,u.assertNonNullable)(this.element),this.state$.setState("running"),this.subscription.add((0,u.merge)(...wn.map((e=>(0,u.fromEvent)(this.element,e))),(0,u.fromEvent)(window,"online")).subscribe((()=>this.tick()),(e=>{this.error$.next({id:"DashVKPlayer",category:u.ErrorCategory.WTF,message:"Internal logic error",thrown:e})}))),this.subscription.add((0,u.fromEvent)(this.element,"progress").subscribe((()=>{this.element&&2===this.element.readyState&&!this.element.seeking&&(this.element.currentTime=this.element.currentTime)}))),this.subscription.add((0,u.fromEvent)(this.element,"waiting").subscribe((()=>{this.element&&2===this.element.readyState&&!this.element.seeking&&es(this.element.buffered,1e3*this.element.currentTime)&&(this.element.currentTime=this.element.currentTime);this.stallWatchdogSubscription?.unsubscribe(),this.stallWatchdogSubscription=(0,u.interval)(50).subscribe((()=>{if(!this.element||"open"!==this.source?.readyState)return;let e=this.currentStallDuration$.getValue();e+=50,this.currentStallDuration$.next(e);let t={timeInWaiting:e},i=(0,u.now)(),r=this.videoBufferManager?.lastDataObtainedTimestamp??0;this.videoLastDataObtainedTimestamp$.next(r);let a=this.audioBufferManager?.lastDataObtainedTimestamp??0,s=this.videoBufferManager?.getForwardBufferDuration()??0,n=this.audioBufferManager?.getForwardBufferDuration()??0,o=s<100&&i-r>this.tuning.dash.crashOnStallTWithoutDataTimeout,l=this.audioBufferManager&&n<100&&i-a>this.tuning.dash.crashOnStallTWithoutDataTimeout;if((o||l)&&e>this.tuning.dash.crashOnStallTWithoutDataTimeout||e>=this.tuning.dash.crashOnStallTimeout)throw new Error(`Stall timeout exceeded: ${e} ms`);if(this.isLive$.getValue()&&e%2e3==0){let e=this.normolizeLiveOffset(-1*this.livePositionFromPlayer$.getValue()*1e3);this.seekLive(e).catch((e=>{this.error$.next({id:"stallIntervalCallback",category:u.ErrorCategory.VIDEO_PIPELINE,message:"stallIntervalCallback failed",thrown:e})})),t.liveLastOffset=e}else{let e=1e3*this.element.currentTime;this.videoBufferManager?.maintain(e),this.audioBufferManager?.maintain(e),t.position=e}this.tracer.log("stallIntervalCallback",(0,u.flattenObject)(t))}),(e=>{this.error$.next({id:"StallWatchdogCallback",category:u.ErrorCategory.NETWORK,message:"Can't restore DASH after stall.",thrown:e})})),this.subscription.add(this.stallWatchdogSubscription)}))),this.tick()}async switchRepresentation(e,t,i=!1){let r={video:this.videoBufferManager,audio:this.audioBufferManager,text:null}[e];return this.tuning.useNewSwitchTo?this.currentStallDuration$.getValue()>0?r?.switchToWithPreviousAbort(t,i):r?.switchTo(t,i):r?.switchToOld(t,i)}async seek(e,t){let i;(0,u.assertNonNullable)(this.element),(0,u.assertNonNullable)(this.videoBufferManager),i=t||1e3*this.element.duration<=this.tuning.dashSeekInSegmentDurationThreshold||Math.abs(1e3*this.element.currentTime-e)<=this.tuning.dashSeekInSegmentAlwaysSeekDelta?e:Math.max(this.videoBufferManager.findSegmentStartTime(e)??e,this.audioBufferManager?.findSegmentStartTime(e)??e),this.warmUpMediaSourceIfNeeded(i),es(this.element.buffered,i)||await Promise.all([this.videoBufferManager.abort(),this.audioBufferManager?.abort()]),!(0,u.isNullable)(this.element)&&!(0,u.isNullable)(this.videoBufferManager)&&(this.videoBufferManager.maintain(i),this.audioBufferManager?.maintain(i),this.element.currentTime=i/1e3,this.tracer.log("seek",(0,u.flattenObject)({requestedPosition:e,forcePrecise:t,position:i})))}warmUpMediaSourceIfNeeded(e=this.element?.currentTime){(0,u.isNonNullable)(this.element)&&(0,u.isNonNullable)(this.source)&&(0,u.isNonNullable)(e)&&"ended"===this.source?.readyState&&1e3*this.element.duration-e>this.tuning.dash.seekBiasInTheEnd&&this.bufferManagers.forEach((e=>e.warmUpMediaSource()))}get isStreamEnded(){return"ended"===this.source?.readyState}stop(){this.tracer.log("stop"),this.element?.querySelectorAll("source").forEach((e=>{URL.revokeObjectURL(e.src),e.remove()})),this.element=null,this.source=null,this.manifest=null,this.currentVideoRepresentation$.next(void 0),this.videoBufferManager?.destroy(),this.videoBufferManager=null,this.audioBufferManager?.destroy(),this.audioBufferManager=null,this.bufferManagers=[],this.state$.setState("none")}setBufferTarget(e){for(let t of this.bufferManagers)t.setTarget(e)}getStreams(){return this.manifest?.streams}setPreloadOnly(e){for(let t of this.bufferManagers)t.setPreloadOnly(e)}destroy(){this.subscription.unsubscribe(),this.representationSubscription.unsubscribe(),this.timeoutSourceOpenId&&clearTimeout(this.timeoutSourceOpenId),this.destroyController.abort(),this.fetcher.destroy(),this.stop(),"open"===this.source?.readyState&&Array.from(this.source.sourceBuffers).every((e=>!e.updating))&&this.source.endOfStream(),this.source=null,this.tracer.end()}initTracerSubscription(){let e=(0,u.getTraceSubscriptionMethod)(this.tracer.error.bind(this.tracer));this.subscription.add(this.error$.subscribe(e("error")))}isManualDecreasePlaybackInLive(){return!(!this.element||!this.isLive$.getValue())&&1-this.element.playbackRate>this.tuning.dashCmafLive.lowLatency.playbackCatchupSpeedup}normolizeLiveOffset(e){return 1e3*Math.trunc(e/1e3)}async updateLive(){this.isUpdatingLive=!0,this.manifest=await this.updateManifest(),this.manifest&&(this.bufferManagers?.forEach((e=>e.updateLive(this.manifest))),this.liveTextManager?.updateLive(this.manifest)),this.isUpdatingLive=!1}jumpGap(){if(!this.element||!this.videoBufferManager)return;let e=this.videoBufferManager.getDebugBufferState();if(!e)return;let t=this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),i={isJumpGapAfterSeekLive:this.isJumpGapAfterSeekLive,isActiveLowLatency:t,initialCurrentTime:this.element.currentTime};this.isJumpGapAfterSeekLive&&!t&&this.element.currentTime>e.to&&(this.isJumpGapAfterSeekLive=!1,this.element.currentTime=0);let r=1e3*this.element.currentTime,a=[],s=1===this.element.readyState?this.tuning.endGapTolerance:0;for(let e of this.bufferManagers)for(let t of e.gaps)e.playingRepresentation$.getValue()===t.representation&&t.from-s<=r&&t.to+s>r&&(1e3*this.element.duration-t.to<this.tuning.endGapTolerance?a.push(1/0):a.push(t.to));if(a.length){let e=Math.max(...a)+10;this.gapWatchdogSubscription.unsubscribe(),this.gapWatchdogActive=!1,e===1/0?this.forceEnded$.next():(this.element.currentTime=e/1e3,i={...i,gapEnds:a,jumpTo:e,resultCurrentTime:this.element.currentTime},this.tracer.log("jumpGap",(0,u.flattenObject)(i)))}}constructor(e){this.element=null,this.manifestUrlString="",this.source=null,this.manifest=null,this.subscription=new u.Subscription,this.representationSubscription=new u.Subscription,this.state$=new lr("none"),this.currentVideoRepresentation$=new u.ValueSubject(void 0),this.currentVideoRepresentationInit$=new u.ValueSubject(void 0),this.currentAudioRepresentation$=new u.ValueSubject(void 0),this.currentVideoSegmentLength$=new u.ValueSubject(0),this.currentAudioSegmentLength$=new u.ValueSubject(0),this.error$=new u.Subject,this.lastConnectionType$=new u.ValueSubject(void 0),this.lastConnectionReused$=new u.ValueSubject(void 0),this.lastRequestFirstBytes$=new u.ValueSubject(void 0),this.currentLiveTextRepresentation$=new u.ValueSubject(null),this.isLive$=new u.ValueSubject(!1),this.isActiveLive$=new u.ValueSubject(!1),this.isLowLatency$=new u.ValueSubject(!1),this.liveDuration$=new u.ValueSubject(0),this.liveSeekableDuration$=new u.ValueSubject(0),this.liveAvailabilityStartTime$=new u.ValueSubject(0),this.liveStreamStatus$=new u.ValueSubject(void 0),this.bufferLength$=new u.ValueSubject(0),this.liveLatency$=new u.ValueSubject(void 0),this.liveLoadBufferLength$=new u.ValueSubject(0),this.livePositionFromPlayer$=new u.ValueSubject(0),this.currentStallDuration$=new u.ValueSubject(0),this.videoLastDataObtainedTimestamp$=new u.ValueSubject(0),this.fetcherRecoverableError$=new u.Subject,this.fetcherError$=new u.Subject,this.liveStreamEndTimestamp=0,this.isUpdatingLive=!1,this.isJumpGapAfterSeekLive=!1,this.forceEnded$=new u.Subject,this.gapWatchdogActive=!1,this.destroyController=new Ya,this.initManifest=(0,u.abortable)(this.destroyController.signal,async function*(e,t,i){this.tracer.log("initManifest"),this.element=e,this.manifestUrlString=sr(t,i,2),this.state$.startTransitionTo("manifest_ready"),this.manifest=yield this.updateManifest(),this.manifest?.streams.video.length?this.state$.setState("manifest_ready"):this.error$.next({id:"NoRepresentations",category:u.ErrorCategory.PARSER,message:"No playable video representations"})}.bind(this)),this.updateManifest=(0,u.abortable)(this.destroyController.signal,async function*(){this.tracer.log("updateManifestStart",{manifestUrl:this.manifestUrlString});let e=yield this.fetcher.fetchManifest(this.manifestUrlString).catch((e=>{!this.manifest&&!this.bufferLength$.getValue()&&this.error$.next({id:"LoadManifest",category:u.ErrorCategory.NETWORK,message:"Failed to load manifest",thrown:e})}));if(!e)return null;let t=null;try{t=((e,t)=>{let i,r={video:[],audio:[],text:[]},a=(new DOMParser).parseFromString(e,"application/xml").children[0],s=Array.from(a.querySelectorAll("MPD > BaseURL").values()).map((e=>e.textContent?.trim()??"")),n=(0,Rs.default)(s,0)??"",o="dynamic"===a.getAttribute("type"),l=a.getAttribute("availabilityStartTime"),d=a.getAttribute("publishTime"),c=a.getElementsByTagName("vk:Attrs")[0],h=c?.getElementsByTagName("vk:XLatestSegmentPublishTime")[0].textContent,p=c?.getElementsByTagName("vk:XStreamIsLive")[0].textContent,f=c?.getElementsByTagName("vk:XStreamIsUnpublished")[0].textContent,m=c?.getElementsByTagName("vk:XPlaybackDuration")[0].textContent;o&&(i={availabilityStartTime:l?new Date(l).getTime():0,publishTime:d?new Date(d).getTime():0,latestSegmentPublishTime:h?new Date(h).getTime():0,streamIsAlive:"yes"===p,streamIsUnpublished:"yes"===f});let v,g=a.getAttribute("mediaPresentationDuration"),b=[...a.getElementsByTagName("Period")],y=b.reduce(((e,t)=>({...e,[t.id]:t.children})),{}),w=b.reduce(((e,t)=>({...e,[t.id]:t.getAttribute("duration")})),{});g?v=Ks(g):(0,Vs.default)(w).filter((e=>e)).length&&!o?v=(0,Vs.default)(w).reduce(((e,t)=>e+(Ks(t)??0)),0):m&&(v=parseInt(m,10));let S=0,x=a.getAttribute("profiles")?.split(",")??[];for(let e of b.map((e=>e.id)))for(let i of y[e]){let e=i.getAttribute("id")??"id"+(S++).toString(10),a=i.getAttribute("mimeType")??"",s=i.getAttribute("codecs")??"",o=i.getAttribute("contentType")??a?.split("/")[0],l=i.getAttribute("profiles")?.split(",")??[],d=Os(i.getAttribute("lang")??"")??{},c=i.querySelector("Label")?.textContent?.trim()??void 0,h=i.querySelectorAll("Representation"),p=i.querySelector("SegmentTemplate"),f=i.querySelector("Role")?.getAttribute("value")??void 0,m=o,g={id:e,language:d.language,isDefault:"main"===f,label:c,codecs:s,hdr:"video"===m&&Bs(s),mime:a,representations:[]};for(let e of h){var $,_,k,T,C;let r,h=e.getAttribute("lang")??void 0,f=c??i.getAttribute("label")??e.getAttribute("label")??void 0,b=e.querySelector("BaseURL")?.textContent?.trim()??"",y=new URL(b||n,t).toString(),w=e.getAttribute("mimeType")??a,E=e.getAttribute("codecs")??s??"";if("text"===o){let t=e.getAttribute("id")||"",i=d.privateuse?.includes("x-auto")||t.includes("_auto"),a=e.querySelector("SegmentTemplate");if(a){let s={representationId:e.getAttribute("id")??void 0,bandwidth:e.getAttribute("bandwidth")??void 0},n=parseInt(e.getAttribute("bandwidth")??"",10)/1e3,o=parseInt(a.getAttribute("startNumber")??"",10)??1,l=parseInt(a.getAttribute("timescale")??"",10),u=a.querySelectorAll("SegmentTimeline S")??[],d=a.getAttribute("media");if(!d)continue;let c=[],h=0,p="",f=0,m=o,g=0;for(let e of u){let t=parseInt(e.getAttribute("d")??"",10),i=parseInt(e.getAttribute("r")??"",10)||0,r=parseInt(e.getAttribute("t")??"",10);g=Number.isFinite(r)?r:g;let a=t/l*1e3,n=g/l*1e3;for(let e=0;e<i+1;e++){let i=Ys(d,{...s,segmentNumber:m.toString(10),segmentTime:(g+e*t).toString(10)}),r=(n??0)+e*a,o=r+a;m++,c.push({time:{from:r,to:o},url:i})}g+=(i+1)*t,h+=(i+1)*a}f=g/l*1e3,p=Ys(d,{...s,segmentNumber:m.toString(10),segmentTime:g.toString(10)}),r={id:t,kind:"text",segmentReference:{type:"template",baseUrl:y,segmentTemplateUrl:d,initUrl:"",totalSegmentsDurationMs:h,segments:c,nextSegmentBeyondManifest:{time:{from:f,to:1/0},url:p},timescale:l},profiles:[],duration:v,bitrate:n,mime:"",codecs:"",width:0,height:0,isAuto:i}}else r={id:t,isAuto:i,kind:"text",url:y}}else{let t,a=e.getAttribute("contentType")??w?.split("/")[0]??o,s=i.getAttribute("profiles")?.split(",")??[],n=parseInt(e.getAttribute("width")??"",10),d=parseInt(e.getAttribute("height")??"",10),c=parseInt(e.getAttribute("bandwidth")??"",10)/1e3,h=e.getAttribute("frameRate")??"",f=e.getAttribute("quality")??void 0,g=h?Ds(h):void 0,b=`${e.getAttribute("id")??"id"+(S++).toString(10)}@${"video"===a?`${d}p`:"audio"===a?`${c}Kbps`:E}`,$=[...x,...l,...s],_=e.querySelector("SegmentBase"),k=e.querySelector("SegmentTemplate")??p;if(_){let i=e.querySelector("SegmentBase Initialization")?.getAttribute("range")??"",[r,a]=i.split("-").map((e=>parseInt(e,10))),s={from:r,to:a},n=e.querySelector("SegmentBase")?.getAttribute("indexRange"),[o,l]=n?n.split("-").map((e=>parseInt(e,10))):[];t={type:"byteRange",url:y,initRange:s,indexRange:n?{from:o,to:l}:void 0}}else{if(!k)throw new ReferenceError("Unknown MPD segment referencing type");{let i={representationId:e.getAttribute("id")??void 0,bandwidth:e.getAttribute("bandwidth")??void 0},r=parseInt(k.getAttribute("timescale")??"",10),a=k.getAttribute("initialization")??"",s=k.getAttribute("media"),n=parseInt(k.getAttribute("startNumber")??"",10)??1,o=Ys(a,i);if(!s)throw new ReferenceError("No media attribute in SegmentTemplate");let l=k.querySelectorAll("SegmentTimeline S")??[],d=[],c=0,h="",p=0;if(l.length){let e=n,t=0;for(let a of l){let n=parseInt(a.getAttribute("d")??"",10),o=parseInt(a.getAttribute("r")??"",10)||0,l=parseInt(a.getAttribute("t")??"",10);t=Number.isFinite(l)?l:t;let u=n/r*1e3,h=t/r*1e3;for(let r=0;r<o+1;r++){let a=Ys(s,{...i,segmentNumber:e.toString(10),segmentTime:(t+r*n).toString(10)}),o=(h??0)+r*u,l=o+u;e++,d.push({time:{from:o,to:l},url:a})}t+=(o+1)*n,c+=(o+1)*u}p=t/r*1e3,h=Ys(s,{...i,segmentNumber:e.toString(10),segmentTime:t.toString(10)})}else if((0,u.isNonNullable)(v)){let e=parseInt(k.getAttribute("duration")??"",10)/r*1e3,t=Math.ceil(v/e),a=0;for(let r=1;r<t;r++){let t=Ys(s,{...i,segmentNumber:r.toString(10),segmentTime:a.toString(10)});d.push({time:{from:a,to:a+e},url:t}),a+=e}p=a,h=Ys(s,{...i,segmentNumber:t.toString(10),segmentTime:a.toString(10)})}t={type:"template",baseUrl:y,segmentTemplateUrl:s,initUrl:o,totalSegmentsDurationMs:c,segments:d,nextSegmentBeyondManifest:{time:{from:p,to:1/0},url:h},timescale:r}}}if(!a||!w)continue;let T={video:"video",audio:"audio",text:"text"}[a];if(!T)continue;m||(m=T),r={id:b,kind:T,segmentReference:t,profiles:$,duration:v,bitrate:c,mime:w,codecs:E,width:n,height:d,fps:g,quality:f}}($=g).language||($.language=h),(_=g).label||(_.label=f),(k=g).mime||(k.mime=w),(T=g).codecs||(T.codecs=E),(C=g).hdr||(C.hdr="video"===m&&Bs(E)),g.representations.push(r)}if(m){let e=r[m].find((e=>e.id===g.id));if(e&&g.representations.every((e=>Qs(e.segmentReference))))for(let t of e.representations){let e=g.representations.find((e=>e.id===t.id))?.segmentReference,i=t.segmentReference;i.segments.push(...e.segments),i.nextSegmentBeyondManifest=e.nextSegmentBeyondManifest}else r[m].push(g)}}return{duration:v,streams:r,baseUrls:s,live:i}})(e??"",this.manifestUrlString)}catch(t){let i=Ja(e)??{id:"ManifestParsing",category:u.ErrorCategory.PARSER,message:"Failed to parse MPD manifest",thrown:t};this.error$.next(i)}if(!t)return null;let i=(e,t,i)=>!!(this.element?.canPlayType?.(t)&&Pr()?.isTypeSupported?.(`${t}; codecs="${i}"`)||"text"===e);if(t.live){this.isLive$.next(!!t.live);let{availabilityStartTime:e,latestSegmentPublishTime:i,streamIsUnpublished:r,streamIsAlive:a}=t.live,s=(t.duration??0)/1e3;this.liveSeekableDuration$.next(-1*s),this.liveDuration$.next((i-e)/1e3),this.liveAvailabilityStartTime$.next(t.live.availabilityStartTime);let n="active";a||(n=r?"unpublished":"unexpectedly_down"),this.liveStreamStatus$.next(n)}let r={text:t.streams.text,video:[],audio:[]};for(let e of["video","audio"]){let a=t.streams[e].filter((({mime:t,codecs:r})=>i(e,t,r))),s=new Set(a.map((({codecs:e})=>e))),n=yn(s);if(n&&(r[e]=a.filter((({codecs:e})=>e.startsWith(n)))),"video"===e){let e=this.tuning.preferHDR,t=r.video.some((e=>e.hdr)),i=r.video.some((e=>!e.hdr));Fr.display.isHDR&&e&&t?r.video=r.video.filter((e=>e.hdr)):i&&(r.video=r.video.filter((e=>!e.hdr)))}}let a={...t,streams:r};return this.tracer.log("updateManifestEnd",(0,u.flattenObject)(a)),a}.bind(this)),this.initRepresentations=(0,u.abortable)(this.destroyController.signal,async function*(e,t,i){this.tracer.log("initRepresentationsStart",(0,u.flattenObject)({initialVideo:e,initialAudio:t,sourceHls:i})),(0,u.assertNonNullable)(this.manifest),(0,u.assertNonNullable)(this.element),this.representationSubscription.unsubscribe(),this.state$.startTransitionTo("representations_ready");let r=e=>{this.representationSubscription.add((0,u.fromEvent)(e,"error").pipe((0,u.filter)((e=>!!this.element?.played.length))).subscribe((e=>{this.error$.next({id:"VideoSource",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Unexpected video source error",thrown:e})})))};this.source=this.tuning.useManagedMediaSource?Ir():new MediaSource;let a=document.createElement("source");if(r(a),a.src=URL.createObjectURL(this.source),this.element.appendChild(a),this.tuning.useManagedMediaSource&&Mr())if(i){let e=document.createElement("source");r(e),e.type="application/x-mpegurl",e.src=i.url,this.element.appendChild(e)}else this.element.disableRemotePlayback=!0;this.isActiveLive$.next(this.isLive$.getValue());let s={fetcher:this.fetcher,tuning:this.tuning,getCurrentPosition:()=>this.element?1e3*this.element.currentTime:void 0,isActiveLowLatency:()=>this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),manifest:this.manifest},n=this.manifest.streams.video.reduce(((e,t)=>[...e,...t.representations]),[]);if(this.videoBufferManager=new Xs("video",this.source,n,s),this.bufferManagers=[this.videoBufferManager],(0,u.isNonNullable)(t)){let e=this.manifest.streams.audio.reduce(((e,t)=>[...e,...t.representations]),[]);this.audioBufferManager=new Xs("audio",this.source,e,s),this.bufferManagers.push(this.audioBufferManager)}pn.isSupported(this.manifest.streams.text)&&!this.isLowLatency$.getValue()&&(this.liveTextManager=new pn(this.manifest.streams.text,s)),this.representationSubscription.add(this.fetcher.lastConnectionType$.subscribe(this.lastConnectionType$)),this.representationSubscription.add(this.fetcher.lastConnectionReused$.subscribe(this.lastConnectionReused$)),this.representationSubscription.add(this.fetcher.lastRequestFirstBytes$.subscribe(this.lastRequestFirstBytes$));let o=()=>{this.stallWatchdogSubscription?.unsubscribe(),this.currentStallDuration$.next(0)};if(this.representationSubscription.add((0,u.merge)(...Sn.map((e=>(0,u.fromEvent)(this.element,e)))).pipe((0,u.map)((e=>this.element?za(this.element.buffered,1e3*this.element.currentTime):0)),(0,u.filterChanged)(),(0,u.tap)((e=>{e>this.tuning.dash.bufferEmptinessTolerance&&o()}))).subscribe(this.bufferLength$)),this.representationSubscription.add((0,u.merge)((0,u.fromEvent)(this.element,"ended"),this.forceEnded$).subscribe((()=>{o()}))),this.isLive$.getValue()){this.subscription.add(this.liveDuration$.pipe((0,u.filterChanged)()).subscribe((e=>this.liveStreamEndTimestamp=(0,u.now)()))),this.subscription.add((0,u.fromEvent)(this.element,"pause").subscribe((()=>{this.livePauseWatchdogSubscription=(0,u.interval)(1e3).subscribe((e=>{let t=nr(this.manifestUrlString,2);this.manifestUrlString=sr(this.manifestUrlString,t+1e3,2),"active"===this.liveStreamStatus$.getValue()&&this.updateManifest()})),this.subscription.add(this.livePauseWatchdogSubscription)}))).add((0,u.fromEvent)(this.element,"play").subscribe((e=>this.livePauseWatchdogSubscription?.unsubscribe()))),this.representationSubscription.add((0,u.combine)({isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).pipe((0,u.map)((({isActiveLive:e,isLowLatency:t})=>e&&t)),(0,u.filterChanged)()).subscribe((e=>{this.isManualDecreasePlaybackInLive()||hn(this.element,1)}))),this.representationSubscription.add((0,u.combine)({bufferLength:this.bufferLength$,isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).pipe((0,u.filter)((({bufferLength:e,isActiveLive:t,isLowLatency:i})=>t&&i&&!!e))).subscribe((({bufferLength:e})=>this.liveBuffer.next(e)))),this.representationSubscription.add(this.videoBufferManager.currentLowLatencySegmentLength$.subscribe((e=>{if(!this.isActiveLive$.getValue()&&!this.isLowLatency$.getValue()&&!e)return;let t=this.liveSeekableDuration$.getValue()-e/1e3;this.liveSeekableDuration$.next(Math.max(t,-1*this.tuning.dashCmafLive.maxLiveDuration)),this.liveDuration$.next(this.liveDuration$.getValue()+e/1e3)}))),this.representationSubscription.add((0,u.combine)({isLive:this.isLive$,rtt:this.throughputEstimator.rtt$,bufferLength:this.bufferLength$,segmentServerLatency:this.videoBufferManager.currentLiveSegmentServerLatency$}).pipe((0,u.filter)((({isLive:e})=>e)),(0,u.filterChanged)(((e,t)=>t.bufferLength<e.bufferLength)),(0,u.map)((({rtt:e,bufferLength:t,segmentServerLatency:i})=>(e/2+t+i+nr(this.manifestUrlString,2))/1e3))).subscribe(this.liveLatency$)),this.representationSubscription.add((0,u.combine)({liveBuffer:this.liveBuffer.smoothed$,isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).subscribe((({liveBuffer:e,isActiveLive:t,isLowLatency:i})=>{if(!i||!t)return;let r=this.tuning.dashCmafLive.lowLatency.maxTargetOffset,a=this.tuning.dashCmafLive.lowLatency.maxTargetOffsetDeviation,s=this.tuning.dashCmafLive.lowLatency.playbackCatchupSpeedup,n=e-r;if(this.isManualDecreasePlaybackInLive())return;let o=1;Math.abs(n)>a&&(o=1+Math.sign(n)*s),hn(this.element,o)}))),this.representationSubscription.add(this.bufferLength$.subscribe((e=>{let t=0;if(e){let e=1e3*(this.element?.currentTime??0);t=Math.min(...this.bufferManagers.map((t=>t.getLiveSegmentsToLoadState(this.manifest)?.to??e)))-e}this.liveLoadBufferLength$.getValue()!==t&&this.liveLoadBufferLength$.next(t)})));let e=0;this.representationSubscription.add((0,u.combine)({liveLoadBufferLength:this.liveLoadBufferLength$,bufferLength:this.bufferLength$}).pipe((0,u.throttle)(1e3)).subscribe((async({liveLoadBufferLength:t,bufferLength:i})=>{if(!this.element||this.isUpdatingLive)return;let r=this.element.playbackRate,a=nr(this.manifestUrlString,2),s=1e3*Math.abs(this.livePositionFromPlayer$.getValue()),n=Math.min(s,this.tuning.dashCmafLive.normalizedTargetMinBufferSize*r),o=this.tuning.dashCmafLive.normalizedActualBufferOffset*r,l=this.tuning.dashCmafLive.normalizedLiveMinBufferSize*r,u=isFinite(t)?t:i,d=this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),c=s<=this.tuning.live.activeLiveDelay;this.isActiveLive$.next(c);let h="none";if(d?h="active_low_latency":this.isLowLatency$.getValue()&&c?(this.bufferManagers.forEach((e=>e.proceedLowLatencyLive())),h="active_low_latency"):0!==a&&u<n?h="live_forward_buffering":u<n+l&&(h="live_with_target_offset"),isFinite(t)&&(e=t>e?t:e),"live_forward_buffering"===h||"live_with_target_offset"===h){let i=e-(n+o),s=this.normolizeLiveOffset(Math.trunc(a+i/r)),l=Math.abs(s-a),u=0;!t||l<=this.tuning.dashCmafLive.offsetCalculationError?u=a:s>0&&l>this.tuning.dashCmafLive.offsetCalculationError&&(u=s),this.manifestUrlString=sr(this.manifestUrlString,u,2)}("live_with_target_offset"===h||"live_forward_buffering"===h)&&(e=0,await this.updateLive())}),(e=>{this.error$.next({id:"updateLive",category:u.ErrorCategory.VIDEO_PIPELINE,thrown:e,message:"Failed to update live with subscription"})})))}let l=(0,u.merge)(...this.bufferManagers.map((e=>e.fullyBuffered$))).pipe((0,u.map)((()=>this.bufferManagers.every((e=>e.fullyBuffered$.getValue()))))),d=(0,u.merge)(...this.bufferManagers.map((e=>e.onLastSegment$))).pipe((0,u.map)((()=>this.bufferManagers.some((e=>e.onLastSegment$.getValue()))))),c=(0,u.combine)({allBuffersFull:l,someBufferEnded:d}).pipe((0,u.filterChanged)(),(0,u.map)((({allBuffersFull:e,someBufferEnded:t})=>e&&t)),(0,u.filter)((e=>e)));if(this.representationSubscription.add((0,u.merge)(this.forceEnded$,c).subscribe((()=>{if(this.source&&"open"===this.source.readyState&&Array.from(this.source.sourceBuffers).every((e=>!e.updating)))try{this.source?.endOfStream()}catch(e){this.error$.next({id:"EndOfStream",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Failed to end MediaSource stream",thrown:e})}}))),this.representationSubscription.add((0,u.merge)(...this.bufferManagers.map((e=>e.error$))).subscribe(this.error$)),this.representationSubscription.add(this.videoBufferManager.playingRepresentation$.subscribe(this.currentVideoRepresentation$)),this.representationSubscription.add(this.videoBufferManager.playingRepresentationInit$.subscribe(this.currentVideoRepresentationInit$)),this.representationSubscription.add(this.videoBufferManager.currentSegmentLength$.subscribe(this.currentVideoSegmentLength$)),this.audioBufferManager&&(this.representationSubscription.add(this.audioBufferManager.playingRepresentation$.subscribe(this.currentAudioRepresentation$)),this.representationSubscription.add(this.audioBufferManager.currentSegmentLength$.subscribe(this.currentAudioSegmentLength$))),this.liveTextManager&&this.representationSubscription.add(this.liveTextManager.currentRepresentation$.subscribe(this.currentLiveTextRepresentation$)),"open"!==this.source.readyState){let e=this.tuning.dash.sourceOpenTimeout>=0;yield new Promise((t=>{e&&(this.timeoutSourceOpenId=setTimeout((()=>{"open"!==this.source?.readyState?this.error$.next({id:"OpenOfStream",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Failed to open MediaSource",thrown:new Error("Timeout reject when wait sourceopen event"),traceAsLog:!0}):t()}),this.tuning.dash.sourceOpenTimeout)),this.source?.addEventListener("sourceopen",(()=>{this.timeoutSourceOpenId&&clearTimeout(this.timeoutSourceOpenId),t()}),{once:!0})}))}if(!this.isLive$.getValue()){let e=[this.manifest.duration??0,...(0,Za.default)((0,Za.default)([...this.manifest.streams.audio,...this.manifest.streams.video],(e=>e.representations)),(e=>{let t=[];return e.duration&&t.push(e.duration),Qs(e.segmentReference)&&e.segmentReference.totalSegmentsDurationMs&&t.push(e.segmentReference.totalSegmentsDurationMs),t}))];this.source.duration=Math.max(...e)/1e3}this.audioBufferManager&&(0,u.isNonNullable)(t)?yield Promise.all([this.videoBufferManager.startWith(e),this.audioBufferManager.startWith(t)]):yield this.videoBufferManager.startWith(e),this.state$.setState("representations_ready"),this.tracer.log("initRepresentationsEnd")}.bind(this)),this.tick=()=>{if(!this.element||!this.videoBufferManager||"open"!==this.source?.readyState)return;let e=1e3*this.element.currentTime;this.videoBufferManager.maintain(e),this.audioBufferManager?.maintain(e),this.liveTextManager?.maintain(e),(this.videoBufferManager.gaps.length||this.audioBufferManager?.gaps.length)&&!this.gapWatchdogActive&&(this.gapWatchdogActive=!0,this.gapWatchdogSubscription=(0,u.interval)(this.tuning.gapWatchdogInterval).subscribe((()=>this.jumpGap()),(e=>{this.error$.next({id:"GapWatchdog",category:u.ErrorCategory.WTF,message:"Error handling gaps",thrown:e})})),this.subscription.add(this.gapWatchdogSubscription))},this.throughputEstimator=e.throughputEstimator,this.tuning=e.tuning,this.tracer=e.tracer.createComponentTracer(this.constructor.name),this.fetcher=new rn({throughputEstimator:this.throughputEstimator,requestQuic:this.tuning.requestQuick,compatibilityMode:e.compatibilityMode,tracer:this.tracer,useEnableSubtitlesParam:e.tuning.useEnableSubtitlesParam}),this.subscription.add(this.fetcher.recoverableError$.subscribe(this.fetcherRecoverableError$)),this.subscription.add(this.fetcher.error$.subscribe(this.fetcherError$)),this.liveBuffer=cn.getLiveBufferSmoothedValue(this.tuning.dashCmafLive.lowLatency.maxTargetOffset,{...e.tuning.dashCmafLive.lowLatency.bufferEstimator}),this.initTracerSubscription()}},$n=class{constructor(e,t){this.fov=e,this.orientation=t}},_n=class{turnCamera(e=0,t=0,i=0){this.pointCameraTo(this.camera.orientation.x+e,this.camera.orientation.y+t,this.camera.orientation.z+i)}pointCameraTo(e=0,t=0,i=0){t=this.limitCameraRotationY(t);let r=e-this.camera.orientation.x,a=t-this.camera.orientation.y,s=i-this.camera.orientation.z;this.camera.orientation.x=e,this.camera.orientation.y=t,this.camera.orientation.z=i,this.lastCameraTurn={x:r,y:a,z:s},this.lastCameraTurnTS=Date.now()}setRotationSpeed(e,t,i){this.rotationSpeed.x=e??this.rotationSpeed.x,this.rotationSpeed.y=t??this.rotationSpeed.y,this.rotationSpeed.z=i??this.rotationSpeed.z}startRotation(){this.rotating=!0}stopRotation(e=!1){e?(this.setRotationSpeed(0,0,0),this.fadeStartSpeed=null):this.startFading(this.rotationSpeed.x,this.rotationSpeed.y,this.rotationSpeed.z),this.rotating=!1}onCameraRelease(){if(this.lastCameraTurn&&this.lastCameraTurnTS){let e=Date.now()-this.lastCameraTurnTS;if(e<this.options.speedFadeThreshold){let t=(1-e/this.options.speedFadeThreshold)*this.options.rotationSpeedCorrection;this.startFading(this.lastCameraTurn.x*t,this.lastCameraTurn.y*t,this.lastCameraTurn.z*t)}}}startFading(e,t,i){this.setRotationSpeed(e,t,i),this.fadeStartSpeed={...this.rotationSpeed},this.fading=!0}stopFading(){this.fadeStartSpeed=null,this.fading=!0,this.fadeTime=0}limitCameraRotationY(e){return Math.max(-this.options.maxYawAngle,Math.min(e,this.options.maxYawAngle))}tick(e){if(!this.lastTickTS)return this.lastTickTS=e,void(this.lastCameraTurnTS=Date.now());let t=e-this.lastTickTS,i=t/1e3;if(this.rotating)this.turnCamera(this.rotationSpeed.x*this.options.rotationSpeedCorrection*i,this.rotationSpeed.y*this.options.rotationSpeedCorrection*i,this.rotationSpeed.z*this.options.rotationSpeedCorrection*i);else if(this.fading&&this.fadeStartSpeed){let e=-this.fadeCorrection*(this.fadeTime/1e3)**2+1;this.setRotationSpeed(this.fadeStartSpeed.x*e,this.fadeStartSpeed.y*e,this.fadeStartSpeed.z*e),e>0?this.turnCamera(this.rotationSpeed.x*this.options.rotationSpeedCorrection*i,this.rotationSpeed.y*this.options.rotationSpeedCorrection*i,this.rotationSpeed.z*this.options.rotationSpeedCorrection*i):(this.stopRotation(!0),this.stopFading()),this.fadeTime=Math.min(this.fadeTime+t,this.options.speedFadeTime)}this.lastTickTS=e}constructor(e,t){this.rotating=!1,this.fading=!1,this.lastTickTS=0,this.lastCameraTurnTS=0,this.fadeStartSpeed=null,this.fadeTime=0,this.camera=e,this.options=t,this.rotationSpeed={x:0,y:0,z:0},this.fadeCorrection=1/(this.options.speedFadeTime/1e3)**2}},kn=class{play(){this.active||(this.videoInitialized?this.doPlay():this.sourceVideoElement.readyState>=2?(this.videoInitialized=!0,this.doPlay()):this.sourceVideoElement.addEventListener("loadeddata",this.videoElementDataLoadedFn))}stop(){this.active=!1}startCameraManualRotation(e,t){this.cameraRotationManager.setRotationSpeed(e*this.params.rotationSpeed,t*this.params.rotationSpeed,0),this.cameraRotationManager.startRotation()}stopCameraManualRotation(e=!1){this.cameraRotationManager.stopRotation(e)}turnCamera(e,t){this.cameraRotationManager.turnCamera(e,t)}pointCameraTo(e,t){this.cameraRotationManager.pointCameraTo(e,t)}pixelToDegree(e){return{x:this.params.degreeToPixelCorrection*this.params.fov.x*-e.x/this.viewportWidth,y:this.params.degreeToPixelCorrection*this.params.fov.y*e.y/this.viewportHeight}}getCameraRotation(){return this.camera.orientation}holdCamera(){this.cameraRotationManager.stopRotation(!0)}releaseCamera(){this.cameraRotationManager.onCameraRelease()}destroy(){this.sourceVideoElement.removeEventListener("loadeddata",this.videoElementDataLoadedFn),this.stop(),this.canvas.remove()}setViewportSize(e,t){this.viewportWidth=e,this.viewportHeight=t,this.canvas.width=this.viewportWidth,this.canvas.height=this.viewportHeight,this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}onDataLoadedHandler(){this.videoInitialized=!0,this.doPlay()}doPlay(){this.updateFrameSize(),this.vertexBuffer=this.createVertexBuffer(),this.active=!0,this.sourceVideoElement.removeEventListener("loadeddata",this.videoElementDataLoadedFn),requestAnimationFrame(this.renderFn)}render(e){this.cameraRotationManager.tick(e),this.updateTexture(),this.updateTextureMappingBuffer();let t=this.gl.getAttribLocation(this.program,"a_vertex"),i=this.gl.getAttribLocation(this.program,"a_texel"),r=this.gl.getUniformLocation(this.program,"u_texture"),a=this.gl.getUniformLocation(this.program,"u_focus");this.gl.enableVertexAttribArray(t),this.gl.enableVertexAttribArray(i),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.vertexAttribPointer(t,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.textureMappingBuffer),this.gl.vertexAttribPointer(i,2,this.gl.FLOAT,!1,0,0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.videoTexture),this.gl.uniform1i(r,0),this.gl.uniform2f(a,-this.camera.orientation.x,-this.camera.orientation.y),this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,4),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.disableVertexAttribArray(t),this.gl.disableVertexAttribArray(i),this.active&&requestAnimationFrame(this.renderFn)}createShader(e,t){let i=this.gl.createShader(t);if(!i)throw this.destroy(),new Error(`Could not create shader (${t})`);if(this.gl.shaderSource(i,e),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))throw this.destroy(),new Error("An error occurred while compiling the shader: "+this.gl.getShaderInfoLog(i));return i}createProgram(){let e=this.gl.createProgram();if(!e)throw this.destroy(),new Error("Could not create shader program");let t=this.createShader("attribute vec2 a_vertex;\nattribute vec2 a_texel;\n\nvarying vec2 v_texel;\n\nvoid main(void) {\n    // direct vertex drawing\n    gl_Position = vec4(a_vertex, 0.0, 1.0);\n    // save texel vector to pass to fragment shader\n    v_texel = a_texel;\n}\n",this.gl.VERTEX_SHADER),i=this.createShader("#ifdef GL_ES\n    precision highp float;\n    precision highp int;\n#else\n    precision highp float;\n#endif\n\n#define PI 3.14159265358979323846264\n\nvarying vec2 v_texel; // [0..1, 0..1]\n\nuniform sampler2D u_texture;\nuniform vec2 u_focus; // current central point [-180..180, -90..90] (degrees)\n\nvoid main(void) {\n    // center point of output projection\n    float lambda0 = u_focus.x / 360.0;\n    float phi0 = u_focus.y / 180.0;\n\n    float lambda = PI * 2.0 * (v_texel.x - 0.5 - lambda0); // [-pi..+pi] (rad)\n    float phi = PI * (v_texel.y - 0.5 - phi0); // [-pi/2..+pi/2] (rad)\n\n    float p = sqrt(lambda * lambda + phi * phi); // rou\n    float c = atan(p);\n    float cos_c = cos(c);\n    float sin_c = sin(c);\n\n    // geo coordinates of projection\n    float x = lambda0 + atan(\n        lambda * sin_c,\n        p * cos(phi0) * cos_c - phi * sin(phi0) * sin_c\n    );\n    float y = asin(cos_c * sin(phi0) + (phi * sin_c * cos(phi0)) / p);\n\n    // reprojected texture coordinates\n    vec2 tc = vec2(\n        mod(x / (PI * 2.0) - 0.5, 1.0), // [0..1]\n        mod(y / PI - 0.5, 1.0) // [0..1]\n    );\n\n    // sample using new coordinates\n    gl_FragColor = texture2D(u_texture, tc);\n}\n",this.gl.FRAGMENT_SHADER);if(this.gl.attachShader(e,t),this.gl.attachShader(e,i),this.gl.linkProgram(e),!this.gl.getProgramParameter(e,this.gl.LINK_STATUS))throw this.destroy(),new Error("Could not link shader program.");return e}createTexture(){let e=this.gl.createTexture();if(!e)throw this.destroy(),new Error("Could not create texture");return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.bindTexture(this.gl.TEXTURE_2D,null),e}updateTexture(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.videoTexture),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.sourceVideoElement),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}createVertexBuffer(){let e=this.gl.createBuffer();if(!e)throw this.destroy(),new Error("Could not create vertex buffer");let t=1,i=1,r=this.frameHeight/(this.frameWidth/this.viewportWidth);return r>this.viewportHeight?t=this.viewportHeight/r:i=r/this.viewportHeight,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-t,-i,t,-i,t,i,-t,i]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),e}createTextureMappingBuffer(){let e=this.gl.createBuffer();if(!e)throw this.destroy(),new Error("Could not create texture mapping buffer");return e}calculateTexturePosition(){let e=.5-this.camera.orientation.x/360,t=.5-this.camera.orientation.y/180,i=this.camera.fov.x/360/2,r=this.camera.fov.y/180/2;return[e-i,t-r,e+i,t-r,e+i,t+r,e-i,t+r]}updateTextureMappingBuffer(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.textureMappingBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([...this.calculateTexturePosition()]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}updateFrameSize(){this.frameWidth=this.sourceVideoElement.videoWidth,this.frameHeight=this.sourceVideoElement.videoHeight}createCanvas(){let e=document.createElement("canvas");return e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.width="100%",e.style.height="100%",e}constructor(e,t,i){this.videoInitialized=!1,this.active=!1,this.container=e,this.sourceVideoElement=t,this.params=i,this.canvas=this.createCanvas();let r=this.canvas.getContext("webgl");if(!r)throw new Error("Could not initialize WebGL context");this.gl=r,this.container.appendChild(this.canvas),this.camera=new $n(this.params.fov,this.params.orientation),this.cameraRotationManager=new _n(this.camera,{rotationSpeed:this.params.rotationSpeed,maxYawAngle:this.params.maxYawAngle,rotationSpeedCorrection:this.params.rotationSpeedCorrection,degreeToPixelCorrection:this.params.degreeToPixelCorrection,speedFadeTime:this.params.speedFadeTime,speedFadeThreshold:this.params.speedFadeThreshold}),this.updateFrameSize(),this.vertexBuffer=this.createVertexBuffer(),this.textureMappingBuffer=this.createTextureMappingBuffer(),this.updateTextureMappingBuffer(),this.program=this.createProgram(),this.videoTexture=this.createTexture(),this.gl.useProgram(this.program),this.videoElementDataLoadedFn=this.onDataLoadedHandler.bind(this),this.renderFn=this.render.bind(this)}},Tn="stalls_manager_metrics",Cn="stalls_manager_abr_params",En=class{connect(e){this.currentStallDuration$=e.currentStallDuration$,this.videoLastDataObtainedTimestamp$=e.videoLastDataObtainedTimestamp$,this.throughput$=e.throughput$,this.rtt$=e.rtt$,this.tuning=e.tuning,this.abrParams=e.abrParams,this.subscribe(e)}get videoMaxQualityLimit(){return this.maxQualityLimit}get predictedThroughput(){return this.predictedThroughputWithoutData}get abrTuningParams(){return{...this.abrParams,...this.getStoredData(Cn)}}set lastVideoTrackSelected(e){this.lastUniqueVideoTrackSelected?.id!==e.id&&(this.lastUniqueVideoTrackSelected=e,this.lastUniqueVideoTrackSelectedTimestamp=(0,u.now)(),this.currentStallsCount=0)}destroy(){window.clearTimeout(this.qualityRestrictionTimer),this.subscription.unsubscribe(),0!==this.currentStallDuration$.getValue()&&this.updateStallData();let e=((0,u.now)()-this.providerStartWatchingTimestamp-this.sumStallsDuration)/1e3,t=this.sumStallsDuration;this.addStallInfoToHistory(e,t),this.updateStoredAbrParams()}updateStoredAbrParams(){let e=[],t=this.getStoredData(Tn,"[]");if(t.length<this.tuning.stallsMetricsHistoryLength)return;if(this.tuning.useTotalStallsDurationPerTvt){let i=t.reduce(((e,t)=>e+t.tvt),0),r=t.reduce(((e,t)=>e+t.stallsDuration),0)/i;e.push(this.calculateOptimalAbrParams(r))}if(this.tuning.useAverageStallsDurationPerTvt){let i=t.reduce(((e,t)=>e+t.stallsDurationPerTvt),0)/t.length;e.push(this.calculateOptimalAbrParams(i))}this.tuning.useEmaStallsDurationPerTvt&&e.push(this.calculateOptimalAbrParams(t[t.length-1].stallsDurationPerTvtSmoothed));let i={bitrateFactorAtEmptyBuffer:Math.max(...e.map((e=>e.bitrateFactorAtEmptyBuffer))),bitrateFactorAtFullBuffer:Math.max(...e.map((e=>e.bitrateFactorAtFullBuffer))),containerSizeFactor:Math.min(...e.map((e=>e.containerSizeFactor)))};this.setStoredData(Tn,[]),this.setStoredData(Cn,i)}calculateOptimalAbrParams(e){let{targetStallsDurationPerTvt:t,deviationStallsDurationPerTvt:i,criticalStallsDurationPerTvt:r,abrAdjustingSpeed:a}=this.tuning,s=this.abrTuningParams;return e<t-i?s={bitrateFactorAtEmptyBuffer:Math.max(s.bitrateFactorAtEmptyBuffer-a,this.abrParams.minBitrateFactorAtEmptyBuffer),bitrateFactorAtFullBuffer:Math.max(s.bitrateFactorAtFullBuffer-a,this.abrParams.minBitrateFactorAtFullBuffer),containerSizeFactor:Math.min(s.containerSizeFactor+a,this.abrParams.maxContainerSizeFactor)}:e>t+i&&(s={bitrateFactorAtEmptyBuffer:Math.min(s.bitrateFactorAtEmptyBuffer+a,this.abrParams.maxBitrateFactorAtEmptyBuffer),bitrateFactorAtFullBuffer:Math.min(s.bitrateFactorAtFullBuffer+a,this.abrParams.maxBitrateFactorAtFullBuffer),containerSizeFactor:Math.max(s.containerSizeFactor-a,this.abrParams.minContainerSizeFactor)}),e>r&&(s={bitrateFactorAtEmptyBuffer:Math.max(s.bitrateFactorAtEmptyBuffer,this.abrParams.bitrateFactorAtEmptyBuffer),bitrateFactorAtFullBuffer:Math.max(s.bitrateFactorAtFullBuffer,this.abrParams.bitrateFactorAtFullBuffer),containerSizeFactor:Math.min(s.containerSizeFactor,this.abrParams.containerSizeFactor)}),s}getStoredData(e,t="{}"){return JSON.parse(u.safeStorage.get(e)??t)}setStoredData(e,t){u.safeStorage.set(e,JSON.stringify(t))}addStallInfoToHistory(e,t){if(e<this.tuning.minTvtToBeCounted||e>this.tuning.maxTvtToBeCounted||1e3*e<t)return;let i=this.getStoredData(Tn,"[]"),r=t/e,a={tvt:e,stallsDuration:t,stallsDurationPerTvt:r,stallsDurationPerTvtSmoothed:i.length?sn(i[i.length-1].stallsDurationPerTvtSmoothed,t/e,this.tuning.emaAlpha):r};i.push(a),i.length>this.tuning.stallsMetricsHistoryLength&&i.shift(),this.setStoredData(Tn,i)}updateStallData(){this.providerStartWatchingTimestamp&&!this.isSeeked$.getValue()&&(this.sumStallsDuration+=Math.min(this.lastStallDuration,this.tuning.maxPossibleStallDuration),this.currentStallsCount++)}subscribe(e){this.subscription.add(e.isSeeked$.subscribe(this.isSeeked$)),this.subscription.add(e.isBuffering$.subscribe(this.isBuffering$)),this.subscription.add(e.looped$.subscribe((e=>this.currentStallsCount=0))),this.subscription.add(e.playing$.pipe((0,u.once)()).subscribe((e=>this.providerStartWatchingTimestamp=(0,u.now)()))),this.subscription.add(this.currentStallDuration$.pipe((0,u.filterChanged)()).subscribe((e=>{let{stallDurationNoDataBeforeQualityDecrease:t,stallCountBeforeQualityDecrease:i,resetQualityRestrictionTimeout:r,ignoreStallsOnSeek:a}=this.tuning;if((0,u.isNullable)(this.lastUniqueVideoTrackSelected)||a&&this.isSeeked$.getValue())return;let s=this.rtt$.getValue(),n=this.throughput$.getValue(),o=this.videoLastDataObtainedTimestamp$.getValue(),l=(0,u.now)(),d=i&&this.currentStallsCount>=i,c=t&&l-this.lastUniqueVideoTrackSelectedTimestamp>=t+s&&l-o>=t+s&&e>=t;(d||c)&&(this.severeStallOccurred$.next(!0),window.clearTimeout(this.qualityRestrictionTimer),this.maxQualityLimit=this.lastUniqueVideoTrackSelected.quality,(0,u.isNonNullable)(this.lastUniqueVideoTrackSelected.bitrate)&&n>this.lastUniqueVideoTrackSelected.bitrate&&(this.predictedThroughputWithoutData=this.lastUniqueVideoTrackSelected.bitrate)),!e&&(0,u.now)()-this.providerStartWatchingTimestamp>this.lastStallDuration&&(this.updateStallData(),this.severeStallOccurred$.next(!1),window.clearTimeout(this.qualityRestrictionTimer),this.qualityRestrictionTimer=window.setTimeout((()=>{this.maxQualityLimit=void 0,this.predictedThroughputWithoutData=0}),r)),this.lastStallDuration=e})))}constructor(){this.isSeeked$=new u.ValueSubject(!1),this.isBuffering$=new u.ValueSubject(!1),this.maxQualityLimit=void 0,this.currentStallsCount=0,this.sumStallsDuration=0,this.lastStallDuration=0,this.providerStartWatchingTimestamp=0,this.lastUniqueVideoTrackSelectedTimestamp=0,this.predictedThroughputWithoutData=0,this.subscription=new u.Subscription,this.severeStallOccurred$=new u.ValueSubject(!1)}},An=class{connect({observableVideo:e,video:t}){let i=e=>{let t=e.target;this.pipSize$.next({width:t.width,height:t.height})};this.subscription.add((0,u.observeElementSize)(t).subscribe(this.videoSize$)).add(e.enterPip$.subscribe((({pictureInPictureWindow:e})=>{this.pipSize$.next({width:e.width,height:e.height}),e.addEventListener("resize",i),this.pictureInPictureWindowRemoveEventListener=()=>{e.removeEventListener("resize",i)}}))).add(e.leavePip$.subscribe((()=>{this.pictureInPictureWindowRemoveEventListener()}))).add((0,u.combine)({videoSize:this.videoSize$,pipSize:this.pipSize$,inPip:e.inPiP$}).pipe((0,u.map)((({videoSize:e,inPip:t,pipSize:i})=>t?i:e))).subscribe(this.elementSize$))}getValue(){return this.elementSize$.getValue()}subscribe(e,t){return this.elementSize$.subscribe(e,t)}getObservable(){return this.elementSize$}destroy(){this.pictureInPictureWindowRemoveEventListener(),this.subscription.unsubscribe()}constructor(){this.subscription=new u.Subscription,this.pipSize$=new u.ValueSubject(void 0),this.videoSize$=new u.ValueSubject(void 0),this.elementSize$=new u.ValueSubject(void 0),this.pictureInPictureWindowRemoveEventListener=u.noop}},Ln=class{getProviderSubscriptionInfo(){let{output:e,desiredState:t}=this.params,i=jr(this.video);this.subscription.add((()=>i.destroy()));let r=this.constructor.name,a=t=>{e.error$.next({id:r,category:u.ErrorCategory.WTF,message:`${r} internal logic error`,thrown:t})};return{output:e,desiredState:t,observableVideo:i,genericErrorListener:a,connect:(e,t)=>this.subscription.add(e.subscribe(t,a))}}subscribe(){let{output:e,desiredState:t,observableVideo:i,genericErrorListener:r,connect:a}=this.getProviderSubscriptionInfo();this.subscription.add(this.params.output.availableVideoTracks$.pipe((0,u.filter)((e=>!!e.length)),(0,u.once)()).subscribe((e=>{this.droppedFramesManager.connect({logger:this.params.dependencies.logger,video:this.video,droppedFramesChecker:this.params.tuning.droppedFramesChecker,isAuto:this.params.desiredState.autoVideoTrackSwitching,playing$:i.playing$,pause$:i.pause$,tracks:e})})));let s=this.params.desiredState.seekState.stateChangeEnded$.pipe((0,u.map)((e=>"none"!==e.to.state)),(0,u.filterChanged)());this.stallsManager.connect({isSeeked$:s,currentStallDuration$:this.player.currentStallDuration$,videoLastDataObtainedTimestamp$:this.player.videoLastDataObtainedTimestamp$,throughput$:this.params.dependencies.throughputEstimator.throughput$,rtt$:this.params.dependencies.throughputEstimator.rtt$,tuning:this.params.tuning.stallsManager,abrParams:this.params.tuning.autoTrackSelection,isBuffering$:i.isBuffering$,looped$:i.looped$,playing$:i.playing$}),a(i.ended$,e.endedEvent$),a(i.looped$,e.loopedEvent$),a(i.error$,e.error$),a(i.isBuffering$,e.isBuffering$),a(i.currentBuffer$,e.currentBuffer$),a(i.playing$,e.firstFrameEvent$),a(i.canplay$,e.canplay$),a(i.inPiP$,e.inPiP$),a(i.inFullscreen$,e.inFullscreen$),a(i.loadedMetadata$,e.loadedMetadataEvent$),a(this.player.error$,e.error$),a(this.player.fetcherRecoverableError$,e.fetcherRecoverableError$),a(this.player.fetcherError$,e.fetcherError$),a(this.player.lastConnectionType$,e.httpConnectionType$),a(this.player.lastConnectionReused$,e.httpConnectionReused$),a(this.player.isLive$,e.isLive$),a(this.player.lastRequestFirstBytes$.pipe((0,u.filter)(u.isNonNullable),(0,u.once)()),e.firstBytesEvent$),a(this.stallsManager.severeStallOccurred$,e.severeStallOccurred$),a(this.videoState.stateChangeEnded$.pipe((0,u.map)((e=>e.to))),this.params.output.playbackState$),this.subscription.add(i.looped$.subscribe((()=>this.player.warmUpMediaSourceIfNeeded()),r)),this.subscription.add(i.seeked$.subscribe(e.seekedEvent$,r)),this.subscription.add(gr(this.video,t.isLooped,r)),this.subscription.add(br(this.video,t.volume,i.volumeState$,r)),this.subscription.add(i.volumeState$.subscribe(this.params.output.volume$,r)),this.subscription.add(yr(this.video,t.playbackRate,i.playbackRateState$,r)),this.elementSizeManager.connect({video:this.video,observableVideo:i}),a(Ba(this.video,{threshold:this.params.tuning.autoTrackSelection.activeVideoAreaThreshold}),e.elementVisible$),this.subscription.add(i.playing$.subscribe((()=>{this.videoState.setState("playing"),or(t.playbackState,"playing"),this.scene3D&&this.scene3D.play()}),r)).add(i.pause$.subscribe((()=>{this.videoState.setState("paused"),or(t.playbackState,"paused")}),r)).add(i.canplay$.subscribe((()=>{"playing"===this.videoState.getState()&&this.playIfAllowed()}),r)),this.subscription.add(this.player.state$.stateChangeEnded$.subscribe((({to:e})=>{if("manifest_ready"===e){this.videoTracksMap=new Map,this.audioTracksMap=new Map,this.textTracksMap=new Map;let e=this.player.getStreams();if((0,u.assertNonNullable)(e,"Manifest not loaded or empty"),!this.params.tuning.isAudioDisabled){let t=[];for(let i of e.audio){t.push(qs(i));let e=[];for(let t of i.representations){let r=zs(t);e.push(r),this.audioTracksMap.set(r,{stream:i,representation:t})}this.audioStreamsMap.set(i,e)}this.params.output.availableAudioStreams$.next(t)}let t=[];for(let i of e.video){t.push(Hs(i));let e=[];for(let t of i.representations){let r=js({...t,streamId:i.id});r&&(e.push(r),this.videoTracksMap.set(r,{stream:i,representation:t}))}this.videoStreamsMap.set(i,e)}this.params.output.availableVideoStreams$.next(t);for(let t of e.text)for(let e of t.representations){let i=Us(t,e);this.textTracksMap.set(i,{stream:t,representation:e})}this.params.output.availableVideoTracks$.next(Array.from(this.videoTracksMap.keys())),this.params.output.availableAudioTracks$.next(Array.from(this.audioTracksMap.keys())),this.params.output.isAudioAvailable$.next(!!this.audioTracksMap.size),this.audioTracksMap.size&&this.textTracksMap.size&&this.params.desiredState.internalTextTracks.startTransitionTo(Array.from(this.textTracksMap.keys()))}else"representations_ready"===e&&(this.videoState.setState("ready"),this.player.initBuffer())}),r)),this.subscription.add((0,u.merge)(this.player.currentStallDuration$,this.player.state$.stateChangeEnded$,t.videoTrack.stateChangeStarted$,t.autoVideoTrackSwitching.transitionStarted$,this.params.dependencies.throughputEstimator.rttAdjustedThroughput$,t.autoVideoTrackLimits.stateChangeStarted$,this.elementSizeManager.getObservable(),this.params.output.elementVisible$,this.droppedFramesManager.onDroopedVideoFramesLimit$,(0,u.fromEvent)(this.video,"progress")).pipe((0,u.filter)((()=>this.videoTracksMap.size>0))).subscribe((async()=>{let e=this.player.state$.getState(),i=this.player.state$.getTransition();if(!(0,ja.default)(["manifest_ready","running"],e)||i)return;t.autoVideoTrackSwitching.getTransition()&&t.autoVideoTrackSwitching.setState(t.autoVideoTrackSwitching.getState());let r=this.selectVideoAudioRepresentations();if(!r)return;let[a,s]=r,n=[...this.videoTracksMap.keys()].find((e=>this.videoTracksMap.get(e)?.representation.id===a.id));(0,u.isNonNullable)(n)&&(this.stallsManager.lastVideoTrackSelected=n);let o=this.params.desiredState.autoVideoTrackLimits.getTransition();if(o&&this.params.output.autoVideoTrackLimits$.next(o.to),"manifest_ready"===e)await this.player.initRepresentations(a.id,s?.id,this.params.sourceHls);else if(await this.player.switchRepresentation("video",a.id),s){let e=!!t.audioStream.getTransition();await this.player.switchRepresentation("audio",s.id,e)}}),r)),this.subscription.add(t.cameraOrientation.stateChangeEnded$.subscribe((({to:e})=>{this.scene3D&&e&&this.scene3D.pointCameraTo(e.x,e.y)}))),this.subscription.add(this.elementSizeManager.subscribe((e=>{this.scene3D&&e&&this.scene3D.setViewportSize(e.width,e.height)}))),this.subscription.add(this.player.currentVideoRepresentation$.pipe((0,u.filterChanged)()).subscribe((t=>{let i=[...this.videoTracksMap.entries()].find((([,{representation:e}])=>e.id===t));if(!i)return e.currentVideoTrack$.next(void 0),void e.currentVideoStream$.next(void 0);let[r,{stream:a}]=i,s=this.params.desiredState.videoStream.getTransition();s&&s.to&&s.to.id===a.id&&this.params.desiredState.videoStream.setState(s.to),e.currentVideoTrack$.next(r),e.currentVideoStream$.next(Hs(a))}),r)),this.subscription.add(this.player.currentAudioRepresentation$.pipe((0,u.filterChanged)()).subscribe((t=>{let i=[...this.audioTracksMap.entries()].find((([,{representation:e}])=>e.id===t));if(!i)return void e.currentAudioStream$.next(void 0);let[r,{stream:a}]=i,s=this.params.desiredState.audioStream.getTransition();s&&s.to&&s.to.id===a.id&&this.params.desiredState.audioStream.setState(s.to),e.currentAudioStream$.next(qs(a))}),r)),this.subscription.add(this.player.currentVideoRepresentationInit$.subscribe((t=>{if(t?.is3dVideo&&this.params.tuning.spherical?.enabled)try{this.init3DScene(t),e.is3DVideo$.next(!0)}catch(t){e.warning$.next({id:"DashProvider",message:`DashProvider could not initialize 3D-scene: ${t}`})}else this.destroy3DScene(),this.params.tuning.spherical?.enabled&&e.is3DVideo$.next(!1)}),r)),this.subscription.add(this.player.currentVideoSegmentLength$.subscribe(e.currentVideoSegmentLength$,r)),this.subscription.add(this.player.currentAudioSegmentLength$.subscribe(e.currentAudioSegmentLength$,r)),this.textTracksManager.connect(this.video,t,e);let n=t.playbackState.stateChangeStarted$.pipe((0,u.map)((({to:e})=>"ready"===e)),(0,u.filterChanged)());this.subscription.add((0,u.merge)(n,t.autoVideoTrackSwitching.stateChangeStarted$,this.player.state$.stateChangeEnded$,(0,u.observableFrom)(["init"])).subscribe((()=>{let e=t.autoVideoTrackSwitching.getState(),i="ready"===t.playbackState.getState()?this.params.tuning.dash.forwardBufferTargetPreload:e?this.params.tuning.dash.forwardBufferTargetAuto:this.params.tuning.dash.forwardBufferTargetManual;this.player.setBufferTarget(i)}))),this.subscription.add((0,u.merge)(n,this.player.state$.stateChangeEnded$,(0,u.observableFrom)(["init"])).subscribe((()=>this.player.setPreloadOnly("ready"===t.playbackState.getState()))));let o=(0,u.merge)(t.playbackState.stateChangeStarted$,t.videoTrack.stateChangeStarted$,t.seekState.stateChangeEnded$,this.videoState.stateChangeEnded$,(0,u.observableFrom)(["init"])).pipe((0,u.debounce)(0));this.subscription.add(o.subscribe(this.syncPlayback,r))}selectVideoAudioRepresentations(){if(this.player.isStreamEnded)return;let e=this.params.tuning.useNewAutoSelectVideoTrack?da:ua,t=this.params.tuning.useNewAutoSelectVideoTrack?ba:ga,i=this.params.tuning.useNewAutoSelectVideoTrack?ma:va,{desiredState:r,output:a}=this.params,s=r.autoVideoTrackSwitching.getState(),n=r.videoTrack.getState()?.id,o=[...this.videoTracksMap.keys()].find((({id:e})=>e===n)),l=a.currentVideoTrack$.getValue(),u=r.videoStream.getState()??(o&&this.videoTracksMap.get(o)?.stream)??1===this.videoStreamsMap.size?this.videoStreamsMap.keys().next().value:void 0;if(!u)return;let d=[...this.videoStreamsMap.keys()].find((({id:e})=>e===u.id)),c=d&&this.videoStreamsMap.get(d);if(!c)return;let h,p=za(this.video.buffered,1e3*this.video.currentTime);h=this.player.isActiveLive$.getValue()?this.player.isLowLatency$.getValue()?this.params.tuning.dashCmafLive.lowLatency.maxTargetOffset:this.params.tuning.dashCmafLive.normalizedLiveMinBufferSize:this.player.isLive$.getValue()?this.params.tuning.dashCmafLive.normalizedTargetMinBufferSize:s?this.params.tuning.dash.forwardBufferTargetAuto:this.params.tuning.dash.forwardBufferTargetManual;let f=(1e3*this.video.duration||1/0)-1e3*this.video.currentTime,m=Math.min(p/Math.min(h,f||1/0),1),v=r.audioStream.getState()??(1===this.audioStreamsMap.size?this.audioStreamsMap.keys().next().value:void 0),g=[...this.audioStreamsMap.keys()].find((({id:e})=>e===v?.id))??this.audioStreamsMap.keys().next().value,b=0;if(g){if(o&&!s){let t=e(o,c,this.audioStreamsMap.get(g)??[],this.params.tuning.autoTrackSelection.minVideoAudioRatio);b=Math.max(b,t?.bitrate??-1/0)}if(l){let t=e(l,c,this.audioStreamsMap.get(g)??[],this.params.tuning.autoTrackSelection.minVideoAudioRatio);b=Math.max(b,t?.bitrate??-1/0)}}let y=i(c,{container:this.elementSizeManager.getValue(),panelSize:this.params.panelSize,estimatedThroughput:this.params.dependencies.throughputEstimator.rttAdjustedThroughput$.getValue(),tuning:this.stallsManager.abrTuningParams,limits:this.params.desiredState.autoVideoTrackLimits.getState(),reserve:b,forwardBufferHealth:m,current:l,visible:this.params.output.elementVisible$.getValue(),history:this.videoTrackSwitchHistory,playbackRate:this.video.playbackRate,droppedVideoMaxQualityLimit:this.droppedFramesManager.droppedVideoMaxQualityLimit,stallsVideoMaxQualityLimit:this.stallsManager.videoMaxQualityLimit,stallsPredictedThroughput:this.stallsManager.predictedThroughput,abrLogger:this.params.dependencies.abrLogger}),w=s?y??o:o??y,S=g&&t(w,c,this.audioStreamsMap.get(g)??[],{estimatedThroughput:this.params.dependencies.throughputEstimator.rttAdjustedThroughput$.getValue(),stallsPredictedThroughput:this.stallsManager.predictedThroughput,tuning:this.stallsManager.abrTuningParams,forwardBufferHealth:m,history:this.audioTrackSwitchHistory,playbackRate:this.video.playbackRate,abrLogger:this.params.dependencies.abrLogger}),x=this.videoTracksMap.get(w)?.representation,$=S&&this.audioTracksMap.get(S)?.representation;return x&&$?[x,$]:x&&!$&&0===this.audioTracksMap.size?[x,void 0]:void 0}prepare(e=0){this.player.initManifest(this.video,this.params.source.url,e)}playIfAllowed(){$a(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:u.ErrorCategory.DOM,thrown:e})))}destroy(){this.subscription.unsubscribe(),this.droppedFramesManager.destroy(),this.stallsManager.destroy(),this.elementSizeManager.destroy(),this.destroy3DScene(),this.textTracksManager.destroy(),this.player.destroy(),this.params.output.element$.next(void 0),this.params.output.currentVideoStream$.next(void 0),fr(this.video),this.tracer.end()}constructor(e){this.subscription=new u.Subscription,this.videoState=new lr("stopped"),this.droppedFramesManager=new Va,this.stallsManager=new En,this.elementSizeManager=new An,this.videoTracksMap=new Map,this.audioTracksMap=new Map,this.textTracksMap=new Map,this.videoStreamsMap=new Map,this.audioStreamsMap=new Map,this.videoTrackSwitchHistory=new aa,this.audioTrackSwitchHistory=new aa,this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.seekState.getState();if(!this.videoState.getTransition()){if("requested"===r.state&&"paused"!==i?.to&&"stopped"!==e&&"stopped"!==t&&this.seek(r.position,r.forcePrecise),"stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.player.stop(),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),or(this.params.desiredState.playbackState,"stopped",!0)));switch(e){case"stopped":return this.videoState.startTransitionTo("ready"),void this.prepare();case"ready":return void("paused"===t?(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused")):"playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"ready"===i?.to&&or(this.params.desiredState.playbackState,"ready"));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===t&&this.video.paused?this.playIfAllowed():"playing"===i?.to&&or(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===i?.to&&or(this.params.desiredState.playbackState,"paused"));default:return(0,u.assertNever)(e)}}},this.init3DScene=e=>{if(this.scene3D)return;this.scene3D=new kn(this.params.container,this.video,{fov:this.params.tuning.spherical.fov,orientation:this.params.tuning.spherical.orientation||{x:e.projectionData?.pose.yaw||0,y:e.projectionData?.pose.pitch||0,z:e.projectionData?.pose.roll||0},rotationSpeed:this.params.tuning.spherical.rotationSpeed,maxYawAngle:this.params.tuning.spherical.maxYawAngle,rotationSpeedCorrection:this.params.tuning.spherical.rotationSpeedCorrection,degreeToPixelCorrection:this.params.tuning.spherical.degreeToPixelCorrection,speedFadeTime:this.params.tuning.spherical.speedFadeTime,speedFadeThreshold:this.params.tuning.spherical.speedFadeThreshold});let t=this.elementSizeManager.getValue();t&&this.scene3D.setViewportSize(t.width,t.height)},this.destroy3DScene=()=>{this.scene3D&&(this.scene3D.destroy(),this.scene3D=void 0)},this.textTracksManager=new xr(e.source.url),this.params=e,this.video=pr(e.container,e.tuning),this.tracer=e.dependencies.tracer.createComponentTracer(this.constructor.name),this.params.output.element$.next(this.video),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(ya(this.params.source.url)),this.params.output.isLive$.next(!1),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.player=new xn({throughputEstimator:this.params.dependencies.throughputEstimator,tuning:this.params.tuning,compatibilityMode:this.params.source.compatibilityMode,tracer:this.tracer}),this.subscribe()}},Pn=class extends Ln{subscribe(){super.subscribe();let{output:e,observableVideo:t,connect:i}=this.getProviderSubscriptionInfo();i(t.timeUpdate$,e.position$),i(t.durationChange$,e.duration$)}seek(e,t){this.params.output.willSeekEvent$.next(),this.player.seek(e,t)}},Mn=class extends Ln{subscribe(){super.subscribe();let e=-1,{output:t,observableVideo:i,desiredState:r,connect:a}=this.getProviderSubscriptionInfo();this.params.output.position$.next(0),this.params.output.isLive$.next(!0),a(i.timeUpdate$,t.liveBufferTime$),a(this.player.liveSeekableDuration$,t.duration$),a(this.player.liveLatency$,t.liveLatency$);let s=new u.ValueSubject(1);a(i.playbackRateState$,s),this.subscription.add(this.params.output.position$.subscribe(this.player.livePositionFromPlayer$)).add(r.isLowLatency.stateChangeEnded$.pipe((0,u.map)((e=>e.to))).subscribe(this.player.isLowLatency$)).add((0,u.combine)({liveBufferTime:t.liveBufferTime$,liveAvailabilityStartTime:this.player.liveAvailabilityStartTime$}).pipe((0,u.map)((({liveBufferTime:e,liveAvailabilityStartTime:t})=>e&&t?e+t:void 0))).subscribe(t.liveTime$)).add(this.player.liveStreamStatus$.pipe((0,u.filter)((e=>(0,u.isNonNullable)(e)))).subscribe((e=>t.isLiveEnded$.next("active"!==e&&0===t.position$.getValue())))).add((0,u.combine)({liveDuration:this.player.liveDuration$,liveStreamStatus:this.player.liveStreamStatus$,playbackRate:(0,u.merge)(i.playbackRateState$,new u.ValueSubject(1))}).pipe((0,u.filter)((({liveStreamStatus:e,liveDuration:t})=>"active"===e&&!!t))).subscribe((({liveDuration:i,playbackRate:r})=>{let a=t.liveBufferTime$.getValue(),s=t.position$.getValue(),{playbackCatchupSpeedup:n}=this.params.tuning.dashCmafLive.lowLatency;s||r<1-n||this.video.paused||(0,u.isNullable)(a)||(e=i-a)}))).add((0,u.combine)({time:t.liveBufferTime$,liveDuration:this.player.liveDuration$,playbackRate:(0,u.merge)(i.playbackRateState$,new u.ValueSubject(1))}).pipe((0,u.filterChanged)(((e,t)=>"active"===this.player.liveStreamStatus$.getValue()?e.liveDuration===t.liveDuration:e.time===t.time))).subscribe((({time:i,liveDuration:r,playbackRate:a})=>{let s=t.position$.getValue(),{playbackCatchupSpeedup:n}=this.params.tuning.dashCmafLive.lowLatency;if(!s&&!this.video.paused&&a>=1-n||(0,u.isNullable)(i)||(0,u.isNullable)(r))return;let o=-1*(r-i-e);t.position$.next(Math.min(o,0))}))).add(this.player.currentLiveTextRepresentation$.subscribe((e=>{if(e){let t=(({language:e,label:t,id:i,url:r,isAuto:a})=>({id:i,url:r,isAuto:a,type:"internal",language:e,label:t}))(e);this.params.output.availableTextTracks$.next([t])}})))}seek(e){this.params.output.willSeekEvent$.next();let t=-e,i=Math.trunc(t/1e3<=Math.abs(this.params.output.duration$.getValue())?t:0);this.player.seekLive(i).then((()=>{this.params.output.position$.next(e/1e3)}))}constructor(e){super(e),this.textTracksManager.destroy()}},In=g(gi(),1),Rn=g(_e(),1),Vn=g(oi(),1),Nn=g(gi(),1),Bn=g(Jt(),1),Dn=!1;try{Dn=Fr.browser.isSafari&&!!Fr.browser.safariVersion&&Fr.browser.safariVersion<=18}catch(e){console.error(e)}var On=class{async append(e,t){return(!t||!t.aborted)&&new Promise((i=>{let r={operation:"append",data:e,signal:t,callback:i};this.queue.push(r),this.pull()}))}async remove(e,t,i){return(!i||!i.aborted)&&new Promise((r=>{let a={operation:"remove",from:e,to:t,signal:i,callback:r};this.queue.unshift(a),this.pull()}))}async abort(e){return new Promise((t=>{let i,r=e=>{this.abortRequested=!1,t(e)};i=Dn&&e?{operation:"safariAbort",init:e,callback:r}:{operation:"abort",callback:r};for(let{callback:e}of this.queue)e(!1);this.abortRequested=!0,i&&(this.queue=[i]),this.pull()}))}destroy(){this.destroyed=!0,this.buffer.removeEventListener("updateend",this.completeTask),this.queue=[],this.currentTask=null;try{this.buffer.abort()}catch(e){if(!(e instanceof DOMException&&"InvalidStateError"===e.name))throw e}}pull(){if((this.buffer.updating||this.currentTask||this.destroyed)&&!this.abortRequested)return;let e=this.queue.shift();if(!e)return;if(e.signal?.aborted)return e.callback(!1),void this.pull();this.currentTask=e;let{operation:t}=this.currentTask;try{this.execute(this.currentTask)}catch(e){e instanceof DOMException&&"QuotaExceededError"===e.name&&"append"===t?this.bufferFull$.next(this.currentTask.data.byteLength):e instanceof DOMException&&"InvalidStateError"===e.name||this.error$.next({id:`BufferTaskQueue:${t}`,category:u.ErrorCategory.VIDEO_PIPELINE,message:"Buffer operation failed",thrown:e}),this.currentTask.callback(!1),this.currentTask=null}this.currentTask&&"abort"===this.currentTask.operation&&this.completeTask()}execute(e){let{operation:t}=e;switch(t){case"append":this.buffer.appendBuffer(e.data);break;case"remove":this.buffer.remove(e.from/1e3,e.to/1e3);break;case"abort":this.buffer.abort();break;case"safariAbort":this.buffer.abort(),this.buffer.appendBuffer(e.init);break;default:(0,u.assertNever)(t)}}constructor(e){this.bufferFull$=new u.Subject,this.error$=new u.Subject,this.queue=[],this.currentTask=null,this.destroyed=!1,this.abortRequested=!1,this.completeTask=()=>{try{if(this.currentTask){let e=this.currentTask.signal?.aborted;this.currentTask.callback(!e),this.currentTask=null}this.queue.length&&this.pull()}catch(e){this.error$.next({id:"BufferTaskQueueUnknown",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Buffer appending or removal failed",thrown:e})}},this.buffer=e,this.buffer.addEventListener("updateend",this.completeTask)}},Fn=class{get id(){return this.type}get size(){return this.size32}scanForBoxes(e){return this.boxParser.parse(e)}readString(e,t="ascii"){let i=new TextDecoder(t).decode(new DataView(this.source.buffer,this.source.byteOffset+this.cursor,e));return this.cursor+=e,i}readUint8(){let e=this.source.getUint8(this.cursor);return this.cursor+=1,e}readUint16(){let e=this.source.getUint16(this.cursor);return this.cursor+=2,e}readUint32(){let e=this.source.getUint32(this.cursor);return this.cursor+=4,e}readUint64(){let e=this.source.getBigInt64(this.cursor);return this.cursor+=8,e}constructor(e,t){this.cursor=0,this.source=e,this.boxParser=t,this.children=[];let i=this.readUint32();this.type=this.readString(4),i>e.byteLength-e.byteOffset&&(this.size32=NaN);let r=this.size32?this.size32-8:void 0,a=e.byteOffset+this.cursor;this.size64=0,this.usertype=0,this.content=new DataView(e.buffer,a,r)}},jn=class extends Fn{},zn=class extends Fn{constructor(e,t){super(e,t);let i=this.readUint32();this.version=i>>>24,this.flags=16777215&i}},Un=class extends zn{get earliestPresentationTime(){return this.earliestPresentationTime32}get firstOffset(){return this.firstOffset32}constructor(e,t){super(e,t),this.segments=[],this.referenceId=this.readUint32(),this.timescale=this.readUint32(),this.earliestPresentationTime32=this.readUint32(),this.firstOffset32=this.readUint32(),this.earliestPresentationTime64=0,this.firstOffset64=0,this.referenceCount=65535&this.readUint32();for(let e=0;e<this.referenceCount;e++){let e=this.readUint32(),t=e>>>31,i=e<<1>>>1,r=this.readUint32();e=this.readUint32();let a=e>>>28,s=e<<3>>>3;this.segments.push({referenceType:t,referencedSize:i,subsegmentDuration:r,SAPType:a,SAPDeltaTime:s})}}},qn={ftyp:class extends Fn{constructor(e,t){super(e,t),this.compatibleBrands=[],this.majorBrand=this.readString(4),this.minorVersion=this.readUint32();let i=this.size-this.cursor;for(;i;){let e=this.readString(4);this.compatibleBrands.push(e),i-=4}}},moov:class extends Fn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mvhd:class extends zn{constructor(e,t){super(e,t),this.creationTime=this.readUint32(),this.modificationTime=this.readUint32(),this.timescale=this.readUint32(),this.duration=this.readUint32(),this.rate=this.readUint32(),this.volume=this.readUint16()}},moof:class extends Fn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mdat:class extends Fn{constructor(e,t){super(e,t),this.data=this.content}},sidx:Un,trak:class extends Fn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mdia:class extends Fn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mfhd:class extends zn{constructor(e,t){super(e,t),this.sequenceNumber=this.readUint32()}},tkhd:class extends zn{constructor(e,t){super(e,t),this.creationTime=this.readUint32(),this.modificationTime=this.readUint32(),this.trackId=this.readUint32(),this.cursor+=4,this.duration=this.readUint32(),this.cursor+=8,this.layer=this.readUint16(),this.alternateGroup=this.readUint16(),this.cursor+=2,this.cursor+=2,this.matrix=[[this.readUint32(),this.readUint32(),this.readUint32()],[this.readUint32(),this.readUint32(),this.readUint32()],[this.readUint32(),this.readUint32(),this.readUint32()]],this.width=this.readUint32(),this.height=this.readUint32()}},traf:class extends Fn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},tfhd:class extends zn{constructor(e,t){super(e,t),this.trackId=this.readUint32(),1&this.flags&&(this.baseDataOffset=this.readUint64()),2&this.flags&&(this.sampleDescriptionIndex=this.readUint32()),8&this.flags&&(this.defaultSampleDuration=this.readUint32()),16&this.flags&&(this.defaultSampleSize=this.readUint32()),32&this.flags&&(this.defaultSampleFlags=this.readUint32())}},tfdt:class extends zn{get baseMediaDecodeTime(){return 1===this.version?this.baseMediaDecodeTime64:this.baseMediaDecodeTime32}constructor(e,t){super(e,t),this.baseMediaDecodeTime32=0,this.baseMediaDecodeTime64=BigInt(0),1===this.version?this.baseMediaDecodeTime64=this.readUint64():this.baseMediaDecodeTime32=this.readUint32()}},trun:class extends zn{constructor(e,t){super(e,t),this.sampleDuration=[],this.sampleSize=[],this.sampleFlags=[],this.sampleCompositionTimeOffset=[],this.optionalFields=0,this.sampleCount=this.readUint32(),1&this.flags&&(this.dataOffset=this.readUint32()),4&this.flags&&(this.firstSampleFlags=this.readUint32());for(let e=0;e<this.sampleCount;e++)256&this.flags&&this.sampleDuration.push(this.readUint32()),512&this.flags&&this.sampleSize.push(this.readUint32()),1024&this.flags&&this.sampleFlags.push(this.readUint32()),2048&this.flags&&this.sampleCompositionTimeOffset.push(this.readUint32())}},minf:class extends Fn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},sv3d:class extends Fn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},st3d:class extends zn{constructor(e,t){switch(super(e,t),this.readUint8()){case 0:this.stereoMode=0;break;case 1:this.stereoMode=1;break;case 2:this.stereoMode=2;break;case 3:this.stereoMode=3;break;case 4:this.stereoMode=4}this.cursor+=1}},prhd:class extends zn{constructor(e,t){super(e,t),this.poseYawDegrees=this.readUint32(),this.posePitchDegrees=this.readUint32(),this.poseRollDegrees=this.readUint32()}},proj:class extends Fn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},equi:class extends zn{constructor(e,t){super(e,t),this.projectionBoundsTop=this.readUint32(),this.projectionBoundsBottom=this.readUint32(),this.projectionBoundsLeft=this.readUint32(),this.projectionBoundsRight=this.readUint32()}},uuid:class extends Fn{constructor(e,t){super(e,t),this.ondemandPrefix="ondemandlivejson",this.ondemandDataReceivedKey="t-in",this.ondemandDataPreparedKey="t-out";let i=this.content.byteOffset,r=i+this.content.byteLength,a=new TextDecoder("ascii").decode(this.content.buffer.slice(i,r)).split(this.ondemandPrefix)[1],s=JSON.parse(a);this.serverDataReceivedTimestamp=s[this.ondemandDataReceivedKey],this.serverDataPreparedTime=s[this.ondemandDataPreparedKey]}},stbl:class extends Fn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},stsd:class extends zn{constructor(e,t){super(e,t),this.entryCount=this.readUint32(),this.children=this.scanForBoxes(new DataView(this.content.buffer,this.content.byteOffset+8,this.content.byteLength-8))}},avc1:class extends Fn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(new DataView(this.content.buffer,this.content.byteOffset+78,this.content.byteLength-78))}},unknown:jn},Hn=class e{parse(e){let t=[],i=this.options.offset;for(;i<e.byteLength;)try{let r=new TextDecoder("ascii").decode(new DataView(e.buffer,e.byteOffset+i+4,4)),a=this.createBox(r,new DataView(e.buffer,e.byteOffset+i,e.byteLength-i));if(!a.size)break;t.push(a),i+=a.size}catch{break}return t}createBox(t,i){let r=qn[t];return r?new r(i,new e):new jn(i,new e)}constructor(e={}){this.options={offset:0,...e}}},Wn=class{indexBoxLevel(e){e.forEach((e=>{var t,i;(t=this.index)[i=e.type]??(t[i]=[]),this.index[e.type].push(e),e.children.length>0&&this.indexBoxLevel(e.children)}))}find(e){return this.index[e]&&this.index[e][0]?this.index[e][0]:null}findAll(e){return this.index[e]||[]}constructor(e){this.index={},this.indexBoxLevel(e)}},Qn=new TextDecoder("ascii"),Gn={validateData:e=>"ftyp"===Qn.decode(new DataView(e.buffer,e.byteOffset+4,4)),parseInit:e=>{let t={is3dVideo:!1,stereoMode:0,projectionType:1,projectionData:{pose:{yaw:0,pitch:0,roll:0},bounds:{top:0,bottom:0,left:0,right:0}}},i=(new Hn).parse(e),r=new Wn(i);if(r.find("sv3d")){t.is3dVideo=!0;let e=r.find("st3d");e&&(t.stereoMode=e.stereoMode);let i=r.find("prhd");i&&(t.projectionData.pose.yaw=i.poseYawDegrees,t.projectionData.pose.pitch=i.posePitchDegrees,t.projectionData.pose.roll=i.poseRollDegrees);let a=r.find("equi");a&&(t.projectionData.bounds.top=a.projectionBoundsTop,t.projectionData.bounds.right=a.projectionBoundsRight,t.projectionData.bounds.bottom=a.projectionBoundsBottom,t.projectionData.bounds.left=a.projectionBoundsLeft)}return t},getIndexRange:()=>{},parseSegments:e=>{let t=new Un(e,new Hn),i=t.earliestPresentationTime/t.timescale*1e3,r=e.byteOffset+e.byteLength+t.firstOffset;return t.segments.map((e=>{if(0!==e.referenceType)throw new Error("Unsupported multilevel sidx");let a=e.subsegmentDuration/t.timescale*1e3,s={status:"none",time:{from:i,to:i+a},byte:{from:r,to:r+e.referencedSize-1}};return i+=a,r+=e.referencedSize,s}))},parseFeedableSegmentChunk:(e,t)=>{let i=(new Hn).parse(e),r=new Wn(i),a=r.findAll("moof"),s=t?r.findAll("uuid"):r.findAll("mdat");if(!s.length||!a.length)return null;let n=a[0],o=s[s.length-1],l=n.source.byteOffset,u=o.source.byteOffset-n.source.byteOffset+o.size;return new DataView(e.buffer,l,u)},getChunkEndTime:(e,t)=>{let i=(new Hn).parse(e),r=new Wn(i).findAll("traf"),a=r[r.length-1].children.find((e=>"tfhd"===e.type)),s=r[r.length-1].children.find((e=>"tfdt"===e.type)),n=r[r.length-1].children.find((e=>"trun"===e.type)),o=0;return o=n.sampleDuration.length?n.sampleDuration.reduce(((e,t)=>e+t),0):a.defaultSampleDuration*n.sampleCount,(Number(s.baseMediaDecodeTime)+o)/t*1e3},getServerLatencyTimestamps:e=>{let t=(new Hn).parse(e),i=new Wn(t).findAll("uuid");return i.length?i[i.length-1]:{}},getTimescaleFromIndex:e=>{let t=(new Hn).parse(e);return new Wn(t).find("sidx")?.timescale}},Kn=g(_e(),1),Yn={440786851:{type:"master"},17030:{type:"uint"},17143:{type:"uint"},17138:{type:"uint"},17139:{type:"uint"},17026:{type:"string"},17031:{type:"uint"},17029:{type:"uint"},236:{type:"binary"},408125543:{type:"master"},290298740:{type:"master"},19899:{type:"master"},21419:{type:"binary"},21420:{type:"uint"},357149030:{type:"master"},2807729:{type:"uint"},17545:{type:"float"},374648427:{type:"master"},174:{type:"master"},224:{type:"master"},30320:{type:"master"},30321:{type:"uint"},30322:{type:"master"},272869232:{type:"master"},524531317:{type:"master"},231:{type:"uint"},22612:{type:"master"},22743:{type:"uint"},167:{type:"uint"},171:{type:"uint"},163:{type:"binary"},160:{type:"master"},175:{type:"binary"},423732329:{type:"master"},307544935:{type:"master"},475249515:{type:"master"},187:{type:"master"},179:{type:"uint"},183:{type:"master"},247:{type:"uint"},241:{type:"uint"},240:{type:"uint"},178:{type:"uint"},21368:{type:"uint"},234:{type:"uint"},219:{type:"master"},150:{type:"uint"}},Zn=e=>{let t=e.getUint8(0),i=0;128&t?i=1:64&t?i=2:32&t?i=3:16&t&&(i=4);let r=Xn(e,i),a=r in Yn,s=a?Yn[r].type:"binary",n=e.getUint8(i),o=0;128&n?o=1:64&n?o=2:32&n?o=3:16&n?o=4:8&n?o=5:4&n?o=6:2&n?o=7:1&n&&(o=8);let l,u=new DataView(e.buffer,e.byteOffset+i+1,o-1),d=(n&255>>o)*2**(8*(o-1))+Xn(u),c=i+o;return l=c+d>e.byteLength?new DataView(e.buffer,e.byteOffset+c):new DataView(e.buffer,e.byteOffset+c,d),{tag:a?r:"0x"+r.toString(16).toUpperCase(),type:s,tagHeaderSize:c,tagSize:c+d,value:l,valueSize:d}},Xn=(e,t=e.byteLength)=>{switch(t){case 1:return e.getUint8(0);case 2:return e.getUint16(0);case 3:return 65536*e.getUint8(0)+e.getUint16(1);case 4:return e.getUint32(0);case 5:return e.getUint8(0)*2**32+e.getUint32(1);case 6:return e.getUint16(0)*2**32+e.getUint32(2);case 7:{let t=281474976710656*e.getUint8(0)+4294967296*e.getUint16(1)+e.getUint32(3);if(Number.isSafeInteger(t))return t}case 8:throw new ReferenceError("Int64 is not supported")}return 0},Jn=(e,t)=>{switch(t){case"int":return e.getInt8(0);case"uint":return Xn(e);case"float":return 4===e.byteLength?e.getFloat32(0):e.getFloat64(0);case"string":return new TextDecoder("ascii").decode(e);case"utf8":return new TextDecoder("utf-8").decode(e);case"date":return new Date(Date.UTC(2001,0)+e.getInt8(0)).getTime();case"master":case"binary":return e;default:(0,u.assertNever)(t)}},eo=(e,t)=>{let i=0;for(;i<e.byteLength;){let r=new DataView(e.buffer,e.byteOffset+i),a=Zn(r);if(!t(a))return;"master"===a.type&&eo(a.value,t),i=a.value.byteOffset-e.byteOffset+a.valueSize}},to=[357149030,290298740,374648427,174,224,30320,30321,30322,272869232,524531317,475249515,423732329,307544935],io=[231,22612,22743,167,171,163,160,175],ro={validateData:e=>{if(440786851!==e.getUint32(0))return!1;let t,i,r,a=Zn(e);return eo(a.value,(({tag:e,type:a,value:s})=>(17143===e?t=Jn(s,a):17026===e?i=Jn(s,a):17029===e&&(r=Jn(s,a)),!0))),(void 0===t||t<=1)&&void 0!==i&&"webm"===i&&(void 0===r||r<=2)},parseInit:e=>{let t,i,r,a,s,n,o=!1,l=!1,d=!1,c=!1;return eo(e,(({tag:e,type:u,value:h,valueSize:p})=>{if(21419===e){let e=Jn(h,u);n=Xn(e)}else 21420!==e&&(n=void 0);return 408125543===e?(t=h.byteOffset,i=h.byteOffset+p):357149030===e?o=!0:290298740===e?l=!0:2807729===e?r=Jn(h,u):17545===e?a=Jn(h,u):21420===e&&475249515===n?s=Jn(h,u):374648427===e?eo(h,(({tag:e,type:t,value:i})=>30321!==e||(c=1===Jn(i,t),!1))):o&&l&&(0,Kn.default)(to,e)&&(d=!0),!d})),(0,u.assertNonNullable)(t,"Failed to parse webm Segment start"),(0,u.assertNonNullable)(i,"Failed to parse webm Segment end"),(0,u.assertNonNullable)(a,"Failed to parse webm Segment duration"),r=r??1e6,{segmentStart:Math.round(t/1e9*r*1e3),segmentEnd:Math.round(i/1e9*r*1e3),timeScale:r,segmentDuration:Math.round(a/1e9*r*1e3),cuesSeekPosition:s,is3dVideo:c,stereoMode:0,projectionType:1,projectionData:{pose:{yaw:0,pitch:0,roll:0},bounds:{top:0,bottom:0,left:0,right:0}}}},getIndexRange:e=>{if((0,u.isNullable)(e.cuesSeekPosition))return;let t=e.segmentStart+e.cuesSeekPosition;return{from:t,to:t+1048576}},parseSegments:(e,t)=>{let i,r=!1,a=!1,s=e=>(0,u.isNonNullable)(e.time)&&(0,u.isNonNullable)(e.position),n=[];return eo(e,(({tag:e,type:t,value:o})=>{switch(e){case 475249515:r=!0;break;case 187:i&&s(i)&&n.push(i),i={};break;case 179:i&&(i.time=Jn(o,t));break;case 183:break;case 241:i&&(i.position=Jn(o,t));break;default:r&&(0,Kn.default)(to,e)&&(a=!0)}return!(r&&a)})),i&&s(i)&&n.push(i),n.map(((e,i)=>{let{time:r,position:a}=e,s=n[i+1];return{status:"none",time:{from:r,to:s?s.time:t.segmentDuration},byte:{from:t.segmentStart+a,to:s?t.segmentStart+s.position-1:t.segmentEnd-1}}}))},parseFeedableSegmentChunk:e=>{let t=0,i=!1;try{eo(e,(r=>524531317===r.tag?r.tagSize<=e.byteLength?(t=r.tagSize,!1):(t+=r.tagHeaderSize,!0):!!(0,Kn.default)(io,r.tag)&&(t+r.tagSize<=e.byteLength&&(t+=r.tagSize,i||(i=(0,Kn.default)([163,160,175],r.tag))),!0)))}catch{}return t>0&&t<=e.byteLength&&i?new DataView(e.buffer,e.byteOffset,t):null}},ao=e=>{let t=/^(.+)\/([^;]+)(?:;.*)?$/.exec(e);if(t){let[,e,i]=t;if("audio"===e||"video"===e)switch(i){case"webm":return ro;case"mp4":return Gn}}throw new ReferenceError(`Unsupported mime type ${e}`)},so=g(Bi(),1),no=g(Ne(),1),oo=g(qi(),1),lo=g(oi(),1),uo=g(ri(),1),co=e=>{try{let t=function(){let e="(?<extlang>(?:[a-z]{3}(?:-[a-z]{3}){0,2}))",t="x(?:-[a-z0-9]{1,8})+",i=`^(?:(?<langtag>\n    (?<language>(?:[a-z]{2,3}(?:-${e})?|[a-z]{4}|[a-z]{5,8}))\n    (-(?<script>[a-z]{4}))?\n    (-(?<region>(?:[a-z]{2}|[0-9]{3})))?\n    (?<variants>(?:-(?:[a-z0-9]{5,8}|[0-9][a-z0-9]{3}))*)\n    (?<extensions>(?:-[0-9a-wy-z](?:-[a-z0-9]{2,8})+)*)\n    (?:-(?<privateuse>(?:${t})))?\n  )|(?<privateuse2>${t}))$`.replace(/[\s\t\n]/g,"");return new RegExp(i,"i")}(),i=e.match(t),{groups:r}=i??{};if(r){let e={};if(r.extensions){let t=r.extensions.toLowerCase().match(/(?:[0-9a-wy-z](?:-[a-z0-9]{2,8})+)/g);Array.from(t||[]).forEach((t=>{e[t[0]]=t.slice(2)}))}let t=r.variants?.split(/-/).filter((e=>""!==e)),i={extlang:r.extlang,langtag:r.langtag,language:r.language,privateuse:r.privateuse||r.privateuse2,region:r.region,script:r.script,extensions:e,variants:t};return Object.keys(i).forEach((e=>{let t=i[e];(typeof t>"u"||""===t)&&delete i[e]})),i}return null}catch{return null}};var ho=g(oi(),1),po=({id:e,width:t,height:i,bitrate:r,fps:a,quality:s,streamId:n})=>{let o=(s?zr(s):void 0)??(0,u.videoSizeToQuality)({width:t,height:i});return o&&{id:e,quality:o,bitrate:r,size:{width:t,height:i},fps:a,streamId:n}},fo=({id:e,bitrate:t})=>({id:e,bitrate:t}),mo=({language:e,label:t},{id:i,url:r,isAuto:a})=>({id:i,url:r,isAuto:a,type:"internal",language:e,label:t}),vo=({id:e,language:t,label:i,codecs:r,isDefault:a})=>({id:e,language:t,label:i,codec:(0,ho.default)(r.split("."),0),isDefault:a}),go=({id:e,language:t,label:i,hdr:r,codecs:a})=>({id:e,language:t,hdr:r,label:i,codec:(0,ho.default)(a.split("."),0)}),bo=e=>"url"in e,yo=e=>"template"===e.type,wo=e=>e instanceof DOMException&&("AbortError"===e.name||20===e.code),So=(e,t)=>{for(let i of e)if(t(i))return i;return null},xo=e=>{if(!e?.startsWith("P"))return;let t=(e,t)=>{let i=e?parseFloat(e.replace(",",".")):NaN;return(isNaN(i)?0:i)*t},i=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/.exec(e),r="-"===i?.[1]?-1:1;return 24*t(i?.[5],r)*60*60*1e3+60*t(i?.[6],r)*60*1e3+60*t(i?.[7],r)*1e3+1e3*t(i?.[8],r)},$o=(e,t)=>{let i=e;i=(0,so.default)(i,"$$","$");let r={RepresentationID:t.representationId,Number:t.segmentNumber,Bandwidth:t.bandwidth,Time:t.segmentTime};for(let[e,t]of(0,no.default)(r)){let r=new RegExp(`\\$${e}(?:%0(\\d+)d)?\\$`,"g");i=(0,so.default)(i,r,((e,i)=>(0,u.isNullable)(t)?e:(0,u.isNullable)(i)?t:(0,oo.default)(t,parseInt(i,10),"0")))}return i},_o=class{switchToWithPreviousAbort(e,t=!1){!Zs(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId||(this.switchAbortController.abort(),this.switchAbortController=new Ya,(0,u.abortable)(this.switchAbortController.signal,async function*(e,t=!1){this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,u.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),a=this.initData.get(e);if((0,u.isNullable)(a)||(0,u.isNullable)(r)?yield this.loadInit(i,"high",!1):a instanceof Promise&&(yield a),r=this.segments.get(e),(0,u.assertNonNullable)(r,"No segments for starting representation"),a=this.initData.get(e),a instanceof ArrayBuffer&&this.sourceBuffer&&Zs(this.mediaSource,this.sourceBuffer)){if(yield this.abort(),yield this.sourceBufferTaskQueue.append(a,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer();else{let t=this.getCurrentPosition();(0,u.isNonNullable)(t)&&!this.isLive&&(this.bufferLimit=this.forwardBufferTarget,yield this.pruneBuffer(t,1/0,!0)),this.downloadingRepresentationId=e,this.switchingToRepresentationId=void 0}this.maintain()}}.bind(this))(e,t))}warmUpMediaSource(){!(0,u.isNullable)(this.sourceBuffer)&&!this.sourceBuffer.updating&&(this.sourceBuffer.mode="segments")}async abort(){for(let e of this.activeSegments)this.abortSegment(e.segment);return this.activeSegments.clear(),this.downloadAbortController.abort(),this.downloadAbortController=new Ya,this.abortBuffer()}maintain(e=this.getCurrentPosition()){if((0,u.isNullable)(e)||(0,u.isNullable)(this.downloadingRepresentationId)||(0,u.isNullable)(this.playingRepresentationId)||(0,u.isNullable)(this.sourceBuffer)||!Zs(this.mediaSource,this.sourceBuffer)||(0,u.isNonNullable)(this.switchingToRepresentationId)||this.isSeekingLive)return;let t=this.representations.get(this.downloadingRepresentationId),i=this.segments.get(this.downloadingRepresentationId);if((0,u.assertNonNullable)(t,`No such representation ${this.downloadingRepresentationId}`),!i)return;let r=i.find((t=>e>=t.time.from&&e<t.time.to));(0,u.isNonNullable)(r)&&isFinite(r.time.from)&&isFinite(r.time.to)&&this.currentSegmentLength$.next(r?.time.to-r.time.from);let a=e;if(this.playingRepresentationId!==this.downloadingRepresentationId){let t=za(this.sourceBuffer.buffered,e),i=r?r.time.to+100:-1/0;r&&r.time.to-e<this.tuning.dash.maxSegmentDurationLeftToSelectNextSegment&&t>=r.time.to-e+100&&(a=i)}if(isFinite(this.bufferLimit)&&cs(this.sourceBuffer.buffered)>=this.bufferLimit){let t=za(this.sourceBuffer.buffered,e),i=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;return void this.pruneBuffer(e,1/0,t<i).catch((e=>{this.handleAsyncError(e,"pruneBuffer")}))}let s=null;if(!this.activeSegments.size&&(s=this.selectForwardBufferSegments(i,t.segmentReference.type,a),s?.length)){let e="auto";if(this.tuning.dash.useFetchPriorityHints&&r)if((0,Rn.default)(s,r))e="high";else{let t=(0,Vn.default)(s,0);t&&t.time.from-r.time.to>=this.forwardBufferTarget/2&&(e="low")}this.loadSegments(s,t,e).catch((e=>{this.handleAsyncError(e,"loadSegments")}))}(!this.preloadOnly&&!this.allInitsLoaded&&r&&"fed"===r.status&&!s?.length&&za(this.sourceBuffer.buffered,e)>3e3||this.isActiveLowLatency())&&this.loadNextInit();let n=(0,Vn.default)(i,-1);!this.isLive&&n&&(this.fullyBuffered$.next(n.time.to-e-za(this.sourceBuffer.buffered,e)<100),this.onLastSegment$.next(e-n.time.from>0))}get lastDataObtainedTimestamp(){return this.lastDataObtainedTimestampMs}searchGaps(e,t){this.gaps=[];let i=0,r=this.isLive?this.liveInitialAdditionalOffset:0;for(let a of e)Math.trunc(a.time.from-i)>0&&this.gaps.push({representation:t.id,from:i,to:a.time.from+r}),i=a.time.to;(0,u.isNonNullable)(t.duration)&&t.duration-i>0&&!this.isLive&&this.gaps.push({representation:t.id,from:i,to:t.duration})}getActualLiveStartingSegments(e){let t=e.segments,i=this.isActiveLowLatency()?this.tuning.dashCmafLive.lowLatency.maxTargetOffset:this.tuning.dashCmafLive.maxActiveLiveOffset,r=[],a=0,s=t.length-1;do{r.unshift(t[s]),a+=t[s].time.to-t[s].time.from,s--}while(a<i&&s>=0);return this.liveInitialAdditionalOffset=a-i,this.isActiveLowLatency()?[r[0]]:r}getLiveSegmentsToLoadState(e){let t=(0,Nn.default)(e?.streams[this.kind],(e=>e.representations)).find((e=>e.id===this.downloadingRepresentationId));if(!t)return;let i=this.segments.get(t.id);return i?.length?{from:i[0].time.from,to:i[i.length-1].time.to}:void 0}updateLive(e){let t=(0,Nn.default)(e?.streams[this.kind],(e=>e.representations))??[];if(![...this.segments.values()].every((e=>!e.length)))for(let e of t){if(!e||!yo(e.segmentReference))return;let t=e.segmentReference.segments.map((e=>({...e,status:"none",size:void 0}))),i=100,r=this.segments.get(e.id)??[],a=(0,Vn.default)(r,-1)?.time.to??0,s=t?.findIndex((e=>a>=e.time.from+i&&a<=e.time.to+i));if(-1===s){this.liveUpdateSegmentIndex=0;let t=this.getActualLiveStartingSegments(e.segmentReference);this.segments.set(e.id,t)}else{let i=t.slice(s+1);this.segments.set(e.id,[...r,...i])}}}proceedLowLatencyLive(){let e=this.downloadingRepresentationId;(0,u.assertNonNullable)(e);let t=this.segments.get(e);if(t?.length){let e=t[t.length-1];this.updateLowLatencyLiveIfNeeded(e)}}updateLowLatencyLiveIfNeeded(e){let t=0;for(let i of this.representations.values()){let r=i.segmentReference;if(!yo(r))return;let a=this.segments.get(i.id);if(!a)continue;let s=a.find((t=>Math.floor(t.time.from)===Math.floor(e.time.from)));if(s&&!isFinite(s.time.to)&&(s.time.to=e.time.to,t=s.time.to-s.time.from),!a.find((t=>Math.floor(t.time.from)===Math.floor(e.time.to)))&&this.isActiveLowLatency()){let t=Math.round(e.time.to*r.timescale/1e3).toString(10),i=$o(r.segmentTemplateUrl,{segmentTime:t});a.push({status:"none",time:{from:e.time.to,to:1/0},url:i})}}this.currentLowLatencySegmentLength$.next(t)}findSegmentStartTime(e){let t=this.switchingToRepresentationId??this.downloadingRepresentationId??this.playingRepresentationId;if(!t)return;let i=this.segments.get(t);return i?i.find((t=>t.time.from<=e&&t.time.to>=e))?.time.from??void 0:void 0}setTarget(e){this.forwardBufferTarget=e}setPreloadOnly(e){this.preloadOnly=e}destroy(){if(this.initData.clear(),this.segments.clear(),this.parsedInitData.clear(),this.representations.clear(),this.sourceBufferTaskQueue?.destroy(),this.gapDetectionIdleCallback&&os&&os(this.gapDetectionIdleCallback),this.initLoadIdleCallback&&os&&os(this.initLoadIdleCallback),this.subscription.unsubscribe(),this.sourceBuffer)try{this.mediaSource.removeSourceBuffer(this.sourceBuffer)}catch(e){if(!(e instanceof DOMException&&"NotFoundError"===e.name))throw e}this.sourceBuffer=null,this.downloadAbortController.abort(),this.switchAbortController.abort(),this.destroyAbortController.abort(),window.clearTimeout(this.loadByteRangeSegmentsTimeoutId)}selectForwardBufferSegments(e,t,i){return this.isLive?this.selectForwardBufferSegmentsLive(e,i):this.selectForwardBufferSegmentsRecord(e,t,i)}selectForwardBufferSegmentsLive(e,t){if(this.playingRepresentationId!==this.downloadingRepresentationId){let i=e.findIndex((e=>t>=e.time.from&&t<e.time.to));this.liveUpdateSegmentIndex=i}return this.liveUpdateSegmentIndex<e.length?e.slice(this.liveUpdateSegmentIndex++):null}selectForwardBufferSegmentsRecord(e,t,i){let r=e.findIndex((({status:e,time:{from:t,to:r}},a)=>{let s=t>i||t<=i&&r>=i||0===a&&0===i,n=Math.min(this.forwardBufferTarget,this.bufferLimit),o=this.preloadOnly&&t<=i+n||r<=i+n;return("none"===e||"partially_ejected"===e&&s&&o&&this.sourceBuffer&&Zs(this.mediaSource,this.sourceBuffer)&&!(es(this.sourceBuffer.buffered,t)&&es(this.sourceBuffer.buffered,r)))&&s&&o}));if(-1===r)return null;if("byteRange"!==t)return e.slice(r,r+1);let a=e,s=0,n=0,o=[],l=this.preloadOnly?0:this.tuning.dash.segmentRequestSize,u=this.preloadOnly?this.forwardBufferTarget:0;for(let e=r;e<a.length&&(s<=l||n<=u);e++){let t=a[e];if(s+=t.byte.to+1-t.byte.from,n+=t.time.to+1-t.time.from,"none"!==t.status&&"partially_ejected"!==t.status)break;o.push(t)}return o}async loadSegments(e,t,i="auto"){yo(t.segmentReference)?await this.loadTemplateSegment(e[0],t,i):await this.loadByteRangeSegments(e,t,i)}async loadTemplateSegment(e,t,i="auto"){e.status="downloading";let r={segment:e,loadedBytes:0,feedingBytes:0,fedBytes:0,representationId:t.id};this.activeSegments.add(r);let{range:a,url:s,signal:n,onProgress:o,onProgressTasks:l}=this.prepareTemplateFetchSegmentParams(e,t);this.failedDownloads&&n&&(await(0,u.abortable)(n,async function*(){let e=(0,u.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>setTimeout(t,e)))}.bind(this))(),n.aborted&&this.abortActiveSegments([e]));try{let e=await this.fetcher.fetch(s,{range:a,signal:n,onProgress:o,priority:i,isLowLatency:this.isActiveLowLatency()});if(this.lastDataObtainedTimestampMs=(0,u.now)(),!e)return;let d=new DataView(e),c=ao(t.mime);if(!isFinite(r.segment.time.to)){let e=t.segmentReference.timescale;r.segment.time.to=c.getChunkEndTime(d,e)}o&&r.feedingBytes&&l?await Promise.all(l):await this.sourceBufferTaskQueue.append(d,n);let{serverDataReceivedTimestamp:h,serverDataPreparedTime:p}=c.getServerLatencyTimestamps(d);h&&p&&this.currentLiveSegmentServerLatency$.next(p-h),r.segment.status="downloaded",this.onSegmentFullyAppended(r,t.id),this.failedDownloads=0}catch(t){this.abortActiveSegments([e]),wo(t)||(this.failedDownloads++,this.updateRepresentationsBaseUrlIfNeeded())}}updateRepresentationsBaseUrlIfNeeded(){if(!this.tuning.dash.enableBaseUrlSupport||!this.baseUrls.length||this.failedDownloads<=this.tuning.dash.maxSegmentRetryCount)return;this.baseUrlsIndex=(this.baseUrlsIndex+1)%this.baseUrls.length;let e=this.baseUrls[this.baseUrlsIndex];for(let t of this.representations.values())yo(t.segmentReference)?t.segmentReference.baseUrl=e:t.segmentReference.url=e}async loadByteRangeSegments(e,t,i="auto"){if(!e.length)return;for(let i of e)i.status="downloading",this.activeSegments.add({segment:i,loadedBytes:0,feedingBytes:0,fedBytes:0,representationId:t.id});let{range:r,url:a,signal:s,onProgress:n}=this.prepareByteRangeFetchSegmentParams(e,t);this.failedDownloads&&s&&(await(0,u.abortable)(s,async function*(){let e=(0,u.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>{this.loadByteRangeSegmentsTimeoutId=window.setTimeout(t,e),(0,u.fromEvent)(window,"online").pipe((0,u.once)()).subscribe((()=>{t(),window.clearTimeout(this.loadByteRangeSegmentsTimeoutId)}))}))}.bind(this))(),s.aborted&&this.abortActiveSegments(e));try{await this.fetcher.fetch(a,{range:r,onProgress:n,signal:s,priority:i}),this.lastDataObtainedTimestampMs=(0,u.now)(),this.failedDownloads=0}catch(t){this.abortActiveSegments(e),wo(t)||(this.failedDownloads++,this.updateRepresentationsBaseUrlIfNeeded())}}prepareByteRangeFetchSegmentParams(e,t){if(yo(t.segmentReference))throw new Error("Representation is not byte range type");let i=t.segmentReference.url,r={from:(0,Vn.default)(e,0).byte.from,to:(0,Vn.default)(e,-1).byte.to},{signal:a}=this.downloadAbortController;return{url:i,range:r,signal:a,onProgress:async(e,i)=>{if(!a.aborted)try{this.lastDataObtainedTimestampMs=(0,u.now)(),await this.onSomeByteRangesDataLoaded({dataView:e,loaded:i,signal:a,onSegmentAppendFailed:()=>this.abort(),globalFrom:r?r.from:0,representationId:t.id})}catch(e){this.error$.next({id:"SegmentFeeding",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Error when feeding segments",thrown:e})}}}}prepareTemplateFetchSegmentParams(e,t){if(!yo(t.segmentReference))throw new Error("Representation is not template type");let i=new URL(e.url,t.segmentReference.baseUrl);this.isActiveLowLatency()&&i.searchParams.set("low-latency","yes");let r=i.toString(),{signal:a}=this.downloadAbortController,s=[],n=this.isActiveLowLatency()||this.tuning.dash.enableSubSegmentBufferFeeding&&this.liveUpdateSegmentIndex<3?(e,i)=>{if(!a.aborted)try{this.lastDataObtainedTimestampMs=(0,u.now)();let r=this.onSomeTemplateDataLoaded({dataView:e,loaded:i,signal:a,onSegmentAppendFailed:()=>this.abort(),representationId:t.id});s.push(r)}catch(e){this.error$.next({id:"SegmentFeeding",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Error when feeding segments",thrown:e})}}:void 0;return{url:r,signal:a,onProgress:n,onProgressTasks:s}}abortActiveSegments(e){for(let t of this.activeSegments)(0,Rn.default)(e,t.segment)&&this.abortSegment(t.segment)}async onSomeTemplateDataLoaded({dataView:e,representationId:t,loaded:i,onSegmentAppendFailed:r,signal:a}){if(!this.activeSegments.size||!Zs(this.mediaSource,this.sourceBuffer))return;let s=this.representations.get(t);if(s)for(let n of this.activeSegments){let{segment:o}=n;if(n.representationId===t){if(a.aborted){r();continue}if(n.loadedBytes=i,n.loadedBytes>n.feedingBytes){let t=new DataView(e.buffer,e.byteOffset+n.feedingBytes,n.loadedBytes-n.feedingBytes),i=ao(s.mime).parseFeedableSegmentChunk(t,this.isLive);i?.byteLength&&(o.status="partially_fed",n.feedingBytes+=i.byteLength,await this.sourceBufferTaskQueue.append(i),n.fedBytes+=i.byteLength)}}}}async onSomeByteRangesDataLoaded({dataView:e,representationId:t,globalFrom:i,loaded:r,signal:a,onSegmentAppendFailed:s}){if(!this.activeSegments.size||!Zs(this.mediaSource,this.sourceBuffer))return;let n=this.representations.get(t);if(n)for(let o of this.activeSegments){if(o.representationId!==t)continue;if(a.aborted){await s();continue}let{segment:l}=o,u=l.byte.from-i,d=l.byte.to-i,c=d-u+1,h=d<=r;if(u<r)if("downloading"===l.status&&h){l.status="downloaded";let i=new DataView(e.buffer,e.byteOffset+u,c);await this.sourceBufferTaskQueue.append(i,a)&&!a.aborted?this.onSegmentFullyAppended(o,t):await s()}else if(this.tuning.dash.enableSubSegmentBufferFeeding&&("downloading"===l.status||"partially_fed"===l.status)&&(o.loadedBytes=Math.min(c,r-u),o.loadedBytes>o.feedingBytes)){let i=new DataView(e.buffer,e.byteOffset+u+o.feedingBytes,o.loadedBytes-o.feedingBytes),r=o.loadedBytes===c?i:ao(n.mime).parseFeedableSegmentChunk(i);r?.byteLength&&(l.status="partially_fed",o.feedingBytes+=r.byteLength,await this.sourceBufferTaskQueue.append(r,a)&&!a.aborted?(o.fedBytes+=r.byteLength,o.fedBytes===c&&this.onSegmentFullyAppended(o,t)):await s())}}}onSegmentFullyAppended(e,t){if(!(0,u.isNullable)(this.sourceBuffer)&&Zs(this.mediaSource,this.sourceBuffer)){!this.isLive&&Fr.browser.isSafari&&this.tuning.useSafariEndlessRequestBugfix&&(es(this.sourceBuffer.buffered,e.segment.time.from,100)&&es(this.sourceBuffer.buffered,e.segment.time.to,100)||this.error$.next({id:"EmptyAppendBuffer",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Browser stuck on empty result of adding segment to source buffer"})),this.playingRepresentationId=t,this.playingRepresentation$.next(this.playingRepresentationId),this.playingRepresentationInit$.next(this.parsedInitData.get(this.playingRepresentationId)),e.segment.status="fed",bo(e.segment)&&(e.segment.size=e.fedBytes);for(let i of this.representations.values()){if(i.id===t)continue;let r=this.segments.get(i.id);if(r)for(let t of r)"fed"===t.status&&Math.round(t.time.from)===Math.round(e.segment.time.from)&&Math.round(t.time.to)===Math.round(e.segment.time.to)&&(t.status="none")}this.isActiveLowLatency()&&this.updateLowLatencyLiveIfNeeded(e.segment),this.activeSegments.delete(e),this.detectGapsWhenIdle(t,e.segment)}}abortSegment(e){"partially_fed"===e.status?e.status="partially_ejected":"partially_ejected"!==e.status&&(e.status="none");for(let t of this.activeSegments.values())if(t.segment===e){this.activeSegments.delete(t);break}}loadNextInit(){if(this.allInitsLoaded||this.initLoadIdleCallback)return;let e=null,t=!1;for(let[i,r]of this.initData.entries()){t||(t=r instanceof Promise),null===r&&(e=i)}if(!e)return void(this.allInitsLoaded=!0);if(t)return;let i=this.representations.get(e);i&&(this.initLoadIdleCallback=ns((()=>(0,Bn.default)(this.loadInit(i,"low",!1),(()=>this.initLoadIdleCallback=null)))))}async loadInit(e,t="auto",i=!1){let r=this.tuning.dash.useFetchPriorityHints?t:"auto",a=(!i&&this.failedDownloads>0?(0,u.abortable)(this.destroyAbortController.signal,async function*(){let e=(0,u.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>setTimeout(t,e)))}.bind(this))():Promise.resolve()).then((()=>this.fetcher.fetchRepresentation(e.segmentReference,ao(e.mime),r))).then((t=>{if(!t)return;let{init:i,dataView:r,segments:a}=t,s=r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);this.initData.set(e.id,s);let n=a;this.isLive&&yo(e.segmentReference)&&(n=this.getActualLiveStartingSegments(e.segmentReference)),(!this.isLive||!this.segments.has(e.id))&&this.segments.set(e.id,n),i&&this.parsedInitData.set(e.id,i)})).then((()=>this.failedDownloads=0),(t=>{this.initData.set(e.id,null),i&&this.error$.next({id:"LoadInits",category:u.ErrorCategory.WTF,message:"loadInit threw",thrown:t})}));return this.initData.set(e.id,a),a}async dropBuffer(){for(let e of this.segments.values())for(let t of e)t.status="none";await this.pruneBuffer(0,1/0,!0)}async pruneBuffer(e,t,i=!1){if(!this.sourceBuffer||!Zs(this.mediaSource,this.sourceBuffer)||!this.playingRepresentationId||(0,u.isNullable)(e))return!1;let r=[],a=0,s=e=>{if(a>=t)return;r.push({...e.time});let i=bo(e)?e.size??0:e.byte.to-e.byte.from;a+=i};for(let t of this.segments.values())for(let i of t){let t=i.time.to<=e-this.tuning.dash.bufferPruningSafeZone,r=i.time.from>=e+Math.min(this.forwardBufferTarget,this.bufferLimit);(t||r)&&"fed"===i.status&&s(i)}for(let e=0;e<this.sourceBuffer.buffered.length;e++){let t=1e3*this.sourceBuffer.buffered.start(e),i=1e3*this.sourceBuffer.buffered.end(e),r=0;for(let e of this.segments.values())for(let a of e)(0,Rn.default)(["none","partially_ejected"],a.status)&&Math.round(a.time.from)<=Math.round(t)&&Math.round(a.time.to)>=Math.round(i)&&r++;if(r===this.segments.size){s({time:{from:t,to:i},url:"",status:"none"})}}if(r.length&&i){let t=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;for(let i of this.segments.values())for(let r of i)r.time.from>=e+t&&"fed"===r.status&&s(r)}return!!r.length&&(r=(e=>{e.sort(((e,t)=>e.from-t.from));let t=[e[0]];for(let i=1;i<e.length;i++){let{from:r,to:a}=e[i],s=t[t.length-1];s.to>=r?s.to=Math.max(s.to,a):t.push(e[i])}return t})(r),(await Promise.all(r.map((e=>this.sourceBufferTaskQueue.remove(e.from,e.to))))).reduce(((e,t)=>e||t),!1))}async abortBuffer(){if(!this.sourceBuffer||!Zs(this.mediaSource,this.sourceBuffer))return!1;let e=this.playingRepresentationId&&this.initData.get(this.playingRepresentationId),t=e instanceof ArrayBuffer?e:void 0;return this.sourceBufferTaskQueue.abort(t)}getDebugBufferState(){if(this.sourceBuffer&&Zs(this.mediaSource,this.sourceBuffer)&&this.sourceBuffer.buffered.length)return{from:this.sourceBuffer.buffered.start(0),to:this.sourceBuffer.buffered.end(this.sourceBuffer.buffered.length-1)}}getBufferedTo(){return this.sourceBuffer&&Zs(this.mediaSource,this.sourceBuffer)&&this.sourceBuffer.buffered.length?this.sourceBuffer.buffered.end(this.sourceBuffer.buffered.length-1):null}getForwardBufferDuration(e=this.getCurrentPosition()){return this.sourceBuffer&&Zs(this.mediaSource,this.sourceBuffer)&&this.sourceBuffer.buffered.length&&!(0,u.isNullable)(e)?za(this.sourceBuffer.buffered,e):0}detectGaps(e,t){if(!this.sourceBuffer||!Zs(this.mediaSource,this.sourceBuffer))return;if(this.tuning.useRefactoredSearchGap)for(let e=0;e<this.sourceBuffer.buffered.length;e++)this.gaps=this.gaps.filter((t=>this.sourceBuffer&&(Math.round(t.from)<Math.round(1e3*this.sourceBuffer.buffered.start(e))||Math.round(t.to)>Math.round(1e3*this.sourceBuffer.buffered.end(e)))));let i={representation:e,from:t.time.from,to:t.time.to};for(let e=0;e<this.sourceBuffer.buffered.length;e++){let r=1e3*this.sourceBuffer.buffered.start(e),a=1e3*this.sourceBuffer.buffered.end(e);if(!(a<=t.time.from||r>=t.time.to)){if(r<=t.time.from&&a>=t.time.to){i=void 0;break}a>t.time.from&&a<t.time.to&&(i.from=a),r<t.time.to&&r>t.time.from&&(i.to=r)}}i&&i.to-i.from>1&&!this.gaps.some((e=>i&&e.from===i.from&&e.to===i.to))&&this.gaps.push(i)}detectGapsWhenIdle(e,t){if(!this.gapDetectionIdleCallback&&this.sourceBuffer&&Zs(this.mediaSource,this.sourceBuffer)){if(!this.tuning.useRefactoredSearchGap)for(let e=0;e<this.sourceBuffer.buffered.length;e++)this.gaps=this.gaps.filter((t=>this.sourceBuffer&&(Math.round(t.from)<Math.round(1e3*this.sourceBuffer.buffered.start(e))||Math.round(t.to)>Math.round(1e3*this.sourceBuffer.buffered.end(e)))));this.gapDetectionIdleCallback=ns((()=>{try{this.detectGaps(e,t)}catch(e){this.error$.next({id:"GapDetection",category:u.ErrorCategory.WTF,message:"detectGaps threw",thrown:e})}finally{this.gapDetectionIdleCallback=null}}))}}checkEjectedSegments(){if((0,u.isNullable)(this.sourceBuffer)||!Zs(this.mediaSource,this.sourceBuffer)||(0,u.isNullable)(this.playingRepresentationId))return;let e=[];for(let t=0;t<this.sourceBuffer.buffered.length;t++){let i=Math.floor(1e3*this.sourceBuffer.buffered.start(t)),r=Math.ceil(1e3*this.sourceBuffer.buffered.end(t));e.push({from:i,to:r})}let t=100;for(let i of this.segments.values())for(let r of i){let{status:i}=r;if("fed"!==i&&"partially_ejected"!==i)continue;let a=Math.floor(r.time.from),s=Math.ceil(r.time.to),n=e.some((e=>e.from-t<=a&&e.to+t>=s)),o=e.filter((e=>a>=e.from&&a<e.to-t||s>e.from+t&&s<=e.to));n||(1===o.length||this.gaps.some((e=>e.from===r.time.from||e.to===r.time.to))?r.status="partially_ejected":r.status="none")}}handleAsyncError(e,t){this.error$.next({id:t,category:u.ErrorCategory.VIDEO_PIPELINE,thrown:e,message:"Something went wrong"})}constructor(e,t,i,{fetcher:r,tuning:a,getCurrentPosition:s,isActiveLowLatency:n,compatibilityMode:o=!1,manifest:l}){this.currentLiveSegmentServerLatency$=new u.ValueSubject(0),this.currentLowLatencySegmentLength$=new u.ValueSubject(0),this.currentSegmentLength$=new u.ValueSubject(0),this.onLastSegment$=new u.ValueSubject(!1),this.fullyBuffered$=new u.ValueSubject(!1),this.playingRepresentation$=new u.ValueSubject(void 0),this.playingRepresentationInit$=new u.ValueSubject(void 0),this.error$=new u.Subject,this.gaps=[],this.subscription=new u.Subscription,this.allInitsLoaded=!1,this.activeSegments=new Set,this.downloadAbortController=new Ya,this.switchAbortController=new Ya,this.destroyAbortController=new Ya,this.bufferLimit=1/0,this.failedDownloads=0,this.baseUrls=[],this.baseUrlsIndex=0,this.isLive=!1,this.liveUpdateSegmentIndex=0,this.liveInitialAdditionalOffset=0,this.isSeekingLive=!1,this.index=0,this.lastDataObtainedTimestampMs=0,this.loadByteRangeSegmentsTimeoutId=0,this.startWith=(0,u.abortable)(this.destroyAbortController.signal,async function*(e){let t=this.representations.get(e);(0,u.assertNonNullable)(t,`Cannot find representation ${e}`),this.playingRepresentationId=e,this.downloadingRepresentationId=e,this.sourceBuffer=this.mediaSource.addSourceBuffer(`${t.mime}; codecs="${t.codecs}"`),this.sourceBufferTaskQueue=new On(this.sourceBuffer),this.subscription.add((0,u.fromEvent)(this.sourceBuffer,"updateend").subscribe((()=>{this.checkEjectedSegments(),this.maintain()}),(e=>{let t,i=this.mediaSource.readyState;"open"!==i&&(t={id:`SegmentEjection_source_${i}`,category:u.ErrorCategory.VIDEO_PIPELINE,message:"Error when trying to clear segments ejected by browser",thrown:e}),t??(t={id:"SegmentEjection",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Error when trying to clear segments ejected by browser",thrown:e}),this.error$.next(t)}))),this.subscription.add((0,u.fromEvent)(this.sourceBuffer,"error").subscribe((()=>this.error$.next({id:"SourceBuffer",category:u.ErrorCategory.VIDEO_PIPELINE,message:"SourceBuffer Error event fired"})))),this.subscription.add(this.sourceBufferTaskQueue.bufferFull$.subscribe((e=>{let t=this.getCurrentPosition();if(!this.sourceBuffer||!t||!Zs(this.mediaSource,this.sourceBuffer))return;let i=Math.min(this.bufferLimit,.8*cs(this.sourceBuffer.buffered));this.bufferLimit=i;let r=za(this.sourceBuffer.buffered,t),a=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;this.pruneBuffer(t,2*e,r<a).catch((e=>{this.handleAsyncError(e,"pruneBuffer")}))}))),this.subscription.add(this.sourceBufferTaskQueue.error$.subscribe((e=>this.error$.next(e)))),yield this.loadInit(t,"high",!0);let i=this.initData.get(t.id),r=this.segments.get(t.id),a=this.parsedInitData.get(t.id);(0,u.assertNonNullable)(i,"No init buffer for starting representation"),(0,u.assertNonNullable)(r,"No segments for starting representation"),i instanceof ArrayBuffer&&(this.searchGaps(r,t),yield this.sourceBufferTaskQueue.append(i,this.destroyAbortController.signal),this.playingRepresentation$.next(this.playingRepresentationId),this.playingRepresentationInit$.next(a))}.bind(this)),this.switchTo=(0,u.abortable)(this.destroyAbortController.signal,async function*(e,t=!1){if(!Zs(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId)return;this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,u.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),a=this.initData.get(e);if((0,u.isNullable)(a)||(0,u.isNullable)(r)?yield this.loadInit(i,"high",!1):a instanceof Promise&&(yield a),r=this.segments.get(e),(0,u.assertNonNullable)(r,"No segments for starting representation"),a=this.initData.get(e),a&&a instanceof ArrayBuffer&&this.sourceBuffer&&Zs(this.mediaSource,this.sourceBuffer)){if(yield this.abort(),yield this.sourceBufferTaskQueue.append(a,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer();else{let t=this.getCurrentPosition();(0,u.isNonNullable)(t)&&!this.isLive&&(this.bufferLimit=1/0,await this.pruneBuffer(t,1/0,!0)),this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e}this.maintain()}}.bind(this)),this.switchToOld=(0,u.abortable)(this.destroyAbortController.signal,async function*(e,t=!1){if(!Zs(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId)return;this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,u.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),a=this.initData.get(e);if((0,u.isNullable)(a)||(0,u.isNullable)(r)?yield this.loadInit(i,"high",!1):a instanceof Promise&&(yield a),r=this.segments.get(e),(0,u.assertNonNullable)(r,"No segments for starting representation"),a=this.initData.get(e),a&&a instanceof ArrayBuffer&&this.sourceBuffer&&Zs(this.mediaSource,this.sourceBuffer))if(yield this.abort(),yield this.sourceBufferTaskQueue.append(a,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer(),this.maintain();else{let t=this.getCurrentPosition();(0,u.isNonNullable)(t)&&(this.isLive||(this.bufferLimit=1/0,await this.pruneBuffer(t,1/0,!0)),this.maintain(t)),this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e}}.bind(this)),this.seekLive=(0,u.abortable)(this.destroyAbortController.signal,async function*(e){let t=(0,Nn.default)(e,(e=>e.representations))??[];if(this.isSeekingLive=!0,!this.downloadingRepresentationId||!t)return;for(let e of this.representations.keys()){let i=t.find((t=>t.id===e));i&&this.representations.set(e,i);let r=this.representations.get(e);if(!r||!yo(r.segmentReference))return;let a=this.getActualLiveStartingSegments(r.segmentReference);this.segments.set(r.id,a)}let i=this.switchingToRepresentationId??this.downloadingRepresentationId,r=this.representations.get(i);(0,u.assertNonNullable)(r);let a=this.segments.get(i);(0,u.assertNonNullable)(a,"No segments for starting representation");let s=this.initData.get(i);if((0,u.assertNonNullable)(s,"No init buffer for starting representation"),!(s instanceof ArrayBuffer))return;let n=this.getDebugBufferState();this.liveUpdateSegmentIndex=0,yield this.abort(),n&&(yield this.sourceBufferTaskQueue.remove(1e3*n.from,1e3*n.to,this.destroyAbortController.signal)),this.searchGaps(a,r),yield this.sourceBufferTaskQueue.append(s,this.destroyAbortController.signal),this.isSeekingLive=!1}.bind(this)),this.fetcher=r,this.tuning=a,this.compatibilityMode=o,this.forwardBufferTarget=a.dash.forwardBufferTargetAuto,this.getCurrentPosition=s,this.isActiveLowLatency=n,this.isLive=!!l?.live,this.baseUrls=l?.baseUrls??[],this.initData=new Map(i.map((e=>[e.id,null]))),this.segments=new Map,this.parsedInitData=new Map,this.representations=new Map(i.map((e=>[e.id,e]))),this.kind=e,this.mediaSource=t,this.sourceBuffer=null}},ko=class{onHeadersReceived(e){let{type:t,reused:i}=en(e);this.lastConnectionType$.next(t),this.lastConnectionReused$.next(i)}async fetchRepresentation(e,t,i="auto"){let{type:r}=e;switch(r){case"byteRange":return await this.fetchByteRangeRepresentation(e,t,i)??null;case"template":return await this.fetchTemplateRepresentation(e,i)??null;default:(0,u.assertNever)(r)}}destroy(){this.abortAllController.abort(),this.tracer.end(),this.subscription.unsubscribe()}async doFetch(e,t){let i=await Ka(e,t);if(i.ok)return i;let r=await i.text(),a=parseInt(r);if(!isNaN(a))switch(a){case 1:this.recoverableError$.next({id:"VideoDataLinkExpiredError",message:"Video data links have expired",category:u.ErrorCategory.FATAL});break;case 8:this.recoverableError$.next({id:"VideoDataLinkBlockedForFloodError",message:"Url blocked for flood",category:u.ErrorCategory.FATAL});break;case 18:this.recoverableError$.next({id:"VideoDataLinkIllegalIpChangeError",message:"Client IP has changed",category:u.ErrorCategory.FATAL});break;case 21:this.recoverableError$.next({id:"VideoDataLinkIllegalHostChangeError",message:"Request HOST has changed",category:u.ErrorCategory.FATAL});break;default:this.error$.next({id:"GeneralVideoDataFetchError",message:`Generic video data fetch error (${a})`,category:u.ErrorCategory.FATAL})}}unsubscribeAbortSubscription(e){e&&(e.unsubscribe(),this.subscription.remove(e))}constructor({throughputEstimator:e,requestQuic:t,tracer:i,compatibilityMode:r=!1,useEnableSubtitlesParam:a=!1}){this.lastConnectionType$=new u.ValueSubject(void 0),this.lastConnectionReused$=new u.ValueSubject(void 0),this.lastRequestFirstBytes$=new u.ValueSubject(void 0),this.recoverableError$=new u.Subject,this.error$=new u.Subject,this.abortAllController=new Ya,this.subscription=new u.SubscriptionRemovable,this.fetchManifest=(0,u.abortable)(this.abortAllController.signal,async function*(e){let t=this.tracer.createComponentTracer("FetchManifest"),i=e;this.requestQuic&&(i=Js(i)),!this.compatibilityMode&&this.useEnableSubtitlesParam&&(i=tn(i));let r=yield this.doFetch(i,{signal:this.abortAllController.signal}).catch(To);return r?(t.log("success",(0,u.flattenObject)({url:i,message:"Request successfully executed"})),t.end(),this.onHeadersReceived(r.headers),r.text()):(t.error("error",(0,u.flattenObject)({url:i,message:"No data in request manifest"})),t.end(),null)}.bind(this)),this.fetch=(0,u.abortable)(this.abortAllController.signal,async function*(e,{rangeMethod:t=(this.compatibilityMode?0:1),range:i,onProgress:r,priority:a="auto",signal:s,measureThroughput:n=!0,isLowLatency:o=!1}={}){let l=e,d=new Headers,c=this.tracer.createComponentTracer("Fetch");if(i)switch(t){case 0:d.append("Range",`bytes=${i.from}-${i.to}`);break;case 1:{let e=new URL(l,location.href);e.searchParams.append("bytes",`${i.from}-${i.to}`),l=e.toString();break}default:(0,u.assertNever)(t)}this.requestQuic&&(l=Js(l));let h,p=this.abortAllController.signal;if(s){let e=new Ya;if(h=(0,u.merge)((0,u.fromEvent)(this.abortAllController.signal,"abort"),(0,u.fromEvent)(s,"abort")).subscribe((()=>{try{e.abort()}catch(e){To(e)}})),this.abortAllController.signal.aborted||s.aborted)try{e.abort()}catch(e){To(e)}p=e.signal}let f=(0,u.now)();c.log("startRequest",(0,u.flattenObject)({url:l,priority:a,rangeMethod:t,range:i,isLowLatency:o,requestStartedAt:f}));let m=yield this.doFetch(l,{priority:a,headers:d,signal:p}),v=(0,u.now)();if(!m)return c.error("error",{message:"No response in request"}),c.end(),this.unsubscribeAbortSubscription(h),null;if(this.throughputEstimator?.addRawRtt(v-f),!m.ok||!m.body){this.unsubscribeAbortSubscription(h);let e=`Fetch error ${m.status}: ${m.statusText}`;return c.error("error",{message:e}),c.end(),Promise.reject(new Error(`Fetch error ${m.status}: ${m.statusText}`))}if(this.onHeadersReceived(m.headers),!r&&!n){this.unsubscribeAbortSubscription(h);let e=(0,u.now)(),t={requestStartedAt:f,requestEndedAt:e,duration:e-f};return c.log("endRequest",(0,u.flattenObject)(t)),c.end(),m.arrayBuffer()}let g=m.body;if(n){let e;[g,e]=m.body.tee(),this.throughputEstimator?.trackStream(e,o)}let b,y=g.getReader(),w=parseInt(m.headers.get("content-length")??"",10);Number.isFinite(w)&&(b=w),!b&&i&&(b=i.to-i.from+1);let S=0,x=b?new Uint8Array(b):new Uint8Array(0),$=!1,_=e=>{this.unsubscribeAbortSubscription(h),$=!0,To(e)},k=(0,u.abortable)(p,async function*({done:e,value:t}){if(0===S&&this.lastRequestFirstBytes$.next((0,u.now)()-f),p.aborted)this.unsubscribeAbortSubscription(h);else if(!e&&t){if(b)x.set(t,S),S+=t.byteLength;else{let e=new Uint8Array(x.length+t.length);e.set(x),e.set(t,x.length),x=e,S+=t.byteLength}r?.(new DataView(x.buffer),S),yield y?.read().then(k,_)}}.bind(this));yield y?.read().then(k,_),this.unsubscribeAbortSubscription(h);let T=(0,u.now)(),C={failed:$,requestStartedAt:f,requestEndedAt:T,duration:T-f};return $?(c.error("endRequest",(0,u.flattenObject)(C)),c.end(),null):(c.log("endRequest",(0,u.flattenObject)(C)),c.end(),x.buffer)}.bind(this)),this.fetchByteRangeRepresentation=(0,u.abortable)(this.abortAllController.signal,async function*(e,t,i){if("byteRange"!==e.type)return null;let r,a,{from:s,to:n}=e.initRange,o=s,l=n,u=!1;e.indexRange&&(r=e.indexRange.from,a=e.indexRange.to,u=n+1===r,u&&(o=Math.min(r,s),l=Math.max(a,n))),o=Math.min(o,0);let d=yield this.fetch(e.url,{range:{from:o,to:l},priority:i,measureThroughput:!1});if(!d)return null;let c=new DataView(d,s-o,n-o+1);if(!t.validateData(c))throw new Error("Invalid media file");let h,p=t.parseInit(c),f=e.indexRange??t.getIndexRange(p);if(!f)throw new ReferenceError("No way to load representation index");if(u)h=new DataView(d,f.from-o,f.to-f.from+1);else{let t=yield this.fetch(e.url,{range:f,priority:i,measureThroughput:!1});if(!t)return null;h=new DataView(t)}let m=t.parseSegments(h,p,f);return{init:p,dataView:new DataView(d),segments:m}}.bind(this)),this.fetchTemplateRepresentation=(0,u.abortable)(this.abortAllController.signal,async function*(e,t){if("template"!==e.type)return null;let i=new URL(e.initUrl,e.baseUrl).toString(),r=yield this.fetch(i,{priority:t,measureThroughput:!1});return r?{init:null,segments:e.segments.map((e=>({...e,status:"none",size:void 0}))),dataView:new DataView(r)}:null}.bind(this)),this.throughputEstimator=e,this.requestQuic=t,this.compatibilityMode=r,this.tracer=i.createComponentTracer("Fetcher"),this.useEnableSubtitlesParam=a}},To=e=>{if(!wo(e))throw e},Co=class e{updateLive(e){this.processStreams(e?.streams.text)}seekLive(e){this.processStreams(e)}maintain(e=this.getCurrentPosition()){if(!(0,u.isNullable)(e))for(let t of this.representations)for(let i of t){let t=i.segmentReference,r=t.segments.length,a=t.segments[0].time.from,s=t.segments[r-1].time.to;if(e<a||e>s)continue;let n=t.segments.find((t=>t.time.from<=e&&t.time.to>=e));!n||this.currentSegment?.time.from===n.time.from&&this.currentSegment.time.to===n.time.to||(this.currentSegment=n,this.currentRepresentation$.next({...i,label:"Live Text",language:"ru",isAuto:!0,url:new URL(n.url,t.baseUrl).toString()}))}}destroy(){this.currentRepresentation$.next(null),this.currentSegment=null,this.representations=[]}processStreams(t){for(let i of t??[]){let t=e.filterRepresentations(i.representations);if(t){this.representations[this.representationsCursor]=t,this.representationsCursor=(this.representationsCursor+1)%this.maxRepresentations;break}}}static isSupported(t){return!!t?.some((t=>e.filterRepresentations(t.representations)))}static filterRepresentations(e){return e?.filter((e=>"text"===e.kind&&"segmentReference"in e&&yo(e.segmentReference)))}constructor(e,t){this.currentRepresentation$=new u.ValueSubject(null),this.maxRepresentations=4,this.representationsCursor=0,this.representations=[],this.currentSegment=null,this.getCurrentPosition=t.getCurrentPosition,this.processStreams(e)}},Eo=["timeupdate","progress","play","seeked","stalled","waiting"],Ao=["timeupdate","progress","loadeddata","playing","seeked"],Lo=class{async seekLive(e){(0,u.assertNonNullable)(this.element);let t="active"!==this.liveStreamStatus$.getValue()?(0,u.now)()-this.liveStreamEndTimestamp:0,i=this.normolizeLiveOffset(e+t);this.isActiveLive$.next(0===i),this.manifestUrlString=sr(this.manifestUrlString,i,2),this.manifest=await this.updateManifest(),this.manifest&&(this.isJumpGapAfterSeekLive=!0,await(this.videoBufferManager?.seekLive(this.manifest.streams.video)),await(this.audioBufferManager?.seekLive(this.manifest.streams.audio)),this.liveTextManager?.seekLive(this.manifest.streams.text))}initBuffer(){(0,u.assertNonNullable)(this.element),this.state$.setState("running"),this.subscription.add((0,u.merge)(...Eo.map((e=>(0,u.fromEvent)(this.element,e))),(0,u.fromEvent)(window,"online")).subscribe((()=>this.tick()),(e=>{this.error$.next({id:"DashVKPlayer",category:u.ErrorCategory.WTF,message:"Internal logic error",thrown:e})}))),this.subscription.add((0,u.fromEvent)(this.element,"progress").subscribe((()=>{this.element&&this.element.readyState===HTMLMediaElement.HAVE_CURRENT_DATA&&!this.element.seeking&&(this.element.currentTime=this.element.currentTime)}))),this.subscription.add((0,u.fromEvent)(this.element,"waiting").subscribe((()=>{this.element&&this.element.readyState===HTMLMediaElement.HAVE_CURRENT_DATA&&!this.element.seeking&&es(this.element.buffered,1e3*this.element.currentTime)&&(this.element.currentTime=this.element.currentTime);this.stallWatchdogSubscription?.unsubscribe(),this.stallWatchdogSubscription=(0,u.interval)(50).subscribe((()=>{if(!this.element||"open"!==this.source?.readyState)return;let e=this.currentStallDuration$.getValue();e+=50,this.currentStallDuration$.next(e);let t={timeInWaiting:e},i=(0,u.now)(),r=this.videoBufferManager?.lastDataObtainedTimestamp??0;this.videoLastDataObtainedTimestamp$.next(r);let a=this.audioBufferManager?.lastDataObtainedTimestamp??0,s=this.videoBufferManager?.getForwardBufferDuration()??0,n=this.audioBufferManager?.getForwardBufferDuration()??0,o=s<100&&i-r>this.tuning.dash.crashOnStallTWithoutDataTimeout,l=this.audioBufferManager&&n<100&&i-a>this.tuning.dash.crashOnStallTWithoutDataTimeout;if((o||l)&&e>this.tuning.dash.crashOnStallTWithoutDataTimeout||e>=this.tuning.dash.crashOnStallTimeout)throw new Error(`Stall timeout exceeded: ${e} ms`);if(this.isLive$.getValue()&&e%2e3==0){let e=this.normolizeLiveOffset(-1*this.livePositionFromPlayer$.getValue()*1e3);this.seekLive(e).catch((e=>{this.error$.next({id:"stallIntervalCallback",category:u.ErrorCategory.VIDEO_PIPELINE,message:"stallIntervalCallback failed",thrown:e})})),t.liveLastOffset=e}else{let e=1e3*this.element.currentTime;this.videoBufferManager?.maintain(e),this.audioBufferManager?.maintain(e),t.position=e}this.tracer.log("stallIntervalCallback",(0,u.flattenObject)(t))}),(e=>{this.error$.next({id:"StallWatchdogCallback",category:u.ErrorCategory.NETWORK,message:"Can't restore DASH after stall.",thrown:e})})),this.subscription.add(this.stallWatchdogSubscription)}))),this.tick()}async switchRepresentation(e,t,i=!1){let r={video:this.videoBufferManager,audio:this.audioBufferManager,text:null}[e];return this.tuning.useNewSwitchTo?this.currentStallDuration$.getValue()>0?r?.switchToWithPreviousAbort(t,i):r?.switchTo(t,i):r?.switchToOld(t,i)}async seek(e,t){let i;(0,u.assertNonNullable)(this.element),(0,u.assertNonNullable)(this.videoBufferManager),i=t||1e3*this.element.duration<=this.tuning.dashSeekInSegmentDurationThreshold||Math.abs(1e3*this.element.currentTime-e)<=this.tuning.dashSeekInSegmentAlwaysSeekDelta?e:Math.max(this.videoBufferManager.findSegmentStartTime(e)??e,this.audioBufferManager?.findSegmentStartTime(e)??e),this.warmUpMediaSourceIfNeeded(i),es(this.element.buffered,i)||await Promise.all([this.videoBufferManager.abort(),this.audioBufferManager?.abort()]),!(0,u.isNullable)(this.element)&&!(0,u.isNullable)(this.videoBufferManager)&&(this.videoBufferManager.maintain(i),this.audioBufferManager?.maintain(i),this.element.currentTime=i/1e3,this.tracer.log("seek",(0,u.flattenObject)({requestedPosition:e,forcePrecise:t,position:i})))}warmUpMediaSourceIfNeeded(e=this.element?.currentTime){(0,u.isNonNullable)(this.element)&&(0,u.isNonNullable)(this.source)&&(0,u.isNonNullable)(e)&&"ended"===this.source?.readyState&&1e3*this.element.duration-e>this.tuning.dash.seekBiasInTheEnd&&this.bufferManagers.forEach((e=>e.warmUpMediaSource()))}get isStreamEnded(){return"ended"===this.source?.readyState}stop(){this.tracer.log("stop"),this.element?.querySelectorAll("source").forEach((e=>{URL.revokeObjectURL(e.src),e.remove()})),this.element=null,this.source=null,this.manifest=null,this.currentVideoRepresentation$.next(void 0),this.videoBufferManager?.destroy(),this.videoBufferManager=null,this.audioBufferManager?.destroy(),this.audioBufferManager=null,this.bufferManagers=[],this.state$.setState("none")}setBufferTarget(e){for(let t of this.bufferManagers)t.setTarget(e)}getStreams(){return this.manifest?.streams}setPreloadOnly(e){for(let t of this.bufferManagers)t.setPreloadOnly(e)}destroy(){this.subscription.unsubscribe(),this.representationSubscription.unsubscribe(),this.timeoutSourceOpenId&&clearTimeout(this.timeoutSourceOpenId),this.destroyController.abort(),this.fetcher.destroy(),this.stop(),"open"===this.source?.readyState&&Array.from(this.source.sourceBuffers).every((e=>!e.updating))&&this.source.endOfStream(),this.source=null,this.tracer.end()}initTracerSubscription(){let e=(0,u.getTraceSubscriptionMethod)(this.tracer.error.bind(this.tracer));this.subscription.add(this.error$.subscribe(e("error")))}isManualDecreasePlaybackInLive(){return!(!this.element||!this.isLive$.getValue())&&1-this.element.playbackRate>this.tuning.dashCmafLive.lowLatency.playbackCatchupSpeedup}normolizeLiveOffset(e){return 1e3*Math.trunc(e/1e3)}async updateLive(){this.isUpdatingLive=!0,this.manifest=await this.updateManifest(),this.manifest&&(this.bufferManagers?.forEach((e=>e.updateLive(this.manifest))),this.liveTextManager?.updateLive(this.manifest)),this.isUpdatingLive=!1}jumpGap(){if(!this.element||!this.videoBufferManager)return;let e=this.videoBufferManager.getBufferedTo();if(null===e)return;let t=this.isActiveLive$.getValue()&&this.isLowLatency$.getValue();this.isJumpGapAfterSeekLive&&!t&&this.element.currentTime>e&&(this.isJumpGapAfterSeekLive=!1,this.element.currentTime=0);let i=1e3*this.element.currentTime,r=null,a=this.element.readyState===HTMLMediaElement.HAVE_METADATA?this.tuning.endGapTolerance:0;for(let e of this.bufferManagers)for(let t of e.gaps)e.playingRepresentation$.getValue()===t.representation&&t.from-a<=i&&t.to+a>i&&(1e3*this.element.duration-t.to<this.tuning.endGapTolerance?r=1/0:(null===r||t.to>r)&&(r=t.to));if(null!==r){let e=r+10;this.gapWatchdogSubscription.unsubscribe(),this.gapWatchdogActive=!1,e===1/0?this.forceEnded$.next():(this.element.currentTime=e/1e3,this.tracer.log("jumpGap",(0,u.flattenObject)({isJumpGapAfterSeekLive:this.isJumpGapAfterSeekLive,isActiveLowLatency:t,initialCurrentTime:this.element.currentTime,jumpTo:e,resultCurrentTime:this.element.currentTime})))}}constructor(e){this.element=null,this.manifestUrlString="",this.source=null,this.manifest=null,this.subscription=new u.Subscription,this.representationSubscription=new u.Subscription,this.state$=new lr("none"),this.currentVideoRepresentation$=new u.ValueSubject(void 0),this.currentVideoRepresentationInit$=new u.ValueSubject(void 0),this.currentAudioRepresentation$=new u.ValueSubject(void 0),this.currentVideoSegmentLength$=new u.ValueSubject(0),this.currentAudioSegmentLength$=new u.ValueSubject(0),this.error$=new u.Subject,this.lastConnectionType$=new u.ValueSubject(void 0),this.lastConnectionReused$=new u.ValueSubject(void 0),this.lastRequestFirstBytes$=new u.ValueSubject(void 0),this.currentLiveTextRepresentation$=new u.ValueSubject(null),this.isLive$=new u.ValueSubject(!1),this.isActiveLive$=new u.ValueSubject(!1),this.isLowLatency$=new u.ValueSubject(!1),this.liveDuration$=new u.ValueSubject(0),this.liveSeekableDuration$=new u.ValueSubject(0),this.liveAvailabilityStartTime$=new u.ValueSubject(0),this.liveStreamStatus$=new u.ValueSubject(void 0),this.bufferLength$=new u.ValueSubject(0),this.liveLatency$=new u.ValueSubject(void 0),this.liveLoadBufferLength$=new u.ValueSubject(0),this.livePositionFromPlayer$=new u.ValueSubject(0),this.currentStallDuration$=new u.ValueSubject(0),this.videoLastDataObtainedTimestamp$=new u.ValueSubject(0),this.fetcherRecoverableError$=new u.Subject,this.fetcherError$=new u.Subject,this.liveStreamEndTimestamp=0,this.isUpdatingLive=!1,this.isJumpGapAfterSeekLive=!1,this.forceEnded$=new u.Subject,this.gapWatchdogActive=!1,this.destroyController=new Ya,this.initManifest=(0,u.abortable)(this.destroyController.signal,async function*(e,t,i){this.tracer.log("initManifest"),this.element=e,this.manifestUrlString=sr(t,i,2),this.state$.startTransitionTo("manifest_ready"),this.manifest=yield this.updateManifest(),this.manifest?.streams.video.length?this.state$.setState("manifest_ready"):this.error$.next({id:"NoRepresentations",category:u.ErrorCategory.PARSER,message:"No playable video representations"})}.bind(this)),this.updateManifest=(0,u.abortable)(this.destroyController.signal,async function*(){this.tracer.log("updateManifestStart",{manifestUrl:this.manifestUrlString});let e=yield this.fetcher.fetchManifest(this.manifestUrlString).catch((e=>{!this.manifest&&!this.bufferLength$.getValue()&&this.error$.next({id:"LoadManifest",category:u.ErrorCategory.NETWORK,message:"Failed to load manifest",thrown:e})}));if(!e)return null;let t=null;try{t=((e,t)=>{let i,r={video:[],audio:[],text:[]},a=(new DOMParser).parseFromString(e,"application/xml").children[0],s=Array.from(a.querySelectorAll("MPD > BaseURL").values()).map((e=>e.textContent?.trim()??"")),n=(0,lo.default)(s,0)??"",o="dynamic"===a.getAttribute("type"),l=a.getAttribute("availabilityStartTime"),d=a.getAttribute("publishTime"),c=a.getElementsByTagName("vk:Attrs")[0],h=c?.getElementsByTagName("vk:XLatestSegmentPublishTime")[0].textContent,p=c?.getElementsByTagName("vk:XStreamIsLive")[0].textContent,f=c?.getElementsByTagName("vk:XStreamIsUnpublished")[0].textContent,m=c?.getElementsByTagName("vk:XPlaybackDuration")[0].textContent;o&&(i={availabilityStartTime:l?new Date(l).getTime():0,publishTime:d?new Date(d).getTime():0,latestSegmentPublishTime:h?new Date(h).getTime():0,streamIsAlive:"yes"===p,streamIsUnpublished:"yes"===f});let v,g=a.getAttribute("mediaPresentationDuration"),b=[...a.getElementsByTagName("Period")],y=b.reduce(((e,t)=>({...e,[t.id]:t.children})),{}),w=b.reduce(((e,t)=>({...e,[t.id]:t.getAttribute("duration")})),{});g?v=xo(g):(0,uo.default)(w).filter((e=>e)).length&&!o?v=(0,uo.default)(w).reduce(((e,t)=>e+(xo(t)??0)),0):m&&(v=parseInt(m,10));let S=0,x=a.getAttribute("profiles")?.split(",")??[];for(let e of b.map((e=>e.id)))for(let i of y[e]){let e=i.getAttribute("id")??"id"+(S++).toString(10),a=i.getAttribute("mimeType")??"",s=i.getAttribute("codecs")??"",o=i.getAttribute("contentType")??a?.split("/")[0],l=i.getAttribute("profiles")?.split(",")??[],d=co(i.getAttribute("lang")??"")??{},c=i.querySelector("Label")?.textContent?.trim()??void 0,h=i.querySelectorAll("Representation"),p=i.querySelector("SegmentTemplate"),f=i.querySelector("Role")?.getAttribute("value")??void 0,m=o,g={id:e,language:d.language,isDefault:"main"===f,label:c,codecs:s,hdr:"video"===m&&Bs(s),mime:a,representations:[]};for(let e of h){var $,_,k,T,C;let r,h=e.getAttribute("lang")??void 0,f=c??i.getAttribute("label")??e.getAttribute("label")??void 0,b=e.querySelector("BaseURL")?.textContent?.trim()??"",y=new URL(b||n,t).toString(),w=e.getAttribute("mimeType")??a,E=e.getAttribute("codecs")??s??"";if("text"===o){let t=e.getAttribute("id")||"",i=d.privateuse?.includes("x-auto")||t.includes("_auto"),a=e.querySelector("SegmentTemplate");if(a){let s={representationId:e.getAttribute("id")??void 0,bandwidth:e.getAttribute("bandwidth")??void 0},n=parseInt(e.getAttribute("bandwidth")??"",10)/1e3,o=parseInt(a.getAttribute("startNumber")??"",10)??1,l=parseInt(a.getAttribute("timescale")??"",10),u=a.querySelectorAll("SegmentTimeline S")??[],d=a.getAttribute("media");if(!d)continue;let c=[],h=0,p="",f=0,m=o,g=0;for(let e of u){let t=parseInt(e.getAttribute("d")??"",10),i=parseInt(e.getAttribute("r")??"",10)||0,r=parseInt(e.getAttribute("t")??"",10);g=Number.isFinite(r)?r:g;let a=t/l*1e3,n=g/l*1e3;for(let e=0;e<i+1;e++){let i=$o(d,{...s,segmentNumber:m.toString(10),segmentTime:(g+e*t).toString(10)}),r=(n??0)+e*a,o=r+a;m++,c.push({time:{from:r,to:o},url:i})}g+=(i+1)*t,h+=(i+1)*a}f=g/l*1e3,p=$o(d,{...s,segmentNumber:m.toString(10),segmentTime:g.toString(10)}),r={id:t,kind:"text",segmentReference:{type:"template",baseUrl:y,segmentTemplateUrl:d,initUrl:"",totalSegmentsDurationMs:h,segments:c,nextSegmentBeyondManifest:{time:{from:f,to:1/0},url:p},timescale:l},profiles:[],duration:v,bitrate:n,mime:"",codecs:"",width:0,height:0,isAuto:i}}else r={id:t,isAuto:i,kind:"text",url:y}}else{let t,a=e.getAttribute("contentType")??w?.split("/")[0]??o,s=i.getAttribute("profiles")?.split(",")??[],n=parseInt(e.getAttribute("width")??"",10),d=parseInt(e.getAttribute("height")??"",10),c=parseInt(e.getAttribute("bandwidth")??"",10)/1e3,h=e.getAttribute("frameRate")??"",f=e.getAttribute("quality")??void 0,g=h?Ds(h):void 0,b=`${e.getAttribute("id")??"id"+(S++).toString(10)}@${"video"===a?`${d}p`:"audio"===a?`${c}Kbps`:E}`,$=[...x,...l,...s],_=e.querySelector("SegmentBase"),k=e.querySelector("SegmentTemplate")??p;if(_){let i=e.querySelector("SegmentBase Initialization")?.getAttribute("range")??"",[r,a]=i.split("-").map((e=>parseInt(e,10))),s={from:r,to:a},n=e.querySelector("SegmentBase")?.getAttribute("indexRange"),[o,l]=n?n.split("-").map((e=>parseInt(e,10))):[];t={type:"byteRange",url:y,initRange:s,indexRange:n?{from:o,to:l}:void 0}}else{if(!k)throw new ReferenceError("Unknown MPD segment referencing type");{let i={representationId:e.getAttribute("id")??void 0,bandwidth:e.getAttribute("bandwidth")??void 0},r=parseInt(k.getAttribute("timescale")??"",10),a=k.getAttribute("initialization")??"",s=k.getAttribute("media"),n=parseInt(k.getAttribute("startNumber")??"",10)??1,o=$o(a,i);if(!s)throw new ReferenceError("No media attribute in SegmentTemplate");let l=k.querySelectorAll("SegmentTimeline S")??[],d=[],c=0,h="",p=0;if(l.length){let e=n,t=0;for(let a of l){let n=parseInt(a.getAttribute("d")??"",10),o=parseInt(a.getAttribute("r")??"",10)||0,l=parseInt(a.getAttribute("t")??"",10);t=Number.isFinite(l)?l:t;let u=n/r*1e3,h=t/r*1e3;for(let r=0;r<o+1;r++){let a=$o(s,{...i,segmentNumber:e.toString(10),segmentTime:(t+r*n).toString(10)}),o=(h??0)+r*u,l=o+u;e++,d.push({time:{from:o,to:l},url:a})}t+=(o+1)*n,c+=(o+1)*u}p=t/r*1e3,h=$o(s,{...i,segmentNumber:e.toString(10),segmentTime:t.toString(10)})}else if((0,u.isNonNullable)(v)){let e=parseInt(k.getAttribute("duration")??"",10)/r*1e3,t=Math.ceil(v/e),a=0;for(let r=1;r<t;r++){let t=$o(s,{...i,segmentNumber:r.toString(10),segmentTime:a.toString(10)});d.push({time:{from:a,to:a+e},url:t}),a+=e}p=a,h=$o(s,{...i,segmentNumber:t.toString(10),segmentTime:a.toString(10)})}t={type:"template",baseUrl:y,segmentTemplateUrl:s,initUrl:o,totalSegmentsDurationMs:c,segments:d,nextSegmentBeyondManifest:{time:{from:p,to:1/0},url:h},timescale:r}}}if(!a||!w)continue;let T={video:"video",audio:"audio",text:"text"}[a];if(!T)continue;m||(m=T),r={id:b,kind:T,segmentReference:t,profiles:$,duration:v,bitrate:c,mime:w,codecs:E,width:n,height:d,fps:g,quality:f}}($=g).language||($.language=h),(_=g).label||(_.label=f),(k=g).mime||(k.mime=w),(T=g).codecs||(T.codecs=E),(C=g).hdr||(C.hdr="video"===m&&Bs(E)),g.representations.push(r)}if(m){let e=r[m].find((e=>e.id===g.id));if(e&&g.representations.every((e=>yo(e.segmentReference))))for(let t of e.representations){let e=g.representations.find((e=>e.id===t.id))?.segmentReference,i=t.segmentReference;i.segments.push(...e.segments),i.nextSegmentBeyondManifest=e.nextSegmentBeyondManifest}else r[m].push(g)}}return{duration:v,streams:r,baseUrls:s,live:i}})(e??"",this.manifestUrlString)}catch(t){let i=Ja(e)??{id:"ManifestParsing",category:u.ErrorCategory.PARSER,message:"Failed to parse MPD manifest",thrown:t};this.error$.next(i)}if(!t)return null;let i=(e,t,i)=>!!(this.element?.canPlayType?.(t)&&Pr()?.isTypeSupported?.(`${t}; codecs="${i}"`)||"text"===e);if(t.live){this.isLive$.next(!!t.live);let{availabilityStartTime:e,latestSegmentPublishTime:i,streamIsUnpublished:r,streamIsAlive:a}=t.live,s=(t.duration??0)/1e3;this.liveSeekableDuration$.next(-1*s),this.liveDuration$.next((i-e)/1e3),this.liveAvailabilityStartTime$.next(t.live.availabilityStartTime);let n="active";a||(n=r?"unpublished":"unexpectedly_down"),this.liveStreamStatus$.next(n)}let r={text:t.streams.text,video:[],audio:[]};for(let e of["video","audio"]){let a=t.streams[e].filter((({mime:t,codecs:r})=>i(e,t,r))),s=new Set(a.map((({codecs:e})=>e))),n=yn(s);if(n&&(r[e]=a.filter((({codecs:e})=>e.startsWith(n)))),"video"===e){let e=this.tuning.preferHDR,t=r.video.some((e=>e.hdr)),i=r.video.some((e=>!e.hdr));Fr.display.isHDR&&e&&t?r.video=r.video.filter((e=>e.hdr)):i&&(r.video=r.video.filter((e=>!e.hdr)))}}let a={...t,streams:r};return this.tracer.log("updateManifestEnd",(0,u.flattenObject)(a)),a}.bind(this)),this.initRepresentations=(0,u.abortable)(this.destroyController.signal,async function*(e,t,i){this.tracer.log("initRepresentationsStart",(0,u.flattenObject)({initialVideo:e,initialAudio:t,sourceHls:i})),(0,u.assertNonNullable)(this.manifest),(0,u.assertNonNullable)(this.element),this.representationSubscription.unsubscribe(),this.representationSubscription=new u.Subscription,this.state$.startTransitionTo("representations_ready");let r=e=>{this.representationSubscription.add((0,u.fromEvent)(e,"error").pipe((0,u.filter)((e=>!!this.element?.played.length))).subscribe((e=>{this.error$.next({id:"VideoSource",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Unexpected video source error",thrown:e})})))};this.source=this.tuning.useManagedMediaSource?Ir():new MediaSource;let a=document.createElement("source");if(r(a),a.src=URL.createObjectURL(this.source),this.element.appendChild(a),this.tuning.useManagedMediaSource&&Mr())if(i){let e=document.createElement("source");r(e),e.type="application/x-mpegurl",e.src=i.url,this.element.appendChild(e)}else this.element.disableRemotePlayback=!0;this.isActiveLive$.next(this.isLive$.getValue());let s={fetcher:this.fetcher,tuning:this.tuning,getCurrentPosition:()=>this.element?1e3*this.element.currentTime:void 0,isActiveLowLatency:()=>this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),manifest:this.manifest},n=this.manifest.streams.video.reduce(((e,t)=>[...e,...t.representations]),[]);if(this.videoBufferManager=new _o("video",this.source,n,s),this.bufferManagers=[this.videoBufferManager],(0,u.isNonNullable)(t)){let e=this.manifest.streams.audio.reduce(((e,t)=>[...e,...t.representations]),[]);this.audioBufferManager=new _o("audio",this.source,e,s),this.bufferManagers.push(this.audioBufferManager)}Co.isSupported(this.manifest.streams.text)&&!this.isLowLatency$.getValue()&&(this.liveTextManager=new Co(this.manifest.streams.text,s)),this.representationSubscription.add(this.fetcher.lastConnectionType$.subscribe(this.lastConnectionType$)),this.representationSubscription.add(this.fetcher.lastConnectionReused$.subscribe(this.lastConnectionReused$)),this.representationSubscription.add(this.fetcher.lastRequestFirstBytes$.subscribe(this.lastRequestFirstBytes$));let o=()=>{this.stallWatchdogSubscription?.unsubscribe(),this.currentStallDuration$.next(0)};if(this.representationSubscription.add((0,u.merge)(...Ao.map((e=>(0,u.fromEvent)(this.element,e)))).pipe((0,u.map)((e=>this.element?za(this.element.buffered,1e3*this.element.currentTime):0)),(0,u.filterChanged)(),(0,u.tap)((e=>{e>this.tuning.dash.bufferEmptinessTolerance&&o()}))).subscribe(this.bufferLength$)),this.representationSubscription.add((0,u.merge)((0,u.fromEvent)(this.element,"ended"),this.forceEnded$).subscribe((()=>{o()}))),this.isLive$.getValue()){this.subscription.add(this.liveDuration$.pipe((0,u.filterChanged)()).subscribe((e=>this.liveStreamEndTimestamp=(0,u.now)()))),this.subscription.add((0,u.fromEvent)(this.element,"pause").subscribe((()=>{this.livePauseWatchdogSubscription=(0,u.interval)(1e3).subscribe((e=>{let t=nr(this.manifestUrlString,2);this.manifestUrlString=sr(this.manifestUrlString,t+1e3,2),"active"===this.liveStreamStatus$.getValue()&&this.updateManifest()})),this.subscription.add(this.livePauseWatchdogSubscription)}))).add((0,u.fromEvent)(this.element,"play").subscribe((e=>this.livePauseWatchdogSubscription?.unsubscribe()))),this.representationSubscription.add((0,u.combine)({isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).pipe((0,u.map)((({isActiveLive:e,isLowLatency:t})=>e&&t)),(0,u.filterChanged)()).subscribe((e=>{this.isManualDecreasePlaybackInLive()||hn(this.element,1)}))),this.representationSubscription.add((0,u.combine)({bufferLength:this.bufferLength$,isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).pipe((0,u.filter)((({bufferLength:e,isActiveLive:t,isLowLatency:i})=>t&&i&&!!e))).subscribe((({bufferLength:e})=>this.liveBuffer.next(e)))),this.representationSubscription.add(this.videoBufferManager.currentLowLatencySegmentLength$.subscribe((e=>{if(!this.isActiveLive$.getValue()&&!this.isLowLatency$.getValue()&&!e)return;let t=this.liveSeekableDuration$.getValue()-e/1e3;this.liveSeekableDuration$.next(Math.max(t,-1*this.tuning.dashCmafLive.maxLiveDuration)),this.liveDuration$.next(this.liveDuration$.getValue()+e/1e3)}))),this.representationSubscription.add((0,u.combine)({isLive:this.isLive$,rtt:this.throughputEstimator.rtt$,bufferLength:this.bufferLength$,segmentServerLatency:this.videoBufferManager.currentLiveSegmentServerLatency$}).pipe((0,u.filter)((({isLive:e})=>e)),(0,u.filterChanged)(((e,t)=>t.bufferLength<e.bufferLength)),(0,u.map)((({rtt:e,bufferLength:t,segmentServerLatency:i})=>(e/2+t+i+nr(this.manifestUrlString,2))/1e3))).subscribe(this.liveLatency$)),this.representationSubscription.add((0,u.combine)({liveBuffer:this.liveBuffer.smoothed$,isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).subscribe((({liveBuffer:e,isActiveLive:t,isLowLatency:i})=>{if(!i||!t)return;let r=this.tuning.dashCmafLive.lowLatency.maxTargetOffset,a=this.tuning.dashCmafLive.lowLatency.maxTargetOffsetDeviation,s=this.tuning.dashCmafLive.lowLatency.playbackCatchupSpeedup,n=e-r;if(this.isManualDecreasePlaybackInLive())return;let o=1;Math.abs(n)>a&&(o=1+Math.sign(n)*s),hn(this.element,o)}))),this.representationSubscription.add(this.bufferLength$.subscribe((e=>{let t=0;if(e){let e=1e3*(this.element?.currentTime??0);t=Math.min(...this.bufferManagers.map((t=>t.getLiveSegmentsToLoadState(this.manifest)?.to??e)))-e}this.liveLoadBufferLength$.getValue()!==t&&this.liveLoadBufferLength$.next(t)})));let e=0;this.representationSubscription.add((0,u.combine)({liveLoadBufferLength:this.liveLoadBufferLength$,bufferLength:this.bufferLength$}).pipe((0,u.throttle)(1e3)).subscribe((async({liveLoadBufferLength:t,bufferLength:i})=>{if(!this.element||this.isUpdatingLive)return;let r=this.element.playbackRate,a=nr(this.manifestUrlString,2),s=1e3*Math.abs(this.livePositionFromPlayer$.getValue()),n=Math.min(s,this.tuning.dashCmafLive.normalizedTargetMinBufferSize*r),o=this.tuning.dashCmafLive.normalizedActualBufferOffset*r,l=this.tuning.dashCmafLive.normalizedLiveMinBufferSize*r,u=isFinite(t)?t:i,d=this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),c=s<=this.tuning.live.activeLiveDelay;this.isActiveLive$.next(c);let h="none";if(d?h="active_low_latency":this.isLowLatency$.getValue()&&c?(this.bufferManagers.forEach((e=>e.proceedLowLatencyLive())),h="active_low_latency"):0!==a&&u<n?h="live_forward_buffering":u<n+l&&(h="live_with_target_offset"),isFinite(t)&&(e=t>e?t:e),"live_forward_buffering"===h||"live_with_target_offset"===h){let i=e-(n+o),s=this.normolizeLiveOffset(Math.trunc(a+i/r)),l=Math.abs(s-a),u=0;!t||l<=this.tuning.dashCmafLive.offsetCalculationError?u=a:s>0&&l>this.tuning.dashCmafLive.offsetCalculationError&&(u=s),this.manifestUrlString=sr(this.manifestUrlString,u,2)}("live_with_target_offset"===h||"live_forward_buffering"===h)&&(e=0,await this.updateLive())}),(e=>{this.error$.next({id:"updateLive",category:u.ErrorCategory.VIDEO_PIPELINE,thrown:e,message:"Failed to update live with subscription"})})))}let l=(0,u.merge)(...this.bufferManagers.map((e=>e.fullyBuffered$))).pipe((0,u.map)((()=>this.bufferManagers.every((e=>e.fullyBuffered$.getValue()))))),d=(0,u.merge)(...this.bufferManagers.map((e=>e.onLastSegment$))).pipe((0,u.map)((()=>this.bufferManagers.some((e=>e.onLastSegment$.getValue()))))),c=(0,u.combine)({allBuffersFull:l,someBufferEnded:d}).pipe((0,u.filterChanged)(),(0,u.map)((({allBuffersFull:e,someBufferEnded:t})=>e&&t)),(0,u.filter)((e=>e)));if(this.representationSubscription.add((0,u.merge)(this.forceEnded$,c).subscribe((()=>{if(this.source&&"open"===this.source.readyState&&Array.from(this.source.sourceBuffers).every((e=>!e.updating)))try{this.source?.endOfStream()}catch(e){this.error$.next({id:"EndOfStream",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Failed to end MediaSource stream",thrown:e})}}))),this.representationSubscription.add((0,u.merge)(...this.bufferManagers.map((e=>e.error$))).subscribe(this.error$)),this.representationSubscription.add(this.videoBufferManager.playingRepresentation$.subscribe(this.currentVideoRepresentation$)),this.representationSubscription.add(this.videoBufferManager.playingRepresentationInit$.subscribe(this.currentVideoRepresentationInit$)),this.representationSubscription.add(this.videoBufferManager.currentSegmentLength$.subscribe(this.currentVideoSegmentLength$)),this.audioBufferManager&&(this.representationSubscription.add(this.audioBufferManager.playingRepresentation$.subscribe(this.currentAudioRepresentation$)),this.representationSubscription.add(this.audioBufferManager.currentSegmentLength$.subscribe(this.currentAudioSegmentLength$))),this.liveTextManager&&this.representationSubscription.add(this.liveTextManager.currentRepresentation$.subscribe(this.currentLiveTextRepresentation$)),"open"!==this.source.readyState){let e=this.tuning.dash.sourceOpenTimeout>=0;yield new Promise((t=>{e&&(this.timeoutSourceOpenId=setTimeout((()=>{"open"!==this.source?.readyState?this.error$.next({id:"OpenOfStream",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Failed to open MediaSource",thrown:new Error("Timeout reject when wait sourceopen event"),traceAsLog:!0}):t()}),this.tuning.dash.sourceOpenTimeout)),this.source?.addEventListener("sourceopen",(()=>{this.timeoutSourceOpenId&&clearTimeout(this.timeoutSourceOpenId),t()}),{once:!0})}))}if(!this.isLive$.getValue()){let e=[this.manifest.duration??0,...(0,In.default)((0,In.default)([...this.manifest.streams.audio,...this.manifest.streams.video],(e=>e.representations)),(e=>{let t=[];return e.duration&&t.push(e.duration),yo(e.segmentReference)&&e.segmentReference.totalSegmentsDurationMs&&t.push(e.segmentReference.totalSegmentsDurationMs),t}))];this.source.duration=Math.max(...e)/1e3}this.audioBufferManager&&(0,u.isNonNullable)(t)?yield Promise.all([this.videoBufferManager.startWith(e),this.audioBufferManager.startWith(t)]):yield this.videoBufferManager.startWith(e),this.state$.setState("representations_ready"),this.tracer.log("initRepresentationsEnd")}.bind(this)),this.tick=()=>{if(!this.element||!this.videoBufferManager||"open"!==this.source?.readyState)return;let e=1e3*this.element.currentTime;this.videoBufferManager.maintain(e),this.audioBufferManager?.maintain(e),this.liveTextManager?.maintain(e),(this.videoBufferManager.gaps.length||this.audioBufferManager?.gaps.length)&&!this.gapWatchdogActive&&(this.gapWatchdogActive=!0,this.gapWatchdogSubscription=(0,u.interval)(this.tuning.gapWatchdogInterval).subscribe((()=>this.jumpGap()),(e=>{this.error$.next({id:"GapWatchdog",category:u.ErrorCategory.WTF,message:"Error handling gaps",thrown:e})})),this.subscription.add(this.gapWatchdogSubscription))},this.throughputEstimator=e.throughputEstimator,this.tuning=e.tuning,this.tracer=e.tracer.createComponentTracer(this.constructor.name),this.fetcher=new ko({throughputEstimator:this.throughputEstimator,requestQuic:this.tuning.requestQuick,compatibilityMode:e.compatibilityMode,tracer:this.tracer,useEnableSubtitlesParam:e.tuning.useEnableSubtitlesParam}),this.subscription.add(this.fetcher.recoverableError$.subscribe(this.fetcherRecoverableError$)),this.subscription.add(this.fetcher.error$.subscribe(this.fetcherError$)),this.liveBuffer=cn.getLiveBufferSmoothedValue(this.tuning.dashCmafLive.lowLatency.maxTargetOffset,{...e.tuning.dashCmafLive.lowLatency.bufferEstimator}),this.initTracerSubscription()}},Po=class{connect({observableVideo:e,video:t}){let i=e=>{let t=e.target;this.pipSize$.next({width:t.width,height:t.height})};this.subscription.add((0,u.observeElementSize)(t).subscribe(this.videoSize$)).add(e.enterPip$.subscribe((({pictureInPictureWindow:e})=>{this.pipSize$.next({width:e.width,height:e.height}),e.addEventListener("resize",i),this.pictureInPictureWindowRemoveEventListener=()=>{e.removeEventListener("resize",i)}}))).add(e.leavePip$.subscribe((()=>{this.pictureInPictureWindowRemoveEventListener()}))).add((0,u.combine)({videoSize:this.videoSize$,pipSize:this.pipSize$,inPip:e.inPiP$}).pipe((0,u.map)((({videoSize:e,inPip:t,pipSize:i})=>t?i:e))).subscribe(this.elementSize$))}getValue(){return this.elementSize$.getValue()}subscribe(e,t){return this.elementSize$.subscribe(e,t)}getObservable(){return this.elementSize$}destroy(){this.pictureInPictureWindowRemoveEventListener(),this.subscription.unsubscribe()}constructor(){this.subscription=new u.Subscription,this.pipSize$=new u.ValueSubject(void 0),this.videoSize$=new u.ValueSubject(void 0),this.elementSize$=new u.ValueSubject(void 0),this.pictureInPictureWindowRemoveEventListener=u.noop}},Mo=class{getProviderSubscriptionInfo(){let{output:e,desiredState:t}=this.params,i=jr(this.video);this.subscription.add((()=>i.destroy()));let r=this.constructor.name,a=t=>{e.error$.next({id:r,category:u.ErrorCategory.WTF,message:`${r} internal logic error`,thrown:t})};return{output:e,desiredState:t,observableVideo:i,genericErrorListener:a,connect:(e,t)=>this.subscription.add(e.subscribe(t,a))}}subscribe(){let{output:e,desiredState:t,observableVideo:i,genericErrorListener:r,connect:a}=this.getProviderSubscriptionInfo();this.subscription.add(this.params.output.availableVideoTracks$.pipe((0,u.filter)((e=>!!e.length)),(0,u.once)()).subscribe((e=>{this.droppedFramesManager.connect({logger:this.params.dependencies.logger,video:this.video,droppedFramesChecker:this.params.tuning.droppedFramesChecker,isAuto:this.params.desiredState.autoVideoTrackSwitching,playing$:i.playing$,pause$:i.pause$,tracks:e})})));let s=this.params.desiredState.seekState.stateChangeEnded$.pipe((0,u.map)((e=>"none"!==e.to.state)),(0,u.filterChanged)());this.stallsManager.connect({isSeeked$:s,currentStallDuration$:this.player.currentStallDuration$,videoLastDataObtainedTimestamp$:this.player.videoLastDataObtainedTimestamp$,throughput$:this.params.dependencies.throughputEstimator.throughput$,rtt$:this.params.dependencies.throughputEstimator.rtt$,tuning:this.params.tuning.stallsManager,abrParams:this.params.tuning.autoTrackSelection,isBuffering$:i.isBuffering$,looped$:i.looped$,playing$:i.playing$}),a(i.ended$,e.endedEvent$),a(i.looped$,e.loopedEvent$),a(i.error$,e.error$),a(i.isBuffering$,e.isBuffering$),a(i.currentBuffer$,e.currentBuffer$),a(i.playing$,e.firstFrameEvent$),a(i.canplay$,e.canplay$),a(i.inPiP$,e.inPiP$),a(i.inFullscreen$,e.inFullscreen$),a(i.loadedMetadata$,e.loadedMetadataEvent$),a(this.player.error$,e.error$),a(this.player.fetcherRecoverableError$,e.fetcherRecoverableError$),a(this.player.fetcherError$,e.fetcherError$),a(this.player.lastConnectionType$,e.httpConnectionType$),a(this.player.lastConnectionReused$,e.httpConnectionReused$),a(this.player.isLive$,e.isLive$),a(this.player.lastRequestFirstBytes$.pipe((0,u.filter)(u.isNonNullable),(0,u.once)()),e.firstBytesEvent$),a(this.stallsManager.severeStallOccurred$,e.severeStallOccurred$),a(this.videoState.stateChangeEnded$.pipe((0,u.map)((e=>e.to))),this.params.output.playbackState$),this.subscription.add(i.looped$.subscribe((()=>this.player.warmUpMediaSourceIfNeeded()),r)),this.subscription.add(i.seeked$.subscribe(e.seekedEvent$,r)),this.subscription.add(gr(this.video,t.isLooped,r)),this.subscription.add(br(this.video,t.volume,i.volumeState$,r)),this.subscription.add(i.volumeState$.subscribe(this.params.output.volume$,r)),this.subscription.add(yr(this.video,t.playbackRate,i.playbackRateState$,r)),this.elementSizeManager.connect({video:this.video,observableVideo:i}),a(Ba(this.video,{threshold:this.params.tuning.autoTrackSelection.activeVideoAreaThreshold}),e.elementVisible$),this.subscription.add(i.playing$.subscribe((()=>{this.videoState.setState("playing"),or(t.playbackState,"playing"),this.scene3D&&this.scene3D.play()}),r)).add(i.pause$.subscribe((()=>{this.videoState.setState("paused"),or(t.playbackState,"paused")}),r)).add(i.canplay$.subscribe((()=>{"playing"===this.videoState.getState()&&this.playIfAllowed()}),r)),this.subscription.add(this.player.state$.stateChangeEnded$.subscribe((({to:e})=>{if("manifest_ready"===e){this.videoTracksMap=new Map,this.audioTracksMap=new Map,this.textTracksMap=new Map;let e=this.player.getStreams();if((0,u.assertNonNullable)(e,"Manifest not loaded or empty"),!this.params.tuning.isAudioDisabled){let t=[];for(let i of e.audio){t.push(vo(i));let e=[];for(let t of i.representations){let r=fo(t);e.push(r),this.audioTracksMap.set(r,{stream:i,representation:t})}this.audioStreamsMap.set(i,e)}this.params.output.availableAudioStreams$.next(t)}let t=[];for(let i of e.video){t.push(go(i));let e=[];for(let t of i.representations){let r=po({...t,streamId:i.id});r&&(e.push(r),this.videoTracksMap.set(r,{stream:i,representation:t}))}this.videoStreamsMap.set(i,e)}this.params.output.availableVideoStreams$.next(t);for(let t of e.text)for(let e of t.representations){let i=mo(t,e);this.textTracksMap.set(i,{stream:t,representation:e})}this.params.output.availableVideoTracks$.next(Array.from(this.videoTracksMap.keys())),this.params.output.availableAudioTracks$.next(Array.from(this.audioTracksMap.keys())),this.params.output.isAudioAvailable$.next(!!this.audioTracksMap.size),this.audioTracksMap.size&&this.textTracksMap.size&&this.params.desiredState.internalTextTracks.startTransitionTo(Array.from(this.textTracksMap.keys()))}else"representations_ready"===e&&(this.videoState.setState("ready"),this.player.initBuffer())}),r)),this.subscription.add((0,u.merge)(this.player.currentStallDuration$,this.player.state$.stateChangeEnded$,t.videoTrack.stateChangeStarted$,t.autoVideoTrackSwitching.transitionStarted$,this.params.dependencies.throughputEstimator.rttAdjustedThroughput$,t.autoVideoTrackLimits.stateChangeStarted$,t.videoStream.stateChangeStarted$,t.audioStream.stateChangeStarted$,this.elementSizeManager.getObservable(),this.params.output.elementVisible$,this.droppedFramesManager.onDroopedVideoFramesLimit$,(0,u.fromEvent)(this.video,"progress")).subscribe((async()=>{let e=this.player.state$.getState(),i=this.player.state$.getTransition();if("manifest_ready"!==e&&"running"!==e||i)return;t.autoVideoTrackSwitching.getTransition()&&t.autoVideoTrackSwitching.setState(t.autoVideoTrackSwitching.getState()),this.selectVideoAudioRepresentations();let{video:r,audio:a}=this.selectedRepresentations;if(!r)return;let s=So(this.videoTracksMap.keys(),(e=>this.videoTracksMap.get(e)?.representation.id===r.id));(0,u.isNonNullable)(s)&&(this.stallsManager.lastVideoTrackSelected=s);let n=this.params.desiredState.autoVideoTrackLimits.getTransition();if(n&&this.params.output.autoVideoTrackLimits$.next(n.to),"manifest_ready"===e)await this.player.initRepresentations(r.id,a?.id,this.params.sourceHls);else if(await this.player.switchRepresentation("video",r.id),a){let e=!!t.audioStream.getTransition();await this.player.switchRepresentation("audio",a.id,e)}}),r)),this.subscription.add(t.cameraOrientation.stateChangeEnded$.subscribe((({to:e})=>{this.scene3D&&e&&this.scene3D.pointCameraTo(e.x,e.y)}))),this.subscription.add(this.elementSizeManager.subscribe((e=>{this.scene3D&&e&&this.scene3D.setViewportSize(e.width,e.height)}))),this.subscription.add(this.player.currentVideoRepresentation$.pipe((0,u.filterChanged)()).subscribe((t=>{let i=So(this.videoTracksMap.entries(),(([,{representation:e}])=>e.id===t));if(!i)return e.currentVideoTrack$.next(void 0),void e.currentVideoStream$.next(void 0);let[r,{stream:a}]=i,s=this.params.desiredState.videoStream.getTransition();s&&s.to&&s.to.id===a.id&&this.params.desiredState.videoStream.setState(s.to),e.currentVideoTrack$.next(r),e.currentVideoStream$.next(go(a))}),r)),this.subscription.add(this.player.currentAudioRepresentation$.pipe((0,u.filterChanged)()).subscribe((t=>{let i=So(this.audioTracksMap.entries(),(([,{representation:e}])=>e.id===t));if(!i)return void e.currentAudioStream$.next(void 0);let[r,{stream:a}]=i,s=this.params.desiredState.audioStream.getTransition();s&&s.to&&s.to.id===a.id&&this.params.desiredState.audioStream.setState(s.to),e.currentAudioStream$.next(vo(a))}),r)),this.subscription.add(this.player.currentVideoRepresentationInit$.subscribe((t=>{if(t?.is3dVideo&&this.params.tuning.spherical?.enabled)try{this.init3DScene(t),e.is3DVideo$.next(!0)}catch(t){e.warning$.next({id:"DashProvider",message:`DashProvider could not initialize 3D-scene: ${t}`})}else this.destroy3DScene(),this.params.tuning.spherical?.enabled&&e.is3DVideo$.next(!1)}),r)),this.subscription.add(this.player.currentVideoSegmentLength$.subscribe(e.currentVideoSegmentLength$,r)),this.subscription.add(this.player.currentAudioSegmentLength$.subscribe(e.currentAudioSegmentLength$,r)),this.textTracksManager.connect(this.video,t,e);let n=t.playbackState.stateChangeStarted$.pipe((0,u.map)((({to:e})=>"ready"===e)),(0,u.filterChanged)());this.subscription.add((0,u.merge)(n,t.autoVideoTrackSwitching.stateChangeStarted$,this.player.state$.stateChangeEnded$,(0,u.observableFrom)(["init"])).subscribe((()=>{let e=t.autoVideoTrackSwitching.getState(),i="ready"===t.playbackState.getState()?this.params.tuning.dash.forwardBufferTargetPreload:e?this.params.tuning.dash.forwardBufferTargetAuto:this.params.tuning.dash.forwardBufferTargetManual;this.player.setBufferTarget(i)}))),this.subscription.add((0,u.merge)(n,this.player.state$.stateChangeEnded$,(0,u.observableFrom)(["init"])).subscribe((()=>this.player.setPreloadOnly("ready"===t.playbackState.getState()))));let o=(0,u.merge)(t.playbackState.stateChangeStarted$,t.videoTrack.stateChangeStarted$,t.seekState.stateChangeEnded$,this.videoState.stateChangeEnded$,(0,u.observableFrom)(["init"])).pipe((0,u.debounce)(0));this.subscription.add(o.subscribe(this.syncPlayback,r))}selectVideoAudioRepresentations(){if(this.player.isStreamEnded)return;let e=this.params.tuning.useNewAutoSelectVideoTrack?da:ua,t=this.params.tuning.useNewAutoSelectVideoTrack?ba:ga,i=this.params.tuning.useNewAutoSelectVideoTrack?ma:va,{desiredState:r,output:a}=this.params,s=r.autoVideoTrackSwitching.getState(),n=r.videoTrack.getState()?.id,o=So(this.videoTracksMap.keys(),(e=>e.id===n)),l=a.currentVideoTrack$.getValue(),u=r.videoStream.getState()??(o&&this.videoTracksMap.get(o)?.stream)??1===this.videoStreamsMap.size?this.videoStreamsMap.keys().next().value:void 0;if(!u)return;let d=So(this.videoStreamsMap.keys(),(e=>e.id===u.id)),c=d&&this.videoStreamsMap.get(d);if(!c)return;let h,p=za(this.video.buffered,1e3*this.video.currentTime);h=this.player.isActiveLive$.getValue()?this.player.isLowLatency$.getValue()?this.params.tuning.dashCmafLive.lowLatency.maxTargetOffset:this.params.tuning.dashCmafLive.normalizedLiveMinBufferSize:this.player.isLive$.getValue()?this.params.tuning.dashCmafLive.normalizedTargetMinBufferSize:s?this.params.tuning.dash.forwardBufferTargetAuto:this.params.tuning.dash.forwardBufferTargetManual;let f=(1e3*this.video.duration||1/0)-1e3*this.video.currentTime,m=Math.min(p/Math.min(h,f||1/0),1),v=r.audioStream.getState()??(1===this.audioStreamsMap.size?this.audioStreamsMap.keys().next().value:void 0),g=v?.id&&So(this.audioStreamsMap.keys(),(e=>e.id===v.id))||this.audioStreamsMap.keys().next().value,b=0;if(g){if(o&&!s){let t=e(o,c,this.audioStreamsMap.get(g)??[],this.params.tuning.autoTrackSelection.minVideoAudioRatio);b=Math.max(b,t?.bitrate??-1/0)}if(l){let t=e(l,c,this.audioStreamsMap.get(g)??[],this.params.tuning.autoTrackSelection.minVideoAudioRatio);b=Math.max(b,t?.bitrate??-1/0)}}let y=o;(s||!y)&&(y=i(c,{container:this.elementSizeManager.getValue(),panelSize:this.params.panelSize,estimatedThroughput:this.params.dependencies.throughputEstimator.rttAdjustedThroughput$.getValue(),tuning:this.stallsManager.abrTuningParams,limits:this.params.desiredState.autoVideoTrackLimits.getState(),reserve:b,forwardBufferHealth:m,current:l,visible:this.params.output.elementVisible$.getValue(),history:this.videoTrackSwitchHistory,playbackRate:this.video.playbackRate,droppedVideoMaxQualityLimit:this.droppedFramesManager.droppedVideoMaxQualityLimit,stallsVideoMaxQualityLimit:this.stallsManager.videoMaxQualityLimit,stallsPredictedThroughput:this.stallsManager.predictedThroughput,abrLogger:this.params.dependencies.abrLogger}));let w=g&&t(y,c,this.audioStreamsMap.get(g)??[],{estimatedThroughput:this.params.dependencies.throughputEstimator.rttAdjustedThroughput$.getValue(),stallsPredictedThroughput:this.stallsManager.predictedThroughput,tuning:this.stallsManager.abrTuningParams,forwardBufferHealth:m,history:this.audioTrackSwitchHistory,playbackRate:this.video.playbackRate,abrLogger:this.params.dependencies.abrLogger}),S=this.videoTracksMap.get(y)?.representation,x=w&&this.audioTracksMap.get(w)?.representation;S&&x?(this.selectedRepresentations.video=S,this.selectedRepresentations.audio=x):S&&!x&&0===this.audioTracksMap.size&&(this.selectedRepresentations.video=S,this.selectedRepresentations.audio=null)}prepare(e=0){this.player.initManifest(this.video,this.params.source.url,e)}playIfAllowed(){$a(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:u.ErrorCategory.DOM,thrown:e})))}destroy(){this.subscription.unsubscribe(),this.droppedFramesManager.destroy(),this.stallsManager.destroy(),this.elementSizeManager.destroy(),this.destroy3DScene(),this.textTracksManager.destroy(),this.player.destroy(),this.params.output.element$.next(void 0),this.params.output.currentVideoStream$.next(void 0),fr(this.video),this.tracer.end()}constructor(e){this.subscription=new u.Subscription,this.videoState=new lr("stopped"),this.droppedFramesManager=new Va,this.stallsManager=new En,this.elementSizeManager=new Po,this.videoTracksMap=new Map,this.audioTracksMap=new Map,this.textTracksMap=new Map,this.videoStreamsMap=new Map,this.audioStreamsMap=new Map,this.videoTrackSwitchHistory=new aa,this.audioTrackSwitchHistory=new aa,this.selectedRepresentations={audio:null,video:null},this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.seekState.getState();if(!this.videoState.getTransition()){if("requested"===r.state&&"paused"!==i?.to&&"stopped"!==e&&"stopped"!==t&&this.seek(r.position,r.forcePrecise),"stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.player.stop(),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),or(this.params.desiredState.playbackState,"stopped",!0)));switch(e){case"stopped":return this.videoState.startTransitionTo("ready"),void this.prepare();case"ready":return void("paused"===t?(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused")):"playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"ready"===i?.to&&or(this.params.desiredState.playbackState,"ready"));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===t&&this.video.paused?this.playIfAllowed():"playing"===i?.to&&or(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===i?.to&&or(this.params.desiredState.playbackState,"paused"));default:return(0,u.assertNever)(e)}}},this.init3DScene=e=>{if(this.scene3D)return;this.scene3D=new kn(this.params.container,this.video,{fov:this.params.tuning.spherical.fov,orientation:this.params.tuning.spherical.orientation||{x:e.projectionData?.pose.yaw||0,y:e.projectionData?.pose.pitch||0,z:e.projectionData?.pose.roll||0},rotationSpeed:this.params.tuning.spherical.rotationSpeed,maxYawAngle:this.params.tuning.spherical.maxYawAngle,rotationSpeedCorrection:this.params.tuning.spherical.rotationSpeedCorrection,degreeToPixelCorrection:this.params.tuning.spherical.degreeToPixelCorrection,speedFadeTime:this.params.tuning.spherical.speedFadeTime,speedFadeThreshold:this.params.tuning.spherical.speedFadeThreshold});let t=this.elementSizeManager.getValue();t&&this.scene3D.setViewportSize(t.width,t.height)},this.destroy3DScene=()=>{this.scene3D&&(this.scene3D.destroy(),this.scene3D=void 0)},this.textTracksManager=new xr(e.source.url),this.params=e,this.video=pr(e.container,e.tuning),this.tracer=e.dependencies.tracer.createComponentTracer(this.constructor.name),this.params.output.element$.next(this.video),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(ya(this.params.source.url)),this.params.output.isLive$.next(!1),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.player=new Lo({throughputEstimator:this.params.dependencies.throughputEstimator,tuning:this.params.tuning,compatibilityMode:this.params.source.compatibilityMode,tracer:this.tracer}),this.subscribe()}},Io=class extends Mo{subscribe(){super.subscribe();let{output:e,observableVideo:t,connect:i}=this.getProviderSubscriptionInfo();i(t.timeUpdate$,e.position$),i(t.durationChange$,e.duration$)}seek(e,t){this.params.output.willSeekEvent$.next(),this.player.seek(e,t)}},Ro=class extends Mo{subscribe(){super.subscribe();let e=-1,{output:t,observableVideo:i,desiredState:r,connect:a}=this.getProviderSubscriptionInfo();this.params.output.position$.next(0),this.params.output.isLive$.next(!0),a(i.timeUpdate$,t.liveBufferTime$),a(this.player.liveSeekableDuration$,t.duration$),a(this.player.liveLatency$,t.liveLatency$);let s=new u.ValueSubject(1);a(i.playbackRateState$,s),this.subscription.add(this.params.output.position$.subscribe(this.player.livePositionFromPlayer$)).add(r.isLowLatency.stateChangeEnded$.pipe((0,u.map)((e=>e.to))).subscribe(this.player.isLowLatency$)).add((0,u.combine)({liveBufferTime:t.liveBufferTime$,liveAvailabilityStartTime:this.player.liveAvailabilityStartTime$}).pipe((0,u.map)((({liveBufferTime:e,liveAvailabilityStartTime:t})=>e&&t?e+t:void 0))).subscribe(t.liveTime$)).add(this.player.liveStreamStatus$.pipe((0,u.filter)((e=>(0,u.isNonNullable)(e)))).subscribe((e=>t.isLiveEnded$.next("active"!==e&&0===t.position$.getValue())))).add((0,u.combine)({liveDuration:this.player.liveDuration$,liveStreamStatus:this.player.liveStreamStatus$,playbackRate:(0,u.merge)(i.playbackRateState$,new u.ValueSubject(1))}).pipe((0,u.filter)((({liveStreamStatus:e,liveDuration:t})=>"active"===e&&!!t))).subscribe((({liveDuration:i,playbackRate:r})=>{let a=t.liveBufferTime$.getValue(),s=t.position$.getValue(),{playbackCatchupSpeedup:n}=this.params.tuning.dashCmafLive.lowLatency;s||r<1-n||this.video.paused||(0,u.isNullable)(a)||(e=i-a)}))).add((0,u.combine)({time:t.liveBufferTime$,liveDuration:this.player.liveDuration$,playbackRate:(0,u.merge)(i.playbackRateState$,new u.ValueSubject(1))}).pipe((0,u.filterChanged)(((e,t)=>"active"===this.player.liveStreamStatus$.getValue()?e.liveDuration===t.liveDuration:e.time===t.time))).subscribe((({time:i,liveDuration:r,playbackRate:a})=>{let s=t.position$.getValue(),{playbackCatchupSpeedup:n}=this.params.tuning.dashCmafLive.lowLatency;if(!s&&!this.video.paused&&a>=1-n||(0,u.isNullable)(i)||(0,u.isNullable)(r))return;let o=-1*(r-i-e);t.position$.next(Math.min(o,0))}))).add(this.player.currentLiveTextRepresentation$.subscribe((e=>{if(e){let t=(({language:e,label:t,id:i,url:r,isAuto:a})=>({id:i,url:r,isAuto:a,type:"internal",language:e,label:t}))(e);this.params.output.availableTextTracks$.next([t])}})))}seek(e){this.params.output.willSeekEvent$.next();let t=-e,i=Math.trunc(t/1e3<=Math.abs(this.params.output.duration$.getValue())?t:0);this.player.seekLive(i).then((()=>{this.params.output.position$.next(e/1e3)}))}constructor(e){super(e),this.textTracksManager.destroy()}},Vo=g(Jt(),1),No={},Bo=(e,t)=>new u.Observable((i=>{let r=(e,t)=>i.next(t);return e.on(t,r),()=>e.off(t,r)})),Do=class{destroy(){this.subscription.unsubscribe(),this.trackLevels.clear(),this.textTracksManager.destroy(),this.hls?.detachMedia(),this.hls?.destroy(),this.params.output.element$.next(void 0),fr(this.video)}loadHlsJs(){let e=!1,t=t=>{e||this.params.output.error$.next({id:"timeout"===t?"HlsJsTimeout":"HlsJsLoadError",category:u.ErrorCategory.NETWORK,message:"Failed to load Hls.js",thrown:t}),e=!0},r=window.setTimeout((()=>t("timeout")),this.params.tuning.dynamicImportTimeout);(0,Vo.default)(Promise.all([i.e(45458),i.e("langs/web/45458")]).then(i.bind(i,164945)).then((t=>{e||(No.Hls=t.default,No.Events=t.default.Events,this.init())}),t),(()=>{window.clearTimeout(r),e=!0}))}init(){(0,u.assertNonNullable)(No.Hls,"hls.js not loaded"),this.hls=new No.Hls({fragLoadingMaxRetry:5,levelLoadingMaxRetry:2,manifestLoadingMaxRetry:2,fragLoadingMaxRetryTimeout:16e3,manifestLoadingMaxRetryTimeout:2e3,levelLoadingMaxRetryTimeout:2e3}),this.subscribe(),this.videoState.setState("stopped")}subscribe(){(0,u.assertNonNullable)(No.Events,"hls.js not loaded");let{desiredState:e,output:t}=this.params,i=e=>{t.error$.next({id:"HlsJsProvider",category:u.ErrorCategory.WTF,message:"HlsJsProvider internal logic error",thrown:e})},r=jr(this.video);this.subscription.add((()=>r.destroy()));let a=(e,t)=>this.subscription.add(e.subscribe(t,i));a(r.timeUpdate$,t.position$),a(r.durationChange$,t.duration$),a(r.ended$,t.endedEvent$),a(r.looped$,t.loopedEvent$),a(r.error$,t.error$),a(r.isBuffering$,t.isBuffering$),a(r.currentBuffer$,t.currentBuffer$),a(r.loadStart$,t.firstBytesEvent$),a(r.loadedMetadata$,t.loadedMetadataEvent$),a(r.playing$,t.firstFrameEvent$),a(r.canplay$,t.canplay$),a(r.seeked$,t.seekedEvent$),a(r.inPiP$,t.inPiP$),a(r.inFullscreen$,t.inFullscreen$),this.subscription.add(gr(this.video,e.isLooped,i)),this.subscription.add(br(this.video,e.volume,r.volumeState$,i)),this.subscription.add(r.volumeState$.subscribe(this.params.output.volume$)),this.subscription.add(yr(this.video,e.playbackRate,r.playbackRateState$,i)),a(Ba(this.video),t.elementVisible$),a(this.videoState.stateChangeEnded$.pipe((0,u.map)((e=>e.to))),this.params.output.playbackState$),this.subscription.add(Bo(this.hls,No.Events.ERROR).subscribe((e=>{e.fatal&&t.error$.next({id:["HlsJsFatal",e.type,e.details].join("_"),category:u.ErrorCategory.WTF,message:`HlsJs fatal ${e.type} ${e.details}, ${e.err?.message} ${e.reason}`,thrown:e.error})}))),this.subscription.add(r.playing$.subscribe((()=>{this.videoState.setState("playing"),or(e.playbackState,"playing")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused"),or(e.playbackState,"paused")}),i)).add(r.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready"),"playing"===this.videoState.getState()&&this.playIfAllowed()}),i)),a(Bo(this.hls,No.Events.MANIFEST_PARSED).pipe((0,u.map)((({levels:e})=>e.reduce(((e,t)=>{let i=t.name||t.height.toString(10),{width:r,height:a}=t,s=zr(t.attrs.QUALITY??"")??(0,u.videoSizeToQuality)({width:r,height:a});if(!s)return e;let n=t.attrs["FRAME-RATE"]?parseFloat(t.attrs["FRAME-RATE"]):void 0,o={id:i.toString(),quality:s,bitrate:t.bitrate/1e3,size:{width:r,height:a},fps:n};return this.trackLevels.set(i,{track:o,level:t}),e.push(o),e}),[])))),t.availableVideoTracks$),a(Bo(this.hls,No.Events.MANIFEST_PARSED),(t=>{if(t.subtitleTracks.length>0){let i=[];for(let e of t.subtitleTracks){let t=e.name,r=e.attrs.URI||"",a=e.lang;i.push({id:t,url:r,language:a,type:"internal"})}e.internalTextTracks.startTransitionTo(i)}})),a(Bo(this.hls,No.Events.LEVEL_LOADING).pipe((0,u.map)((({url:e})=>ya(e)))),t.hostname$),a(Bo(this.hls,No.Events.FRAG_CHANGED),(e=>{let{video:i,audio:r}=e.frag.elementaryStreams;t.currentVideoSegmentLength$.next(1e3*((i?.endPTS??0)-(i?.startPTS??0))),t.currentAudioSegmentLength$.next(1e3*((r?.endPTS??0)-(r?.startPTS??0)))})),this.subscription.add(wr(e.autoVideoTrackSwitching,(()=>this.hls.autoLevelEnabled),(e=>{this.hls.nextLevel=e?-1:this.hls.currentLevel,this.hls.loadLevel=e?-1:this.hls.loadLevel}),{onError:i}));let s=e=>Array.from(this.trackLevels.values()).find((({level:t})=>t===e))?.track,n=Bo(this.hls,No.Events.LEVEL_SWITCHED).pipe((0,u.map)((({level:e})=>s(this.hls.levels[e]))));n.pipe((0,u.filter)(u.isNonNullable)).subscribe(t.currentVideoTrack$,i),this.subscription.add(wr(e.videoTrack,(()=>s(this.hls.levels[this.hls.currentLevel])),(e=>{if((0,u.isNullable)(e))return;let t=this.trackLevels.get(e.id)?.level;if(!t)return;let i=this.hls.levels.indexOf(t),r=this.hls.currentLevel,a=this.hls.levels[r];!a||t.bitrate>a.bitrate?this.hls.nextLevel=i:(this.hls.loadLevel=i,this.hls.loadLevel=i)}),{changed$:n,onError:i})),a(r.progress$,(()=>{this.params.dependencies.throughputEstimator.addRawThroughput(this.hls.bandwidthEstimate/1e3)})),this.textTracksManager.connect(this.video,e,t);let o=(0,u.merge)(e.playbackState.stateChangeStarted$,e.videoTrack.stateChangeStarted$,e.seekState.stateChangeEnded$,this.videoState.stateChangeEnded$,(0,u.observableFrom)(["init"])).pipe((0,u.debounce)(0));this.subscription.add(o.subscribe(this.syncPlayback,i))}prepare(){this.videoState.startTransitionTo("ready"),this.hls.attachMedia(this.video),this.hls.loadSource(this.params.source.url)}async playIfAllowed(){this.videoState.startTransitionTo("playing"),await $a(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).catch((e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:u.ErrorCategory.DOM,thrown:e})))||(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused",!0))}pause(){this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()}seek(e){this.params.output.willSeekEvent$.next(),this.video.currentTime=e/1e3}stop(){this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.hls.stopLoad(),this.hls.detachMedia(),this.video.removeAttribute("src"),this.video.load(),this.videoState.setState("stopped"),or(this.params.desiredState.playbackState,"stopped",!0)}constructor(e){this.subscription=new u.Subscription,this.videoState=new lr("initializing"),this.trackLevels=new Map,this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.seekState.getState();if("initializing"!==e)switch("paused"!==i?.to&&"requested"===r.state&&this.seek(r.position),t){case"stopped":switch(e){case"stopped":break;case"ready":case"playing":case"paused":this.stop();break;default:(0,u.assertNever)(e)}break;case"ready":switch(e){case"stopped":this.prepare();break;case"ready":case"playing":case"paused":break;default:(0,u.assertNever)(e)}break;case"playing":switch(e){case"playing":break;case"stopped":this.prepare();break;case"ready":case"paused":this.playIfAllowed();break;default:(0,u.assertNever)(e)}break;case"paused":switch(e){case"paused":break;case"stopped":this.prepare();break;case"ready":this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused");break;case"playing":this.pause();break;default:(0,u.assertNever)(e)}break;default:(0,u.assertNever)(t)}},this.textTracksManager=new xr(e.source.url),this.video=pr(e.container,e.tuning),this.params=e,this.params.output.element$.next(this.video),this.params.output.isLive$.next(!1),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(ya(this.params.source.url)),this.loadHlsJs()}},Oo="X-Playback-Duration",Fo=async e=>{let t=await Ka(e),i=await t.text(),r=/#EXT-X-VK-PLAYBACK-DURATION:(\d+)/m.exec(i)?.[1];return r?parseInt(r,10):t.headers.has(Oo)?parseInt(t.headers.get(Oo),10):void 0},jo=g(mt(),1),zo=e=>{let t=null;if(e.QUALITY&&(t=zr(e.QUALITY)),!t&&e.RESOLUTION){let[i,r]=e.RESOLUTION.split("x").map((e=>parseInt(e,10)));t=(0,u.videoSizeToQuality)({width:i,height:r})}return t??null},Uo=0,qo=async(e,t=e,i,r)=>{let a=await(await Ka(e,r)).text();Uo+=1;try{let{qualityManifests:e,textTracks:i}=((e,t)=>{let i=e.split("\n"),r=[],a=[];for(let e=0;e<i.length;e++){let s=i[e],n=s.match(/^#EXT-X-STREAM-INF:(.+)/),o=s.match(/^#EXT-X-MEDIA:TYPE=SUBTITLES,(.+)/);if(n||o){if(n){let a,s=(0,jo.default)(n[1].split(",").map((e=>e.split("=")))),o=s.QUALITY??`stream-${s.BANDWIDTH}`,l=zo(s);s.BANDWIDTH&&(a=parseInt(s.BANDWIDTH,10)/1e3||void 0),!a&&s["AVERAGE-BANDWIDTH"]&&(a=parseInt(s["AVERAGE-BANDWIDTH"],10)/1e3||void 0);let u,d=s["FRAME-RATE"]?parseFloat(s["FRAME-RATE"]):void 0;if(s.RESOLUTION){let[e,t]=s.RESOLUTION.split("x").map((e=>parseInt(e,10)));e&&t&&(u={width:e,height:t})}let c=new URL(i[++e],t).toString();l&&r.push({id:o,quality:l,url:c,bandwidth:a,size:u,fps:d})}if(o){let e=(0,jo.default)(o[1].split(",").map((e=>{let t=e.indexOf("=");return[e.substring(0,t),e.substring(t+1)]})).map((([e,t])=>[e,t.replace(/^"|"$/g,"")]))),t=e.URI?.replace(/playlist$/,"subtitles.vtt"),i=e.LANGUAGE,r=e.NAME;t&&i&&a.push({type:"internal",id:i,label:r,language:i,url:t,isAuto:!1})}}}if(!r.length)throw new Error("Empty manifest");return{qualityManifests:r,textTracks:a}})(a,t);return{qualityManifests:e,textTracks:i}}catch{if(Uo<=i.manifestRetryMaxCount)return await(e=>new Promise((t=>{setTimeout((()=>{t()}),e)})))((0,u.getExponentialDelay)(Uo-1,{start:i.manifestRetryInterval,max:i.manifestRetryMaxInterval})),qo(e,t,i)}return{qualityManifests:[],textTracks:[]}},Ho=qo,Wo=class{destroy(){this.subscription.unsubscribe(),this.abortControllers.destroy.abort()}async prepare(e){try{let t=new URL(e);t.searchParams.set("enable-subtitles","yes"),this.prepareUrl=t.toString();let{textTracks:i}=await this.fetchManifestData();await this.processTextTracks(i,this.params.sourceUrl)}catch(e){this.error("prepare",e)}}async processTextTracks(e,t){try{let i=await this.parseTextTracks(e,t);i&&(this.currentTextTrackData=i)}catch(e){this.error("processTextTracks",e)}}async parseTextTracks(e,t){for(let i of e){let e=new URL(i.url,t).toString(),r=await(await Ka(e,{signal:this.abortControllers.destroy.signal})).text();return{textTrack:i,playlist:this.parsePlaylist(r,e)}}}parsePlaylist(e,t){let i={mediaSequence:0,programDateTime:"",segments:[],targetDuration:0,vkPlaybackDuration:0,segmentStartTime:0,vkStartTime:""},r=e.split("\n"),a=0;for(let e=0;e<r.length;++e){let s=r[e];switch(!0){case s.startsWith("#EXTINF:"):{let n=r[++e],o=new URL(n,t).toString(),l=1e3*Number(this.extractPlaylistRowValue("#EXTINF:",s));if(i.segments.push({time:{from:a,to:a+l},url:o}),a+=l,!i.segmentStartTime){let e=new Date(i.vkStartTime).valueOf(),t=new Date(i.programDateTime).valueOf();i.segmentStartTime=t-e}break}case s.startsWith("#EXT-X-TARGETDURATION:"):i.targetDuration=Number(this.extractPlaylistRowValue("#EXT-X-TARGETDURATION:",s));break;case s.startsWith("#EXT-X-MEDIA-SEQUENCE:"):i.mediaSequence=Number(this.extractPlaylistRowValue("#EXT-X-MEDIA-SEQUENCE:",s));break;case s.startsWith("#EXT-X-VK-PLAYBACK-DURATION:"):i.vkPlaybackDuration=Number(this.extractPlaylistRowValue("#EXT-X-VK-PLAYBACK-DURATION:",s));break;case s.startsWith("#EXT-X-PROGRAM-DATE-TIME:"):{let e=this.extractPlaylistRowValue("#EXT-X-PROGRAM-DATE-TIME:",s);i.programDateTime=e;let t=new Date(e);t.setMilliseconds(0),a=t.valueOf();break}case s.startsWith("#EXT-X-VK-START-TIME:"):i.vkStartTime=this.extractPlaylistRowValue("#EXT-X-VK-START-TIME:",s)}}return i}extractPlaylistRowValue(e,t){return"#EXTINF:"===e?t.substring(e.length,t.length-1):t.substring(e.length)}processLiveTime(e){if((0,u.isNonNullable)(e)&&this.currentTextTrackData){let{segments:t}=this.currentTextTrackData.playlist,{from:i}=t[0].time,{to:r}=t[t.length-1].time;if(e<i||e>r)return;r-e<this.params.downloadThreshold&&this.fetchNextManifestData();for(let i of t)if(i.time.from<=e&&i.time.to>=e){this.availableTextTracks$.next([{...this.currentTextTrackData.textTrack,url:i.url,isAuto:!0}]);break}}}async fetchNextManifestData(){try{if(this.abortControllers.nextManifest)return;this.abortControllers.nextManifest=new Ya;let{textTracks:e}=await this.fetchManifestData(),t=await this.parseTextTracks(e,this.params.sourceUrl);this.currentTextTrackData&&t&&(this.currentTextTrackData.playlist.segments=t.playlist.segments)}catch(e){this.error("fetchNextManifestData",e)}finally{this.abortControllers.nextManifest=null}}async fetchManifestData(){let e=this.prepareUrl??this.params.sourceUrl;return await this.params.fetchManifestData(e,{signal:this.abortControllers.destroy.signal})}error(e,t){this.error$.next({id:"[LiveTextManager][HLS_LIVE_CMAF]",category:u.ErrorCategory.WTF,thrown:t,message:e})}constructor(e,t,i,r,a){this.subscription=new u.Subscription,this.abortControllers={destroy:new Ya,nextManifest:null},this.prepareUrl=void 0,this.currentTextTrackData=null,this.availableTextTracks$=new u.ValueSubject(null),this.getCurrentTime$=new u.ValueSubject(null),this.error$=new u.Subject,this.params={fetchManifestData:i,sourceUrl:r,downloadThreshold:a},this.subscription.add(e.pipe((0,u.throttle)(1e3)).subscribe((e=>{this.processLiveTime(e)}))),this.getCurrentTime$.next((()=>this.currentTextTrackData?this.currentTextTrackData.playlist.segmentStartTime/1e3+t.currentTime:0))}},Qo=class{selectManifest(){let{autoVideoTrackSwitching:e,videoTrack:t}=this.params.desiredState,i=e.getState(),r=t.getTransition(),a=r?.to?.id??t.getState()?.id??"master",s=this.manifests$.getValue();if(!s.length)return;let n=i?"master":a;return i&&!r&&t.startTransitionTo(this.masterManifest),s.find((e=>e.id===n))}subscribe(){let{output:e,desiredState:t}=this.params,i=t=>{e.error$.next({id:"HlsLiveProvider",category:u.ErrorCategory.WTF,message:"HlsLiveProvider internal logic error",thrown:t})},r=jr(this.video);this.subscription.add((()=>r.destroy()));let a=(e,t)=>this.subscription.add(e.subscribe(t,i));a(r.ended$,e.endedEvent$),a(r.error$,e.error$),a(r.isBuffering$,e.isBuffering$),a(r.currentBuffer$,e.currentBuffer$),a(r.loadedMetadata$,e.firstBytesEvent$),a(r.loadedMetadata$,e.loadedMetadataEvent$),a(r.playing$,e.firstFrameEvent$),a(r.canplay$,e.canplay$),a(r.inPiP$,e.inPiP$),a(r.inFullscreen$,e.inFullscreen$),this.subscription.add(t.isLooped.stateChangeStarted$.subscribe((()=>t.isLooped.setState(!1)),i)),this.subscription.add(br(this.video,t.volume,r.volumeState$,i)),this.subscription.add(r.volumeState$.subscribe(this.params.output.volume$,i)),this.subscription.add(yr(this.video,t.playbackRate,r.playbackRateState$,i)),a(Ba(this.video),e.elementVisible$),this.liveTextManager?(a(this.liveTextManager.getCurrentTime$,this.params.output.getCurrentTime$),a(this.liveTextManager.error$,this.params.output.error$)):this.textTracksManager&&this.textTracksManager.connect(this.video,t,e),this.subscription.add(r.playing$.subscribe((()=>{this.videoState.setState("playing"),or(t.playbackState,"playing")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused"),or(t.playbackState,"paused")}),i)).add(r.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready"),"playing"===this.videoState.getState()&&this.playIfAllowed()}),i)),this.liveTextManager&&this.subscription.add(this.liveTextManager.availableTextTracks$.subscribe((e=>{e&&this.params.output.availableTextTracks$.next(e)}))),this.subscription.add(this.maxSeekBackTime$.pipe((0,u.filterChanged)(),(0,u.map)((e=>-e/1e3))).subscribe(this.params.output.duration$,i)),this.subscription.add(r.loadedMetadata$.subscribe((()=>{let e=this.params.desiredState.seekState.getState(),t=this.videoState.getTransition(),i=this.params.desiredState.videoTrack.getTransition(),r=this.params.desiredState.autoVideoTrackSwitching.getTransition();if(i&&(0,u.isNonNullable)(i.to)){let e=i.to.id;this.params.desiredState.videoTrack.setState(i.to);let t=this.manifests$.getValue().find((t=>t.id===e));t&&(this.params.output.currentVideoTrack$.next(t),this.params.output.hostname$.next(ya(t.url)))}r&&this.params.desiredState.autoVideoTrackSwitching.setState(r.to),t&&"changing_manifest"===t.from&&this.videoState.setState(t.to),e&&"requested"===e.state&&this.seek(e.position)}),i)),this.subscription.add(r.loadedData$.subscribe((()=>{let e=this.video?.getStartDate?.()?.getTime();this.manifestStartTime$.next(e||void 0)}),i)),this.subscription.add((0,u.combine)({startTime:this.manifestStartTime$.pipe((0,u.filter)(u.isNonNullable)),currentTime:r.timeUpdate$}).subscribe((({startTime:e,currentTime:t})=>this.params.output.liveTime$.next(e+1e3*t)),i)),this.subscription.add(this.manifests$.pipe((0,u.map)((e=>e.map((({id:e,quality:t,size:i,bandwidth:r,fps:a})=>({id:e,quality:t,size:i,fps:a,bitrate:r})))))).subscribe(this.params.output.availableVideoTracks$,i));let s=(0,u.merge)(t.playbackState.stateChangeStarted$,t.seekState.stateChangeEnded$,t.videoTrack.stateChangeStarted$,t.autoVideoTrackSwitching.stateChangeStarted$,t.autoVideoTrackLimits.stateChangeStarted$,this.videoState.stateChangeEnded$,this.manifests$,(0,u.observableFrom)(["init"])).pipe((0,u.debounce)(0));this.subscription.add(s.subscribe(this.syncPlayback,i))}destroy(){this.subscription.unsubscribe(),this.textTracksManager?.destroy(),this.liveTextManager?.destroy(),this.params.output.element$.next(void 0),fr(this.video)}prepare(){let e=this.selectManifest();if((0,u.isNullable)(e))return;let t=this.params.desiredState.autoVideoTrackLimits.getTransition(),i=this.params.desiredState.autoVideoTrackLimits.getState(),r=new URL(e.url);if((t||i)&&e.id===this.masterManifest.id){let{max:e,min:a}=t?.to??i??{};for(let[t,i]of[[e,"mq"],[a,"lq"]]){let e=String(parseFloat(t||""));i&&t&&r.searchParams.set(i,e)}}let a="HLS_LIVE_CMAF"===this.params.format?2:0,s=sr(r.toString(),this.liveOffset.getTotalOffset(),a);this.liveTextManager?.prepare(s),this.video.setAttribute("src",s),this.video.load(),Fo(s).then((e=>{if((0,u.isNullable)(e)){let e=this.params.source.maxSeekBackTime??this.maxSeekBackTime$.getValue();((0,u.isNullable)(e)||!isFinite(e))&&Ka(s).then((e=>e.text())).then((e=>{let t=/#EXT-X-STREAM-INF[^\n]+\n(.+)/m.exec(e)?.[1];if(t){let e=new URL(t,s).toString();Fo(e).then((e=>{(0,u.isNullable)(e)||this.maxSeekBackTime$.next(e)}))}})).catch((()=>{}))}else this.maxSeekBackTime$.next(e)}))}playIfAllowed(){$a(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),this.liveOffset.pause(),or(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:u.ErrorCategory.DOM,thrown:e})))}seek(e){this.params.output.willSeekEvent$.next();let t=-e,i=t<this.maxSeekBackTime$.getValue()?t:0;this.liveOffset.resetTo(i),this.params.output.position$.next(-i/1e3),this.params.output.seekedEvent$.next()}generateLiveUrl(){let e=sr(this.params.source.url);if(this.params.tuning.useHlsLiveNewTextManager){let t=new URL(e);t.searchParams.set("enable-subtitles","yes"),e=t.toString()}return e}constructor(e){this.subscription=new u.Subscription,this.videoState=new lr("stopped"),this.textTracksManager=null,this.liveTextManager=null,this.manifests$=new u.ValueSubject([]),this.liveOffset=new $r,this.manifestStartTime$=new u.ValueSubject(void 0),this.syncPlayback=()=>{if(!this.manifests$.getValue().length)return;let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.videoTrack.getTransition(),a=this.params.desiredState.autoVideoTrackSwitching.getTransition(),s=this.params.desiredState.autoVideoTrackLimits.getTransition();if("stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.video.removeAttribute("src"),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),or(this.params.desiredState.playbackState,"stopped",!0)));if(this.videoState.getTransition())return;let n=this.params.desiredState.seekState.getState();if("stopped"===e)return this.videoState.startTransitionTo("ready"),void this.prepare();if(r||a||s){let e=this.videoState.getState();return this.videoState.setState("changing_manifest"),this.videoState.startTransitionTo(e),this.prepare(),s&&this.params.output.autoVideoTrackLimits$.next(s.to),void("none"===n.state&&this.params.desiredState.seekState.setState({state:"requested",position:-this.liveOffset.getTotalOffset(),forcePrecise:!0}))}if("paused"!==i?.to&&"requested"===n.state)return this.videoState.startTransitionTo("ready"),this.seek(n.position&&n.position-this.liveOffset.getTotalPausedTime()),void this.prepare();switch(e){case"ready":return void("ready"===t?or(this.params.desiredState.playbackState,"ready"):"paused"===t?(this.videoState.setState("paused"),this.liveOffset.pause(),or(this.params.desiredState.playbackState,"paused")):"playing"===t&&(this.videoState.startTransitionTo("playing"),this.playIfAllowed()));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.liveOffset.pause(),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===i?.to&&or(this.params.desiredState.playbackState,"playing"));case"paused":if("playing"===t)if(this.videoState.startTransitionTo("playing"),this.liveOffset.getTotalPausedTime()<this.params.config.maxPausedTime&&this.liveOffset.getTotalOffset()<this.maxSeekBackTime$.getValue())this.liveOffset.resume(),this.playIfAllowed(),this.params.output.position$.next(-this.liveOffset.getTotalOffset()/1e3);else{let e=this.liveOffset.getTotalOffset();e>=this.maxSeekBackTime$.getValue()&&(e=0,this.liveOffset.resetTo(e)),this.liveOffset.resume(),this.params.output.position$.next(-e/1e3),this.prepare()}else"paused"===i?.to&&(or(this.params.desiredState.playbackState,"paused"),this.liveOffset.pause());return;case"changing_manifest":break;default:return(0,u.assertNever)(e)}},this.params=e,this.video=pr(e.container,e.tuning),this.params.output.element$.next(this.video),this.masterManifest={id:"master",quality:u.VideoQuality.INVARIANT,url:this.params.source.url};let t=(e,t)=>Ho(e,this.params.source.url,{manifestRetryInterval:this.params.tuning.manifestRetryInterval,manifestRetryMaxInterval:this.params.tuning.manifestRetryMaxInterval,manifestRetryMaxCount:this.params.tuning.manifestRetryMaxCount},t);this.params.tuning.useHlsLiveNewTextManager?this.liveTextManager=new Wo(this.params.output.liveTime$,this.video,t,this.params.source.url,this.params.tuning.hlsLiveNewTextManagerDownloadThreshold):this.textTracksManager=new xr(e.source.url),t(this.generateLiveUrl()).then((({qualityManifests:e,textTracks:t})=>{0===e.length&&this.params.output.error$.next({id:"HlsLiveProviderInternal:empty_manifest",category:u.ErrorCategory.WTF,message:"HlsLiveProvider: there are no qualities in manifest"}),this.liveTextManager?.processTextTracks(t,this.params.source.url),this.manifests$.next([this.masterManifest,...e])})).catch((e=>{this.params.output.error$.next({id:"ExtractHlsQualities",category:u.ErrorCategory.NETWORK,message:"Error fetching manifest and extracting qualities",thrown:e})})),this.params.output.isLive$.next(!0),this.params.output.canChangePlaybackSpeed$.next(!1),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(ya(this.params.source.url)),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.maxSeekBackTime$=new u.ValueSubject(e.source.maxSeekBackTime??1/0),this.subscribe()}},Go=class{selectManifest(){let{autoVideoTrackSwitching:e,videoTrack:t}=this.params.desiredState,i=e.getState(),r=t.getTransition(),a=r?.to?.id??t.getState()?.id??"master",s=this.manifests$.getValue();if(!s.length)return;let n=i?"master":a;return i&&(!r||!r.from)&&t.startTransitionTo(this.masterManifest),s.find((e=>e.id===n))}subscribe(){let{output:e,desiredState:t}=this.params,i=t=>{e.error$.next({id:"HlsProvider",category:u.ErrorCategory.WTF,message:"HlsProvider internal logic error",thrown:t})},r=jr(this.video);this.subscription.add((()=>r.destroy()));let a=(e,t)=>this.subscription.add(e.subscribe(t));if(a(r.timeUpdate$,e.position$),a(r.durationChange$,e.duration$),a(r.ended$,e.endedEvent$),a(r.looped$,e.loopedEvent$),a(r.error$,e.error$),a(r.isBuffering$,e.isBuffering$),a(r.currentBuffer$,e.currentBuffer$),a(r.loadedMetadata$,e.firstBytesEvent$),a(r.loadedMetadata$,e.loadedMetadataEvent$),a(r.playing$,e.firstFrameEvent$),a(r.canplay$,e.canplay$),a(r.seeked$,e.seekedEvent$),a(r.inPiP$,e.inPiP$),a(r.inFullscreen$,e.inFullscreen$),a(this.videoState.stateChangeEnded$.pipe((0,u.map)((e=>e.to))),this.params.output.playbackState$),this.subscription.add(gr(this.video,t.isLooped,i)),this.subscription.add(br(this.video,t.volume,r.volumeState$,i)),this.subscription.add(r.volumeState$.subscribe(this.params.output.volume$,i)),this.subscription.add(yr(this.video,t.playbackRate,r.playbackRateState$,i)),this.textTracksManager.connect(this.video,t,e),this.subscription.add(r.playing$.subscribe((()=>{this.videoState.setState("playing"),or(t.playbackState,"playing")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused"),or(t.playbackState,"paused")}),i)).add(r.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready"),"playing"===this.videoState.getState()&&this.playIfAllowed()}),i).add(r.loadedMetadata$.subscribe((()=>{let e=this.params.desiredState.seekState.getState(),t=this.videoState.getTransition(),i=this.params.desiredState.videoTrack.getTransition(),r=this.params.desiredState.autoVideoTrackSwitching.getTransition();if(i&&(0,u.isNonNullable)(i.to)){let e=i.to.id;this.params.desiredState.videoTrack.setState(i.to);let t=this.manifests$.getValue().find((t=>t.id===e));t&&(this.params.output.currentVideoTrack$.next(t),this.params.output.hostname$.next(ya(t.url)))}let a=this.params.desiredState.playbackRate.getState(),s=this.params.output.element$.getValue()?.playbackRate;if(a!==s){let e=this.params.output.element$.getValue();e&&(this.params.desiredState.playbackRate.setState(a),e.playbackRate=a)}r&&this.params.desiredState.autoVideoTrackSwitching.setState(r.to),t&&"changing_manifest"===t.from&&this.videoState.setState(t.to),"requested"===e.state&&this.seek(e.position)}),i))),this.subscription.add(this.manifests$.pipe((0,u.map)((e=>e.map((({id:e,quality:t,size:i,bandwidth:r,fps:a})=>({id:e,quality:t,size:i,fps:a,bitrate:r})))))).subscribe(this.params.output.availableVideoTracks$,i)),!Fr.device.isIOS||!this.params.tuning.useNativeHLSTextTracks){let{textTracks:e}=this.video;this.subscription.add((0,u.merge)((0,u.fromEvent)(e,"addtrack"),(0,u.fromEvent)(e,"removetrack"),(0,u.fromEvent)(e,"change"),(0,u.observableFrom)(["init"])).subscribe((()=>{for(let t=0;t<e.length;t++)e[t].mode="hidden"}),i))}let s=(0,u.merge)(t.playbackState.stateChangeStarted$,t.seekState.stateChangeEnded$,t.videoTrack.stateChangeStarted$,t.autoVideoTrackSwitching.stateChangeStarted$,t.autoVideoTrackLimits.stateChangeStarted$,this.videoState.stateChangeEnded$,this.manifests$,(0,u.observableFrom)(["init"])).pipe((0,u.debounce)(0));this.subscription.add(s.subscribe(this.syncPlayback,i))}destroy(){this.subscription.unsubscribe(),this.textTracksManager.destroy(),this.params.output.element$.next(void 0),fr(this.video)}prepare(){let e=this.selectManifest();if((0,u.isNullable)(e))return;let t=this.params.desiredState.autoVideoTrackLimits.getTransition(),i=this.params.desiredState.autoVideoTrackLimits.getState(),r=new URL(e.url);if((t||i)&&e.id===this.masterManifest.id){let{max:e,min:a}=t?.to??i??{};for(let[t,i]of[[e,"mq"],[a,"lq"]]){let e=String(parseFloat(t||""));i&&t&&r.searchParams.set(i,e)}}this.video.setAttribute("src",r.toString()),this.video.load()}playIfAllowed(){$a(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:u.ErrorCategory.DOM,thrown:e})))}seek(e){this.params.output.willSeekEvent$.next(),this.video.currentTime=e/1e3}constructor(e){this.subscription=new u.Subscription,this.videoState=new lr("stopped"),this.manifests$=new u.ValueSubject([]),this.syncPlayback=()=>{if(!this.manifests$.getValue().length)return;let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.videoTrack.getTransition(),a=this.params.desiredState.autoVideoTrackSwitching.getTransition(),s=this.params.desiredState.autoVideoTrackLimits.getTransition();if("stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.video.removeAttribute("src"),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),or(this.params.desiredState.playbackState,"stopped",!0)));if(this.videoState.getTransition())return;let n=this.params.desiredState.seekState.getState();if("stopped"===e)return this.videoState.startTransitionTo("ready"),void this.prepare();if(r||a||s){let e=this.videoState.getState();this.videoState.setState("changing_manifest"),this.videoState.startTransitionTo(e);let{currentTime:t}=this.video;return this.prepare(),s&&this.params.output.autoVideoTrackLimits$.next(s.to),void("none"===n.state&&this.params.desiredState.seekState.setState({state:"requested",position:1e3*t,forcePrecise:!0}))}switch("paused"!==i?.to&&"requested"===n.state&&this.seek(n.position),e){case"ready":return void("ready"===t?or(this.params.desiredState.playbackState,"ready"):"paused"===t?(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused")):"playing"===t&&(this.videoState.startTransitionTo("playing"),this.playIfAllowed()));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===i?.to&&or(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===i?.to&&or(this.params.desiredState.playbackState,"paused"));case"changing_manifest":break;default:return(0,u.assertNever)(e)}},this.textTracksManager=new xr(e.source.url),this.params=e,this.video=pr(e.container,e.tuning),this.params.output.element$.next(this.video),this.masterManifest={id:"master",quality:u.VideoQuality.INVARIANT,url:this.params.source.url},this.params.output.isLive$.next(!1),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(ya(this.params.source.url)),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),Ho(sr(this.params.source.url),this.params.source.url,{manifestRetryInterval:this.params.tuning.manifestRetryInterval,manifestRetryMaxInterval:this.params.tuning.manifestRetryMaxInterval,manifestRetryMaxCount:this.params.tuning.manifestRetryMaxCount}).then((({qualityManifests:e,textTracks:t})=>{this.manifests$.next([this.masterManifest,...e]),this.params.tuning.useNativeHLSTextTracks||this.params.desiredState.internalTextTracks.startTransitionTo(t)}),(e=>this.params.output.error$.next({id:"ExtractHlsQualities",category:u.ErrorCategory.NETWORK,message:"Error fetching manifest and extracting qualities",thrown:e}))),this.subscribe()}},Ko=g(Ne(),1),Yo=g(ri(),1),Zo=g(oi(),1),Xo=class{subscribe(){let{output:e,desiredState:t}=this.params,i=t=>{e.error$.next({id:"MpegProvider",category:u.ErrorCategory.WTF,message:"MpegProvider internal logic error",thrown:t})},r=jr(this.video);this.subscription.add((()=>r.destroy()));let a=(e,t)=>this.subscription.add(e.subscribe(t,i));a(r.timeUpdate$,e.position$),a(r.durationChange$,e.duration$),a(r.ended$,e.endedEvent$),a(r.looped$,e.loopedEvent$),a(r.error$,e.error$),a(r.isBuffering$,e.isBuffering$),a(r.currentBuffer$,e.currentBuffer$),a(r.loadedMetadata$,e.firstBytesEvent$),a(r.loadedMetadata$,e.loadedMetadataEvent$),a(r.playing$,e.firstFrameEvent$),a(r.canplay$,e.canplay$),a(r.seeked$,e.seekedEvent$),a(r.inPiP$,e.inPiP$),a(r.inFullscreen$,e.inFullscreen$),a(this.videoState.stateChangeEnded$.pipe((0,u.map)((e=>e.to))),this.params.output.playbackState$),this.subscription.add(gr(this.video,t.isLooped,i)),this.subscription.add(br(this.video,t.volume,r.volumeState$,i)),this.subscription.add(r.volumeState$.subscribe(this.params.output.volume$,i)),this.subscription.add(yr(this.video,t.playbackRate,r.playbackRateState$,i)),a(Ba(this.video),e.elementVisible$),this.subscription.add(r.playing$.subscribe((()=>{this.videoState.setState("playing"),or(t.playbackState,"playing")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused"),or(t.playbackState,"paused")}),i)).add(r.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready");let e=this.params.desiredState.videoTrack.getTransition();if(e&&(0,u.isNonNullable)(e.to)){this.params.desiredState.videoTrack.setState(e.to),this.params.output.currentVideoTrack$.next(this.trackUrls[e.to.id].track);let t=this.params.desiredState.playbackRate.getState(),i=this.params.output.element$.getValue()?.playbackRate;if(t!==i){let e=this.params.output.element$.getValue();e&&(this.params.desiredState.playbackRate.setState(t),e.playbackRate=t)}}"playing"===this.videoState.getState()&&this.playIfAllowed()}),i)),this.textTracksManager.connect(this.video,t,e);let s=(0,u.merge)(t.playbackState.stateChangeStarted$,t.videoTrack.stateChangeStarted$,t.seekState.stateChangeEnded$,t.autoVideoTrackLimits.stateChangeStarted$,this.videoState.stateChangeEnded$,(0,u.observableFrom)(["init"])).pipe((0,u.debounce)(0));this.subscription.add(s.subscribe(this.syncPlayback,i))}destroy(){this.subscription.unsubscribe(),this.textTracksManager.destroy(),this.trackUrls={},this.params.output.element$.next(void 0),fr(this.video)}prepare(){let e=this.params.desiredState.videoTrack.getState()?.id;(0,u.assertNonNullable)(e,"MpegProvider: track is not selected");let{url:t}=this.trackUrls[e];(0,u.assertNonNullable)(t,`MpegProvider: No url for ${e}`),this.params.tuning.requestQuick&&(t=Js(t)),this.video.setAttribute("src",t),this.video.load(),this.params.output.hostname$.next(ya(t))}playIfAllowed(){$a(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:u.ErrorCategory.DOM,thrown:e})))}seek(e){this.params.output.willSeekEvent$.next(),this.video.currentTime=e/1e3}handleQualityLimitTransition(e){this.params.output.autoVideoTrackLimits$.next(e);let t=e=>{this.params.output.currentVideoTrack$.next(e),this.params.desiredState.videoTrack.startTransitionTo(e)},i=e=>{let i=ma(s,{container:this.video.getBoundingClientRect(),panelSize:this.params.panelSize,estimatedThroughput:this.params.dependencies.throughputEstimator.throughput$.getValue(),tuning:this.params.tuning.autoTrackSelection,forwardBufferHealth:0,limits:e,abrLogger:this.params.dependencies.abrLogger});t(i)},r=this.params.output.currentVideoTrack$.getValue()?.quality,a=!(!e.max&&!e.min),s=(0,Yo.default)(this.trackUrls).map((e=>e.track));if(!r||!a||Jr(e,s[0].quality,(0,Zo.default)(s,-1)?.quality))return void i();let n=!e.max||(0,u.isLowerOrEqual)(r,e.max),o=!e.min||(0,u.isHigherOrEqual)(r,e.min);n&&o||i(e)}constructor(e){this.subscription=new u.Subscription,this.videoState=new lr("stopped"),this.trackUrls={},this.textTracksManager=new xr,this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition();if("stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.video.removeAttribute("src"),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),or(this.params.desiredState.playbackState,"stopped",!0)));if(this.videoState.getTransition())return;let r=this.params.desiredState.autoVideoTrackLimits.getTransition(),a=this.params.desiredState.videoTrack.getTransition(),s=this.params.desiredState.seekState.getState();if(!r||"ready"===e||a){if("stopped"===e)return this.videoState.startTransitionTo("ready"),void this.prepare();if(a){let{currentTime:e}=this.video;return this.prepare(),void("none"===s.state&&this.params.desiredState.seekState.setState({state:"requested",position:1e3*e,forcePrecise:!0}))}switch("paused"!==i?.to&&"requested"===s.state&&this.seek(s.position),e){case"ready":return void("ready"===t?or(this.params.desiredState.playbackState,"ready"):"paused"===t?(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused")):"playing"===t&&(this.videoState.startTransitionTo("playing"),this.playIfAllowed()));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===i?.to&&or(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===i?.to&&or(this.params.desiredState.playbackState,"paused"));default:return(0,u.assertNever)(e)}}else this.handleQualityLimitTransition(r.to)},this.params=e,this.video=pr(e.container,e.tuning),this.params.output.element$.next(this.video),(0,Ko.default)(this.params.source).reverse().forEach((([e,t],i)=>{let r=i.toString(10);this.trackUrls[r]={track:{quality:e,id:r},url:t}})),this.params.output.isLive$.next(!1),this.params.output.availableVideoTracks$.next((0,Yo.default)(this.trackUrls).map((({track:e})=>e))),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.desiredState.autoVideoTrackSwitching.setState(!1),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),this.subscribe()}},Jo=["stun:videostun.mycdn.me:80"],el=()=>null,tl=class{onStart(e){try{this.externalStartCallback=e}catch(e){this.handleSystemError(e)}}onStop(e){try{this.externalStopCallback=e}catch(e){this.handleSystemError(e)}}onError(e){try{this.externalErrorCallback=e}catch(e){this.handleSystemError(e)}}connect(){this.connectWS()}disconnect(){try{this.externalStopCallback(),this.closeConnections()}catch(e){this.handleSystemError(e)}}connectWS(){this.ws||(this.ws=new WebSocket(this.serverUrl),this.ws.onopen=this.onSocketOpen.bind(this),this.ws.onmessage=this.onSocketMessage.bind(this),this.ws.onclose=this.onSocketClose.bind(this),this.ws.onerror=this.onSocketError.bind(this))}onSocketOpen(){this.handleLogin()}onSocketClose(e){try{if(!this.ws)return;this.ws=null,e.code>1e3?(this.retryCount++,this.retryCount>this.options.maxRetryNumber?this.handleNetworkError():this.scheduleRetry()):this.externalStopCallback()}catch(e){this.handleRTCError(e)}}onSocketError(e){try{this.externalErrorCallback(new Error(e.toString()))}catch(e){this.handleRTCError(e)}}onSocketMessage(e){try{let t=this.parseMessage(e.data);switch(t.type){case"JOIN":case"CALL_JOIN":this.handleJoinMessage(t);break;case"UPDATE":this.handleUpdateMessage(t);break;case"STATUS":this.handleStatusMessage(t)}}catch(e){this.handleRTCError(e)}}handleJoinMessage(e){switch(e.inviteType){case"ANSWER":this.handleAnswer(e.sdp);break;case"CANDIDATE":this.handleCandidate(e.candidate)}}handleStatusMessage(e){if("UNPUBLISHED"===e.status)this.handleUnpublished()}async handleUpdateMessage(e){try{let t=await this.createOffer();this.peerConnection&&await this.peerConnection.setLocalDescription(t),this.handleAnswer(e.sdp)}catch(e){this.handleRTCError(e)}}async handleLogin(){try{let e={iceServers:[{urls:Jo}]};this.peerConnection=new RTCPeerConnection(e),this.peerConnection.ontrack=this.onPeerConnectionStream.bind(this),this.peerConnection.onicecandidate=this.onPeerConnectionIceCandidate.bind(this),this.peerConnection.oniceconnectionstatechange=this.onPeerConnectionIceConnectionStateChange.bind(this);let t=await this.createOffer();await this.peerConnection.setLocalDescription(t),this.send({type:this.signalingType,inviteType:"OFFER",streamKey:this.streamKey,sdp:t.sdp,callSupport:!1})}catch(e){this.handleRTCError(e)}}async handleAnswer(e){try{this.peerConnection&&await this.peerConnection.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:e}))}catch(e){this.handleRTCError(e)}}async handleCandidate(e){if(e)try{this.peerConnection&&await this.peerConnection.addIceCandidate(e)}catch(e){this.handleRTCError(e)}}handleUnpublished(){try{this.closeConnections(),this.externalStopCallback()}catch(e){this.handleRTCError(e)}}handleSystemError(e){this.options.errorChanel&&this.options.errorChanel.next({id:"webrtc-provider-error",category:u.ErrorCategory.WTF,message:e.message})}async onPeerConnectionStream(e){let t=e.streams[0];this.stream&&this.stream.id===t.id||(this.stream=t,this.externalStartCallback(this.stream))}onPeerConnectionIceCandidate(e){e.candidate&&this.send({type:this.signalingType,inviteType:"CANDIDATE",candidate:e.candidate})}onPeerConnectionIceConnectionStateChange(){if(this.peerConnection){let e=this.peerConnection.iceConnectionState;["failed","closed"].indexOf(e)>-1&&(this.retryCount++,this.retryCount>this.options.maxRetryNumber?this.handleNetworkError():(this.closeConnections(),this.scheduleRetry()))}}async createOffer(){if(!this.peerConnection)throw new Error("Can not create offer - no peer connection instance ");let e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!1}),t=e.sdp||"";if(!/^a=rtpmap:\d+ H264\/\d+$/m.test(t))throw new Error("No h264 codec support error");return e}handleRTCError(e){try{this.externalErrorCallback(e||new Error("RTC connection error"))}catch(e){this.handleSystemError(e)}}handleNetworkError(){try{this.externalErrorCallback(new Error("Network error"))}catch(e){this.handleSystemError(e)}}send(e){this.ws&&this.ws.send(JSON.stringify(e))}parseMessage(e){try{return JSON.parse(e)}catch{throw new Error("Can not parse socket message")}}closeConnections(){let e=this.ws;e&&(this.ws=null,e.close(1e3)),this.removePeerConnection()}removePeerConnection(){let e=this.peerConnection;e&&(this.peerConnection=null,e.close(),e.ontrack=null,e.onicecandidate=null,e.oniceconnectionstatechange=null,e=null)}scheduleRetry(){this.retryTimeout=setTimeout(this.connectWS.bind(this),1e3)}normalizeOptions(e={}){let t={stunServerList:Jo,maxRetryNumber:3,errorChanel:null};return e.stunServerList&&(t.stunServerList=e.stunServerList),e.maxRetryNumber&&e.maxRetryNumber>0&&(t.maxRetryNumber=e.maxRetryNumber),t}constructor(e,t){this.ws=null,this.peerConnection=null,this.serverUrl="",this.streamKey="",this.stream=null,this.signalingType="JOIN",this.retryCount=0,this.externalStartCallback=el,this.externalStopCallback=el,this.externalErrorCallback=el,this.options=this.normalizeOptions(t);let i=e.split("/");this.serverUrl=i.slice(0,i.length-1).join("/"),this.streamKey=i[i.length-1]}},il=class{destroy(){this.subscription.unsubscribe(),this.liveStreamClient.disconnect(),this.params.output.element$.next(void 0),fr(this.video)}subscribe(){let{output:e,desiredState:t}=this.params,i=t=>{e.error$.next({id:"WebRTCLiveProvider",category:u.ErrorCategory.WTF,message:"WebRTCLiveProvider internal logic error",thrown:t})};this.subscription.add((0,u.merge)(this.videoState.stateChangeStarted$.pipe((0,u.map)((e=>({transition:e,type:"start"})))),this.videoState.stateChangeEnded$.pipe((0,u.map)((e=>({transition:e,type:"end"}))))).subscribe((({transition:e,type:t})=>{this.log({message:`[videoState change] ${t}: ${JSON.stringify(e)}`})})));let r=jr(this.video);this.subscription.add((()=>r.destroy()));let a=(e,t)=>this.subscription.add(e.subscribe(t,i));a(r.timeUpdate$,e.liveTime$),a(r.ended$,e.endedEvent$),a(r.looped$,e.loopedEvent$),a(r.error$,e.error$),a(r.isBuffering$,e.isBuffering$),a(r.currentBuffer$,e.currentBuffer$),a(Ba(this.video),this.params.output.elementVisible$),this.subscription.add(r.durationChange$.subscribe((t=>{e.duration$.next(t===1/0?0:t)}))).add(r.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused")}),i)).add(r.playing$.subscribe((()=>{this.videoState.setState("playing")}),i)).add(r.error$.subscribe(e.error$)).add(this.maxSeekBackTime$.subscribe(this.params.output.duration$)).add(br(this.video,t.volume,r.volumeState$,i)).add(r.volumeState$.subscribe(e.volume$,i)).add(this.videoState.stateChangeEnded$.subscribe((i=>{switch(i.to){case"stopped":e.position$.next(0),e.duration$.next(0),t.playbackState.setState("stopped");break;case"ready":break;case"paused":t.playbackState.setState("paused");break;case"playing":t.playbackState.setState("playing");break;default:return(0,u.assertNever)(i.to)}}),i)).add((0,u.merge)(t.playbackState.stateChangeStarted$,this.videoState.stateChangeEnded$,(0,u.observableFrom)(["init"])).pipe((0,u.debounce)(0)).subscribe(this.syncPlayback.bind(this),i)),this.subscription.add(t.isLooped.stateChangeStarted$.subscribe((()=>t.isLooped.setState(!1)),i)),this.subscription.add(t.autoVideoTrackSwitching.stateChangeStarted$.subscribe((()=>t.autoVideoTrackSwitching.setState(!1)),i))}onLiveStreamStart(e){this.params.output.element$.next(this.video),this.params.output.duration$.next(0),this.params.output.position$.next(0),this.params.output.isLive$.next(!0),this.params.output.canChangePlaybackSpeed$.next(!1),this.params.output.hostname$.next(ya(this.params.source.url)),this.params.output.autoVideoTrackLimitingAvailable$.next(!1),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.currentVideoTrack$.next({id:"webrtc",quality:u.VideoQuality.INVARIANT}),this.video.srcObject=e,or(this.params.desiredState.playbackState,"playing")}onLiveStreamStop(){this.videoState.startTransitionTo("stopped"),this.syncPlayback(),this.params.output.position$.next(0),this.params.output.duration$.next(0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.params.output.endedEvent$.next()}onLiveStreamError(e){this.onLiveStreamStop(),this.params.output.error$.next({id:"WebRTC stream runtime error",category:u.ErrorCategory.EXTERNAL_API,message:e.message,thrown:e})}playIfAllowed(){$a(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:u.ErrorCategory.DOM,thrown:e})))}prepare(){this.liveStreamClient.connect()}constructor(e){this.videoState=new lr("stopped"),this.maxSeekBackTime$=new u.ValueSubject(0),this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition();if("stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.video.pause(),this.video.srcObject=null,this.params.output.position$.next(0),this.params.output.duration$.next(0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),or(this.params.desiredState.playbackState,"stopped",!0)));if(this.videoState.getTransition())return;let r=this.params.desiredState.videoTrack.getTransition();if("stopped"===e)return this.videoState.startTransitionTo("ready"),void this.prepare();if(r)this.prepare();else switch(e){case"ready":return void("paused"===t?(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused")):"playing"===t&&(this.videoState.startTransitionTo("playing"),this.playIfAllowed()));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===i?.to&&or(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===i?.to&&or(this.params.desiredState.playbackState,"paused"));default:return(0,u.assertNever)(e)}},this.subscription=new u.Subscription,this.params=e,this.log=this.params.dependencies.logger.createComponentLog("WebRTCLiveProvider"),this.video=pr(e.container,e.tuning),this.liveStreamClient=new tl(this.params.source.url,{maxRetryNumber:this.params.tuning.webrtc.connectionRetryMaxNumber,errorChanel:this.params.output.error$}),this.liveStreamClient.onStart(this.onLiveStreamStart.bind(this)),this.liveStreamClient.onStop(this.onLiveStreamStop.bind(this)),this.liveStreamClient.onError(this.onLiveStreamError.bind(this)),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.subscribe()}},rl=class{next(){this.current=this.iterator.next()}getValue(){if(this.current.done)throw new Error("Iterable is completed");return this.current.value}isCompleted(){return!!this.current.done}constructor(e){this.iterator=e[Symbol.iterator](),this.next()}};var al=(r=class e{subscribe(e){Fr.browser.isSafari&&"MPEG"!==e||this.subscriptions.add((0,u.combine)({video:this.providerOutput.element$,playbackState:this.providerOutput.playbackState$,volume:this.providerOutput.volume$}).pipe((0,u.filter)((({playbackState:e,video:t,volume:{muted:i,volume:r}})=>"playing"===e&&!!t&&!i&&!!r)),(0,u.once)()).subscribe((({video:e})=>{this.initAudioContextOnce(e).then((e=>{e||this.destroy()})).catch((e=>{this.handleError(e),this.destroy()}))})))}static isSupported(){return"AudioContext"in window&&"GainNode"in window&&"MediaElementAudioSourceNode"in window}async initAudioContextOnce(e){let{volumeMultiplier:t}=this,i=new(window.AudioContext||window.webkitAudioContext);this.audioContext=i;let r=i.createGain();if(this.gainNode=r,r.gain.value=t,r.connect(i.destination),"suspended"===i.state&&(await i.resume(),this.destroyController.signal.aborted))return!1;let a=i.createMediaElementSource(e);return this.mediaElementSource=a,a.connect(r),!0}cleanup(){this.mediaElementSource&&(this.mediaElementSource.disconnect(),this.mediaElementSource=null),this.gainNode&&(this.gainNode.disconnect(),this.gainNode=null),this.audioContext&&("closed"!==this.audioContext.state&&this.audioContext.close(),this.audioContext=null)}destroy(){this.destroyController.abort(),this.subscriptions.unsubscribe(),this.cleanup()}handleError(t){this.volumeMultiplierError$.next({id:e.errorId,category:u.ErrorCategory.VIDEO_PIPELINE,message:t?.message??`${e.errorId} exception`,thrown:t})}constructor(e,t,i,r){this.providerOutput=e,this.provider$=t,this.volumeMultiplierError$=i,this.volumeMultiplier=r,this.destroyController=new Ya,this.subscriptions=new u.Subscription,this.audioContext=null,this.gainNode=null,this.mediaElementSource=null,this.subscriptions.add(this.provider$.pipe((0,u.filter)((e=>!!e.type)),(0,u.once)()).subscribe((({type:e})=>this.subscribe(e))))}},r.errorId="VolumeMultiplierManager",r),sl={chunkDuration:5e3,maxParallelRequests:5},nl=class{init(){this.subscription.add(this.initProviderErrorHandling()),this.subscription.add(this.params.dependencies.chromecastInitializer.connection$.subscribe((()=>{this.reinitProvider()})))}destroy(){this.destroyProvider(),this.current$.next({type:void 0}),this.subscription.unsubscribe(),this.volumeMultiplierManager?.destroy(),this.volumeMultiplierManager=null,this.tracer.end()}initProvider(){let e,t=this.chooseDestination(),i=this.chooseFormat(t);if((0,u.isNullable)(i))this.handleNoFormatsError(t);else{try{e=this.createProvider(t,i)}catch(e){this.providerError$.next({id:"ProviderNotConstructed",category:u.ErrorCategory.WTF,message:"Failed to create provider",thrown:e})}e?this.current$.next({type:i,provider:e,destination:t}):this.current$.next({type:void 0})}}reinitProvider(){this.tracer.log("reinitProvider"),this.destroyProvider(),this.initProvider()}switchToNextProvider(e){this.tracer.log("switchToNextProvider",{destination:e}),this.destroyProvider(),this.failoverIndex=void 0,this.skipFormat(e),this.initProvider()}destroyProvider(){let e=this.current$.getValue().provider;if(!e)return;this.log({message:"destroyProvider"}),this.tracer.log("destroyProvider"),e.destroy();let t=1e3*this.providerOutput.position$.getValue(),i=this.params.desiredState.seekState.getState(),r="none"!==i.state;if(this.params.desiredState.seekState.setState({state:"requested",position:r?i.position:t,forcePrecise:!!r&&i.forcePrecise}),e.scene3D){let t=e.scene3D.getCameraRotation();this.params.desiredState.cameraOrientation.setState({x:t.x,y:t.y})}let a=this.providerOutput.isBuffering$;a.getValue()||a.next(!0)}createProvider(e,t){switch(this.log({message:`createProvider: ${e}:${t}`}),this.tracer.log("createProvider",{destination:e,format:t}),e){case"SCREEN":return this.createScreenProvider(t);case"CHROMECAST":return this.createChromecastProvider(t);default:return(0,u.assertNever)(e)}}createScreenProvider(e){let{sources:t,container:i,desiredState:r,panelSize:a}=this.params,s=this.providerOutput,n={container:i,source:null,desiredState:r,output:s,dependencies:this.params.dependencies,tuning:this.params.tuning,panelSize:a};switch(e){case"DASH_SEP":case"DASH_WEBM":case"DASH_WEBM_AV1":case"DASH_ONDEMAND":case"DASH_STREAMS":{let i=this.applyFailoverHost(t[e]),r=this.applyFailoverHost(t.HLS_ONDEMAND||t.HLS);return(0,u.assertNonNullable)(i),this.params.tuning.useNewDashProvider?new Io({...n,source:i,sourceHls:r}):new Pn({...n,source:i,sourceHls:r})}case"DASH_LIVE_CMAF":{let i=this.applyFailoverHost(t[e]);return(0,u.assertNonNullable)(i),this.params.tuning.useNewDashProvider?new Ro({...n,source:i}):new Mn({...n,source:i})}case"HLS":case"HLS_ONDEMAND":{let i=this.applyFailoverHost(t[e]);return(0,u.assertNonNullable)(i),Fr.video.nativeHlsSupported||!this.params.tuning.useHlsJs?new Go({...n,source:i}):new Do({...n,source:i})}case"HLS_LIVE":case"HLS_LIVE_CMAF":{let i=this.applyFailoverHost(t[e]);return(0,u.assertNonNullable)(i),new Qo({...n,source:i,config:{maxPausedTime:this.params.tuning.live.maxPausedTime},format:e})}case"MPEG":{let i=this.applyFailoverHost(t[e]);return(0,u.assertNonNullable)(i),new Xo({...n,source:i})}case"DASH_LIVE":{let i=this.applyFailoverHost(t[e]);return(0,u.assertNonNullable)(i),new Fa({...n,source:i,config:{...sl,maxPausedTime:this.params.tuning.live.maxPausedTime}})}case"WEB_RTC_LIVE":{let a=this.applyFailoverHost(t[e]);return(0,u.assertNonNullable)(a),new il({container:i,source:a,desiredState:r,output:s,dependencies:this.params.dependencies,tuning:this.params.tuning})}case"DASH":case"DASH_LIVE_WEBM":throw new Error(`${e} is no longer supported`);default:return(0,u.assertNever)(e)}}createChromecastProvider(e){let{sources:t,container:i,desiredState:r,meta:a}=this.params,s=this.providerOutput,n=this.params.dependencies.chromecastInitializer.connection$.getValue();return(0,u.assertNonNullable)(n),new ur({connection:n,meta:a,container:i,source:t,format:e,desiredState:r,output:s,dependencies:this.params.dependencies,tuning:this.params.tuning})}chooseDestination(){return this.params.dependencies.chromecastInitializer.connection$.getValue()?"CHROMECAST":"SCREEN"}chooseFormat(e){switch(e){case"SCREEN":return this.screenFormatsIterator.isCompleted()?void 0:this.screenFormatsIterator.getValue();case"CHROMECAST":return this.chromecastFormatsIterator.isCompleted()?void 0:this.chromecastFormatsIterator.getValue();default:return(0,u.assertNever)(e)}}skipFormat(e){switch(e){case"SCREEN":return this.screenFormatsIterator.next();case"CHROMECAST":return this.chromecastFormatsIterator.next();default:return(0,u.assertNever)(e)}}handleNoFormatsError(e){switch(e){case"SCREEN":return this.noAvailableProvidersError$.next(this.params.tuning.forceFormat),void this.current$.next({type:void 0});case"CHROMECAST":return void this.params.dependencies.chromecastInitializer.disconnect();default:return(0,u.assertNever)(e)}}applyFailoverHost(e){if(void 0===this.failoverIndex)return e;let t=this.params.failoverHosts[this.failoverIndex];if(!t)return e;let i=e=>{let i=new URL(e);return i.host=t,i.toString()};if(void 0===e)return e;if("type"in e){if("raw"===e.type)return e;if("url"===e.type)return{...e,url:i(e.url)}}return(0,rr.default)((0,ir.default)(e).map((([e,t])=>[e,i(t)])))}initProviderErrorHandling(){let e=new u.Subscription,t=!1,i=0;return e.add((0,u.merge)(this.providerOutput.error$.pipe((0,u.filter)((e=>!this.params.tuning.ignoreAudioRendererError||!e.message||!/AUDIO_RENDERER_ERROR/gi.test(e.message)))),(r={desiredPlaybackState$:this.params.desiredState.playbackState,maxTransitionInterval:this.params.tuning.maxPlaybackTransitionInterval,position$:this.providerOutput.position$,providerChanged$:this.current$},new u.Observable((e=>{let t=new u.Subscription,i=r.desiredPlaybackState$.stateChangeStarted$.pipe((0,u.map)((({from:e,to:t})=>`${e}-${t}`))),a=r.desiredPlaybackState$.stateChangeEnded$,s=r.providerChanged$.pipe((0,u.map)((({type:e})=>void 0!==e))),n=new u.Subject,o=0,l="unknown";return t.add(i.subscribe((e=>{o&&window.clearTimeout(o),l=e,o=window.setTimeout((()=>n.next(e)),r.maxTransitionInterval)}))),t.add(a.subscribe((()=>{window.clearTimeout(o),l="unknown",o=0}))),t.add(s.subscribe((e=>{o&&(window.clearTimeout(o),o=0,e&&(o=window.setTimeout((()=>n.next(l)),r.maxTransitionInterval)))}))),t.add(n.subscribe(e)),()=>{window.clearTimeout(o),t.unsubscribe()}}))).pipe((0,u.map)((e=>({id:`ProviderHangup:${e}`,category:u.ErrorCategory.WTF,message:`A ${e} transition failed to complete within reasonable time`}))))).subscribe(this.providerError$)),e.add(this.providerOutput.fetcherError$.subscribe(this.providerError$)),e.add(this.current$.subscribe((()=>{t=!1;let i=this.params.desiredState.playbackState.transitionEnded$.pipe((0,u.filter)((({to:e})=>"playing"===e)),(0,u.once)()).subscribe((()=>t=!0));e.add(i)}))),e.add(this.providerError$.subscribe((e=>{let r=this.current$.getValue().destination,a={error:e,currentDestination:r};if("CHROMECAST"===r)this.destroyProvider(),this.params.dependencies.chromecastInitializer.stopMedia().then((()=>this.switchToNextProvider("SCREEN")),(()=>this.params.dependencies.chromecastInitializer.disconnect()));else{let s=e.category===u.ErrorCategory.NETWORK,n=e.category===u.ErrorCategory.FATAL,o=this.params.failoverHosts.length>0&&(void 0===this.failoverIndex||this.failoverIndex<this.params.failoverHosts.length-1),l=i<this.params.tuning.providerErrorLimit&&!n,d=o&&!n&&(s&&t||!l);a={...a,isNetworkError:s,isFatalError:n,haveFailoverHost:o,tryFailover:d,canReinitProvider:l},l?(i++,this.reinitProvider()):d?(this.failoverIndex=void 0===this.failoverIndex?0:this.failoverIndex+1,this.reinitProvider()):(i=0,this.switchToNextProvider(r??"SCREEN"))}e.traceAsLog?this.tracer.log("providerInfo",(0,u.flattenObject)(a)):this.tracer.error("providerError",(0,u.flattenObject)(a))}))),e;var r}constructor(e){this.current$=new u.ValueSubject({type:void 0}),this.providerError$=new u.Subject,this.noAvailableProvidersError$=new u.Subject,this.volumeMultiplierError$=new u.Subject,this.providerOutput={position$:new u.ValueSubject(0),duration$:new u.ValueSubject(1/0),volume$:new u.ValueSubject({muted:!1,volume:1}),availableVideoStreams$:new u.ValueSubject([]),currentVideoStream$:new u.ValueSubject(void 0),availableVideoTracks$:new u.ValueSubject([]),currentVideoTrack$:new u.ValueSubject(void 0),availableAudioStreams$:new u.ValueSubject([]),currentAudioStream$:new u.ValueSubject(void 0),availableAudioTracks$:new u.ValueSubject([]),currentVideoSegmentLength$:new u.ValueSubject(0),currentAudioSegmentLength$:new u.ValueSubject(0),isAudioAvailable$:new u.ValueSubject(!0),autoVideoTrackLimitingAvailable$:new u.ValueSubject(!1),autoVideoTrackLimits$:new u.ValueSubject(void 0),currentBuffer$:new u.ValueSubject(void 0),isBuffering$:new u.ValueSubject(!0),error$:new u.Subject,fetcherError$:new u.Subject,fetcherRecoverableError$:new u.Subject,warning$:new u.Subject,willSeekEvent$:new u.Subject,soundProhibitedEvent$:new u.Subject,seekedEvent$:new u.Subject,loopedEvent$:new u.Subject,endedEvent$:new u.Subject,firstBytesEvent$:new u.Subject,loadedMetadataEvent$:new u.Subject,firstFrameEvent$:new u.Subject,canplay$:new u.Subject,isLive$:new u.ValueSubject(void 0),isLiveEnded$:new u.ValueSubject(null),isLowLatency$:new u.ValueSubject(!1),canChangePlaybackSpeed$:new u.ValueSubject(!0),liveTime$:new u.ValueSubject(void 0),liveBufferTime$:new u.ValueSubject(void 0),liveLatency$:new u.ValueSubject(void 0),severeStallOccurred$:new u.Subject,availableTextTracks$:new u.ValueSubject([]),currentTextTrack$:new u.ValueSubject(void 0),hostname$:new u.ValueSubject(void 0),httpConnectionType$:new u.ValueSubject(void 0),httpConnectionReused$:new u.ValueSubject(void 0),inPiP$:new u.ValueSubject(!1),inFullscreen$:new u.ValueSubject(!1),element$:new u.ValueSubject(void 0),elementVisible$:new u.ValueSubject(!0),availableSources$:new u.ValueSubject(void 0),is3DVideo$:new u.ValueSubject(!1),playbackState$:new u.ValueSubject(""),getCurrentTime$:new u.ValueSubject(null)},this.subscription=new u.Subscription,this.volumeMultiplierManager=null,this.params=e,this.log=this.params.dependencies.logger.createComponentLog("ProviderContainer"),this.tracer=e.dependencies.tracer.createComponentTracer(this.constructor.name);let t=((e,{useHlsJs:t,useManagedMediaSource:i,useOldMSEDetection:r})=>{let{containers:a,protocols:s,codecs:n,nativeHlsSupported:o}=Fr.video,l=(n.h264||n.h265)&&n.aac,d=s.mse&&(!r||!!window.MediaStreamTrack)||s.mms&&i;return e.filter((e=>{switch(e){case"DASH_SEP":case"DASH_LIVE":case"DASH_ONDEMAND":return d&&a.mp4&&l;case"DASH_WEBM":return d&&a.webm&&n.vp9&&n.opus;case"DASH_WEBM_AV1":return d&&a.webm&&n.av1&&n.opus;case"DASH_STREAMS":return d&&(a.mp4&&l||a.webm&&(n.vp9||n.av1)&&(n.opus||n.aac));case"DASH_LIVE_CMAF":return d&&a.mp4&&l&&a.cmaf;case"HLS":case"HLS_ONDEMAND":return o||t&&d&&a.mp4&&l;case"HLS_LIVE":case"HLS_LIVE_CMAF":return o;case"MPEG":return a.mp4;case"DASH":case"DASH_LIVE_WEBM":return!1;case"WEB_RTC_LIVE":return s.webrtc&&s.ws&&n.h264&&(a.mp4||a.webm);default:return(0,u.assertNever)(e)}}))})([...gn(this.params.tuning),...vn(this.params.tuning)],this.params.tuning).filter((t=>(0,u.isNonNullable)(e.sources[t]))),{forceFormat:i,formatsToAvoid:r}=this.params.tuning,a=[];a=i?[i]:r.length?[...t.filter((e=>!(0,tr.default)(r,e))),...t.filter((e=>(0,tr.default)(r,e)))]:t,this.log({message:`Selected formats: ${a.join(" > ")}`}),this.tracer.log("Selected formats",(0,u.flattenObject)(a)),this.screenFormatsIterator=new rl(a);let s=[...bn(!0),...bn(!1)];this.chromecastFormatsIterator=new rl(s.filter((t=>(0,u.isNonNullable)(e.sources[t])))),this.providerOutput.availableSources$.next(e.sources);let{volumeMultiplier:n=1,tuning:{useVolumeMultiplier:o}}=this.params;o&&1!==n&&al.isSupported()&&(this.volumeMultiplierManager=new al(this.providerOutput,this.current$,this.volumeMultiplierError$,n))}},ol="one_video_throughput",ll="one_video_rtt",ul=window.navigator.connection,dl=()=>{let e=ul?.downlink;if((0,u.isNonNullable)(e)&&10!==e)return 1e3*e},cl=()=>{let e=ul?.rtt;if((0,u.isNonNullable)(e)&&3e3!==e)return e},hl=(e,t,i)=>{let r=8*i;return r/(r/e+t)},pl=class e{destroy(){this.concurrentDownloads.clear(),this.subscription.unsubscribe()}trackXHR(e){let t=0,i=(0,u.now)(),r=new u.Subscription;switch(this.subscription.add(r),this.concurrentDownloads.add(e),e.readyState){case 4:break;case 3:case 2:r.add((0,u.fromEvent)(e,"progress").pipe((0,u.once)()).subscribe((e=>{t=e.loaded,i=(0,u.now)()})));break;case 1:case 0:r.add((0,u.fromEvent)(e,"loadstart").subscribe((()=>{t=0,i=(0,u.now)()})))}r.add((0,u.fromEvent)(e,"loadend").subscribe((a=>{if(200===e.status){let e=a.loaded,r=(0,u.now)(),s=e-t,n=r-i;this.addRawSpeed(s,n,1)}this.concurrentDownloads.delete(e),r.unsubscribe()})))}trackStream(e,t=!1){let i=e.getReader();if(!i)return void e.cancel("Could not get reader");let r=0,a=(0,u.now)(),s=0,n=(0,u.now)(),o=t=>{this.concurrentDownloads.delete(e),i.releaseLock(),e.cancel(`Throughput Estimator error: ${t}`).catch((()=>{}))},l=async({done:d,value:c})=>{if(d)!t&&this.addRawSpeed(r,(0,u.now)()-a,1),this.concurrentDownloads.delete(e);else if(c){if(t){let e=(0,u.now)();if(e-n>this.tuningConfig.lowLatency.continuesByteSequenceInterval||e-a>this.tuningConfig.lowLatency.maxLastEvaluationTimeout){let e=n-a;e&&this.addRawSpeed(s,e,1,t),s=c.byteLength,a=(0,u.now)()}else s+=c.byteLength;n=(0,u.now)()}else r+=c.byteLength,s+=c.byteLength,s>=this.tuningConfig.streamMinSampleSize&&(0,u.now)()-n>=this.tuningConfig.streamMinSampleTime&&(this.addRawSpeed(s,(0,u.now)()-n,this.concurrentDownloads.size),s=0,n=(0,u.now)());await(i?.read().then(l,o))}};this.concurrentDownloads.add(e),i?.read().then(l,o)}addRawSpeed(t,i,r=1,a=!1){if(e.sanityCheck(t,i,a)){let e=8*t/i;this.throughput.next(e*r)}}addRawThroughput(e){this.throughput.next(e)}addRawRtt(e){this.rtt.next(e)}static sanityCheck(e,t,i=!1){let r=8*e/t;return!(!r||!isFinite(r)||r>1e6||r<30||i&&e<1e4||!i&&e<10240||!i&&t<=20)}static load(e){let t=u.safeStorage.get(e);if((0,u.isNonNullable)(t))return parseInt(t,10)??void 0}constructor(t){this.subscription=new u.Subscription,this.concurrentDownloads=new Set,this.tuningConfig=t;let i=e.load(ol)||(t.useBrowserEstimation?dl():void 0)||5e3,r=e.load(ll)??(t.useBrowserEstimation?cl():void 0)??0;if(this.throughput$=new u.ValueSubject(i),this.rtt$=new u.ValueSubject(r),this.rttAdjustedThroughput$=new u.ValueSubject(hl(i,r,t.rttPenaltyRequestSize)),this.throughput=cn.getSmoothedValue(i,-1,t),this.rtt=cn.getSmoothedValue(r,1,t),t.useBrowserEstimation){let e=()=>{let e=dl();e&&this.throughput.next(e);let t=cl();(0,u.isNonNullable)(t)&&this.rtt.next(t)};ul&&"onchange"in ul&&this.subscription.add((0,u.fromEvent)(ul,"change").subscribe(e)),e()}this.subscription.add(this.throughput.smoothed$.subscribe((e=>{u.safeStorage.set(ol,e.toFixed(0))}))),this.subscription.add(this.rtt.smoothed$.subscribe((e=>{u.safeStorage.set(ll,e.toFixed(0))}))),this.subscription.add(this.throughput.debounced$.subscribe(this.throughput$)),this.subscription.add(this.rtt.debounced$.subscribe(this.rtt$)),this.subscription.add((0,u.combine)({throughput:this.throughput.smoothed$,rtt:this.rtt.smoothed$}).pipe((0,u.map)((({throughput:e,rtt:i})=>hl(e,i,t.rttPenaltyRequestSize))),(0,u.filter)((e=>{let i=this.rttAdjustedThroughput$.getValue()||0;return Math.abs(e-i)/i>=t.changeThreshold}))).subscribe(this.rttAdjustedThroughput$))}},fl={configName:["core"],throughputEstimator:{type:"EmaAndMa",emaAlphaSlow:.2,emaAlphaFast:.7,emaAlpha:.45,basisTrendChangeCount:10,changeThreshold:.05,useBrowserEstimation:!0,rttPenaltyRequestSize:1048576,streamMinSampleSize:10240,streamMinSampleTime:300,deviationDepth:20,deviationFactor:.5,lowLatency:{continuesByteSequenceInterval:50,maxLastEvaluationTimeout:300}},autoTrackSelection:{maxBitrateFactorAtEmptyBuffer:4,bitrateFactorAtEmptyBuffer:2.8,minBitrateFactorAtEmptyBuffer:1.5,bitrateAudioFactorAtEmptyBuffer:10,maxBitrateFactorAtFullBuffer:3,bitrateFactorAtFullBuffer:2,minBitrateFactorAtFullBuffer:1,bitrateAudioFactorAtFullBuffer:7,minVideoAudioRatio:5,minAvailableThroughputAudioRatio:5,usePixelRatio:!0,pixelRatioMultiplier:void 0,pixelRatioLogBase:3,pixelRatioLogCoefficients:[1,0,1],limitByContainer:!0,maxContainerSizeFactor:2,containerSizeFactor:1.3,minContainerSizeFactor:1,lazyQualitySwitch:!0,minBufferToSwitchUp:.4,considerPlaybackRate:!1,trackCooldownIncreaseQuality:15e3,trackCooldownDecreaseQuality:3e3,backgroundVideoQualityLimit:u.VideoQuality.Q_4320P,activeVideoAreaThreshold:.1,highQualityLimit:u.VideoQuality.Q_720P,trafficSavingLimit:u.VideoQuality.Q_480P},stallsManager:{stallDurationNoDataBeforeQualityDecrease:500,stallDurationToBeCount:100,stallCountBeforeQualityDecrease:3,resetQualityRestrictionTimeout:1e4,ignoreStallsOnSeek:!1,stallsMetricsHistoryLength:5,maxPossibleStallDuration:3e4,minTvtToBeCounted:5,maxTvtToBeCounted:0,targetStallsDurationPerTvt:1,deviationStallsDurationPerTvt:.5,criticalStallsDurationPerTvt:6,abrAdjustingSpeed:.1,emaAlpha:.6,useTotalStallsDurationPerTvt:!0,useAverageStallsDurationPerTvt:!0,useEmaStallsDurationPerTvt:!0},droppedFramesChecker:{enabled:!1,percentLimit:.1,checkTime:1e3,countLimit:3,tickCountAfterQualityChange:5,qualityUpWaitingTime:5e3,minQualityBanLimit:u.VideoQuality.Q_480P},dash:{forwardBufferTarget:6e4,forwardBufferTargetAuto:6e4,forwardBufferTargetManual:3e5,forwardBufferTargetPreload:5e3,seekBiasInTheEnd:2e3,maxSegmentDurationLeftToSelectNextSegment:3e3,minSafeBufferThreshold:.5,bufferPruningSafeZone:1e3,segmentRequestSize:1048576,representationSwitchForwardBufferGap:3e3,crashOnStallTimeout:25e3,crashOnStallTWithoutDataTimeout:5e3,enableSubSegmentBufferFeeding:!0,bufferEmptinessTolerance:100,useFetchPriorityHints:!0,enableBaseUrlSupport:!0,maxSegmentRetryCount:5,sourceOpenTimeout:1e3},dashCmafLive:{maxActiveLiveOffset:1e4,normalizedTargetMinBufferSize:6e4,normalizedLiveMinBufferSize:5e3,normalizedActualBufferOffset:1e4,offsetCalculationError:3e3,maxLiveDuration:7200,lowLatency:{maxTargetOffset:3e3,maxTargetOffsetDeviation:250,playbackCatchupSpeedup:.05,isActiveOnDefault:!1,bufferEstimator:{emaAlpha:.45,changeThreshold:.05,deviationDepth:20,deviationFactor:.5,extremumInterval:5}}},live:{minBuffer:3e3,minBufferSegments:3,lowLatencyMinBuffer:1e3,lowLatencyMinBufferSegments:1,isLiveCatchUpMode:!1,lowLatencyActiveLiveDelay:3e3,activeLiveDelay:5e3,maxPausedTime:5e3},downloadBackoff:{bufferThreshold:100,start:100,factor:2,max:3e3,random:.1},enableWakeLock:!0,enableTelemetryAtStart:!1,forceFormat:void 0,formatsToAvoid:[],disableChromecast:!1,chromecastReceiverId:"07A4434E",useWebmBigRequest:!1,webmCodec:"vp9",androidPreferredFormat:"dash",preferCMAF:!1,preferWebRTC:!1,preferMultiStream:!1,preferHDR:!1,bigRequestMinInitSize:51200,bigRequestMinDataSize:1048576,stripRangeHeader:!0,flushShortLoopedBuffers:!0,insufficientBufferRuleMargin:1e4,seekNearDurationBias:1,dashSeekInSegmentDurationThreshold:18e4,dashSeekInSegmentAlwaysSeekDelta:1e4,endGapTolerance:300,stallIgnoreThreshold:33,gapWatchdogInterval:50,requestQuick:!1,useHlsJs:!1,useNativeHLSTextTracks:!1,useManagedMediaSource:!0,useNewSwitchTo:!1,useNewDashProvider:!1,useNewAutoSelectVideoTrack:!1,useSafariEndlessRequestBugfix:!0,useRefactoredSearchGap:!1,isAudioDisabled:!1,autoplayOnlyInActiveTab:!0,dynamicImportTimeout:5e3,maxPlaybackTransitionInterval:2e4,providerErrorLimit:3,manifestRetryInterval:300,manifestRetryMaxInterval:1e4,manifestRetryMaxCount:10,audioVideoSyncRate:20,webrtc:{connectionRetryMaxNumber:3},spherical:{enabled:!1,fov:{x:135,y:76},rotationSpeed:45,maxYawAngle:175,rotationSpeedCorrection:10,degreeToPixelCorrection:5,speedFadeTime:2e3,speedFadeThreshold:50},useVolumeMultiplier:!1,ignoreAudioRendererError:!1,useEnableSubtitlesParam:!1,useOldMSEDetection:!1,useHlsLiveNewTextManager:!1,exposeInternalsToGlobal:!1,hlsLiveNewTextManagerDownloadThreshold:4e3,disableYandexPiP:!1,asyncResolveClientChecker:!1,autostartOnlyIfVisible:!1},ml=({seekState:e,position$:t})=>(0,u.merge)(e.stateChangeEnded$.pipe((0,u.map)((({to:e})=>"none"===e.state?void 0:(e.position??NaN)/1e3)),(0,u.filter)(u.isNonNullable)),t.pipe((0,u.filter)((()=>"none"===e.getState().state)))),vl=class{initVideo(e){this.config=e,this.internalsExposure?.expose({config:e,logger:this.logger,tuning:this.tuning}),this.setMuted(this.tuning.isAudioDisabled);let t=()=>{let{container:t,...i}=e;this.tracer.log("initVideo",(0,u.flattenObject)(i)),this.domContainer=(e=>{let t="string"==typeof e.container?document.getElementById(e.container):e.container;return(0,u.assertNonNullable)(t,`Wrong container or containerId {${e.container}}`),t})(e),this.chromecastInitializer.contentId=e.meta?.videoId,this.providerContainer=new nl({sources:e.sources,meta:e.meta??{},failoverHosts:e.failoverHosts??[],container:this.domContainer,desiredState:this.desiredState,dependencies:{throughputEstimator:this.throughputEstimator,chromecastInitializer:this.chromecastInitializer,tracer:this.tracer,logger:this.logger,abrLogger:this.abrLogger},tuning:this.tuning,volumeMultiplier:e.volumeMultiplier,panelSize:e.panelSize}),this.initProviderContainerSubscription(this.providerContainer),this.initStartingVideoTrack(this.providerContainer),this.initTracerSubscription(),this.providerContainer.init(),this.setLiveLowLatency(this.tuning.dashCmafLive.lowLatency.isActiveOnDefault),this.initDebugTelemetry(),this.initWakeLock(),this.playerInited.next(!0)},i=()=>{this.tuning.autostartOnlyIfVisible&&window.requestAnimationFrame?this.playerInitRequest=window.requestAnimationFrame((()=>t())):t()},r=()=>{this.tuning.asyncResolveClientChecker?Fr.isInited$.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{console.log("Core SDK async start"),i()})):i()};return this.isNotActiveTabCase()?(this.tracer.log("request play from hidden tab"),(0,u.fromEvent)(document,"visibilitychange").pipe((0,u.once)()).subscribe(r)):r(),this}destroy(){this.tracer.log("destroy"),window.clearTimeout(this.hasLiveOffsetByPausedTimer),this.playerInitRequest&&window.cancelAnimationFrame(this.playerInitRequest),this.events.willDestruct$.next(),this.stop(),this.providerContainer?.destroy(),this.throughputEstimator.destroy(),this.chromecastInitializer.destroy(),this.subscription.unsubscribe(),this.tracer.end(),this.internalsExposure?.destroy()}prepare(){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let e=this.desiredState.playbackState;this.tracer.log("prepare",{currentPlayBackState:e.getState()}),"stopped"===e.getState()&&e.startTransitionTo("ready")}))),this}play(){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let e=this.desiredState.playbackState;this.tracer.log("play",{currentPlayBackState:e.getState()}),"playing"!==e.getState()&&e.startTransitionTo("playing")}))),this}pause(){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let e=this.desiredState.playbackState;this.tracer.log("pause",{currentPlayBackState:e.getState()}),"paused"!==e.getState()&&e.startTransitionTo("paused")}))),this}stop(){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let e=this.desiredState.playbackState;this.tracer.log("stop",{currentPlayBackState:e.getState()}),"stopped"!==e.getState()&&e.startTransitionTo("stopped")}))),this}seekTime(e,t=!0){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let i=this.info.duration$.getValue(),r=this.info.isLive$.getValue(),a=e;e>=i&&!r&&(a=i-this.tuning.seekNearDurationBias),this.tracer.log("seekTime",{duration:i,isLive:r,time:e,calculatedTime:a,forcePrecise:t}),Number.isFinite(a)&&(this.events.willSeek$.next({from:this.getExactTime(),to:a}),this.desiredState.seekState.setState({state:"requested",position:1e3*a,forcePrecise:t}))}))),this}seekPercent(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let t=this.info.duration$.getValue();this.tracer.log("seekPercent",{percent:e,duration:t}),isFinite(t)&&this.seekTime(Math.abs(t)*e,!1)}))),this}setVolume(e,t){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let i=this.desiredState.volume,r=i.getTransition()?.to.muted??this.info.muted$.getValue(),a=t??(this.tuning.isAudioDisabled||r);this.tracer.log("setVolume",{volume:e,isAudioDisabled:this.tuning.isAudioDisabled,chromecastState:this.chromecastInitializer.castState$.getValue(),muted:a}),"CONNECTED"===this.chromecastInitializer.castState$.getValue()?this.chromecastInitializer.setVolume(e):i.startTransitionTo({volume:e,muted:a})}))),this}setMuted(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let t=this.desiredState.volume,i=this.tuning.isAudioDisabled||e,r=t.getTransition()?.to.volume??this.info.volume$.getValue();this.tracer.log("setMuted",{isMuted:e,nextMuted:i,volume:r,isAudioDisabled:this.tuning.isAudioDisabled,chromecastState:this.chromecastInitializer.castState$.getValue()}),"CONNECTED"===this.chromecastInitializer.castState$.getValue()?this.chromecastInitializer.setMuted(i):t.startTransitionTo({volume:r,muted:i})}))),this}setVideoStream(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{this.desiredState.videoStream.startTransitionTo(e)}))),this}setAudioStream(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{this.desiredState.audioStream.startTransitionTo(e)}))),this}setQuality(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{(0,u.assertNonNullable)(this.providerContainer);let t=this.providerContainer.providerOutput.availableVideoTracks$.getValue();this.tracer.log("setQuality",{isDelayed:0===t.length,quality:e}),void 0===this.desiredState.videoTrack.getState()&&void 0===this.desiredState.videoTrack.getPrevState()&&0===t.length?this.wasSetStartedQuality?this.providerContainer.providerOutput.availableVideoTracks$.pipe((0,u.filter)((e=>e.length>0)),(0,u.once)()).subscribe((t=>{this.setVideoTrackIdByQuality(t,e)})):this.explicitInitialQuality=e:t.length>0&&this.setVideoTrackIdByQuality(t,e)}))),this}setAutoQuality(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{this.tracer.log("setAutoQuality",{enable:e}),this.desiredState.autoVideoTrackSwitching.startTransitionTo(e)}))),this}setAutoQualityLimits(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{this.tracer.log("setAutoQualityLimits",(0,u.flattenObject)(e)),this.desiredState.autoVideoTrackLimits.startTransitionTo(e)}))),this}setPredefinedQualityLimits(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{if(this.info.predefinedQualityLimitType$.getValue()===e)return this;let t,{highQualityLimit:i,trafficSavingLimit:r}=this.tuning.autoTrackSelection;switch(e){case"high_quality":t={min:i,max:void 0};break;case"traffic_saving":t={max:r,min:void 0};break;default:t={max:void 0,min:void 0}}this.setAutoQualityLimits(t)}))),this}setPlaybackRate(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{(0,u.assertNonNullable)(this.providerContainer);let t=this.providerContainer?.providerOutput.element$.getValue();this.tracer.log("setPlaybackRate",{playbackRate:e,isVideoElementAvailable:!!t}),t&&(this.desiredState.playbackRate.setState(e),t.playbackRate=e)}))),this}setExternalTextTracks(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{e.length&&this.tracer.log("setExternalTextTracks",(0,u.flattenObject)(e)),this.desiredState.externalTextTracks.startTransitionTo(e.map((e=>({type:"external",...e}))))}))),this}selectTextTrack(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{((e,t,i,r)=>{void 0!==e&&void 0===t.getState()&&void 0===t.getPrevState()&&0===i?.getValue().length?i.pipe((0,u.filter)((e=>e.length>0)),(0,u.once)()).subscribe((i=>{i.find(r)&&t.startTransitionTo(e)})):(void 0===e||i?.getValue().find(r))&&t.startTransitionTo(e)})(e,this.desiredState.currentTextTrack,this.providerContainer?.providerOutput.availableTextTracks$,(t=>t.id===e)),this.tracer.log("selectTextTrack",{textTrackId:e})}))),this}setTextTrackCueSettings(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{this.tracer.log("setTextTrackCueSettings",{...e}),this.desiredState.textTrackCuesSettings.startTransitionTo(e)}))),this}setLiveLowLatency(e){let t=this.info.isLive$.getValue(),i=this.desiredState.isLowLatency.getState();return t&&i!==e?(this.tracer.log("live switch to low latency "+e),this.desiredState.isLowLatency.setState(e),this.seekTime(0)):this}setLooped(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{this.tracer.log("setLooped",{isLooped:e}),this.desiredState.isLooped.startTransitionTo(e)}))),this}toggleChromecast(){this.tracer.log("toggleChromecast"),this.chromecastInitializer.toggleConnection()}startCameraManualRotation(e,t){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let i=this.getScene3D();this.tracer.log("startCameraManualRotation",{isScene3DAvailable:!!i,mx:e,my:t}),i&&i.startCameraManualRotation(e,t)}))),this}stopCameraManualRotation(e=!1){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let t=this.getScene3D();this.tracer.log("stopCameraManualRotation",{isScene3DAvailable:!!t,immediate:e}),t&&t.stopCameraManualRotation(e)}))),this}moveCameraFocusPX(e,t){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let i=this.getScene3D();if(this.tracer.log("moveCameraFocusPX",{isScene3DAvailable:!!i,dxpx:e,dypx:t}),i){let r=i.getCameraRotation(),a=i.pixelToDegree({x:e,y:t});this.desiredState.cameraOrientation.setState({x:r.x+a.x,y:r.y+a.y})}}))),this}holdCamera(){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>e)),(0,u.once)()).subscribe((()=>{let e=this.getScene3D();e&&e.holdCamera()}))),this}releaseCamera(){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let e=this.getScene3D();e&&e.releaseCamera()}))),this}getExactTime(){if(!this.providerContainer)return 0;let e=this.providerContainer.providerOutput.element$.getValue();if((0,u.isNullable)(e))return this.info.position$.getValue();let t=this.desiredState.seekState.getState(),i="none"===t.state?void 0:t.position;return(0,u.isNonNullable)(i)?i/1e3:e.currentTime}getAllLogs(){return this.logger.getAllLogs()}getScene3D(){let e=this.providerContainer?.current$.getValue();if(e?.provider?.scene3D)return e.provider.scene3D}setIntrinsicVideoSize(...e){let t={width:e.reduce(((e,{width:t})=>e||t||0),0),height:e.reduce(((e,{height:t})=>e||t||0),0)};t.width&&t.height&&this.info.intrinsicVideoSize$.next({width:t.width,height:t.height})}initDesiredStateSubscriptions(){this.subscription.add((0,u.merge)(this.desiredState.playbackState.stateChangeStarted$,this.desiredState.playbackState.forceChanged$).pipe((0,u.map)((e=>e.to))).subscribe(this.info.playbackState$)).add(this.desiredState.isLooped.stateChangeEnded$.pipe((0,u.map)((e=>e.to))).subscribe(this.info.isLooped$)).add(this.desiredState.playbackRate.stateChangeEnded$.pipe((0,u.map)((e=>e.to))).subscribe(this.info.currentPlaybackRate$)).add(this.desiredState.autoVideoTrackSwitching.stateChangeEnded$.pipe((0,u.map)((e=>e.to))).subscribe(this.info.isAutoQualityEnabled$)).add(this.desiredState.autoVideoTrackLimits.stateChangeEnded$.pipe((0,u.map)((e=>e.to))).subscribe((e=>{this.info.autoQualityLimits$.next(e);let{highQualityLimit:t,trafficSavingLimit:i}=this.tuning.autoTrackSelection;this.info.predefinedQualityLimitType$.next(Zr(e,t,i))}))),this.subscription.add(this.desiredState.playbackState.stateChangeStarted$.pipe((0,u.filter)((({from:e})=>"stopped"===e)),(0,u.once)()).subscribe((()=>{this.initedAt=(0,u.now)(),this.events.inited$.next()}))).add(this.desiredState.playbackState.stateChangeEnded$.subscribe((e=>{switch(e.to){case"ready":this.events.ready$.next();break;case"playing":this.isPlaybackStarted||this.events.started$.next(),this.isPlaybackStarted=!0,this.events.playing$.next();break;case"paused":this.events.paused$.next();break;case"stopped":this.events.stopped$.next()}}))).add(this.desiredState.playbackState.stateChangeStarted$.subscribe((e=>{switch(e.to){case"paused":this.events.willPause$.next();break;case"playing":this.isPlaybackStarted?this.events.willResume$.next():this.events.willStart$.next();break;case"stopped":this.events.willStop$.next()}})))}initProviderContainerSubscription(e){this.subscription.add(e.providerOutput.willSeekEvent$.subscribe((()=>{let e=this.desiredState.seekState.getState();this.tracer.log("willSeekEvent",(0,u.flattenObject)(e)),"requested"===e.state?this.desiredState.seekState.setState({...e,state:"applying"}):this.events.managedError$.next({id:`WillSeekIn${e.state}`,category:u.ErrorCategory.WTF,message:"Received unexpeceted willSeek$"})}))).add(e.providerOutput.soundProhibitedEvent$.pipe((0,u.once)()).subscribe(this.events.autoplaySoundProhibited$)).add(e.providerOutput.severeStallOccurred$.subscribe(this.events.severeStallOccured$)).add(e.providerOutput.seekedEvent$.subscribe((()=>{let e=this.desiredState.seekState.getState();this.tracer.log("seekedEvent",(0,u.flattenObject)(e)),"applying"===e.state&&(this.desiredState.seekState.setState({state:"none"}),this.events.seeked$.next())}))).add(e.current$.pipe((0,u.map)((e=>e.type))).subscribe(this.info.currentFormat$)).add(e.current$.pipe((0,u.map)((e=>e.destination)),(0,u.filterChanged)()).subscribe((()=>this.isPlaybackStarted=!1))).add(e.providerOutput.availableVideoStreams$.subscribe(this.info.availableVideoStreams$)).add((0,u.combine)({availableVideoTracks:e.providerOutput.availableVideoTracks$,currentVideoStream:e.providerOutput.currentVideoStream$}).pipe((0,u.map)((({availableVideoTracks:e,currentVideoStream:t})=>e.filter((e=>!t||t.id===e.streamId)).map((({quality:e})=>e)).sort(((e,t)=>(0,u.isInvariantQuality)(e)?1:(0,u.isInvariantQuality)(t)?-1:(0,u.isHigher)(t,e)?1:-1))))).subscribe(this.info.availableQualities$)).add(e.providerOutput.availableVideoTracks$.subscribe((e=>{let t={};for(let i of e)i.fps&&(t[i.quality]=i.fps);this.info.availableQualitiesFps$.next(t)}))).add(e.providerOutput.availableAudioStreams$.subscribe(this.info.availableAudioStreams$)).add(e.providerOutput.currentVideoStream$.subscribe(this.info.currentVideoStream$)).add(e.providerOutput.currentAudioStream$.subscribe(this.info.currentAudioStream$)).add(e.providerOutput.availableAudioTracks$.subscribe(this.info.availableAudioTracks$)).add(e.providerOutput.isAudioAvailable$.pipe((0,u.filterChanged)()).subscribe(this.info.isAudioAvailable$)).add(e.providerOutput.currentVideoTrack$.pipe((0,u.filter)((e=>(0,u.isNonNullable)(e)))).subscribe((e=>{this.info.currentQuality$.next(e?.quality),this.info.videoBitrate$.next(e?.bitrate)}))).add(e.providerOutput.currentVideoSegmentLength$.pipe((0,u.filterChanged)(((e,t)=>Math.round(e)===Math.round(t)))).subscribe(this.info.currentVideoSegmentLength$)).add(e.providerOutput.currentAudioSegmentLength$.pipe((0,u.filterChanged)(((e,t)=>Math.round(e)===Math.round(t)))).subscribe(this.info.currentAudioSegmentLength$)).add(e.providerOutput.hostname$.pipe((0,u.filterChanged)()).subscribe(this.info.hostname$)).add(e.providerOutput.httpConnectionType$.pipe((0,u.filterChanged)()).subscribe(this.info.httpConnectionType$)).add(e.providerOutput.httpConnectionReused$.pipe((0,u.filterChanged)()).subscribe(this.info.httpConnectionReused$)).add(e.providerOutput.currentTextTrack$.subscribe(this.info.currentTextTrack$)).add(e.providerOutput.availableTextTracks$.subscribe(this.info.availableTextTracks$)).add(e.providerOutput.autoVideoTrackLimitingAvailable$.subscribe(this.info.autoQualityLimitingAvailable$)).add(e.providerOutput.autoVideoTrackLimits$.subscribe((e=>{this.desiredState.autoVideoTrackLimits.setState(e??{})}))).add(e.providerOutput.currentBuffer$.pipe((0,u.map)((e=>e?{start:e.from,end:e.to}:{start:0,end:0}))).subscribe(this.info.currentBuffer$)).add(e.providerOutput.duration$.subscribe(this.info.duration$)).add(e.providerOutput.isBuffering$.subscribe(this.info.isBuffering$)).add(e.providerOutput.isLive$.subscribe(this.info.isLive$)).add(e.providerOutput.isLiveEnded$.pipe((0,u.tap)((e=>e&&this.stop()))).subscribe(this.info.isLiveEnded$)).add(e.providerOutput.canChangePlaybackSpeed$.subscribe(this.info.canChangePlaybackSpeed$)).add(e.providerOutput.liveTime$.subscribe(this.info.liveTime$)).add(e.providerOutput.liveBufferTime$.subscribe(this.info.liveBufferTime$)).add(e.providerOutput.liveLatency$.subscribe(this.info.liveLatency$)).add((0,u.combine)({hasLiveOffsetByPaused:(0,u.merge)(this.desiredState.playbackState.stateChangeStarted$,this.desiredState.playbackState.forceChanged$).pipe((0,u.map)((e=>e.to)),(0,u.filterChanged)(),(0,u.map)((e=>"paused"===e))),isLowLatency:e.providerOutput.isLowLatency$}).subscribe((({hasLiveOffsetByPaused:e,isLowLatency:t})=>{window.clearTimeout(this.hasLiveOffsetByPausedTimer),e?this.hasLiveOffsetByPausedTimer=window.setTimeout((()=>{this.hasLiveOffsetByPaused.next(!0)}),this.getActiveLiveDelay(t)):this.hasLiveOffsetByPaused.next(!1)}))).add((0,u.combine)({atLiveEdge:(0,u.combine)({isLive:e.providerOutput.isLive$,isLowLatency:e.providerOutput.isLowLatency$,position:ml({seekState:this.desiredState.seekState,position$:e.providerOutput.position$})}).pipe((0,u.map)((({isLive:e,position:t,isLowLatency:i})=>{let r=this.getActiveLiveDelay(i);return e&&Math.abs(t)<r/1e3})),(0,u.filterChanged)(),(0,u.tap)((e=>e&&this.setPlaybackRate(1)))),hasPausedTimeoutCase:this.hasLiveOffsetByPaused}).pipe((0,u.map)((({atLiveEdge:e,hasPausedTimeoutCase:t})=>e&&!t))).subscribe(this.info.atLiveEdge$)).add((0,u.combine)({isLive:e.providerOutput.isLive$,position:e.providerOutput.position$,duration:e.providerOutput.duration$}).pipe((0,u.map)((({isLive:e,position:t,duration:i})=>e&&1e3*(Math.abs(i)-Math.abs(t))<this.tuning.live.activeLiveDelay)),(0,u.filterChanged)(),(0,u.tap)((e=>e&&this.setPlaybackRate(1)))).subscribe(this.info.atLiveDurationEdge$)).add(e.providerOutput.volume$.pipe((0,u.map)((e=>e.muted)),(0,u.filterChanged)()).subscribe(this.info.muted$)).add(e.providerOutput.volume$.pipe((0,u.map)((e=>e.volume)),(0,u.filterChanged)()).subscribe(this.info.volume$)).add(ml({seekState:this.desiredState.seekState,position$:e.providerOutput.position$}).subscribe(this.info.position$)).add((0,u.merge)(e.providerOutput.endedEvent$.pipe((0,u.mapTo)(!0)),e.providerOutput.seekedEvent$.pipe((0,u.mapTo)(!1))).pipe((0,u.filterChanged)()).subscribe(this.info.isEnded$)).add(e.providerOutput.endedEvent$.subscribe(this.events.ended$)).add(e.providerOutput.loopedEvent$.subscribe(this.events.looped$)).add(e.providerError$.subscribe(this.events.managedError$)).add(e.providerOutput.fetcherRecoverableError$.subscribe(this.events.fetcherRecoverableError$)).add(e.providerOutput.fetcherError$.subscribe(this.events.fatalError$)).add(e.volumeMultiplierError$.subscribe(this.events.managedError$)).add(e.noAvailableProvidersError$.pipe((0,u.map)((e=>({id:e?`No${e}`:"NoProviders",category:u.ErrorCategory.VIDEO_PIPELINE,message:e?`${e} was forced but failed or not available`:"No suitable providers or all providers failed"})))).subscribe(this.events.fatalError$)).add(e.providerOutput.element$.subscribe(this.experimental.element$)).add(e.providerOutput.getCurrentTime$.subscribe(this.experimental.getCurrentTime$)).add(e.providerOutput.firstBytesEvent$.pipe((0,u.once)(),(0,u.map)((e=>e??(0,u.now)()-this.initedAt))).subscribe(this.events.firstBytes$)).add(e.providerOutput.loadedMetadataEvent$.subscribe(this.events.loadedMetadata$)).add(e.providerOutput.firstFrameEvent$.pipe((0,u.once)(),(0,u.map)((()=>(0,u.now)()-this.initedAt))).subscribe(this.events.firstFrame$)).add(e.providerOutput.canplay$.pipe((0,u.once)(),(0,u.map)((()=>(0,u.now)()-this.initedAt))).subscribe(this.events.canplay$)).add(this.throughputEstimator.throughput$.subscribe(this.info.throughputEstimation$)).add(this.throughputEstimator.rtt$.subscribe(this.info.rttEstimation$)).add(e.providerOutput.availableSources$.subscribe(this.info.availableSources$));let t=new u.ValueSubject(!1);this.subscription.add(e.providerOutput.seekedEvent$.subscribe((()=>t.next(!1)))).add(e.providerOutput.willSeekEvent$.subscribe((()=>t.next(!0))));let i=new u.ValueSubject(!0);this.subscription.add(e.current$.subscribe((()=>i.next(!0)))).add(this.desiredState.playbackState.stateChangeEnded$.pipe((0,u.filter)((({to:e})=>"playing"===e)),(0,u.once)()).subscribe((()=>i.next(!1))));let r=0,a=(0,u.merge)(e.providerOutput.isBuffering$,t,i).pipe((0,u.map)((()=>{let r=e.providerOutput.isBuffering$.getValue(),a=t.getValue()||i.getValue();return r&&!a})),(0,u.filterChanged)());this.subscription.add(a.subscribe((e=>{e?r=window.setTimeout((()=>this.info.isStalled$.next(!0)),this.tuning.stallIgnoreThreshold):(window.clearTimeout(r),this.info.isStalled$.next(!1))}))),this.subscription.add((0,u.merge)(e.providerOutput.canplay$,e.providerOutput.firstFrameEvent$,e.providerOutput.firstBytesEvent$).subscribe((()=>{let t=e.providerOutput.element$.getValue();this.setIntrinsicVideoSize({width:t?.videoWidth,height:t?.videoHeight})}))).add(e.providerOutput.currentVideoTrack$.subscribe((t=>{let i=e.providerOutput.element$.getValue();this.setIntrinsicVideoSize({width:t?.size?.width,height:t?.size?.height},{width:i?.videoWidth,height:i?.videoHeight})}))).add(e.providerOutput.is3DVideo$.subscribe(this.info.is3DVideo$)),this.subscription.add((0,u.merge)(e.providerOutput.inPiP$,e.providerOutput.inFullscreen$,e.providerOutput.element$,e.providerOutput.elementVisible$,this.chromecastInitializer.castState$).subscribe((()=>{let t,i=e.providerOutput.inPiP$.getValue(),r=e.providerOutput.inFullscreen$.getValue(),a=e.providerOutput.element$.getValue(),s=e.providerOutput.elementVisible$.getValue();t="CONNECTED"===this.chromecastInitializer.castState$.getValue()?"second_screen":a?s?i?"pip":r?"fullscreen":"inline":"invisible":"none",this.info.surface$.getValue()!==t&&this.info.surface$.next(t)})))}initChromecastSubscription(){this.subscription.add(this.chromecastInitializer.castState$.subscribe(this.info.chromecastState$)),this.subscription.add(this.chromecastInitializer.connection$.pipe((0,u.map)((e=>e?.castDevice.friendlyName))).subscribe(this.info.chromecastDeviceName$)),this.subscription.add(this.chromecastInitializer.errorEvent$.subscribe(this.events.managedError$))}initStartingVideoTrack(e){let t=new u.Subscription;this.subscription.add(t),this.subscription.add(e.current$.pipe((0,u.filterChanged)(((e,t)=>e.provider===t.provider))).subscribe((()=>{t.unsubscribe(),t.add(e.providerOutput.availableVideoTracks$.pipe((0,u.filter)((e=>e.length>0)),(0,u.once)()).subscribe((e=>{this.setStartingVideoTrack(e)})))})))}setStartingVideoTrack(e){let t;this.wasSetStartedQuality=!0;let i=this.explicitInitialQuality??this.info.currentQuality$.getValue();i&&(t=e.find((({quality:e})=>e===i)),t||this.setAutoQuality(!0)),t||(t=ma(e,{container:this.domContainer.getBoundingClientRect(),panelSize:this.config.panelSize,estimatedThroughput:this.throughputEstimator.throughput$.getValue(),tuning:this.tuning.autoTrackSelection,limits:this.desiredState.autoVideoTrackLimits.getState(),playbackRate:this.info.currentPlaybackRate$.getValue(),forwardBufferHealth:0,abrLogger:this.abrLogger})),this.desiredState.videoTrack.startTransitionTo(t),this.info.currentQuality$.next(t.quality),this.info.videoBitrate$.next(t.bitrate)}initLogs(){this.subscription.add((0,u.merge)(this.desiredState.videoTrack.stateChangeStarted$.pipe((0,u.map)((e=>({transition:e,entity:"quality",type:"start"})))),this.desiredState.videoTrack.stateChangeEnded$.pipe((0,u.map)((e=>({transition:e,entity:"quality",type:"end"})))),this.desiredState.autoVideoTrackSwitching.stateChangeStarted$.pipe((0,u.map)((e=>({transition:e,entity:"autoQualityEnabled",type:"start"})))),this.desiredState.autoVideoTrackSwitching.stateChangeEnded$.pipe((0,u.map)((e=>({transition:e,entity:"autoQualityEnabled",type:"end"})))),this.desiredState.seekState.stateChangeStarted$.pipe((0,u.map)((e=>({transition:e,entity:"seekState",type:"start"})))),this.desiredState.seekState.stateChangeEnded$.pipe((0,u.map)((e=>({transition:e,entity:"seekState",type:"end"})))),this.desiredState.playbackState.stateChangeStarted$.pipe((0,u.map)((e=>({transition:e,entity:"playbackState",type:"start"})))),this.desiredState.playbackState.stateChangeEnded$.pipe((0,u.map)((e=>({transition:e,entity:"playbackState",type:"end"}))))).pipe((0,u.map)((e=>({component:"desiredState",message:`[${e.entity} change] ${e.type}: ${JSON.stringify(e.transition)}`})))).subscribe(this.logger.log)),this.subscription.add(this.logger.log$.subscribe(this.events.log$))}initDebugTelemetry(){let e=this.providerContainer?.providerOutput;(0,u.assertNonNullable)(this.providerContainer),(0,u.assertNonNullable)(e),Qr={},this.experimental.enableDebugTelemetry$.next(this.tuning.enableTelemetryAtStart),[this.experimental.enableDebugTelemetry$.subscribe((e=>{Wr=e})),this.providerContainer.current$.subscribe((({type:e})=>Kr("provider",e))),e.duration$.subscribe((e=>Kr("duration",e))),e.availableVideoTracks$.pipe((0,u.filter)((e=>!!e.length)),(0,u.once)()).subscribe((e=>Kr("tracks",e))),this.events.fatalError$.subscribe(new Yr("fatalError")),this.events.managedError$.subscribe(new Yr("managedError")),e.position$.subscribe(new Yr("position")),e.currentVideoTrack$.pipe((0,u.map)((e=>e?.quality))).subscribe(new Yr("quality")),this.info.currentBuffer$.subscribe(new Yr("buffer")),e.isBuffering$.subscribe(new Yr("isBuffering"))].forEach((e=>this.subscription.add(e))),Kr("codecs",Fr.video.supportedCodecs)}initTracerSubscription(){let e=(0,u.getTraceSubscriptionMethod)(this.tracer.log.bind(this.tracer)),t=(0,u.getTraceSubscriptionMethod)(this.tracer.error.bind(this.tracer));this.subscription.add(this.info.playbackState$.subscribe(e("playbackState"))).add(this.info.isLooped$.subscribe(e("isLooped"))).add(this.info.currentPlaybackRate$.pipe((0,u.filterChanged)()).subscribe(e("currentPlaybackRate"))).add(this.info.isAutoQualityEnabled$.subscribe(e("isAutoQualityEnabled"))).add(this.info.autoQualityLimits$.subscribe(e("autoQualityLimits"))).add(this.info.currentFormat$.subscribe(e("currentFormat"))).add(this.info.availableQualities$.subscribe(e("availableQualities"))).add(this.info.availableQualitiesFps$.subscribe(e("availableQualitiesFps"))).add(this.info.availableAudioTracks$.subscribe(e("availableAudioTracks"))).add(this.info.isAudioAvailable$.subscribe(e("isAudioAvailable"))).add((0,u.combine)({currentQuality:this.info.currentQuality$,videoBitrate:this.info.videoBitrate$}).pipe((0,u.filter)((({currentQuality:e,videoBitrate:t})=>!!e&&!!t)),(0,u.filterChanged)(((e,t)=>e.currentQuality===t.currentQuality))).subscribe(e("currentVideoTrack"))).add(this.info.currentVideoSegmentLength$.pipe((0,u.filter)((e=>e>0)),(0,u.filterChanged)()).subscribe(e("currentVideoSegmentLength"))).add(this.info.currentAudioSegmentLength$.pipe((0,u.filter)((e=>e>0)),(0,u.filterChanged)()).subscribe(e("currentAudioSegmentLength"))).add(this.info.hostname$.subscribe(e("hostname"))).add(this.info.currentTextTrack$.subscribe(e("currentTextTrack"))).add(this.info.availableTextTracks$.subscribe(e("availableTextTracks"))).add(this.info.autoQualityLimitingAvailable$.subscribe(e("autoQualityLimitingAvailable"))).add((0,u.combine)({currentBuffer:this.info.currentBuffer$.pipe((0,u.filter)((e=>e.end>0)),(0,u.filterChanged)(((e,t)=>e.end===t.end&&e.start===t.start))),position:this.info.position$.pipe((0,u.filterChanged)())}).pipe((0,u.throttle)(1e3)).subscribe(e("currentBufferAndPosition"))).add(this.info.duration$.pipe((0,u.filterChanged)()).subscribe(e("duration"))).add(this.info.isBuffering$.subscribe(e("isBuffering"))).add(this.info.isLive$.pipe((0,u.filterChanged)()).subscribe(e("isLive"))).add(this.info.canChangePlaybackSpeed$.pipe((0,u.filterChanged)()).subscribe(e("canChangePlaybackSpeed"))).add((0,u.combine)({liveTime:this.info.liveTime$,liveBufferTime:this.info.liveBufferTime$,position:this.info.position$}).pipe((0,u.filter)((({liveTime:e,liveBufferTime:t})=>!!e&&!!t)),(0,u.throttle)(1e3)).subscribe(e("liveBufferAndPosition"))).add(this.info.atLiveEdge$.pipe((0,u.filterChanged)(),(0,u.filter)((e=>!0===e))).subscribe(e("atLiveEdge"))).add(this.info.atLiveDurationEdge$.pipe((0,u.filterChanged)(),(0,u.filter)((e=>!0===e))).subscribe(e("atLiveDurationEdge"))).add(this.info.muted$.pipe((0,u.filterChanged)()).subscribe(e("muted"))).add(this.info.volume$.pipe((0,u.filterChanged)()).subscribe(e("volume"))).add(this.info.isEnded$.pipe((0,u.filterChanged)(),(0,u.filter)((e=>!0===e))).subscribe(e("isEnded"))).add(this.info.availableSources$.subscribe(e("availableSources"))).add((0,u.combine)({throughputEstimation:this.info.throughputEstimation$,rtt:this.info.rttEstimation$}).pipe((0,u.filter)((({throughputEstimation:e,rtt:t})=>!!e&&!!t)),(0,u.throttle)(3e3)).subscribe(e("throughputEstimation"))).add(this.info.isStalled$.subscribe(e("isStalled"))).add(this.info.is3DVideo$.pipe((0,u.filterChanged)(),(0,u.filter)((e=>!0===e))).subscribe(e("is3DVideo"))).add(this.info.surface$.subscribe(e("surface"))).add(this.events.ended$.subscribe(e("ended"))).add(this.events.looped$.subscribe(e("looped"))).add(this.events.managedError$.subscribe(t("managedError"))).add(this.events.fatalError$.subscribe(t("fatalError"))).add(this.events.firstBytes$.subscribe(e("firstBytes"))).add(this.events.firstFrame$.subscribe(e("firstFrame"))).add(this.events.canplay$.subscribe(e("canplay")))}initWakeLock(){if(!window.navigator.wakeLock||!this.tuning.enableWakeLock)return;let e,t=()=>{e?.release(),e=void 0},i=async()=>{t(),e=await window.navigator.wakeLock.request("screen").catch((e=>{e instanceof DOMException&&"NotAllowedError"===e.name||this.events.managedError$.next({id:"WakeLock",category:u.ErrorCategory.DOM,message:String(e)})}))};this.subscription.add((0,u.merge)((0,u.fromEvent)(document,"visibilitychange"),(0,u.fromEvent)(document,"fullscreenchange"),this.desiredState.playbackState.stateChangeEnded$).subscribe((()=>{let r="visible"===document.visibilityState,a="playing"===this.desiredState.playbackState.getState();r&&a?!!e&&!e?.released||i():t()}))).add(this.events.willDestruct$.subscribe(t))}setVideoTrackIdByQuality(e,t){let i=e.find((e=>e.quality===t));this.tracer.log("setVideoTrackIdByQuality",(0,u.flattenObject)({quality:t,availableTracks:(0,u.flattenObject)(e),track:(0,u.flattenObject)(i),isAutoQuality:!i})),i?this.desiredState.videoTrack.startTransitionTo(i):this.setAutoQuality(!0)}getActiveLiveDelay(e=!1){return e?this.tuning.live.lowLatencyActiveLiveDelay:this.tuning.live.activeLiveDelay}isNotActiveTabCase(){return document.hidden&&this.tuning.autoplayOnlyInActiveTab&&!Na()}constructor(e={configName:[]},t=u.Tracer.createRootTracer(!1)){if(this.subscription=new u.Subscription,this.logger=new u.Logger,this.abrLogger=this.logger.createComponentLog("ABR"),this.internalsExposure=null,this.isPlaybackStarted=!1,this.hasLiveOffsetByPaused=new u.ValueSubject(!1),this.hasLiveOffsetByPausedTimer=0,this.playerInitRequest=0,this.playerInited=new u.ValueSubject(!1),this.wasSetStartedQuality=!1,this.desiredState={playbackState:new lr("stopped"),seekState:new lr({state:"none"}),volume:new lr({volume:1,muted:!1}),videoTrack:new lr(void 0),videoStream:new lr(void 0),audioStream:new lr(void 0),autoVideoTrackSwitching:new lr(!0),autoVideoTrackLimits:new lr({}),isLooped:new lr(!1),isLowLatency:new lr(!1),playbackRate:new lr(1),externalTextTracks:new lr([]),internalTextTracks:new lr([]),currentTextTrack:new lr(void 0),textTrackCuesSettings:new lr({}),cameraOrientation:new lr({x:0,y:0})},this.info={playbackState$:new u.ValueSubject(void 0),position$:new u.ValueSubject(0),duration$:new u.ValueSubject(1/0),muted$:new u.ValueSubject(!1),volume$:new u.ValueSubject(1),availableVideoStreams$:new u.ValueSubject([]),currentVideoStream$:new u.ValueSubject(void 0),availableQualities$:new u.ValueSubject([]),availableQualitiesFps$:new u.ValueSubject({}),currentQuality$:new u.ValueSubject(void 0),isAutoQualityEnabled$:new u.ValueSubject(!0),autoQualityLimitingAvailable$:new u.ValueSubject(!1),autoQualityLimits$:new u.ValueSubject({}),predefinedQualityLimitType$:new u.ValueSubject("unknown"),availableAudioStreams$:new u.ValueSubject([]),currentAudioStream$:new u.ValueSubject(void 0),availableAudioTracks$:new u.ValueSubject([]),isAudioAvailable$:new u.ValueSubject(!0),currentPlaybackRate$:new u.ValueSubject(1),currentBuffer$:new u.ValueSubject({start:0,end:0}),isBuffering$:new u.ValueSubject(!0),isStalled$:new u.ValueSubject(!1),isEnded$:new u.ValueSubject(!1),isLooped$:new u.ValueSubject(!1),isLive$:new u.ValueSubject(void 0),isLiveEnded$:new u.ValueSubject(null),canChangePlaybackSpeed$:new u.ValueSubject(void 0),atLiveEdge$:new u.ValueSubject(void 0),atLiveDurationEdge$:new u.ValueSubject(void 0),liveTime$:new u.ValueSubject(void 0),liveBufferTime$:new u.ValueSubject(void 0),liveLatency$:new u.ValueSubject(void 0),currentFormat$:new u.ValueSubject(void 0),availableTextTracks$:new u.ValueSubject([]),currentTextTrack$:new u.ValueSubject(void 0),throughputEstimation$:new u.ValueSubject(void 0),rttEstimation$:new u.ValueSubject(void 0),videoBitrate$:new u.ValueSubject(void 0),hostname$:new u.ValueSubject(void 0),httpConnectionType$:new u.ValueSubject(void 0),httpConnectionReused$:new u.ValueSubject(void 0),surface$:new u.ValueSubject("none"),chromecastState$:new u.ValueSubject("NOT_AVAILABLE"),chromecastDeviceName$:new u.ValueSubject(void 0),intrinsicVideoSize$:new u.ValueSubject(void 0),availableSources$:new u.ValueSubject(void 0),is3DVideo$:new u.ValueSubject(!1),currentVideoSegmentLength$:new u.ValueSubject(0),currentAudioSegmentLength$:new u.ValueSubject(0)},this.events={inited$:new u.Subject,ready$:new u.Subject,started$:new u.Subject,playing$:new u.Subject,paused$:new u.Subject,stopped$:new u.Subject,willStart$:new u.Subject,willResume$:new u.Subject,willPause$:new u.Subject,willStop$:new u.Subject,willDestruct$:new u.Subject,watchCoverageRecord$:new u.Subject,watchCoverageLive$:new u.Subject,managedError$:new u.Subject,fatalError$:new u.Subject,fetcherRecoverableError$:new u.Subject,ended$:new u.Subject,looped$:new u.Subject,seeked$:new u.Subject,willSeek$:new u.Subject,autoplaySoundProhibited$:new u.Subject,firstBytes$:new u.Subject,loadedMetadata$:new u.Subject,firstFrame$:new u.Subject,canplay$:new u.Subject,log$:new u.Subject,fetcherError$:new u.Subject,severeStallOccured$:new u.Subject},this.experimental={element$:new u.ValueSubject(void 0),tuningConfigName$:new u.ValueSubject([]),enableDebugTelemetry$:new u.ValueSubject(!1),dumpTelemetry:Gr,getCurrentTime$:new u.ValueSubject(null)},this.initLogs(),this.tuning=(i=e,{...(0,u.fillWithDefault)(i,fl),configName:[...i.configName??[],...fl.configName]}),this.tracer=t,this.experimental.tuningConfigName$.next(this.tuning.configName),this.chromecastInitializer=new Ji({receiverApplicationId:e.chromecastReceiverId,isDisabled:e.disableChromecast,dependencies:{logger:this.logger}}),this.throughputEstimator=new pl(this.tuning.throughputEstimator),e.exposeInternalsToGlobal&&(this.internalsExposure=new u.InternalsExposure("CORE"),this.internalsExposure.expose({player:this})),this.initChromecastSubscription(),this.initDesiredStateSubscriptions(),Proxy&&Reflect)return new Proxy(this,{get:(e,t,i)=>{let r=Reflect.get(e,t,i);return"function"!=typeof r?r:(...i)=>{try{return r.apply(e,i)}catch(e){let r=i.map((e=>JSON.stringify(e,((e,t)=>{let i=typeof t;return(0,Xi.default)(["number","string","boolean"],i)?t:null===t?null:`<${i}>`})))),a=`Player.${String(t)}`,s=`Exception calling ${a} (${r.join(", ")})`;throw this.events.fatalError$.next({id:a,category:u.ErrorCategory.WTF,message:s,thrown:e}),e}}}});var i}},gl=`@vkontakte/videoplayer-core@${Hi}`},819705:(e,t,i)=>{var r;i.d(t,{ErrorCategory:()=>Wi,InterfaceLanguage:()=>or,InternalsExposure:()=>dr,Logger:()=>xt,Observable:()=>wt,Subject:()=>St,Subscription:()=>vt,SubscriptionRemovable:()=>$i,Tracer:()=>_t,VERSION:()=>mt,ValueSubject:()=>mi,VideoQuality:()=>Qt,abortable:()=>Pt,addScript:()=>At,assertNever:()=>gt,assertNonNullable:()=>kt,assertNotEmptyArray:()=>Et,checkNever:()=>bt,clearVideoElement:()=>ci,cloneDeepWith:()=>li,combine:()=>gi,createURL:()=>pi,debounce:()=>ki,debounceFn:()=>ni,detectEmbed:()=>Wt,devNull:()=>cr,fillWithDefault:()=>si,filter:()=>Li,filterChanged:()=>Ri,flattenObject:()=>di,fromEvent:()=>xi,getExponentialDelay:()=>Mt,getHighestQuality:()=>Jt,getTraceSubscriptionMethod:()=>fi,interval:()=>wi,isHigher:()=>Kt,isHigherOrEqual:()=>Yt,isInvariantQuality:()=>ai,isLower:()=>Zt,isLowerOrEqual:()=>Xt,isNonNullable:()=>Tt,isNullable:()=>Ct,isValidURL:()=>hi,loadVKLangPack:()=>ar,map:()=>Bi,mapTo:()=>Oi,merge:()=>bi,noop:()=>yt,now:()=>Lt,observableFrom:()=>Si,observeElementSize:()=>ui,once:()=>Fi,safeStorage:()=>It,skip:()=>Ui,tap:()=>ji,throttle:()=>Ei,throttleFn:()=>oi,timeout:()=>yi,videoHeightToQuality:()=>ti,videoQualityToHeight:()=>ri,videoSizeToQuality:()=>ii});var a=Object.create,s=Object.defineProperty,n=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,l=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty,d=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),c=(e,t)=>{for(var i in t)s(e,i,{get:t[i],enumerable:!0})},h=(e,t,i)=>(i=null!=e?a(l(e)):{},((e,t,i,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))!u.call(e,a)&&a!==i&&s(e,a,{get:()=>t[a],enumerable:!(r=n(t,a))||r.enumerable});return e})(!t&&e&&e.__esModule?i:s(i,"default",{value:e,enumerable:!0}),e)),p=d(((e,t)=>{var i=function(e){return e&&e.Math===Math&&e};t.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof global&&global)||i("object"==typeof e&&e)||function(){return this}()||Function("return this")()})),f=d(((e,t)=>{t.exports=function(e){try{return!!e()}catch{return!0}}})),m=d(((e,t)=>{var i=f();t.exports=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))})),v=d(((e,t)=>{var i=m(),r=Function.prototype,a=r.apply,s=r.call;t.exports="object"==typeof Reflect&&Reflect.apply||(i?s.bind(a):function(){return s.apply(a,arguments)})})),g=d(((e,t)=>{var i=m(),r=Function.prototype,a=r.call,s=i&&r.bind.bind(a,a);t.exports=i?s:function(e){return function(){return a.apply(e,arguments)}}})),b=d(((e,t)=>{var i=g(),r=i({}.toString),a=i("".slice);t.exports=function(e){return a(r(e),8,-1)}})),y=d(((e,t)=>{var i=b(),r=g();t.exports=function(e){if("Function"===i(e))return r(e)}})),w=d(((e,t)=>{var i="object"==typeof document&&document.all;t.exports=typeof i>"u"&&void 0!==i?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}})),S=d(((e,t)=>{var i=f();t.exports=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))})),x=d(((e,t)=>{var i=m(),r=Function.prototype.call;t.exports=i?r.bind(r):function(){return r.apply(r,arguments)}})),$=d((e=>{var t={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,r=i&&!t.call({1:2},1);e.f=r?function(e){var t=i(this,e);return!!t&&t.enumerable}:t})),_=d(((e,t)=>{t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}})),k=d(((e,t)=>{var i=g(),r=f(),a=b(),s=Object,n=i("".split);t.exports=r((function(){return!s("z").propertyIsEnumerable(0)}))?function(e){return"String"===a(e)?n(e,""):s(e)}:s})),T=d(((e,t)=>{t.exports=function(e){return null==e}})),C=d(((e,t)=>{var i=T(),r=TypeError;t.exports=function(e){if(i(e))throw new r("Can't call method on "+e);return e}})),E=d(((e,t)=>{var i=k(),r=C();t.exports=function(e){return i(r(e))}})),A=d(((e,t)=>{var i=w();t.exports=function(e){return"object"==typeof e?null!==e:i(e)}})),L=d(((e,t)=>{t.exports={}})),P=d(((e,t)=>{var i=L(),r=p(),a=w(),s=function(e){return a(e)?e:void 0};t.exports=function(e,t){return arguments.length<2?s(i[e])||s(r[e]):i[e]&&i[e][t]||r[e]&&r[e][t]}})),M=d(((e,t)=>{var i=g();t.exports=i({}.isPrototypeOf)})),I=d(((e,t)=>{var i=p().navigator,r=i&&i.userAgent;t.exports=r?String(r):""})),R=d(((e,t)=>{var i,r,a=p(),s=I(),n=a.process,o=a.Deno,l=n&&n.versions||o&&o.version,u=l&&l.v8;u&&(r=(i=u.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!r&&s&&((!(i=s.match(/Edge\/(\d+)/))||i[1]>=74)&&((i=s.match(/Chrome\/(\d+)/))&&(r=+i[1]))),t.exports=r})),V=d(((e,t)=>{var i=R(),r=f(),a=p().String;t.exports=!!Object.getOwnPropertySymbols&&!r((function(){var e=Symbol("symbol detection");return!a(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41}))})),N=d(((e,t)=>{var i=V();t.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator})),B=d(((e,t)=>{var i=P(),r=w(),a=M(),s=N(),n=Object;t.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return r(t)&&a(t.prototype,n(e))}})),D=d(((e,t)=>{var i=String;t.exports=function(e){try{return i(e)}catch{return"Object"}}})),O=d(((e,t)=>{var i=w(),r=D(),a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not a function")}})),F=d(((e,t)=>{var i=O(),r=T();t.exports=function(e,t){var a=e[t];return r(a)?void 0:i(a)}})),j=d(((e,t)=>{var i=x(),r=w(),a=A(),s=TypeError;t.exports=function(e,t){var n,o;if("string"===t&&r(n=e.toString)&&!a(o=i(n,e))||r(n=e.valueOf)&&!a(o=i(n,e))||"string"!==t&&r(n=e.toString)&&!a(o=i(n,e)))return o;throw new s("Can't convert object to primitive value")}})),z=d(((e,t)=>{t.exports=!0})),U=d(((e,t)=>{var i=p(),r=Object.defineProperty;t.exports=function(e,t){try{r(i,e,{value:t,configurable:!0,writable:!0})}catch{i[e]=t}return t}})),q=d(((e,t)=>{var i=z(),r=p(),a=U(),s="__core-js_shared__",n=t.exports=r[s]||a(s,{});(n.versions||(n.versions=[])).push({version:"3.38.0",mode:i?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),H=d(((e,t)=>{var i=q();t.exports=function(e,t){return i[e]||(i[e]=t||{})}})),W=d(((e,t)=>{var i=C(),r=Object;t.exports=function(e){return r(i(e))}})),Q=d(((e,t)=>{var i=g(),r=W(),a=i({}.hasOwnProperty);t.exports=Object.hasOwn||function(e,t){return a(r(e),t)}})),G=d(((e,t)=>{var i=g(),r=0,a=Math.random(),s=i(1..toString);t.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++r+a,36)}})),K=d(((e,t)=>{var i=p(),r=H(),a=Q(),s=G(),n=V(),o=N(),l=i.Symbol,u=r("wks"),d=o?l.for||l:l&&l.withoutSetter||s;t.exports=function(e){return a(u,e)||(u[e]=n&&a(l,e)?l[e]:d("Symbol."+e)),u[e]}})),Y=d(((e,t)=>{var i=x(),r=A(),a=B(),s=F(),n=j(),o=K(),l=TypeError,u=o("toPrimitive");t.exports=function(e,t){if(!r(e)||a(e))return e;var o,d=s(e,u);if(d){if(void 0===t&&(t="default"),o=i(d,e,t),!r(o)||a(o))return o;throw new l("Can't convert object to primitive value")}return void 0===t&&(t="number"),n(e,t)}})),Z=d(((e,t)=>{var i=Y(),r=B();t.exports=function(e){var t=i(e,"string");return r(t)?t:t+""}})),X=d(((e,t)=>{var i=p(),r=A(),a=i.document,s=r(a)&&r(a.createElement);t.exports=function(e){return s?a.createElement(e):{}}})),J=d(((e,t)=>{var i=S(),r=f(),a=X();t.exports=!i&&!r((function(){return 7!==Object.defineProperty(a("div"),"a",{get:function(){return 7}}).a}))})),ee=d((e=>{var t=S(),i=x(),r=$(),a=_(),s=E(),n=Z(),o=Q(),l=J(),u=Object.getOwnPropertyDescriptor;e.f=t?u:function(e,t){if(e=s(e),t=n(t),l)try{return u(e,t)}catch{}if(o(e,t))return a(!i(r.f,e,t),e[t])}})),te=d(((e,t)=>{var i=f(),r=w(),a=/#|\.prototype\./,s=function(e,t){var a=o[n(e)];return a===u||a!==l&&(r(t)?i(t):!!t)},n=s.normalize=function(e){return String(e).replace(a,".").toLowerCase()},o=s.data={},l=s.NATIVE="N",u=s.POLYFILL="P";t.exports=s})),ie=d(((e,t)=>{var i=y(),r=O(),a=m(),s=i(i.bind);t.exports=function(e,t){return r(e),void 0===t?e:a?s(e,t):function(){return e.apply(t,arguments)}}})),re=d(((e,t)=>{var i=S(),r=f();t.exports=i&&r((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))})),ae=d(((e,t)=>{var i=A(),r=String,a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not an object")}})),se=d((e=>{var t=S(),i=J(),r=re(),a=ae(),s=Z(),n=TypeError,o=Object.defineProperty,l=Object.getOwnPropertyDescriptor,u="enumerable",d="configurable",c="writable";e.f=t?r?function(e,t,i){if(a(e),t=s(t),a(i),"function"==typeof e&&"prototype"===t&&"value"in i&&c in i&&!i[c]){var r=l(e,t);r&&r[c]&&(e[t]=i.value,i={configurable:d in i?i[d]:r[d],enumerable:u in i?i[u]:r[u],writable:!1})}return o(e,t,i)}:o:function(e,t,r){if(a(e),t=s(t),a(r),i)try{return o(e,t,r)}catch{}if("get"in r||"set"in r)throw new n("Accessors not supported");return"value"in r&&(e[t]=r.value),e}})),ne=d(((e,t)=>{var i=S(),r=se(),a=_();t.exports=i?function(e,t,i){return r.f(e,t,a(1,i))}:function(e,t,i){return e[t]=i,e}})),oe=d(((e,t)=>{var i=p(),r=v(),a=y(),s=w(),n=ee().f,o=te(),l=L(),u=ie(),d=ne(),c=Q();q();var h=function(e){var t=function(i,a,s){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,a)}return new e(i,a,s)}return r(e,this,arguments)};return t.prototype=e.prototype,t};t.exports=function(e,t){var r,p,f,m,v,g,b,y,w,S=e.target,x=e.global,$=e.stat,_=e.proto,k=x?i:$?i[S]:i[S]&&i[S].prototype,T=x?l:l[S]||d(l,S,{})[S],C=T.prototype;for(m in t)p=!(r=o(x?m:S+($?".":"#")+m,e.forced))&&k&&c(k,m),g=T[m],p&&(e.dontCallGetSet?b=(w=n(k,m))&&w.value:b=k[m]),v=p&&b?b:t[m],(r||_||typeof g!=typeof v)&&(y=e.bind&&p?u(v,i):e.wrap&&p?h(v):_&&s(v)?a(v):v,(e.sham||v&&v.sham||g&&g.sham)&&d(y,"sham",!0),d(T,m,y),_&&(c(l,f=S+"Prototype")||d(l,f,{}),d(l[f],m,v),e.real&&C&&(r||!C[m])&&d(C,m,v)))}})),le=d(((e,t)=>{var i=Math.ceil,r=Math.floor;t.exports=Math.trunc||function(e){var t=+e;return(t>0?r:i)(t)}})),ue=d(((e,t)=>{var i=le();t.exports=function(e){var t=+e;return t!=t||0===t?0:i(t)}})),de=d(((e,t)=>{var i=ue(),r=Math.min;t.exports=function(e){var t=i(e);return t>0?r(t,9007199254740991):0}})),ce=d(((e,t)=>{var i=de();t.exports=function(e){return i(e.length)}})),he=d(((e,t)=>{t.exports=function(){}})),pe=d((()=>{var e=oe(),t=W(),i=ce(),r=ue(),a=he();e({target:"Array",proto:!0},{at:function(e){var a=t(this),s=i(a),n=r(e),o=n>=0?n:s+n;return o<0||o>=s?void 0:a[o]}}),a("at")})),fe=d(((e,t)=>{var i=P();t.exports=i})),me=d(((e,t)=>{pe();var i=fe();t.exports=i("Array","at")})),ve=d(((e,t)=>{var i=me();t.exports=i})),ge=d(((e,t)=>{var i=ve();t.exports=i})),be=d(((e,t)=>{var i=H(),r=G(),a=i("keys");t.exports=function(e){return a[e]||(a[e]=r(e))}})),ye=d(((e,t)=>{var i=f();t.exports=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))})),we=d(((e,t)=>{var i=Q(),r=w(),a=W(),s=be(),n=ye(),o=s("IE_PROTO"),l=Object,u=l.prototype;t.exports=n?l.getPrototypeOf:function(e){var t=a(e);if(i(t,o))return t[o];var s=t.constructor;return r(s)&&t instanceof s?s.prototype:t instanceof l?u:null}})),Se=d(((e,t)=>{var i=ue(),r=Math.max,a=Math.min;t.exports=function(e,t){var s=i(e);return s<0?r(s+t,0):a(s,t)}})),xe=d(((e,t)=>{var i=E(),r=Se(),a=ce(),s=function(e){return function(t,s,n){var o=i(t),l=a(o);if(0===l)return!e&&-1;var u,d=r(n,l);if(e&&s!=s){for(;l>d;)if((u=o[d++])!=u)return!0}else for(;l>d;d++)if((e||d in o)&&o[d]===s)return e||d||0;return!e&&-1}};t.exports={includes:s(!0),indexOf:s(!1)}})),$e=d(((e,t)=>{t.exports={}})),_e=d(((e,t)=>{var i=g(),r=Q(),a=E(),s=xe().indexOf,n=$e(),o=i([].push);t.exports=function(e,t){var i,l=a(e),u=0,d=[];for(i in l)!r(n,i)&&r(l,i)&&o(d,i);for(;t.length>u;)r(l,i=t[u++])&&(~s(d,i)||o(d,i));return d}})),ke=d(((e,t)=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]})),Te=d(((e,t)=>{var i=_e(),r=ke();t.exports=Object.keys||function(e){return i(e,r)}})),Ce=d(((e,t)=>{var i=S(),r=f(),a=g(),s=we(),n=Te(),o=E(),l=a($().f),u=a([].push),d=i&&r((function(){var e=Object.create(null);return e[2]=2,!l(e,2)})),c=function(e){return function(t){for(var r,a=o(t),c=n(a),h=d&&null===s(a),p=c.length,f=0,m=[];p>f;)r=c[f++],(!i||(h?r in a:l(a,r)))&&u(m,e?[r,a[r]]:a[r]);return m}};t.exports={entries:c(!0),values:c(!1)}})),Ee=d((()=>{var e=oe(),t=Ce().entries;e({target:"Object",stat:!0},{entries:function(e){return t(e)}})})),Ae=d(((e,t)=>{Ee();var i=L();t.exports=i.Object.entries})),Le=d(((e,t)=>{var i=Ae();t.exports=i})),Pe=d(((e,t)=>{var i=Le();t.exports=i})),Me=d((()=>{var e=oe(),t=xe().includes,i=f(),r=he();e({target:"Array",proto:!0,forced:i((function(){return!Array(1).includes()}))},{includes:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),r("includes")})),Ie=d(((e,t)=>{Me();var i=fe();t.exports=i("Array","includes")})),Re=d(((e,t)=>{var i=Ie();t.exports=i})),Ve=d(((e,t)=>{var i=Re();t.exports=i})),Ne=d(((e,t)=>{t.exports={}})),Be=d(((e,t)=>{var i=p(),r=w(),a=i.WeakMap;t.exports=r(a)&&/native code/.test(String(a))})),De=d(((e,t)=>{var i,r,a,s,n,o=Be(),l=p(),u=A(),d=ne(),c=Q(),h=q(),f=be(),m=$e(),v="Object already initialized",g=l.TypeError,b=l.WeakMap;o||h.state?((s=h.state||(h.state=new b)).get=s.get,s.has=s.has,s.set=s.set,i=function(e,t){if(s.has(e))throw new g(v);return t.facade=e,s.set(e,t),t},r=function(e){return s.get(e)||{}},a=function(e){return s.has(e)}):(m[n=f("state")]=!0,i=function(e,t){if(c(e,n))throw new g(v);return t.facade=e,d(e,n,t),t},r=function(e){return c(e,n)?e[n]:{}},a=function(e){return c(e,n)}),t.exports={set:i,get:r,has:a,enforce:function(e){return a(e)?r(e):i(e,{})},getterFor:function(e){return function(t){var i;if(!u(t)||(i=r(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return i}}}})),Oe=d(((e,t)=>{var i=S(),r=Q(),a=Function.prototype,s=i&&Object.getOwnPropertyDescriptor,n=r(a,"name"),o=n&&"something"===function(){}.name,l=n&&(!i||i&&s(a,"name").configurable);t.exports={EXISTS:n,PROPER:o,CONFIGURABLE:l}})),Fe=d((e=>{var t=S(),i=re(),r=se(),a=ae(),s=E(),n=Te();e.f=t&&!i?Object.defineProperties:function(e,t){a(e);for(var i,o=s(t),l=n(t),u=l.length,d=0;u>d;)r.f(e,i=l[d++],o[i]);return e}})),je=d(((e,t)=>{var i=P();t.exports=i("document","documentElement")})),ze=d(((e,t)=>{var i,r=ae(),a=Fe(),s=ke(),n=$e(),o=je(),l=X(),u=be(),d="prototype",c="script",h=u("IE_PROTO"),p=function(){},f=function(e){return"<"+c+">"+e+"</"+c+">"},m=function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t},v=function(){try{i=new ActiveXObject("htmlfile")}catch{}v=typeof document<"u"?document.domain&&i?m(i):function(){var e,t=l("iframe"),i="java"+c+":";return t.style.display="none",o.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(f("document.F=Object")),e.close(),e.F}():m(i);for(var e=s.length;e--;)delete v[d][s[e]];return v()};n[h]=!0,t.exports=Object.create||function(e,t){var i;return null!==e?(p[d]=r(e),i=new p,p[d]=null,i[h]=e):i=v(),void 0===t?i:a.f(i,t)}})),Ue=d(((e,t)=>{var i=ne();t.exports=function(e,t,r,a){return a&&a.enumerable?e[t]=r:i(e,t,r),e}})),qe=d(((e,t)=>{var i,r,a,s=f(),n=w(),o=A(),l=ze(),u=we(),d=Ue(),c=K(),h=z(),p=c("iterator"),m=!1;[].keys&&("next"in(a=[].keys())?(r=u(u(a)))!==Object.prototype&&(i=r):m=!0),!o(i)||s((function(){var e={};return i[p].call(e)!==e}))?i={}:h&&(i=l(i)),n(i[p])||d(i,p,(function(){return this})),t.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:m}})),He=d(((e,t)=>{var i={};i[K()("toStringTag")]="z",t.exports="[object z]"===String(i)})),We=d(((e,t)=>{var i=He(),r=w(),a=b(),s=K()("toStringTag"),n=Object,o="Arguments"===a(function(){return arguments}());t.exports=i?a:function(e){var t,i,l;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch{}}(t=n(e),s))?i:o?a(t):"Object"===(l=a(t))&&r(t.callee)?"Arguments":l}})),Qe=d(((e,t)=>{var i=He(),r=We();t.exports=i?{}.toString:function(){return"[object "+r(this)+"]"}})),Ge=d(((e,t)=>{var i=He(),r=se().f,a=ne(),s=Q(),n=Qe(),o=K()("toStringTag");t.exports=function(e,t,l,u){var d=l?e:e&&e.prototype;d&&(s(d,o)||r(d,o,{configurable:!0,value:t}),u&&!i&&a(d,"toString",n))}})),Ke=d(((e,t)=>{var i=qe().IteratorPrototype,r=ze(),a=_(),s=Ge(),n=Ne(),o=function(){return this};t.exports=function(e,t,l,u){var d=t+" Iterator";return e.prototype=r(i,{next:a(+!u,l)}),s(e,d,!1,!0),n[d]=o,e}})),Ye=d(((e,t)=>{var i=g(),r=O();t.exports=function(e,t,a){try{return i(r(Object.getOwnPropertyDescriptor(e,t)[a]))}catch{}}})),Ze=d(((e,t)=>{var i=A();t.exports=function(e){return i(e)||null===e}})),Xe=d(((e,t)=>{var i=Ze(),r=String,a=TypeError;t.exports=function(e){if(i(e))return e;throw new a("Can't set "+r(e)+" as a prototype")}})),Je=d(((e,t)=>{var i=Ye(),r=A(),a=C(),s=Xe();t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=i(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(i,n){return a(i),s(n),r(i)&&(t?e(i,n):i.__proto__=n),i}}():void 0)})),et=d(((e,t)=>{var i=oe(),r=x(),a=z(),s=Oe(),n=w(),o=Ke(),l=we(),u=Je(),d=Ge(),c=ne(),h=Ue(),p=K(),f=Ne(),m=qe(),v=s.PROPER,g=s.CONFIGURABLE,b=m.IteratorPrototype,y=m.BUGGY_SAFARI_ITERATORS,S=p("iterator"),$="keys",_="values",k="entries",T=function(){return this};t.exports=function(e,t,s,p,m,w,x){o(s,t,p);var C,E,A,L=function(e){if(e===m&&V)return V;if(!y&&e&&e in I)return I[e];switch(e){case $:case _:case k:return function(){return new s(this,e)}}return function(){return new s(this)}},P=t+" Iterator",M=!1,I=e.prototype,R=I[S]||I["@@iterator"]||m&&I[m],V=!y&&R||L(m),N="Array"===t&&I.entries||R;if(N&&((C=l(N.call(new e)))!==Object.prototype&&C.next&&(!a&&l(C)!==b&&(u?u(C,b):n(C[S])||h(C,S,T)),d(C,P,!0,!0),a&&(f[P]=T))),v&&m===_&&R&&R.name!==_&&(!a&&g?c(I,"name",_):(M=!0,V=function(){return r(R,this)})),m)if(E={values:L(_),keys:w?V:L($),entries:L(k)},x)for(A in E)(y||M||!(A in I))&&h(I,A,E[A]);else i({target:t,proto:!0,forced:y||M},E);return(!a||x)&&I[S]!==V&&h(I,S,V,{name:m}),f[t]=V,E}})),tt=d(((e,t)=>{t.exports=function(e,t){return{value:e,done:t}}})),it=d(((e,t)=>{var i=E(),r=he(),a=Ne(),s=De(),n=se().f,o=et(),l=tt(),u=z(),d=S(),c="Array Iterator",h=s.set,p=s.getterFor(c);t.exports=o(Array,"Array",(function(e,t){h(this,{type:c,target:i(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=void 0,l(void 0,!0);switch(e.kind){case"keys":return l(i,!1);case"values":return l(t[i],!1)}return l([i,t[i]],!1)}),"values");var f=a.Arguments=a.Array;if(r("keys"),r("values"),r("entries"),!u&&d&&"values"!==f.name)try{n(f,"name",{value:"values"})}catch{}})),rt=d(((e,t)=>{var i=K(),r=Ne(),a=i("iterator"),s=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||s[a]===e)}})),at=d(((e,t)=>{var i=We(),r=F(),a=T(),s=Ne(),n=K()("iterator");t.exports=function(e){if(!a(e))return r(e,n)||r(e,"@@iterator")||s[i(e)]}})),st=d(((e,t)=>{var i=x(),r=O(),a=ae(),s=D(),n=at(),o=TypeError;t.exports=function(e,t){var l=arguments.length<2?n(e):t;if(r(l))return a(i(l,e));throw new o(s(e)+" is not iterable")}})),nt=d(((e,t)=>{var i=x(),r=ae(),a=F();t.exports=function(e,t,s){var n,o;r(e);try{if(!(n=a(e,"return"))){if("throw"===t)throw s;return s}n=i(n,e)}catch(e){o=!0,n=e}if("throw"===t)throw s;if(o)throw n;return r(n),s}})),ot=d(((e,t)=>{var i=ie(),r=x(),a=ae(),s=D(),n=rt(),o=ce(),l=M(),u=st(),d=at(),c=nt(),h=TypeError,p=function(e,t){this.stopped=e,this.result=t},f=p.prototype;t.exports=function(e,t,m){var v,g,b,y,w,S,x,$=m&&m.that,_=!(!m||!m.AS_ENTRIES),k=!(!m||!m.IS_RECORD),T=!(!m||!m.IS_ITERATOR),C=!(!m||!m.INTERRUPTED),E=i(t,$),A=function(e){return v&&c(v,"normal",e),new p(!0,e)},L=function(e){return _?(a(e),C?E(e[0],e[1],A):E(e[0],e[1])):C?E(e,A):E(e)};if(k)v=e.iterator;else if(T)v=e;else{if(!(g=d(e)))throw new h(s(e)+" is not iterable");if(n(g)){for(b=0,y=o(e);y>b;b++)if((w=L(e[b]))&&l(f,w))return w;return new p(!1)}v=u(e,g)}for(S=k?e.next:v.next;!(x=r(S,v)).done;){try{w=L(x.value)}catch(e){c(v,"throw",e)}if("object"==typeof w&&w&&l(f,w))return w}return new p(!1)}})),lt=d(((e,t)=>{var i=S(),r=se(),a=_();t.exports=function(e,t,s){i?r.f(e,t,a(0,s)):e[t]=s}})),ut=d((()=>{var e=oe(),t=ot(),i=lt();e({target:"Object",stat:!0},{fromEntries:function(e){var r={};return t(e,(function(e,t){i(r,e,t)}),{AS_ENTRIES:!0}),r}})})),dt=d(((e,t)=>{it(),ut();var i=L();t.exports=i.Object.fromEntries})),ct=d(((e,t)=>{t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}})),ht=d((()=>{it();var e,t=ct(),i=p(),r=Ge(),a=Ne();for(e in t)r(i[e],e),a[e]=a.Array})),pt=d(((e,t)=>{var i=dt();ht(),t.exports=i})),ft=d(((e,t)=>{var i=pt();t.exports=i})),mt="1.0.60",vt=class{unsubscribe(){let e=this.subscriptions;this.subscriptions=[],e.forEach((e=>{"function"==typeof e?e():e.unsubscribe()}))}add(e){return this.subscriptions.push(e),this}constructor(){this.subscriptions=[]}},gt=e=>{throw new Error(`${e} is value of unexpected type`)},bt=e=>{},yt=()=>{},wt=class{subscribe(e,t){let i;i=t?"function"==typeof t?{next:t,error:yt}:{next:e=>t.next(e),error:e=>t.error?.(e)}:{next:yt,error:yt};let r,a="function"==typeof e?{next:t=>{try{let r=e(t);r instanceof Promise&&r.catch((e=>i.next(e)))}catch(e){i.next(e)}},error:e=>i.next(e)}:{next:t=>e.next(t),error:t=>e.error?e.error(t):i.next(t)};try{r=this._subscribe(a)}catch(e){a.error?.(e)}return(new vt).add((()=>{switch(a.next=yt,a.error=yt,typeof r){case"function":return void r();case"object":return void r.unsubscribe();case"undefined":return;default:return gt(r)}}))}pipe(...e){return e.reduce(((e,t)=>t(e)),this)}_subscribe(e){}constructor(e){e&&(this._subscribe=e)}},St=class extends wt{next(e){this.subscribers.forEach((t=>t.next(e)))}error(e){this.subscribers.forEach((t=>t.error?.(e)))}_subscribe(e){let t=this.keyCounter++;return this.subscribers.set(t,e),(new vt).add((()=>this.subscribers.delete(t)))}constructor(){super(),this.keyCounter=0,this.subscribers=new Map}},xt=class{createCustomLog(e){return(...t)=>{let i;try{i=e(...t)}catch{i={message:"error in `createCustomLog`",component:"Logger"}}this.log(i)}}createComponentLog(e){return this.createCustomLog((t=>({component:e,...t})))}constructor(){this.log$=new St,this.logs=[],this.log=e=>{let t={...e,timestamp:Date.now()};this.logs.push(t),this.log$.next(t)},this.getAllLogs=()=>this.logs}},$t=class e{log(e,t){}error(e,t){}critical(e,t){}createComponentTracer(t){return new e({name:t})}end(){}getFinishedSpans(){}getTraceId(){return this.fakeTraceId}constructor({name:e}){}},_t=(r=class e{init({name:t,parentContext:i,tracer:r}){let a=!r;if(a){let t=e.dynamicImports.tracer.initTracerOpenTelemetry({serviceName:"videoplayer-sdk-web",appToken:"L9SBoka6ZWk4xPjaK7tmfSfYvMhcge7nvGDjpdMmscb",spanLimits:{attributeCountLimit:1/0,eventCountLimit:1/0,attributePerEventCountLimit:1/0}}).getProvider(),i=new e.dynamicImports.tracer.TracerMemorySpanExporter,r=new e.dynamicImports.tracer.TracerMemorySpanExporter;this.spanExporter=i,t.addSpanProcessor(new e.dynamicImports.tracer.TracerAllSpansProcessor({startedSpansExporter:i,endedSpansExporter:r})),this.tracer=t.getTracer("sdk-videoplayer-tracer")}else this.tracer=r;this.span=this.tracer.startSpan(t,{root:a},i),this.context=e.dynamicImports.opentelemetryApi.trace.setSpan(e.dynamicImports.opentelemetryApi.context.active(),this.span),e.dynamicImportStatus="initialized"}async loadOpentelemetry(){if("not_started"===e.dynamicImportStatus){e.dynamicImportStatus="in_progress";try{let t=new Promise(((e,t)=>setTimeout(t,this.dynamicImportTimeout))),r=Promise.all([Promise.all([i.e(65852),i.e(90874),i.e("langs/web/65852+90874")]).then(i.bind(i,590874)),Promise.all([i.e(65852),i.e(25817),i.e("langs/web/65852+25817")]).then(i.bind(i,625817)),Promise.all([i.e(58240),i.e("langs/web/58240")]).then(i.bind(i,758240))]),[a,s,n]=await Promise.race([r,t]);e.dynamicImports={opentelemetryApi:a,opentelemetrySdk:s,tracer:n},e.dynamicImportStatus="completed"}catch{e.dynamicImportStatus="failed"}}}log(t,i){"initialized"===e.dynamicImportStatus&&this.span.addEvent(t,{...i,type:"log"})}error(t,i){"initialized"===e.dynamicImportStatus&&this.span.addEvent(t,{...i,type:"error"})}critical(t,i){"initialized"===e.dynamicImportStatus&&this.span.addEvent(t,{...i,type:"critical"})}static createRootTracer(t=!1){return t?new e({name:"Root"}):new $t({name:"Root"})}createComponentTracer(t){let i=new e({name:t,parentContext:this.context,tracer:this.tracer});return this.childTracers.push(i),i}end(){"initialized"===e.dynamicImportStatus&&(this.childTracers.forEach((e=>e.end())),this.span.end())}getFinishedSpans(){if("initialized"===e.dynamicImportStatus)return this.spanExporter?.getJsonData()}getTraceId(){return"initialized"!==e.dynamicImportStatus?"":this.span.spanContext().traceId}constructor({name:t,parentContext:i,tracer:r}){if(this.dynamicImportTimeout=5e3,this.childTracers=[],"failed"===e.dynamicImportStatus)return this;"not_started"===e.dynamicImportStatus&&(e.dynamicImportPromise=this.loadOpentelemetry()),e.dynamicImportPromise.then((()=>this.init({name:t,parentContext:i,tracer:r})))}},r.dynamicImportStatus="not_started",r);function kt(e,t='Assertion "value is not nullable" failed'){if(null==e)throw new Error(t)}function Tt(e){return typeof e<"u"&&null!==e}function Ct(e){return null==e}function Et(e,t){if(!e?.length)throw new Error(t)}var At=(e,t,i)=>new Promise(((r,a)=>{t.addEventListener("abort",(()=>{l(),u.remove()}));let s,n=()=>{l(),a("error")},o=()=>{l(),r()},l=()=>{s&&clearTimeout(s),u.removeEventListener("load",o),u.removeEventListener("error",n)};i&&(s=window.setTimeout((()=>{l(),a("timeout")}),i));let u=document.createElement("script");u.addEventListener("load",o),u.addEventListener("error",n),u.src=e,document.head.appendChild(u)})),Lt="function"==typeof window.performance?.now?()=>window.performance.now():()=>Date.now(),Pt=(e,t)=>async(...i)=>{let r,a=t(...i),s=e.aborted;for(;!s&&!e.aborted;)try{let e=await a.next(r);s=e.done??!1,r=e.value}catch(e){await a.throw(e)}return r},Mt=(e,{start:t=0,factor:i=2,max:r=1/0,min:a=t,random:s=0}={})=>{let n=t;return n*=i**e,n*=Math.random()*s*2-s+1,n=Math.round(n),n=Math.min(n,r),n=Math.max(n,a),n},It={};c(It,{clear:()=>qt,get:()=>Ft,has:()=>zt,isPersistent:()=>Ot,remove:()=>Ut,set:()=>jt});var Rt,Vt,Nt,Bt=`vk-videoplayer-dummy-key-${Math.random()}`,Dt=()=>{if(void 0!==Vt)return Vt;try{localStorage.setItem(Bt,"test"),localStorage.removeItem(Bt),Vt=0}catch(e){if(!(e instanceof DOMException||e instanceof TypeError))throw e;try{sessionStorage.getItem(Bt),Vt=1}catch(e){if(!(e instanceof DOMException||e instanceof TypeError))throw e;Vt=2}}return 2===Vt&&(Rt=new Map),Vt},Ot=()=>0===Dt(),Ft=e=>{let t=Dt();switch(t){case 0:return localStorage.getItem(e)??void 0;case 1:return sessionStorage.getItem(e)??void 0;case 2:return Rt?.get(e);default:gt(t)}},jt=(e,t)=>{let i=Dt();switch(i){case 0:try{localStorage.setItem(e,t)}catch(e){if(!(e instanceof DOMException))throw e;console.error(e)}break;case 1:try{sessionStorage.setItem(e,t)}catch(e){if(!(e instanceof DOMException))throw e;console.error(e)}break;case 2:return void Rt?.set(e,t);default:gt(i)}},zt=e=>{let t=Dt();switch(t){case 0:return e in localStorage;case 1:return e in sessionStorage;case 2:return Rt?.has(e)??!1;default:return gt(t),!1}},Ut=e=>{let t=Dt();switch(t){case 0:return localStorage.removeItem(e);case 1:return sessionStorage.removeItem(e);case 2:return void Rt?.delete(e);default:gt(t)}},qt=()=>{let e=Dt();switch(e){case 0:return localStorage.clear();case 1:return sessionStorage.clear();case 2:return Rt?.clear();default:gt(e)}},Ht=h(ge(),1),Wt=()=>{let e,t=[];try{e=window.self!==window.top}catch(t){t instanceof DOMException&&"SecurityError"===t.name?e=!0:(e=!1,console.error(t))}try{window.location.ancestorOrigins&&(t=[...window.location.ancestorOrigins])}catch(e){console.error(e)}try{!t.length&&document.referrer&&(t=[new URL(document.referrer).origin])}catch(e){console.error(e)}return{isEmbed:e,origins:t,topOrigin:(0,Ht.default)(t,-1),immediateOrigin:(0,Ht.default)(t,0)}},Qt=((Nt=Qt||{}).INVARIANT="Invariant quality",Nt.Q_144P="144p",Nt.Q_240P="240p",Nt.Q_360P="360p",Nt.Q_480P="480p",Nt.Q_576P="576p",Nt.Q_720P="720p",Nt.Q_1080P="1080p",Nt.Q_1440P="1440p",Nt.Q_2160P="2160p",Nt.Q_4320P="4320p",Nt),Gt={"144p":{width:256,height:144},"240p":{width:428,height:240},"360p":{width:640,height:360},"480p":{width:856,height:480},"576p":{width:1024,height:576},"720p":{width:1280,height:720},"1080p":{width:1920,height:1080},"1440p":{width:2560,height:1440},"2160p":{width:3840,height:2160},"4320p":{width:7680,height:4320}},Kt=(e,t)=>Gt[e].height>Gt[t].height,Yt=(e,t)=>Gt[e].height>=Gt[t].height,Zt=(e,t)=>Gt[e].height<Gt[t].height,Xt=(e,t)=>Gt[e].height<=Gt[t].height,Jt=e=>e.sort(((e,t)=>e===t?0:"Invariant quality"===e?1:"Invariant quality"===t?-1:Zt(e,t)?1:-1))[0],ei=Object.keys(Gt).sort(((e,t)=>Zt(e,t)?-1:1)),ti=(e,t=.02)=>[...ei].find((i=>Gt[i].height*(1+t)>=e)),ii=({width:e,height:t})=>{let i=Math.min(e,t),r=Math.max(e,t);return ei.find((e=>{let t=Gt[e];return t.width>=r&&t.height>=i}))},ri=e=>Gt[e].height,ai=e=>"Invariant quality"===e;var si=(e,t)=>{let i={};for(let r of Object.keys(t)){let a=t[r],s=e[r];Array.isArray(a)&&Array.isArray(s)?i[r]=s:i[r]="object"==typeof a&&"object"==typeof s?si(s,a):r in e?s:a}return i};function ni(e,t=0,i){let r,a,s,n,o,l,u=0,d=!1,c=!1,h=!0,p=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;function f(t){let i=r,s=a;return r=a=void 0,u=t,n=e.apply(s,i),n}function m(e,t){return p?(o&&window.cancelAnimationFrame(o),window.requestAnimationFrame(e)):setTimeout(e,t)}function v(e){let i=e-l;return void 0===l||i>=t||i<0||c&&e-u>=s}function g(){let e=Date.now();if(v(e))return b(e);o=m(g,function(e){let i=e-u,r=t-(e-l);return c?Math.min(r,s-i):r}(e))}function b(e){return o=void 0,h&&r?f(e):(r=a=void 0,n)}function y(...e){let i=Date.now(),s=v(i);if(r=e,a=this,l=i,s){if(void 0===o)return function(e){return u=e,o=m(g,t),d?f(e):n}(l);if(c)return o=m(g,t),f(l)}return void 0===o&&(o=m(g,t)),n}return i&&(d=!!i.leading,c="maxWait"in i,s=i?.maxWait?Math.max(+i?.maxWait||0,t):s,h="trailing"in i?!!i.trailing:h),y.cancel=function(){var e;void 0!==o&&(e=o,p?window.cancelAnimationFrame(e):clearTimeout(e)),u=0,r=l=a=o=void 0},y.flush=function(){return void 0===o?n:b(Date.now())},y.pending=function(){return void 0!==o},y}var oi=(e,t=0,i)=>ni(e,t,{leading:!0,trailing:!0,...i,maxWait:t}),li=(e,t)=>{if(null===e||"object"!=typeof e)return e;let i=Array.isArray(e)?[]:{};for(let r in e){if("function"==typeof t){let a=t(e[r],r,e,i);if(void 0!==a){i[r]=a;continue}}"object"==typeof e[r]?i[r]=li(e[r],t):i[r]=e[r]}return i},ui=(e,t=300)=>new wt((i=>{let{width:r,height:a}=e.getBoundingClientRect();if(i.next({width:r,height:a}),!window.ResizeObserver)return;let s=new ResizeObserver(oi((e=>{let t,r,a=e[0];a&&(a.contentBoxSize&&a.contentBoxSize[0]?(r=a.contentBoxSize[0].blockSize,t=a.contentBoxSize[0].inlineSize):a.contentRect&&(t=a.contentRect.width,r=a.contentRect.height),Tt(t)&&Tt(r)&&i.next({width:t,height:r}))}),t));return s.observe(e),()=>s.disconnect()})),di=(e,t=6,i=".")=>{let r={};for(let a in e)if(e.hasOwnProperty(a)&&!(e[a]instanceof HTMLElement)&&t)if("object"==typeof e[a]&&null!==e[a]){let s=di(e[a],t-1);for(let e in s)s.hasOwnProperty(e)&&(r[a+i+e]=s[e])}else r[a]=e[a];return r},ci=e=>{e.removeAttribute("src"),e.load()},hi=e=>{let t;try{t=new URL(e)}catch{return!1}return"https:"===t.protocol},pi=e=>{try{return new URL(e)}catch{return null}},fi=e=>t=>i=>{let r="object"==typeof i;null==i||r&&!Object.keys(i).length||e(t,r?di(i):{value:i})},mi=class extends St{next(e){super.next(this.value=e)}error(e){super.error(this.value=e)}getValue(){return this.value}_subscribe(e){let t=super._subscribe(e);return e.next(this.value),t}constructor(e){super(),this.value=e}},vi=h(Pe(),1);function gi(e){return new wt((t=>{let i={},r=Object.keys(e).length;return(0,vi.default)(e).reduce(((e,[a,s])=>e.add(s.subscribe((e=>a=>{e in i||r--,i[e]=a,0===r&&t.next(i)})(a)))),new vt)}))}function bi(...e){return new wt((t=>e.reduce(((e,i)=>e.add(i.subscribe(t))),new vt)))}var yi=e=>new wt((t=>{let i=window.setTimeout((()=>{try{t.next()}catch(e){if(!t.error)throw e;t.error(e)}}),e);return()=>window.clearTimeout(i)})),wi=e=>new wt((t=>{let i=window.setInterval((()=>t.next()),e);return()=>{i&&(window.clearInterval(i),i=void 0)}})),Si=e=>new wt((t=>{e.forEach((e=>t.next(e)))})),xi=(e,t)=>new wt((i=>{let r=e=>i.next(e);return e.addEventListener(t,r),()=>e.removeEventListener(t,r)})),$i=class extends vt{remove(e){this.subscriptions=this.subscriptions.filter((t=>t!==e))}};var _i={leading:!1,trailing:!0};function ki(e,t=_i){return i=>new wt((r=>i.subscribe(new Ti(r,e,t))))}var Ti=class{next(e){this.lastValue=e,Tt(this.timeout)?window.clearTimeout(this.timeout):this.config.leading&&this.destination.next(e),this.timeout=window.setTimeout((()=>{if(this.config.trailing)try{this.destination.next(this.lastValue)}catch(e){if(!this.destination.error)throw e;this.destination.error(e)}this.timeout=void 0}),this.time)}error(e){this.destination.error?.(e)}constructor(e,t,i){this.destination=e,this.time=t,this.config=i}},Ci={leading:!0,trailing:!1};function Ei(e,t=Ci){return i=>new wt((r=>i.subscribe(new Ai(r,e,t))))}var Ai=class{next(e){this.lastValue=e,Ct(this.timeout)&&(this.config.leading&&this.destination.next(e),this.timeout=window.setTimeout((()=>{this.config.trailing&&this.destination.next(this.lastValue),this.timeout=void 0}),this.time))}error(e){this.destination.error?.(e)}constructor(e,t,i){this.destination=e,this.time=t,this.config=i}};function Li(e){return t=>new wt((i=>t.subscribe(new Pi(i,e))))}var Pi=class{next(e){let t;try{t=this.predicate(e)}catch(e){throw this.error(e),e}t&&this.destination.next(e)}error(e){this.destination.error?.(e)}constructor(e,t){this.destination=e,this.predicate=t}},Mi=h(Ve(),1),Ii=(e,t)=>e instanceof Object&&t instanceof Object?((e,t)=>{let i=(e,t)=>{let i=Object.keys(e);for(let r in t)if(!(0,Mi.default)(i,r)||t[r]!==e[r])return!1;return!0};return i(e,t)&&i(t,e)})(e,t):e===t;function Ri(e=Ii){return t=>new wt((i=>t.subscribe(new Ni(i,e))))}var Vi={},Ni=class{next(e){let t;try{t=this.lastValue===Vi||!this.predicate(this.lastValue,e),this.lastValue=e instanceof Object?{...e}:e}catch(e){throw this.error(e),e}t&&this.destination.next(e)}error(e){this.destination.error?.(e)}constructor(e,t){this.destination=e,this.predicate=t,this.lastValue=Vi}};function Bi(e){return t=>new wt((i=>t.subscribe(new Di(i,e))))}var Di=class{next(e){let t;try{t=this.mapper(e)}catch(e){throw this.error(e),e}this.destination.next(t)}error(e){this.destination.error?.(e)}constructor(e,t){this.destination=e,this.mapper=t}};function Oi(e){return Bi((()=>e))}function Fi(){return e=>new wt((t=>{let i=!1,r=!1,a=e.subscribe((e=>{i||(i=!0,t.next(e)),r&&a.unsubscribe()}),(e=>{i=!0,t.error?.(e),r&&a.unsubscribe()}));return r=!0,i&&a.unsubscribe(),a}))}function ji(e){return t=>new wt((i=>t.subscribe(new zi(i,e))))}var zi=class{next(e){try{this.effect(e)}catch(e){throw this.error(e),e}this.destination.next(e)}error(e){this.destination.error?.(e)}constructor(e,t){this.destination=e,this.effect=t}};function Ui(e){return t=>new wt((i=>t.subscribe(new Hi(i,e))))}var qi,Hi=class{next(e){0===this.count?this.destination.next(e):this.count--}error(e){this.destination.error?.(e)}constructor(e,t){this.destination=e,this.count=t,t<0&&this.destination.error?.(new Error("Count can not be less than zero"))}},Wi=((qi=Wi||{}).NETWORK="network",qi.VIDEO_PIPELINE="video_pipeline",qi.EXTERNAL_API="external_api",qi.PARSER="parser",qi.DOM="dom",qi.WTF="wtf",qi.FATAL="fatal",qi),Qi=class{addEventListener(e,t,i){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:i})}removeEventListener(e,t){if(!(e in this.listeners))return;let i=this.listeners[e];for(let e=0,r=i.length;e<r;e++)if(i[e].callback===t)return void i.splice(e,1)}dispatchEvent(e){if(!(e.type in this.listeners))return;let t=this.listeners[e.type].slice();for(let i=0,r=t.length;i<r;i++){let r=t[i];try{r.callback.call(this,e)}catch(e){Promise.resolve().then((()=>{throw e}))}r.options&&r.options.once&&this.removeEventListener(e.type,r.callback)}return!e.defaultPrevented}constructor(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}},Gi=class extends Qi{toString(){return"[object AbortSignal]"}dispatchEvent(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}constructor(){super(),this.listeners||Qi.call(this),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(this,"reason",{value:void 0,writable:!0,configurable:!0})}},Ki=class{abort(e){let t;try{t=new Event("abort")}catch{typeof document<"u"?document.createEvent?(t=document.createEvent("Event"),t.initEvent("abort",!1,!1)):(t=document.createEventObject(),t.type="abort"):t={type:"abort",bubbles:!1,cancelable:!1}}let i=e;if(void 0===i)if(typeof document>"u")i=new Error("This operation was aborted"),i.name="AbortError";else try{i=new DOMException("signal is aborted without reason")}catch{i=new Error("This operation was aborted"),i.name="AbortError"}this.signal.reason=i,this.signal.dispatchEvent(t)}toString(){return"[object AbortController]"}constructor(){Object.defineProperty(this,"signal",{value:new Gi,writable:!0,configurable:!0})}};function Yi(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}typeof Symbol<"u"&&Symbol.toStringTag&&(Ki.prototype[Symbol.toStringTag]="AbortController",Gi.prototype[Symbol.toStringTag]="AbortSignal");var Zi,Xi=Yi({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}),Ji=Xi?function(e){"function"==typeof e&&(e={fetch:e});let{fetch:t,Request:i=t.Request,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:a=!1}=e;if(!Yi({fetch:t,Request:i,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:a}))return{fetch:t,Request:s};let s=i;(s&&!s.prototype.hasOwnProperty("signal")||a)&&(s=function(e,t){let r;t&&t.signal&&(r=t.signal,delete t.signal);let a=new i(e,t);return r&&Object.defineProperty(a,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),a},s.prototype=i.prototype);let n=t;return{fetch:(e,t)=>{let i=s&&s.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(i){let r;try{r=new DOMException("Aborted","AbortError")}catch{r=new Error("Aborted"),r.name="AbortError"}if(i.aborted)return Promise.reject(r);let a=new Promise(((e,t)=>{i.addEventListener("abort",(()=>t(r)),{once:!0})}));return t&&t.signal&&delete t.signal,Promise.race([a,n(e,t)])}return n(e,t)},Request:s}}({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}):void 0,er=Xi?Ji.fetch:window.fetch,tr=(Xi?Ji.Request:window.Request,Xi||window.AbortController,Xi||window.AbortSignal,h(Pe(),1)),ir=h(ft(),1),rr=(e=>(e.Armenian="58",e.Azerbaijani="57",e.Belarusian="114",e.English="3",e.Kazakh="97",e.Portuguese="73",e.Russian="0",e.Spanish="4",e.Ukrainian="1",e.Uzbek="65",e.Vietnamese="75",e))(rr||{}),ar=async(e,t,i)=>{let r=new URL("https://vk.com/js/lang-pack.js");r.searchParams.set("format","json"),r.searchParams.set("name",t),void 0!==e&&r.searchParams.set("lang",e);let a=await(await er(r.toString())).json();return sr(a,i)},sr=(e,t)=>(0,ir.default)((0,tr.default)(e.keys).map((([e,i])=>[e.substring(`${t}_`.length),nr(i)]))),nr=e=>Array.isArray(e)?e[0]:e,or=((Zi=or||{}).RU="ru",Zi.EN="en",Zi),lr={UI:"__vkVideoPlayer",CORE:"__vkVideoCore"},ur=(()=>{let e=0;return()=>{let t=e;return e=(e+1)%Number.MAX_SAFE_INTEGER,t}})(),dr=class{getWindowObject(){let e=this.key();return window[e]?.[this.id]??{}}initWindowObjects(){let e=this.key();window[e]||(window[e]={}),window[e][this.id]={}}expose(e){Object.assign(this.getWindowObject(),e)}destroy(){let e=this.key();window&&window[e]&&window[e][this.id]&&(delete window[e][this.id],Object.keys(window[e]).length||delete window[e])}key(){let{type:e}=this;return lr[e]}constructor(e){this.id=ur(),this.type=e,this.initWindowObjects()}},cr={};c(cr,{create:()=>pr,destroy:()=>fr,push:()=>mr,subscribe:()=>vr});var hr=new Map,pr=(e,t)=>hr.set(e,t??[]),fr=e=>hr.delete(e),mr=(e,t)=>{let i=hr.get(e);i&&("function"==typeof i?i(t):i.push(t))},vr=(e,t)=>{let i=hr.get(e);if(i){if(i&&Array.isArray(i))for(let e of i)t(e);hr.set(e,t)}}},89923:(e,t,i)=>{i.d(t,{ApiEnv:()=>di,InteractiveInterfaceClick:()=>mi,OneStat:()=>er,SeekAction:()=>fi,VERSION:()=>wi});var r,a,s,n,o,l,u=i(819705),d=i(773439),c=Object.create,h=Object.defineProperty,p=Object.getOwnPropertyDescriptor,f=Object.getOwnPropertyNames,m=Object.getPrototypeOf,v=Object.prototype.hasOwnProperty,g=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),b=(e,t,i)=>(i=null!=e?c(m(e)):{},((e,t,i,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of f(t))!v.call(e,a)&&a!==i&&h(e,a,{get:()=>t[a],enumerable:!(r=p(t,a))||r.enumerable});return e})(!t&&e&&e.__esModule?i:h(i,"default",{value:e,enumerable:!0}),e)),y=g(((e,t)=>{var i=function(e){return e&&e.Math===Math&&e};t.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof global&&global)||i("object"==typeof e&&e)||function(){return this}()||Function("return this")()})),w=g(((e,t)=>{t.exports=function(e){try{return!!e()}catch{return!0}}})),S=g(((e,t)=>{var i=w();t.exports=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))})),x=g(((e,t)=>{var i=S(),r=Function.prototype,a=r.apply,s=r.call;t.exports="object"==typeof Reflect&&Reflect.apply||(i?s.bind(a):function(){return s.apply(a,arguments)})})),$=g(((e,t)=>{var i=S(),r=Function.prototype,a=r.call,s=i&&r.bind.bind(a,a);t.exports=i?s:function(e){return function(){return a.apply(e,arguments)}}})),_=g(((e,t)=>{var i=$(),r=i({}.toString),a=i("".slice);t.exports=function(e){return a(r(e),8,-1)}})),k=g(((e,t)=>{var i=_(),r=$();t.exports=function(e){if("Function"===i(e))return r(e)}})),T=g(((e,t)=>{var i="object"==typeof document&&document.all;t.exports=typeof i>"u"&&void 0!==i?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}})),C=g(((e,t)=>{var i=w();t.exports=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))})),E=g(((e,t)=>{var i=S(),r=Function.prototype.call;t.exports=i?r.bind(r):function(){return r.apply(r,arguments)}})),A=g((e=>{var t={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,r=i&&!t.call({1:2},1);e.f=r?function(e){var t=i(this,e);return!!t&&t.enumerable}:t})),L=g(((e,t)=>{t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}})),P=g(((e,t)=>{var i=$(),r=w(),a=_(),s=Object,n=i("".split);t.exports=r((function(){return!s("z").propertyIsEnumerable(0)}))?function(e){return"String"===a(e)?n(e,""):s(e)}:s})),M=g(((e,t)=>{t.exports=function(e){return null==e}})),I=g(((e,t)=>{var i=M(),r=TypeError;t.exports=function(e){if(i(e))throw new r("Can't call method on "+e);return e}})),R=g(((e,t)=>{var i=P(),r=I();t.exports=function(e){return i(r(e))}})),V=g(((e,t)=>{var i=T();t.exports=function(e){return"object"==typeof e?null!==e:i(e)}})),N=g(((e,t)=>{t.exports={}})),B=g(((e,t)=>{var i=N(),r=y(),a=T(),s=function(e){return a(e)?e:void 0};t.exports=function(e,t){return arguments.length<2?s(i[e])||s(r[e]):i[e]&&i[e][t]||r[e]&&r[e][t]}})),D=g(((e,t)=>{var i=$();t.exports=i({}.isPrototypeOf)})),O=g(((e,t)=>{var i=y().navigator,r=i&&i.userAgent;t.exports=r?String(r):""})),F=g(((e,t)=>{var i,r,a=y(),s=O(),n=a.process,o=a.Deno,l=n&&n.versions||o&&o.version,u=l&&l.v8;u&&(r=(i=u.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!r&&s&&((!(i=s.match(/Edge\/(\d+)/))||i[1]>=74)&&((i=s.match(/Chrome\/(\d+)/))&&(r=+i[1]))),t.exports=r})),j=g(((e,t)=>{var i=F(),r=w(),a=y().String;t.exports=!!Object.getOwnPropertySymbols&&!r((function(){var e=Symbol("symbol detection");return!a(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41}))})),z=g(((e,t)=>{var i=j();t.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator})),U=g(((e,t)=>{var i=B(),r=T(),a=D(),s=z(),n=Object;t.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return r(t)&&a(t.prototype,n(e))}})),q=g(((e,t)=>{var i=String;t.exports=function(e){try{return i(e)}catch{return"Object"}}})),H=g(((e,t)=>{var i=T(),r=q(),a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not a function")}})),W=g(((e,t)=>{var i=H(),r=M();t.exports=function(e,t){var a=e[t];return r(a)?void 0:i(a)}})),Q=g(((e,t)=>{var i=E(),r=T(),a=V(),s=TypeError;t.exports=function(e,t){var n,o;if("string"===t&&r(n=e.toString)&&!a(o=i(n,e))||r(n=e.valueOf)&&!a(o=i(n,e))||"string"!==t&&r(n=e.toString)&&!a(o=i(n,e)))return o;throw new s("Can't convert object to primitive value")}})),G=g(((e,t)=>{t.exports=!0})),K=g(((e,t)=>{var i=y(),r=Object.defineProperty;t.exports=function(e,t){try{r(i,e,{value:t,configurable:!0,writable:!0})}catch{i[e]=t}return t}})),Y=g(((e,t)=>{var i=G(),r=y(),a=K(),s="__core-js_shared__",n=t.exports=r[s]||a(s,{});(n.versions||(n.versions=[])).push({version:"3.38.0",mode:i?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),Z=g(((e,t)=>{var i=Y();t.exports=function(e,t){return i[e]||(i[e]=t||{})}})),X=g(((e,t)=>{var i=I(),r=Object;t.exports=function(e){return r(i(e))}})),J=g(((e,t)=>{var i=$(),r=X(),a=i({}.hasOwnProperty);t.exports=Object.hasOwn||function(e,t){return a(r(e),t)}})),ee=g(((e,t)=>{var i=$(),r=0,a=Math.random(),s=i(1..toString);t.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++r+a,36)}})),te=g(((e,t)=>{var i=y(),r=Z(),a=J(),s=ee(),n=j(),o=z(),l=i.Symbol,u=r("wks"),d=o?l.for||l:l&&l.withoutSetter||s;t.exports=function(e){return a(u,e)||(u[e]=n&&a(l,e)?l[e]:d("Symbol."+e)),u[e]}})),ie=g(((e,t)=>{var i=E(),r=V(),a=U(),s=W(),n=Q(),o=te(),l=TypeError,u=o("toPrimitive");t.exports=function(e,t){if(!r(e)||a(e))return e;var o,d=s(e,u);if(d){if(void 0===t&&(t="default"),o=i(d,e,t),!r(o)||a(o))return o;throw new l("Can't convert object to primitive value")}return void 0===t&&(t="number"),n(e,t)}})),re=g(((e,t)=>{var i=ie(),r=U();t.exports=function(e){var t=i(e,"string");return r(t)?t:t+""}})),ae=g(((e,t)=>{var i=y(),r=V(),a=i.document,s=r(a)&&r(a.createElement);t.exports=function(e){return s?a.createElement(e):{}}})),se=g(((e,t)=>{var i=C(),r=w(),a=ae();t.exports=!i&&!r((function(){return 7!==Object.defineProperty(a("div"),"a",{get:function(){return 7}}).a}))})),ne=g((e=>{var t=C(),i=E(),r=A(),a=L(),s=R(),n=re(),o=J(),l=se(),u=Object.getOwnPropertyDescriptor;e.f=t?u:function(e,t){if(e=s(e),t=n(t),l)try{return u(e,t)}catch{}if(o(e,t))return a(!i(r.f,e,t),e[t])}})),oe=g(((e,t)=>{var i=w(),r=T(),a=/#|\.prototype\./,s=function(e,t){var a=o[n(e)];return a===u||a!==l&&(r(t)?i(t):!!t)},n=s.normalize=function(e){return String(e).replace(a,".").toLowerCase()},o=s.data={},l=s.NATIVE="N",u=s.POLYFILL="P";t.exports=s})),le=g(((e,t)=>{var i=k(),r=H(),a=S(),s=i(i.bind);t.exports=function(e,t){return r(e),void 0===t?e:a?s(e,t):function(){return e.apply(t,arguments)}}})),ue=g(((e,t)=>{var i=C(),r=w();t.exports=i&&r((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))})),de=g(((e,t)=>{var i=V(),r=String,a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not an object")}})),ce=g((e=>{var t=C(),i=se(),r=ue(),a=de(),s=re(),n=TypeError,o=Object.defineProperty,l=Object.getOwnPropertyDescriptor,u="enumerable",d="configurable",c="writable";e.f=t?r?function(e,t,i){if(a(e),t=s(t),a(i),"function"==typeof e&&"prototype"===t&&"value"in i&&c in i&&!i[c]){var r=l(e,t);r&&r[c]&&(e[t]=i.value,i={configurable:d in i?i[d]:r[d],enumerable:u in i?i[u]:r[u],writable:!1})}return o(e,t,i)}:o:function(e,t,r){if(a(e),t=s(t),a(r),i)try{return o(e,t,r)}catch{}if("get"in r||"set"in r)throw new n("Accessors not supported");return"value"in r&&(e[t]=r.value),e}})),he=g(((e,t)=>{var i=C(),r=ce(),a=L();t.exports=i?function(e,t,i){return r.f(e,t,a(1,i))}:function(e,t,i){return e[t]=i,e}})),pe=g(((e,t)=>{var i=y(),r=x(),a=k(),s=T(),n=ne().f,o=oe(),l=N(),u=le(),d=he(),c=J();Y();var h=function(e){var t=function(i,a,s){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,a)}return new e(i,a,s)}return r(e,this,arguments)};return t.prototype=e.prototype,t};t.exports=function(e,t){var r,p,f,m,v,g,b,y,w,S=e.target,x=e.global,$=e.stat,_=e.proto,k=x?i:$?i[S]:i[S]&&i[S].prototype,T=x?l:l[S]||d(l,S,{})[S],C=T.prototype;for(m in t)p=!(r=o(x?m:S+($?".":"#")+m,e.forced))&&k&&c(k,m),g=T[m],p&&(e.dontCallGetSet?b=(w=n(k,m))&&w.value:b=k[m]),v=p&&b?b:t[m],(r||_||typeof g!=typeof v)&&(y=e.bind&&p?u(v,i):e.wrap&&p?h(v):_&&s(v)?a(v):v,(e.sham||v&&v.sham||g&&g.sham)&&d(y,"sham",!0),d(T,m,y),_&&(c(l,f=S+"Prototype")||d(l,f,{}),d(l[f],m,v),e.real&&C&&(r||!C[m])&&d(C,m,v)))}})),fe=g(((e,t)=>{var i=Math.ceil,r=Math.floor;t.exports=Math.trunc||function(e){var t=+e;return(t>0?r:i)(t)}})),me=g(((e,t)=>{var i=fe();t.exports=function(e){var t=+e;return t!=t||0===t?0:i(t)}})),ve=g(((e,t)=>{var i=me(),r=Math.max,a=Math.min;t.exports=function(e,t){var s=i(e);return s<0?r(s+t,0):a(s,t)}})),ge=g(((e,t)=>{var i=me(),r=Math.min;t.exports=function(e){var t=i(e);return t>0?r(t,9007199254740991):0}})),be=g(((e,t)=>{var i=ge();t.exports=function(e){return i(e.length)}})),ye=g(((e,t)=>{var i=R(),r=ve(),a=be(),s=function(e){return function(t,s,n){var o=i(t),l=a(o);if(0===l)return!e&&-1;var u,d=r(n,l);if(e&&s!=s){for(;l>d;)if((u=o[d++])!=u)return!0}else for(;l>d;d++)if((e||d in o)&&o[d]===s)return e||d||0;return!e&&-1}};t.exports={includes:s(!0),indexOf:s(!1)}})),we=g(((e,t)=>{t.exports=function(){}})),Se=g((()=>{var e=pe(),t=ye().includes,i=w(),r=we();e({target:"Array",proto:!0,forced:i((function(){return!Array(1).includes()}))},{includes:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),r("includes")})),xe=g(((e,t)=>{var i=B();t.exports=i})),$e=g(((e,t)=>{Se();var i=xe();t.exports=i("Array","includes")})),_e=g(((e,t)=>{var i=$e();t.exports=i})),ke=g(((e,t)=>{var i=_e();t.exports=i})),Te=g((()=>{})),Ce=g(((e,t)=>{var i=y(),r=O(),a=_(),s=function(e){return r.slice(0,e.length)===e};t.exports=s("Bun/")?"BUN":s("Cloudflare-Workers")?"CLOUDFLARE":s("Deno/")?"DENO":s("Node.js/")?"NODE":i.Bun&&"string"==typeof Bun.version?"BUN":i.Deno&&"object"==typeof Deno.version?"DENO":"process"===a(i.process)?"NODE":i.window&&i.document?"BROWSER":"REST"})),Ee=g(((e,t)=>{var i=Ce();t.exports="NODE"===i})),Ae=g(((e,t)=>{var i=he();t.exports=function(e,t,r,a){return a&&a.enumerable?e[t]=r:i(e,t,r),e}})),Le=g(((e,t)=>{var i=$(),r=H();t.exports=function(e,t,a){try{return i(r(Object.getOwnPropertyDescriptor(e,t)[a]))}catch{}}})),Pe=g(((e,t)=>{var i=V();t.exports=function(e){return i(e)||null===e}})),Me=g(((e,t)=>{var i=Pe(),r=String,a=TypeError;t.exports=function(e){if(i(e))return e;throw new a("Can't set "+r(e)+" as a prototype")}})),Ie=g(((e,t)=>{var i=Le(),r=V(),a=I(),s=Me();t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=i(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(i,n){return a(i),s(n),r(i)&&(t?e(i,n):i.__proto__=n),i}}():void 0)})),Re=g(((e,t)=>{var i={};i[te()("toStringTag")]="z",t.exports="[object z]"===String(i)})),Ve=g(((e,t)=>{var i=Re(),r=T(),a=_(),s=te()("toStringTag"),n=Object,o="Arguments"===a(function(){return arguments}());t.exports=i?a:function(e){var t,i,l;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch{}}(t=n(e),s))?i:o?a(t):"Object"===(l=a(t))&&r(t.callee)?"Arguments":l}})),Ne=g(((e,t)=>{var i=Re(),r=Ve();t.exports=i?{}.toString:function(){return"[object "+r(this)+"]"}})),Be=g(((e,t)=>{var i=Re(),r=ce().f,a=he(),s=J(),n=Ne(),o=te()("toStringTag");t.exports=function(e,t,l,u){var d=l?e:e&&e.prototype;d&&(s(d,o)||r(d,o,{configurable:!0,value:t}),u&&!i&&a(d,"toString",n))}})),De=g(((e,t)=>{var i=ce();t.exports=function(e,t,r){return i.f(e,t,r)}})),Oe=g(((e,t)=>{var i=B(),r=De(),a=te(),s=C(),n=a("species");t.exports=function(e){var t=i(e);s&&t&&!t[n]&&r(t,n,{configurable:!0,get:function(){return this}})}})),Fe=g(((e,t)=>{var i=D(),r=TypeError;t.exports=function(e,t){if(i(t,e))return e;throw new r("Incorrect invocation")}})),je=g(((e,t)=>{var i=$(),r=T(),a=Y(),s=i(Function.toString);r(a.inspectSource)||(a.inspectSource=function(e){return s(e)}),t.exports=a.inspectSource})),ze=g(((e,t)=>{var i=$(),r=w(),a=T(),s=Ve(),n=B(),o=je(),l=function(){},u=n("Reflect","construct"),d=/^\s*(?:class|function)\b/,c=i(d.exec),h=!d.test(l),p=function(e){if(!a(e))return!1;try{return u(l,[],e),!0}catch{return!1}},f=function(e){if(!a(e))return!1;switch(s(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return h||!!c(d,o(e))}catch{return!0}};f.sham=!0,t.exports=!u||r((function(){var e;return p(p.call)||!p(Object)||!p((function(){e=!0}))||e}))?f:p})),Ue=g(((e,t)=>{var i=ze(),r=q(),a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not a constructor")}})),qe=g(((e,t)=>{var i=de(),r=Ue(),a=M(),s=te()("species");t.exports=function(e,t){var n,o=i(e).constructor;return void 0===o||a(n=i(o)[s])?t:r(n)}})),He=g(((e,t)=>{var i=B();t.exports=i("document","documentElement")})),We=g(((e,t)=>{var i=$();t.exports=i([].slice)})),Qe=g(((e,t)=>{var i=TypeError;t.exports=function(e,t){if(e<t)throw new i("Not enough arguments");return e}})),Ge=g(((e,t)=>{var i=O();t.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(i)})),Ke=g(((e,t)=>{var i,r,a,s,n=y(),o=x(),l=le(),u=T(),d=J(),c=w(),h=He(),p=We(),f=ae(),m=Qe(),v=Ge(),g=Ee(),b=n.setImmediate,S=n.clearImmediate,$=n.process,_=n.Dispatch,k=n.Function,C=n.MessageChannel,E=n.String,A=0,L={},P="onreadystatechange";c((function(){i=n.location}));var M=function(e){if(d(L,e)){var t=L[e];delete L[e],t()}},I=function(e){return function(){M(e)}},R=function(e){M(e.data)},V=function(e){n.postMessage(E(e),i.protocol+"//"+i.host)};(!b||!S)&&(b=function(e){m(arguments.length,1);var t=u(e)?e:k(e),i=p(arguments,1);return L[++A]=function(){o(t,void 0,i)},r(A),A},S=function(e){delete L[e]},g?r=function(e){$.nextTick(I(e))}:_&&_.now?r=function(e){_.now(I(e))}:C&&!v?(s=(a=new C).port2,a.port1.onmessage=R,r=l(s.postMessage,s)):n.addEventListener&&u(n.postMessage)&&!n.importScripts&&i&&"file:"!==i.protocol&&!c(V)?(r=V,n.addEventListener("message",R,!1)):r=P in f("script")?function(e){h.appendChild(f("script"))[P]=function(){h.removeChild(this),M(e)}}:function(e){setTimeout(I(e),0)}),t.exports={set:b,clear:S}})),Ye=g(((e,t)=>{var i=y(),r=C(),a=Object.getOwnPropertyDescriptor;t.exports=function(e){if(!r)return i[e];var t=a(i,e);return t&&t.value}})),Ze=g(((e,t)=>{var i=function(){this.head=null,this.tail=null};i.prototype={add:function(e){var t={item:e,next:null},i=this.tail;i?i.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}},t.exports=i})),Xe=g(((e,t)=>{var i=O();t.exports=/ipad|iphone|ipod/i.test(i)&&typeof Pebble<"u"})),Je=g(((e,t)=>{var i=O();t.exports=/web0s(?!.*chrome)/i.test(i)})),et=g(((e,t)=>{var i,r,a,s,n,o,l,u=y(),d=Ye(),c=le(),h=Ke().set,p=Ze(),f=Ge(),m=Xe(),v=Je(),g=Ee(),b=u.MutationObserver||u.WebKitMutationObserver,w=u.document,S=u.process,x=u.Promise,$=d("queueMicrotask");$||(o=new p,l=function(){var e,t;for(g&&(e=S.domain)&&e.exit();t=o.get();)try{t()}catch(e){throw o.head&&i(),e}e&&e.enter()},f||g||v||!b||!w?!m&&x&&x.resolve?((s=x.resolve(void 0)).constructor=x,n=c(s.then,s),i=function(){n(l)}):g?i=function(){S.nextTick(l)}:(h=c(h,u),i=function(){h(l)}):(r=!0,a=w.createTextNode(""),new b(l).observe(a,{characterData:!0}),i=function(){a.data=r=!r}),$=function(e){o.head||i(),o.add(e)}),t.exports=$})),tt=g(((e,t)=>{t.exports=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch{}}})),it=g(((e,t)=>{t.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}})),rt=g(((e,t)=>{var i=y(),r=T(),a=i.WeakMap;t.exports=r(a)&&/native code/.test(String(a))})),at=g(((e,t)=>{var i=Z(),r=ee(),a=i("keys");t.exports=function(e){return a[e]||(a[e]=r(e))}})),st=g(((e,t)=>{t.exports={}})),nt=g(((e,t)=>{var i,r,a,s,n,o=rt(),l=y(),u=V(),d=he(),c=J(),h=Y(),p=at(),f=st(),m="Object already initialized",v=l.TypeError,g=l.WeakMap;o||h.state?((s=h.state||(h.state=new g)).get=s.get,s.has=s.has,s.set=s.set,i=function(e,t){if(s.has(e))throw new v(m);return t.facade=e,s.set(e,t),t},r=function(e){return s.get(e)||{}},a=function(e){return s.has(e)}):(f[n=p("state")]=!0,i=function(e,t){if(c(e,n))throw new v(m);return t.facade=e,d(e,n,t),t},r=function(e){return c(e,n)?e[n]:{}},a=function(e){return c(e,n)}),t.exports={set:i,get:r,has:a,enforce:function(e){return a(e)?r(e):i(e,{})},getterFor:function(e){return function(t){var i;if(!u(t)||(i=r(t)).type!==e)throw new v("Incompatible receiver, "+e+" required");return i}}}})),ot=g(((e,t)=>{var i=y();t.exports=i.Promise})),lt=g(((e,t)=>{var i=y(),r=ot(),a=T(),s=oe(),n=je(),o=te(),l=Ce(),u=G(),d=F(),c=r&&r.prototype,h=o("species"),p=!1,f=a(i.PromiseRejectionEvent),m=s("Promise",(function(){var e=n(r),t=e!==String(r);if(!t&&66===d||u&&(!c.catch||!c.finally))return!0;if(!d||d<51||!/native code/.test(e)){var i=new r((function(e){e(1)})),a=function(e){e((function(){}),(function(){}))};if((i.constructor={})[h]=a,!(p=i.then((function(){}))instanceof a))return!0}return!(t||"BROWSER"!==l&&"DENO"!==l||f)}));t.exports={CONSTRUCTOR:m,REJECTION_EVENT:f,SUBCLASSING:p}})),ut=g(((e,t)=>{var i=H(),r=TypeError,a=function(e){var t,a;this.promise=new e((function(e,i){if(void 0!==t||void 0!==a)throw new r("Bad Promise constructor");t=e,a=i})),this.resolve=i(t),this.reject=i(a)};t.exports.f=function(e){return new a(e)}})),dt=g((()=>{var e,t,i,r=pe(),a=G(),s=Ee(),n=y(),o=E(),l=Ae(),u=Ie(),d=Be(),c=Oe(),h=H(),p=T(),f=V(),m=Fe(),v=qe(),g=Ke().set,b=et(),w=tt(),S=it(),x=Ze(),$=nt(),_=ot(),k=lt(),C=ut(),A="Promise",L=k.CONSTRUCTOR,P=k.REJECTION_EVENT,M=k.SUBCLASSING,I=$.getterFor(A),R=$.set,N=_&&_.prototype,B=_,D=N,O=n.TypeError,F=n.document,j=n.process,z=C.f,U=z,q=!!(F&&F.createEvent&&n.dispatchEvent),W="unhandledrejection",Q=function(e){var t;return!(!f(e)||!p(t=e.then))&&t},K=function(e,t){var i,r,a,s=t.value,n=1===t.state,l=n?e.ok:e.fail,u=e.resolve,d=e.reject,c=e.domain;try{l?(n||(2===t.rejection&&ee(t),t.rejection=1),!0===l?i=s:(c&&c.enter(),i=l(s),c&&(c.exit(),a=!0)),i===e.promise?d(new O("Promise-chain cycle")):(r=Q(i))?o(r,i,u,d):u(i)):d(s)}catch(e){c&&!a&&c.exit(),d(e)}},Y=function(e,t){e.notified||(e.notified=!0,b((function(){for(var i,r=e.reactions;i=r.get();)K(i,e);e.notified=!1,t&&!e.rejection&&X(e)})))},Z=function(e,t,i){var r,a;q?((r=F.createEvent("Event")).promise=t,r.reason=i,r.initEvent(e,!1,!0),n.dispatchEvent(r)):r={promise:t,reason:i},!P&&(a=n["on"+e])?a(r):e===W&&w("Unhandled promise rejection",i)},X=function(e){o(g,n,(function(){var t,i=e.facade,r=e.value;if(J(e)&&(t=S((function(){s?j.emit("unhandledRejection",r,i):Z(W,i,r)})),e.rejection=s||J(e)?2:1,t.error))throw t.value}))},J=function(e){return 1!==e.rejection&&!e.parent},ee=function(e){o(g,n,(function(){var t=e.facade;s?j.emit("rejectionHandled",t):Z("rejectionhandled",t,e.value)}))},te=function(e,t,i){return function(r){e(t,r,i)}},ie=function(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,Y(e,!0))},re=function(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw new O("Promise can't be resolved itself");var r=Q(t);r?b((function(){var i={done:!1};try{o(r,t,te(re,i,e),te(ie,i,e))}catch(t){ie(i,t,e)}})):(e.value=t,e.state=1,Y(e,!1))}catch(t){ie({done:!1},t,e)}}};if(L&&(D=(B=function(t){m(this,D),h(t),o(e,this);var i=I(this);try{t(te(re,i),te(ie,i))}catch(e){ie(i,e)}}).prototype,(e=function(e){R(this,{type:A,done:!1,notified:!1,parent:!1,reactions:new x,rejection:!1,state:0,value:void 0})}).prototype=l(D,"then",(function(e,t){var i=I(this),r=z(v(this,B));return i.parent=!0,r.ok=!p(e)||e,r.fail=p(t)&&t,r.domain=s?j.domain:void 0,0===i.state?i.reactions.add(r):b((function(){K(r,i)})),r.promise})),t=function(){var t=new e,i=I(t);this.promise=t,this.resolve=te(re,i),this.reject=te(ie,i)},C.f=z=function(e){return e===B||undefined===e?new t(e):U(e)},!a&&p(_)&&N!==Object.prototype)){i=N.then,M||l(N,"then",(function(e,t){var r=this;return new B((function(e,t){o(i,r,e,t)})).then(e,t)}),{unsafe:!0});try{delete N.constructor}catch{}u&&u(N,D)}r({global:!0,constructor:!0,wrap:!0,forced:L},{Promise:B}),d(B,A,!1,!0),c(A)})),ct=g(((e,t)=>{t.exports={}})),ht=g(((e,t)=>{var i=te(),r=ct(),a=i("iterator"),s=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||s[a]===e)}})),pt=g(((e,t)=>{var i=Ve(),r=W(),a=M(),s=ct(),n=te()("iterator");t.exports=function(e){if(!a(e))return r(e,n)||r(e,"@@iterator")||s[i(e)]}})),ft=g(((e,t)=>{var i=E(),r=H(),a=de(),s=q(),n=pt(),o=TypeError;t.exports=function(e,t){var l=arguments.length<2?n(e):t;if(r(l))return a(i(l,e));throw new o(s(e)+" is not iterable")}})),mt=g(((e,t)=>{var i=E(),r=de(),a=W();t.exports=function(e,t,s){var n,o;r(e);try{if(!(n=a(e,"return"))){if("throw"===t)throw s;return s}n=i(n,e)}catch(e){o=!0,n=e}if("throw"===t)throw s;if(o)throw n;return r(n),s}})),vt=g(((e,t)=>{var i=le(),r=E(),a=de(),s=q(),n=ht(),o=be(),l=D(),u=ft(),d=pt(),c=mt(),h=TypeError,p=function(e,t){this.stopped=e,this.result=t},f=p.prototype;t.exports=function(e,t,m){var v,g,b,y,w,S,x,$=m&&m.that,_=!(!m||!m.AS_ENTRIES),k=!(!m||!m.IS_RECORD),T=!(!m||!m.IS_ITERATOR),C=!(!m||!m.INTERRUPTED),E=i(t,$),A=function(e){return v&&c(v,"normal",e),new p(!0,e)},L=function(e){return _?(a(e),C?E(e[0],e[1],A):E(e[0],e[1])):C?E(e,A):E(e)};if(k)v=e.iterator;else if(T)v=e;else{if(!(g=d(e)))throw new h(s(e)+" is not iterable");if(n(g)){for(b=0,y=o(e);y>b;b++)if((w=L(e[b]))&&l(f,w))return w;return new p(!1)}v=u(e,g)}for(S=k?e.next:v.next;!(x=r(S,v)).done;){try{w=L(x.value)}catch(e){c(v,"throw",e)}if("object"==typeof w&&w&&l(f,w))return w}return new p(!1)}})),gt=g(((e,t)=>{var i,r,a=te()("iterator"),s=!1;try{i=0,(r={next:function(){return{done:!!i++}},return:function(){s=!0}})[a]=function(){return this},Array.from(r,(function(){throw 2}))}catch{}t.exports=function(e,t){try{if(!t&&!s)return!1}catch{return!1}var i=!1;try{var r={};r[a]=function(){return{next:function(){return{done:i=!0}}}},e(r)}catch{}return i}})),bt=g(((e,t)=>{var i=ot(),r=gt(),a=lt().CONSTRUCTOR;t.exports=a||!r((function(e){i.all(e).then(void 0,(function(){}))}))})),yt=g((()=>{var e=pe(),t=E(),i=H(),r=ut(),a=it(),s=vt();e({target:"Promise",stat:!0,forced:bt()},{all:function(e){var n=this,o=r.f(n),l=o.resolve,u=o.reject,d=a((function(){var r=i(n.resolve),a=[],o=0,d=1;s(e,(function(e){var i=o++,s=!1;d++,t(r,n,e).then((function(e){s||(s=!0,a[i]=e,--d||l(a))}),u)})),--d||l(a)}));return d.error&&u(d.value),o.promise}})})),wt=g((()=>{var e,t=pe(),i=G(),r=lt().CONSTRUCTOR,a=ot(),s=B(),n=T(),o=Ae(),l=a&&a.prototype;t({target:"Promise",proto:!0,forced:r,real:!0},{catch:function(e){return this.then(void 0,e)}}),!i&&n(a)&&(e=s("Promise").prototype.catch,l.catch!==e&&o(l,"catch",e,{unsafe:!0}))})),St=g((()=>{var e=pe(),t=E(),i=H(),r=ut(),a=it(),s=vt();e({target:"Promise",stat:!0,forced:bt()},{race:function(e){var n=this,o=r.f(n),l=o.reject,u=a((function(){var r=i(n.resolve);s(e,(function(e){t(r,n,e).then(o.resolve,l)}))}));return u.error&&l(u.value),o.promise}})})),xt=g((()=>{var e=pe(),t=ut();e({target:"Promise",stat:!0,forced:lt().CONSTRUCTOR},{reject:function(e){var i=t.f(this);return(0,i.reject)(e),i.promise}})})),$t=g(((e,t)=>{var i=de(),r=V(),a=ut();t.exports=function(e,t){if(i(e),r(t)&&t.constructor===e)return t;var s=a.f(e);return(0,s.resolve)(t),s.promise}})),_t=g((()=>{var e=pe(),t=B(),i=G(),r=ot(),a=lt().CONSTRUCTOR,s=$t(),n=t("Promise"),o=i&&!a;e({target:"Promise",stat:!0,forced:i||a},{resolve:function(e){return s(o&&this===n?r:this,e)}})})),kt=g((()=>{dt(),yt(),wt(),St(),xt(),_t()})),Tt=g((()=>{var e,t=pe(),i=G(),r=ot(),a=w(),s=B(),n=T(),o=qe(),l=$t(),u=Ae(),d=r&&r.prototype;t({target:"Promise",proto:!0,real:!0,forced:!!r&&a((function(){d.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=o(this,s("Promise")),i=n(e);return this.then(i?function(i){return l(t,e()).then((function(){return i}))}:e,i?function(i){return l(t,e()).then((function(){throw i}))}:e)}}),!i&&n(r)&&(e=s("Promise").prototype.finally,d.finally!==e&&u(d,"finally",e,{unsafe:!0}))})),Ct=g(((e,t)=>{Te(),kt(),Tt();var i=xe();t.exports=i("Promise","finally")})),Et=g(((e,t)=>{var i=Ct();t.exports=i})),At=g(((e,t)=>{var i=Et();t.exports=i})),Lt=g(((e,t)=>{var i=w();t.exports=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))})),Pt=g(((e,t)=>{var i=J(),r=T(),a=X(),s=at(),n=Lt(),o=s("IE_PROTO"),l=Object,u=l.prototype;t.exports=n?l.getPrototypeOf:function(e){var t=a(e);if(i(t,o))return t[o];var s=t.constructor;return r(s)&&t instanceof s?s.prototype:t instanceof l?u:null}})),Mt=g(((e,t)=>{var i=$(),r=J(),a=R(),s=ye().indexOf,n=st(),o=i([].push);t.exports=function(e,t){var i,l=a(e),u=0,d=[];for(i in l)!r(n,i)&&r(l,i)&&o(d,i);for(;t.length>u;)r(l,i=t[u++])&&(~s(d,i)||o(d,i));return d}})),It=g(((e,t)=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]})),Rt=g(((e,t)=>{var i=Mt(),r=It();t.exports=Object.keys||function(e){return i(e,r)}})),Vt=g(((e,t)=>{var i=C(),r=w(),a=$(),s=Pt(),n=Rt(),o=R(),l=a(A().f),u=a([].push),d=i&&r((function(){var e=Object.create(null);return e[2]=2,!l(e,2)})),c=function(e){return function(t){for(var r,a=o(t),c=n(a),h=d&&null===s(a),p=c.length,f=0,m=[];p>f;)r=c[f++],(!i||(h?r in a:l(a,r)))&&u(m,e?[r,a[r]]:a[r]);return m}};t.exports={entries:c(!0),values:c(!1)}})),Nt=g((()=>{var e=pe(),t=Vt().entries;e({target:"Object",stat:!0},{entries:function(e){return t(e)}})})),Bt=g(((e,t)=>{Nt();var i=N();t.exports=i.Object.entries})),Dt=g(((e,t)=>{var i=Bt();t.exports=i})),Ot=g(((e,t)=>{var i=Dt();t.exports=i})),Ft=g(((e,t)=>{var i=C(),r=J(),a=Function.prototype,s=i&&Object.getOwnPropertyDescriptor,n=r(a,"name"),o=n&&"something"===function(){}.name,l=n&&(!i||i&&s(a,"name").configurable);t.exports={EXISTS:n,PROPER:o,CONFIGURABLE:l}})),jt=g((e=>{var t=C(),i=ue(),r=ce(),a=de(),s=R(),n=Rt();e.f=t&&!i?Object.defineProperties:function(e,t){a(e);for(var i,o=s(t),l=n(t),u=l.length,d=0;u>d;)r.f(e,i=l[d++],o[i]);return e}})),zt=g(((e,t)=>{var i,r=de(),a=jt(),s=It(),n=st(),o=He(),l=ae(),u=at(),d="prototype",c="script",h=u("IE_PROTO"),p=function(){},f=function(e){return"<"+c+">"+e+"</"+c+">"},m=function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t},v=function(){try{i=new ActiveXObject("htmlfile")}catch{}v=typeof document<"u"?document.domain&&i?m(i):function(){var e,t=l("iframe"),i="java"+c+":";return t.style.display="none",o.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(f("document.F=Object")),e.close(),e.F}():m(i);for(var e=s.length;e--;)delete v[d][s[e]];return v()};n[h]=!0,t.exports=Object.create||function(e,t){var i;return null!==e?(p[d]=r(e),i=new p,p[d]=null,i[h]=e):i=v(),void 0===t?i:a.f(i,t)}})),Ut=g(((e,t)=>{var i,r,a,s=w(),n=T(),o=V(),l=zt(),u=Pt(),d=Ae(),c=te(),h=G(),p=c("iterator"),f=!1;[].keys&&("next"in(a=[].keys())?(r=u(u(a)))!==Object.prototype&&(i=r):f=!0),!o(i)||s((function(){var e={};return i[p].call(e)!==e}))?i={}:h&&(i=l(i)),n(i[p])||d(i,p,(function(){return this})),t.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:f}})),qt=g(((e,t)=>{var i=Ut().IteratorPrototype,r=zt(),a=L(),s=Be(),n=ct(),o=function(){return this};t.exports=function(e,t,l,u){var d=t+" Iterator";return e.prototype=r(i,{next:a(+!u,l)}),s(e,d,!1,!0),n[d]=o,e}})),Ht=g(((e,t)=>{var i=pe(),r=E(),a=G(),s=Ft(),n=T(),o=qt(),l=Pt(),u=Ie(),d=Be(),c=he(),h=Ae(),p=te(),f=ct(),m=Ut(),v=s.PROPER,g=s.CONFIGURABLE,b=m.IteratorPrototype,y=m.BUGGY_SAFARI_ITERATORS,w=p("iterator"),S="keys",x="values",$="entries",_=function(){return this};t.exports=function(e,t,s,p,m,k,T){o(s,t,p);var C,E,A,L=function(e){if(e===m&&V)return V;if(!y&&e&&e in I)return I[e];switch(e){case S:case x:case $:return function(){return new s(this,e)}}return function(){return new s(this)}},P=t+" Iterator",M=!1,I=e.prototype,R=I[w]||I["@@iterator"]||m&&I[m],V=!y&&R||L(m),N="Array"===t&&I.entries||R;if(N&&((C=l(N.call(new e)))!==Object.prototype&&C.next&&(!a&&l(C)!==b&&(u?u(C,b):n(C[w])||h(C,w,_)),d(C,P,!0,!0),a&&(f[P]=_))),v&&m===x&&R&&R.name!==x&&(!a&&g?c(I,"name",x):(M=!0,V=function(){return r(R,this)})),m)if(E={values:L(x),keys:k?V:L(S),entries:L($)},T)for(A in E)(y||M||!(A in I))&&h(I,A,E[A]);else i({target:t,proto:!0,forced:y||M},E);return(!a||T)&&I[w]!==V&&h(I,w,V,{name:m}),f[t]=V,E}})),Wt=g(((e,t)=>{t.exports=function(e,t){return{value:e,done:t}}})),Qt=g(((e,t)=>{var i=R(),r=we(),a=ct(),s=nt(),n=ce().f,o=Ht(),l=Wt(),u=G(),d=C(),c="Array Iterator",h=s.set,p=s.getterFor(c);t.exports=o(Array,"Array",(function(e,t){h(this,{type:c,target:i(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=void 0,l(void 0,!0);switch(e.kind){case"keys":return l(i,!1);case"values":return l(t[i],!1)}return l([i,t[i]],!1)}),"values");var f=a.Arguments=a.Array;if(r("keys"),r("values"),r("entries"),!u&&d&&"values"!==f.name)try{n(f,"name",{value:"values"})}catch{}})),Gt=g(((e,t)=>{var i=C(),r=ce(),a=L();t.exports=function(e,t,s){i?r.f(e,t,a(0,s)):e[t]=s}})),Kt=g((()=>{var e=pe(),t=vt(),i=Gt();e({target:"Object",stat:!0},{fromEntries:function(e){var r={};return t(e,(function(e,t){i(r,e,t)}),{AS_ENTRIES:!0}),r}})})),Yt=g(((e,t)=>{Qt(),Kt();var i=N();t.exports=i.Object.fromEntries})),Zt=g(((e,t)=>{t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}})),Xt=g((()=>{Qt();var e,t=Zt(),i=y(),r=Be(),a=ct();for(e in t)r(i[e],e),a[e]=a.Array})),Jt=g(((e,t)=>{var i=Yt();Xt(),t.exports=i})),ei=g(((e,t)=>{var i=Jt();t.exports=i})),ti=g(((e,t)=>{var i=Ve(),r=String;t.exports=function(e){if("Symbol"===i(e))throw new TypeError("Cannot convert a Symbol value to a string");return r(e)}})),ii=g(((e,t)=>{var i=me(),r=ti(),a=I(),s=RangeError;t.exports=function(e){var t=r(a(this)),n="",o=i(e);if(o<0||o===1/0)throw new s("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(n+=t);return n}})),ri=g(((e,t)=>{var i=$(),r=ge(),a=ti(),s=ii(),n=I(),o=i(s),l=i("".slice),u=Math.ceil,d=function(e){return function(t,i,s){var d,c,h=a(n(t)),p=r(i),f=h.length,m=void 0===s?" ":a(s);return p<=f||""===m?h:((c=o(m,u((d=p-f)/m.length))).length>d&&(c=l(c,0,d)),e?h+c:c+h)}};t.exports={start:d(!1),end:d(!0)}})),ai=g(((e,t)=>{var i=O();t.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(i)})),si=g((()=>{var e=pe(),t=ri().start;e({target:"String",proto:!0,forced:ai()},{padStart:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),ni=g(((e,t)=>{si();var i=xe();t.exports=i("String","padStart")})),oi=g(((e,t)=>{var i=ni();t.exports=i})),li=g(((e,t)=>{var i=oi();t.exports=i})),ui=b(ke(),1),di=((s=di||{}).PROD="prod",s.VK_ALIAS="vk_alias",s.VIDEOTEST="videotest",s.TEST="test",s.OKCDN="okcdn",s.AUTO="auto",s),ci=((a=ci||{}).Q144P="mobile",a.Q240P="lowest",a.Q360P="low",a.Q480P="medium",a.Q720P="high",a.Q1080P="fullhd",a.Q1440P="quadhd",a.Q2160P="ultrahd",a.UNKNOWN="unknown",a),hi=((r=hi||{}).MP4="mp4",r.DASH="dash",r.DASH_SEP="dash_sep",r.ONDEMAND_DASH="ondemand_dash",r.HLS="hls",r.ONDEMAND_HLS="ondemand_hls",r.WEBM="webm",r.AV1="av1",r.ONDEMAND_DASH_LIVE="ondemand_dash_live",r.ONDEMAND_HLS_LIVE="ondemand_hls_live",r.WEBRTC="webrtc",r.UNKNOWN="unknown",r.RTMP="rtmp",r),pi=((n=pi||{}).HTTP1="http1",n.HTTP2="http2",n.HTTP3="http3",n),fi=((l=fi||{}).SLIDER="slider",l.DOUBLE_TAP="double_tap",l.TIME_CODE="time_code",l.EPISODE="episode",l.REWIND="rewind",l.LIVE="live",l.UNKNOWN="unknown",l),mi=((o=mi||{}).GRAPH_SHOW="iGraphShow",o.GRAPH_HIDE="iGraphHide",o.NEXT_AREA="iNextChapterArea",o.NEXT_BUTTON="iNextChapterBtn",o.WATCH_AGAIN="iWatchAgainBtn",o),vi={action_play:"ap",action_play_interactive:"api",first_bytes:"fb",player_ready:"pr",first_frame:"ff",seek:"sk",watch_coverage_record:"wr",watch_coverage_live:"wl",empty_buffer:"eb",action_stop:"as",close_at_empty_buffer:"cb",content_error:"er",player_interface_click:"pc",next_movie:"nm",track_switch:"ts",failover:"fo",quality:"qt"},gi={vsid:"si",isid:"is",vid:"vi",place:"pl",quality:"qt",cdn_host:"ch",stat_type:"st",param:"pm",vk_app_id:"va",track_code:"tc",connection_type:"cnt",connection_reused:"cr",cached_data:"cd",live:"lv",muted:"mu",mode:"mo",subtitles:"sb",failover:"fo",download_speed:"ds",manual_quality:"mq",ref_domain:"rd",direct_url:"du"},bi={unknown:"un",mobile:"m",lowest:"ls",low:"l",medium:"md",high:"h",fullhd:"f",quadhd:"q",ultrahd:"u"},yi={pip:"pi",fullscreen:"fs",external:"ex",prefetch:"pr",airplay:"ap",chromecast:"cc",invisible:"iv"},wi="1.0.78",Si={prod:"https://api.ok.ru",vk_alias:"https://api.mycdn.me",videotest:"https://videotestapi.ok.ru/api",test:"https://apitest.ok.ru",okcdn:"https://api.okcdn.ru",auto:""},xi={apiEnv:"vk_alias",apiKey:"CIOPGQJGDIHBABABA",requestRetryCount:1,firstFlushTime:5e3,flushDebounceTime:1e4,flushMaxWait:6e4,storageExpiration:1296e5,watchCoverageInterval:15e3,disabledOperations:["quality"],disabledCustomFields:[],shorten:!0,maxLoops:100,embedUrlParams:[],useBeacon:!0,synchronizeTime:!0,debugLog:!1,clearStorageAtUnload:!0,useVKComIsMobileLogic:!1,backoff:{start:1e3,factor:1.5,max:3e5,random:.1}};var $i=b(At(),1),_i=b(Ot(),1),ki=b(ei(),1),Ti=e=>{let{operation:t,custom:i}=e,r=(0,ki.default)((0,_i.default)(i).map((([e,t])=>{let i=t;return t&&("mode"===e?i=yi[t]??t:"quality"===e&&(i=bi[t]??t)),[gi[e]??e,i]})));return{...e,operation:vi[t]??t,custom:r}},Ci=/Mobile|mini|Fennec|Android|iP(ad|od|hone)|opera (mini|mobi)/i,Ei=class{async authorize(e){return this.authToken=e??await this.refreshAuthToken(),this._authorizeWithBackoff()}logBeacon(e){let t=this.createLogParams(e),i=this.sessionKey;i&&(this.params.apiTransport.sendBeacon("log.externalLog",t,i)||this.logRequest(e).catch((()=>{})))}async logRequest(e){let t="log.externalLog",i=this.createLogParams(e),r=this.sessionKey??await this._authorizeWithBackoff();if(!r)return;let a=async(e,s=this.params.config.requestRetryCount)=>{try{return await this.params.apiTransport.sendRequest(t,i,r)}catch(i){if(!i||!("error_code"in i))return void this.params.error$.next({id:"logRequestUnknown",category:u.ErrorCategory.NETWORK,message:`Unknown ${t} error`,thrown:i});let r=i?.error_code;switch(r){case 102:case 103:case 104:return this.authorized$.next(!1),this.sessionKey=await this._authorizeWithBackoff(),s>0?a(e,s-1):void 0;case 401:return this.authorized$.next(!1),this.authToken=await this.refreshAuthToken(),this.sessionKey=await this._authorizeWithBackoff(),s>0?a(e,s-1):void 0;default:return void this.params.error$.next({id:`LogRequest#${r}`,category:u.ErrorCategory.EXTERNAL_API,message:`${t} error`,data:i})}}};return a(e)}destroy(){window.clearTimeout(this.backoffTimeoutId),this.backoffTimeoutId=0}async refreshAuthToken(){if(this.params.refreshAuthToken)return this.refreshAuthTokenPromise||(this.refreshAuthTokenPromise=(0,$i.default)(this.params.refreshAuthToken(),(()=>{this.refreshAuthTokenPromise=void 0}))),this.refreshAuthTokenPromise}createLogParams(e){let t="WEB",i=!1;if(this.params.config.useVKComIsMobileLogic){let{appVersion:e}=window.navigator;i=Ci.test(e)}else this.params.mobile&&(i=!0);return i&&(t="M_WEB"),{collector:"ok.mobile.apps.video",data:JSON.stringify({application:`@vkontakte/videoplayer-statistics:${wi}`,platform:t,items:this.params.config.shorten?e.map(Ti):e})}}_authorizeWithBackoff(){if(!this.consequentAuthErrors)return this._authorize();let e=(0,u.getExponentialDelay)(this.consequentAuthErrors,this.params.config.backoff);return new Promise((t=>{this.backoffTimeoutId||(this.backoffTimeoutId=window.setTimeout((()=>{(0,$i.default)(this._authorize().then(t).catch((e=>this.params.error$.next({id:"AuthorizeBackoff",category:u.ErrorCategory.NETWORK,message:"Otherwise unhandled error in authorization",thrown:e}))),(()=>this.backoffTimeoutId=0))}),e))}))}async _authorize(){if(this.authorizePromise)return this.authorizePromise;this.sessionKey=void 0,this.authorized$.next(!1);let e={session_data:{version:2,device_id:this.params.deviceId,client_version:wi.split("-")[0],client_type:"SDK_JS"}};return void 0!==this.authToken&&(e.session_data.auth_token=this.authToken,e.session_data.version=3),this.authorizePromise=(0,$i.default)(this.params.apiTransport.sendRequest("auth.anonymLogin",e).then((e=>((!e||!e.session_key)&&this.params.error$.next({id:"AuthorizeFailed",category:u.ErrorCategory.EXTERNAL_API,message:"No session key",data:e}),this.sessionKey=e?.session_key??void 0,this.sessionKey))).catch((async e=>{this.sessionKey=void 0;let t=e?.error_code;if(401===t)return this.authToken=await this.refreshAuthToken(),this._authorizeWithBackoff();t?this.params.error$.next({id:`Authorize#${t}`,category:u.ErrorCategory.EXTERNAL_API,message:"authorize error",data:e}):this.params.error$.next({id:"AuthorizeUnknown",category:u.ErrorCategory.NETWORK,message:"authorize error",thrown:e})})),(()=>{this.authorizePromise=void 0,this.consequentAuthErrors=this.sessionKey?0:this.consequentAuthErrors+1,this.authorized$.next(void 0!==this.sessionKey)})),this.authorizePromise}constructor(e){this.consequentAuthErrors=0,this.authorized$=new u.ValueSubject(!1),this.params=e}},Ai=class{addEventListener(e,t,i){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:i})}removeEventListener(e,t){if(!(e in this.listeners))return;let i=this.listeners[e];for(let e=0,r=i.length;e<r;e++)if(i[e].callback===t)return void i.splice(e,1)}dispatchEvent(e){if(!(e.type in this.listeners))return;let t=this.listeners[e.type].slice();for(let i=0,r=t.length;i<r;i++){let r=t[i];try{r.callback.call(this,e)}catch(e){Promise.resolve().then((()=>{throw e}))}r.options&&r.options.once&&this.removeEventListener(e.type,r.callback)}return!e.defaultPrevented}constructor(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}},Li=class extends Ai{toString(){return"[object AbortSignal]"}dispatchEvent(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}constructor(){super(),this.listeners||Ai.call(this),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(this,"reason",{value:void 0,writable:!0,configurable:!0})}},Pi=class{abort(e){let t;try{t=new Event("abort")}catch{typeof document<"u"?document.createEvent?(t=document.createEvent("Event"),t.initEvent("abort",!1,!1)):(t=document.createEventObject(),t.type="abort"):t={type:"abort",bubbles:!1,cancelable:!1}}let i=e;if(void 0===i)if(typeof document>"u")i=new Error("This operation was aborted"),i.name="AbortError";else try{i=new DOMException("signal is aborted without reason")}catch{i=new Error("This operation was aborted"),i.name="AbortError"}this.signal.reason=i,this.signal.dispatchEvent(t)}toString(){return"[object AbortController]"}constructor(){Object.defineProperty(this,"signal",{value:new Li,writable:!0,configurable:!0})}};function Mi(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}typeof Symbol<"u"&&Symbol.toStringTag&&(Pi.prototype[Symbol.toStringTag]="AbortController",Li.prototype[Symbol.toStringTag]="AbortSignal");var Ii=Mi({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}),Ri=Ii?function(e){"function"==typeof e&&(e={fetch:e});let{fetch:t,Request:i=t.Request,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:a=!1}=e;if(!Mi({fetch:t,Request:i,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:a}))return{fetch:t,Request:s};let s=i;(s&&!s.prototype.hasOwnProperty("signal")||a)&&(s=function(e,t){let r;t&&t.signal&&(r=t.signal,delete t.signal);let a=new i(e,t);return r&&Object.defineProperty(a,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),a},s.prototype=i.prototype);let n=t;return{fetch:(e,t)=>{let i=s&&s.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(i){let r;try{r=new DOMException("Aborted","AbortError")}catch{r=new Error("Aborted"),r.name="AbortError"}if(i.aborted)return Promise.reject(r);let a=new Promise(((e,t)=>{i.addEventListener("abort",(()=>t(r)),{once:!0})}));return t&&t.signal&&delete t.signal,Promise.race([a,n(e,t)])}return n(e,t)},Request:s}}({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}):void 0,Vi=Ii?Ri.fetch:window.fetch,Ni=(Ii?Ri.Request:window.Request,Ii||window.AbortController,Ii||window.AbortSignal,b(ke(),1)),Bi=b(Ot(),1),Di=class{async resolveApiBaseUrl(){if("auto"!==this.apiEnv||this.isApiBaseUrlFetched)return this.apiBaseUrl;try{let e=atob("aHR0cHM6Ly9kbnMuZ29vZ2xlL3Jlc29sdmU/bmFtZT12aWRlby5fZW5kcG9pbnQub2sucnUmdHlwZT1UWFQ="),t=(await(await Vi(e,{method:"GET",mode:"cors",cache:"no-cache"})).json())?.Answer[0]?.data;if(!t)throw new Error("Wrong DNS response");return t}catch(e){return this.params.error$.next({id:"OneStat:ApiTransport:resolveApiBaseUrl",category:u.ErrorCategory.NETWORK,message:"Unhandled resolve api base url error",thrown:e}),Si.vk_alias}finally{this.isApiBaseUrlFetched=!0}}sendBeacon(e,t,i){if(!window.Blob||!window.navigator.sendBeacon)return!1;let r=this._prepareQueryParams({method:e,queryParams:t,sessionKey:i}),a=new window.Blob([r.toString()],{type:"application/x-www-form-urlencoded"});try{return window.navigator.sendBeacon(`${this.apiBaseUrl}/fb.do`,a)}catch(i){this.params.error$.next({id:"OneStat:ApiTransport:sendBeacon",category:u.ErrorCategory.NETWORK,message:"Unhandled beacon error",thrown:i,data:{method:e,params:t}})}return!1}async sendRequest(e,t,i){let r=(0,u.now)(),a=a=>{a instanceof TypeError&&(0,Ni.default)(["Failed to fetch","NetworkError when attempting to fetch resource."],a.message)?this.params.error$.next({id:"Network",category:u.ErrorCategory.NETWORK,message:"Request failed",thrown:a}):this.params.error$.next({id:"OneStat:ApiTransport:sendRequest",category:u.ErrorCategory.NETWORK,message:"Unhandled request error",thrown:a,data:{method:e,params:t,sessionKey:i,time:(0,u.now)()-r}})};return this.apiBaseUrl=await this.resolveApiBaseUrl(),Vi(`${this.apiBaseUrl}/fb.do`,{method:"post",headers:{"Content-type":"application/x-www-form-urlencoded"},body:this._prepareQueryParams({method:e,queryParams:t,sessionKey:i})}).then((e=>{let t=0===Number(e.headers.get("content-length")),i=new Date(e.headers.get("date")??"").getTime(),s=(0,u.now)()-r;if(isFinite(i)&&this.timeSynchronisation?.addServerTime(i,s),!t)return e.json().then((e=>Object.prototype.hasOwnProperty.call(e,"error_msg")?Promise.reject(e):e),a)}),a)}_prepareQueryParams(e){let t=new URLSearchParams({format:"JSON",method:e.method,application_key:this.apiKey});return void 0!==e.sessionKey&&t.append("session_key",e.sessionKey),(0,Bi.default)(e.queryParams).forEach((([e,i])=>t.append(e,"string"==typeof i?i:JSON.stringify(i)))),t}constructor(e){this.params=e,this.apiKey=e.config.apiKey,this.apiEnv=e.config.apiEnv,this.apiBaseUrl=Si[this.apiEnv],this.timeSynchronisation=e.timeSynchronisation,this.isApiBaseUrlFetched=!1}},Oi=b(ke(),1),Fi=b(Ot(),1),ji="onestat_events",zi=e=>t=>t.timestamp+e>=(0,u.now)(),Ui=class{safeFlush(){try{this.flush()}catch(e){this.error$.next({id:"LoggerError",category:u.ErrorCategory.WTF,message:e?String(e):"Unknown logger error",thrown:e})}}readFromStorage(){let e=u.safeStorage.get(ji);try{return e?JSON.parse(e):{}}catch{}return{}}addToStorage(e){if(!this.userSalt)return void this.unsaltedStorage.push(e);let t=this.readFromStorage(),i=(t[this.userSalt]??[]).filter(zi(this.params.config.storageExpiration));u.safeStorage.set(ji,JSON.stringify({...t,[this.userSalt]:[...i,e]}))}getFromStorage(){return this.userSalt?(this.readFromStorage()[this.userSalt]??[]).filter(zi(this.params.config.storageExpiration)):this.unsaltedStorage}markStorageSent(){if(!this.userSalt)return void(this.unsaltedStorage=[]);let e=this.readFromStorage();delete e[this.userSalt],u.safeStorage.set(ji,JSON.stringify(e))}housekeepStorage(){let e=this.readFromStorage();for(let[t,i]of(0,Fi.default)(e)){let r=i.filter(zi(this.params.config.storageExpiration));r.length?e[t]=r:delete e[t],this.loggerDebugLog({message:`${i.length} retrieved from storage, ${r.length} of them actual`})}u.safeStorage.set(ji,JSON.stringify(e))}log(e){this.addToStorage(e),!this.isPaused&&(this.isUrgent(e)?this.flush():this.lastVsid!==e.custom.vsid?this.firstFlush():this.debouncedFlush(),this.lastVsid=e.custom.vsid)}flush({wantBeacon:e,clearStorage:t}={wantBeacon:!1,clearStorage:!0}){let i=this.getFromStorage();0!==i.length&&(this.api.authorized$.getValue()?(e&&this.params.config.useBeacon?(this.loggerDebugLog({message:`Flushing ${i.length} events through beacon`}),this.api.logBeacon(i)):(this.loggerDebugLog({message:`Flushing ${i.length} events`}),this.api.logRequest(i)),t&&this.markStorageSent()):this.api.authorize(),this.firstFlush.cancel(),this.debouncedFlush.cancel())}pause(){this.isPaused=!0,this.debouncedFlush.cancel()}resume(){this.isPaused=!1,this.debouncedFlush()}destroy(){this.subscription.unsubscribe(),this.firstFlush.cancel(),this.debouncedFlush.cancel()}constructor(e){this.unsaltedStorage=[],this.isPaused=!1,this.isUrgent=e=>{let{operation:t}=e;return(0,Oi.default)(["action_play","watch_coverage_record","watch_coverage_live"],t)},this.params=e,this.api=e.api,this.error$=e.error$,this.userSalt=e.userSalt,this.loggerDebugLog=e.debugLogger.createComponentLog("stat logger"),this.firstFlush=(0,u.debounceFn)((()=>this.safeFlush()),this.params.config.firstFlushTime,{maxWait:this.params.config.firstFlushTime});let t=u.safeStorage.isPersistent()?this.params.config.flushMaxWait:0;this.debouncedFlush=(0,u.debounceFn)((()=>this.safeFlush()),this.params.config.flushDebounceTime,{maxWait:t}),this.subscription=this.api.authorized$.subscribe((e=>{e&&this.debouncedFlush()})),this.housekeepStorage()}},qi=e=>e&&{[d.HttpConnectionType.HTTP1]:"http1",[d.HttpConnectionType.HTTP2]:"http2",[d.HttpConnectionType.QUIC]:"http3"}[e],Hi=e=>{if(void 0!==e)switch(e){case d.VideoFormat.MPEG:return"mp4";case d.VideoFormat.DASH:case d.VideoFormat.DASH_LIVE:case d.VideoFormat.DASH_STREAMS:return"dash";case d.VideoFormat.DASH_SEP:return"dash_sep";case d.VideoFormat.DASH_ONDEMAND:return"ondemand_dash";case d.VideoFormat.DASH_WEBM:case d.VideoFormat.DASH_LIVE_WEBM:return"webm";case d.VideoFormat.DASH_WEBM_AV1:return"av1";case d.VideoFormat.DASH_LIVE_CMAF:return"ondemand_dash_live";case d.VideoFormat.HLS:case d.VideoFormat.HLS_LIVE:return"hls";case d.VideoFormat.HLS_ONDEMAND:return"ondemand_hls";case d.VideoFormat.HLS_LIVE_CMAF:return"ondemand_hls_live";case d.VideoFormat.WEB_RTC_LIVE:return"webrtc";default:return(0,u.assertNever)(e)}},Wi=e=>{if(void 0!==e)switch(e){case d.Surface.NONE:case d.Surface.INLINE:return;case d.Surface.FULLSCREEN:return"fullscreen";case d.Surface.SECOND_SCREEN:return"chromecast";case d.Surface.PIP:return"pip";case d.Surface.INVISIBLE:return"invisible";default:return(0,u.assertNever)(e)}},Qi=e=>{switch(e){case"slow-2g":case"2g":return"poor";case"3g":return"good";case"4g":return"excellent"}},Gi=class{getOffset(){return this.offset??0}setOffset(e){this.offset=e}now(){return Date.now()+(this.offset??0)}date(e=new Date){return e.setTime(e.getTime()+(this.offset??0)),e}addServerTime(e,t){let i=e-Date.now()-t/2;Math.abs(i)<1e3?this.offset=0:void 0===this.offset?this.offset=Math.round(i):this.offset=Math.round(.2*i+.8*this.offset)}constructor(e){this.offset=void 0,this.offset=e}},Ki=b(li(),1),Yi="_one-stat_",Zi=`${Yi}uuid`,Xi=`${Yi}deviceId`,Ji=()=>{let e=new u.Subscription;return{subscription:e,subscribe:(t,i)=>{t&&e.add(t.subscribe(i))}}},er=class{updateContext(e){this.statContext={...this.statContext,...e}}attachTo(e){let t,i=new u.Subscription,r=(e,t)=>i.add(e.subscribe(t));r(e.events.willStart$,(()=>{let t=e.info.position$.getValue();this.logActionPlay({position:t}),this.statContext.projectId&&this.logActionPlayInteractive()})),r(e.events.looped$,(()=>{this.resetViewSession(),++this.loopCounter>this.config.maxLoops&&(this.disabled=!0),this.logActionPlay({position:e.info.position$.getValue()})})),r(e.events.seeked$,(()=>{this.logSeek({action:this.seekAction$.getValue(),time:e.info.position$.getValue()}),this.seekAction$.next("unknown")})),r(e.events.paused$,(()=>{this.logPause({position:e.info.position$.getValue()})})),r(e.events.willResume$,(()=>{this.logPlay()})),r(e.events.started$,(()=>{this.statContext.clip&&this.logWatchCoverageRecord({start:0,end:0})})),r(e.events.playing$,(()=>{this.logPlaying()})),r(((e,t)=>new u.Observable((i=>{let r,a=new u.Subscription,s=(0,u.merge)((0,u.fromEvent)(window,"beforeunload"),e.events.willDestruct$),n=new u.ValueSubject(void 0);a.add(e.info.isLive$.pipe((0,u.filterChanged)()).subscribe((t=>{r&&(r.unsubscribe(),n.next(void 0)),r=t?e.info.liveTime$.pipe((0,u.map)((e=>e&&e/1e3))).subscribe(n):e.info.position$.subscribe(n),a.add(r)})));let{playing$:o,paused$:l}=e.events,c=e.events.willSeek$.pipe((0,u.filter)((()=>e.info.playbackState$.getValue()===d.PlaybackState.PLAYING))),h=e.events.seeked$.pipe((0,u.filter)((()=>e.info.playbackState$.getValue()===d.PlaybackState.PLAYING))),p=!1,f=new u.Subject;a.add(c.subscribe((()=>{p||f.next(),p=!0}))),a.add(h.subscribe((()=>p=!1)));let m,v=new u.Subject,g=new u.Subject,b=(0,u.merge)(o,h,v),y=(0,u.merge)(l,f,s,e.events.looped$,g),w=()=>{g.next(),v.next()};if(a.add(b.subscribe((()=>m=n.getValue()))),a.add(y.subscribe((()=>{let e=n.getValue();(0,u.isNullable)(m)||m===e||(0,u.isNullable)(e)||(i.next({from:m,to:e}),m=void 0)}))),t.forceInterval&&isFinite(t.forceInterval)){let e=0;a.add(b.subscribe((()=>e=window.setTimeout(w,t.forceInterval)))),a.add(y.subscribe((()=>window.clearTimeout(e))))}return a})))(e,{forceInterval:this.config.watchCoverageInterval}),(t=>{let i=e.info.isLive$.getValue(),r=e.info.atLiveEdge$.getValue(),a={start:parseFloat(t.from.toFixed(3)),end:parseFloat(t.to.toFixed(3))};if(r){let t=e.info.liveLatency$.getValue()??0,i=e.info.currentBuffer$.getValue()?.end??0,r=e.info.liveBufferTime$.getValue()??0,s=Math.round(1e3*(t-(i-r))),n=Math.round(1e3*t);s&&n&&(a.latency=s,a.bufferLatency=n)}i?this.logWatchCoverageLive(a):this.logWatchCoverageRecord(a)})),r(e.info.isStalled$,(e=>{e?t=(0,u.now)():((0,u.isNonNullable)(t)&&this.logEmptyBuffer({duration:(0,u.now)()-t}),t=void 0)}));let a=!1;i.add(e.events.fatalError$.pipe((0,u.once)()).subscribe((()=>a=!0))),r(e.events.willStop$,(()=>{if(e.info.isStalled$.getValue()){let e=(0,u.isNonNullable)(t)?(0,u.now)()-t:void 0;this.logCloseAtEmptyBuffer({duration:e??0}),t=void 0}else a||this.logActionStop()})),r(e.events.managedError$,(({id:e})=>{this.logError({fatal:!1,errorType:e})})),r(e.events.fatalError$,(({id:e})=>{this.logError({fatal:!0,errorType:e})}));let s,n,o,l,c,h=!1;return r(e.events.firstBytes$,(e=>{s=(0,u.now)(),this.logFirstBytes({time:e})})),r(e.events.willStart$,(()=>n=(0,u.now)())),r(e.info.currentBuffer$,(e=>{!h&&e&&e.end-e.start>0&&(0,u.isNonNullable)(s)&&(this.logPlayerReady({duration:(0,u.now)()-s}),h=!0)})),r(e.events.firstFrame$,(()=>{(0,u.isNonNullable)(s)&&!h&&(this.logPlayerReady({duration:(0,u.now)()-s}),h=!0),(0,u.isNonNullable)(n)&&this.logFirstFrame({time:(0,u.now)()-n})})),r(e.info.currentVideoStream$,(e=>{e&&(o&&e.id!==o&&this.logTrackSwitch(e),o=e.id)})),r(e.info.currentAudioStream$,(e=>{e&&(l&&e.id!==l&&this.logTrackSwitch(e),l=e.id)})),r(e.info.atLiveEdge$,(e=>this.updateContext({liveEdge:e}))),r((0,u.combine)({muted:e.info.muted$,volume:e.info.volume$}),(({muted:e,volume:t})=>this.updateContext({audible:!e&&t>0}))),r(e.info.currentQuality$,(e=>{let t=(i=e)&&{[d.VideoQuality.INVARIANT]:"unknown",[d.VideoQuality.Q_144P]:"mobile",[d.VideoQuality.Q_240P]:"lowest",[d.VideoQuality.Q_360P]:"low",[d.VideoQuality.Q_480P]:"medium",[d.VideoQuality.Q_576P]:"unknown",[d.VideoQuality.Q_720P]:"high",[d.VideoQuality.Q_1080P]:"fullhd",[d.VideoQuality.Q_1440P]:"quadhd",[d.VideoQuality.Q_2160P]:"ultrahd",[d.VideoQuality.Q_4320P]:"unknown"}[i];var i;this.updateContext({quality:t}),t&&this.logQuality(t)})),r(e.info.isAutoQualityEnabled$,(e=>this.updateContext({autoQuality:e}))),r(e.info.currentFormat$,(e=>this.updateContext({contentType:Hi(e)}))),r(e.info.currentPlaybackRate$,(e=>this.updateContext({rate:e}))),r(e.info.is3DVideo$,(e=>this.updateContext({is3d:e}))),r(e.info.hostname$,(e=>{let t=void 0!==c&&c!==e;this.updateContext({cdnHostname:e,failover:t}),t&&this.logFailover(e),c=e})),r(e.info.throughputEstimation$,(e=>this.updateContext({downloadSpeed:e}))),r(e.info.httpConnectionType$,(e=>{this.statContext.firstConnectionType||this.updateContext({firstConnectionType:qi(e)}),this.updateContext({connectionType:qi(e)})})),r(e.info.httpConnectionReused$,(e=>{(0,u.isNullable)(this.statContext.firstConnectionReused)&&this.updateContext({firstConnectionReused:e}),this.updateContext({connectionReused:e})})),r(e.info.surface$,(e=>this.updateContext({mode:Wi(e)}))),r((0,u.combine)({current:e.info.currentTextTrack$,available:e.info.availableTextTracks$}),(({current:e,available:t})=>{let i=t.find((({id:t})=>t===e)),r=i&&(i.isAuto?`${i.language}_auto`:i.language);this.updateContext({subtitles:r?.split(".")[0]})})),this.player=e,this.uiEvents&&this.attachToUi(this.uiEvents),this.resubscribeBeforeunload(),this.subscription.add(i),i}attachToUi(e){this.uiEvents=e;let{subscription:t,subscribe:i}=Ji();return this.player&&(i(e.actionRewind$,(()=>{this.player&&(this.resetViewSession(),this.logActionPlay({position:this.player.info.position$.getValue()}))})),i(e.actionSeek$,this.seekAction$),i(e.inPiP$,(e=>{let t=e?"pip":Wi(this.player?.info.surface$.getValue());this.updateContext({mode:t})})),i(e.inFullscreen$,(e=>{let t=e?"fullscreen":Wi(this.player?.info.surface$.getValue());this.updateContext({mode:t})})),i(e.actionSetSubtitle$,(e=>this.updateContext({subtitles:e.split(".")[0]}))),i(e.nextMovie$,(e=>this.logNextMovie(e))),this.resubscribeBeforeunload(),this.subscription.add(t)),t}attachToAds(e){let{subscription:t,subscribe:i}=Ji();return i(e.slotRequested$,(()=>this.logAdSlotRequest())),i(e.started$,(e=>this.logAdStarted(e))),i(e.paused$,(()=>this.logAdPaused())),i(e.resumed$,(()=>this.logAdResumed())),i(e.ended$,(()=>this.logAdEnded())),i(e.skipped$,(()=>this.logAdSkipped())),i(e.clicked$,(()=>this.logAdClicked())),i(e.error$,(e=>this.logError({errorType:e,fatal:!1}))),this.resubscribeBeforeunload(),this.subscription.add(t),t}attachToInteractive(e){let{subscription:t,subscribe:i}=Ji();return i(e.click$,(e=>this.logInterfaceClick(e))),i(e.nextMovie$,(e=>this.logNextMovie(e))),this.resubscribeBeforeunload(),this.subscription.add(t),t}authorize(e){return this.api.authorize(e)}pause(){this.logger.pause(),this.oneStatDebugLog({message:"paused"})}resume(){this.logger.resume(),this.oneStatDebugLog({message:"resumed"})}destroy(){this.logger.flush(),this.subscription.unsubscribe(),this.api.destroy(),this.logger.destroy()}resetViewSession(){this.oneStatDebugLog({message:"VSID reset"}),this.vsid$.next((0,Ki.default)(Math.floor(Math.random()*2**32).toString(36),7,"0"))}getDeviceId(){return this.deviceId}setFieldBlacklist(){}logInited(){}logReady(e){this.log({operation:"player_ready",param:String(e.time)})}logStarted(...e){this.logActionPlay(...e)}logPlay(){this.log({operation:"play_toggle"})}logPlaying(){this.log({operation:"playing"})}logPause(e){this.log({operation:"pause",param:String(Math.round(e.position))})}logSeek(e){this.log({operation:"seek",param:e.action,time:e.time})}logFirstBytes(e){this.log({operation:"first_bytes",param:String(e.time)})}logFirstFrame(e){this.log({operation:"first_frame",param:String(e.time)})}logError(e){this.log({operation:"content_error",param:`${e.fatal?"fatal":"recoverable"}_${e.errorType}`})}logWatchCoverageRecord(e){this.log({operation:"watch_coverage_record",param:`${e.start}-${e.end}`},{in_history:this.statContext.inHistory?1:void 0})}logWatchCoverageLive(e){let t=this.timeSynchronisation?.getOffset()??0,i=e.start+t,r=e.end+t;this.log({operation:"watch_coverage_live",param:`${i}-${r}`},{in_history:this.statContext.inHistory?1:void 0,latency:e.latency,buffer_latency:e.bufferLatency})}logEmptyBuffer(e){this.log({operation:"empty_buffer",param:String(e.duration)})}logDownloadSpeed(){}logAdSlotRequest(){this.log({operation:"adv",param:"slot_request"})}logAdStarted(e){this.log({operation:"adv",param:e})}logAdPaused(){this.log({operation:"adv",param:"pause"})}logAdResumed(){this.log({operation:"adv",param:"resume"})}logAdEnded(){this.log({operation:"adv",param:"ended"})}logAdSkipped(){this.log({operation:"adv",param:"skip"})}logAdClicked(){this.log({operation:"adv",param:"click"})}logInterfaceClick(e){this.log({operation:"player_interface_click",param:e})}logNextMovie(e){this.log({operation:"next_movie",param:String(e)})}subscribe(){this.resubscribeBeforeunload();let e=window.navigator.connection;e&&"onchange"in e&&"effectiveType"in e&&this.subscription.add((0,u.merge)((0,u.fromEvent)(e,"change"),(0,u.observableFrom)(["init"])).subscribe((()=>this.updateContext({network:Qi(e.effectiveType)})))),this.config.debugLog&&this.debugLogger.log$.subscribe((e=>{console.debug("%c stat ","background:#fa6470;",`component: ${e.component}.`,e.message)}))}resubscribeBeforeunload(){this.beforeunloadSubscription?.unsubscribe(),this.beforeunloadSubscription=(0,u.fromEvent)(window,"beforeunload").subscribe((()=>this.logger.flush({wantBeacon:!0,clearStorage:this.config.clearStorageAtUnload}))),this.subscription.add(this.beforeunloadSubscription)}logPlayerReady(e){this.log({operation:"player_ready",param:String(Math.round(e.duration))})}logActionPlay(e){this.log({operation:"action_play",param:String(Math.round(e.position))})}logActionPlayInteractive(){this.statContext.projectId&&this.log({operation:"action_play_interactive",param:String(this.statContext.movieId)},{vid:this.statContext.projectId})}logFailover(e){this.log({operation:"failover",param:e})}logCloseAtEmptyBuffer(e){this.log({operation:"close_at_empty_buffer",param:String(Math.round(e.duration))})}logActionStop(){this.log({operation:"action_stop"})}logTrackSwitch(e){this.log({operation:"track_switch",param:e.id})}logQuality(e){this.log({operation:"quality",param:e})}log(e,t={}){if(this.disabled)return void this.oneStatDebugLog({message:`operation ${e.operation} but statistics is disabled`});if((0,ui.default)(this.config.disabledOperations,e.operation))return void this.oneStatDebugLog({message:`operation ${e.operation} but it is disabled`});this.oneStatDebugLog({message:`operation ${e.operation} ${e.param}`});let i=this.createLogItem(e,t);this.logger.log(i)}createLogItem({operation:e,param:t,time:i},r={}){let a=this.timeSynchronisation?.now()??(0,u.now)(),s=this.vsid$.getValue();(0,u.assertNonNullable)(s);let n,o,l=this.isid$.getValue(),d="empty_buffer"===e||"close_at_empty_buffer"===e?this.statContext.connectionType:this.statContext.firstConnectionType,c=this.statContext.firstConnectionReused;if(this.isEmbed||"embed"===this.statContext.place){n=this.embedParent;let e=[...new URLSearchParams(location.search).entries()].filter((([e,t])=>(0,ui.default)(this.config.embedUrlParams,e)));o=new URLSearchParams(e).toString()}else"direct"===this.statContext.place&&(this.statContext.refDomain?n=(0,u.createURL)(this.statContext.refDomain)?.hostname??this.statContext.refDomain:document.referrer&&(n=(0,u.createURL)(document.referrer)?.hostname??document.referrer),o=location.href.substring(0,1024));let h={vsid:s,isid:l,vid:this.statContext.movieId,uid:this.zenUid$.getValue(),ct:this.statContext.contentType,place:this.isEmbed?"embed":this.statContext.place,quality:this.statContext.quality,cdn_host:this.statContext.cdnHostname,stat_type:!0===this.statContext.autoplay?"auto":!1===this.statContext.autoplay?"":void 0,param:t,vk_app_id:this.statContext.vkAppId,track_code:this.statContext.trackCode,connection_type:d,connection_reused:!0===c?1:!1===c?0:void 0,cached_data:!0===this.statContext.cached?1:!1===this.statContext.cached?0:void 0,live:this.statContext.liveEdge?1:void 0,muted:!1===this.statContext.audible?1:void 0,mode:this.statContext.mode,subtitles:this.statContext.subtitles,download_speed:this.statContext.downloadSpeed,manual_quality:this.statContext.autoQuality?void 0:1,ref_domain:n,direct_url:o,rate:1===this.statContext.rate||(0,u.isNullable)(this.statContext.rate)?void 0:this.statContext.rate.toFixed(2),view_360:this.statContext.is3d?1:void 0,aid:this.statContext.albumId,vk_playlist_id:this.statContext.vkPlaylistId,...r};for(let e of this.config.disabledCustomFields)delete h[e];return{operation:e,type:1,time:i,network:this.statContext.network,timestamp:a,custom:h}}constructor(e,t){var i;this.subscription=new u.Subscription,this.debugLogger=new u.Logger,this.oneStatDebugLog=this.debugLogger.createComponentLog("onestat"),this.loopCounter=0,this.disabled=!1,this.vsid$=new u.ValueSubject(void 0),this.isid$=new u.ValueSubject(void 0),this.zenUid$=new u.ValueSubject(void 0),this.seekAction$=new u.ValueSubject("unknown"),this.statContext=e,this.config=(i=t.config??{},(0,u.fillWithDefault)(i,xi)),(0,u.isNonNullable)(t.apiEnv)&&(this.config.apiEnv=t.apiEnv),this.config.synchronizeTime&&(this.timeSynchronisation=new Gi);let r=new u.Subject;this.experimental={error$:r},u.safeStorage.get(Zi)&&u.safeStorage.remove(Zi);let a=u.safeStorage.get(Xi);this.statContext.deviceId?this.deviceId=this.statContext.deviceId:a?this.deviceId=a:(this.deviceId=function(){let e,t,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=new Array(36),a=0;for(t=0;t<36;t++)8===t||13===t||18===t||23===t?r[t]="-":14===t?r[t]="4":(a<=2&&(a=33554432+16777216*Math.random()|0),e=15&a,a>>=4,r[t]=i[19===t?3&e|8:e]);return r.join("")}(),u.safeStorage.set(Xi,this.deviceId)),this.resetViewSession(),t.useIsid&&this.isid$.next(t.isid??(0,Ki.default)(Math.floor(Math.random()*2**64).toString(36),13,"0")),this.zenUid$.next(t.zenUid);let s=new Di({config:this.config,error$:r,timeSynchronisation:this.timeSynchronisation});this.api=new Ei({config:this.config,apiTransport:s,refreshAuthToken:t.refreshAuthToken,mobile:this.statContext.mobile??!1,deviceId:this.deviceId,error$:r}),this.logger=new Ui({config:this.config,debugLogger:this.debugLogger,api:this.api,error$:r,userSalt:t.userSalt});let{isEmbed:n,topOrigin:o}=(0,u.detectEmbed)();this.isEmbed=n,this.embedParent=o?new URL(o).hostname:void 0,this.subscribe()}}},317929:(e,t,i)=>{i.d(t,{ControlButtonType:()=>hd,GridTypes:()=>Ma,VERSION:()=>Va,VideoFormat:()=>f.VideoFormat,registerPlayerWebComponent:()=>hv});var r,a,s,n,o,l,u,d,c,h=i(434518),p=i(763812),f=i(773439),m=i(819705),v=i(89923),g="[!",b={},y=Symbol(),w=Symbol("filename"),S=(Symbol("hmr"),globalThis.process?.env?.NODE_ENV),x=S&&!S.toLowerCase().startsWith("prod"),$=Symbol("$state"),_=Symbol("$state metadata"),k=Symbol("legacy props"),T=Symbol(""),C=Array.isArray,E=Array.prototype.indexOf,A=Array.from,L=Object.keys,P=Object.defineProperty,M=Object.getOwnPropertyDescriptor,I=Object.getOwnPropertyDescriptors,R=Object.prototype,V=Array.prototype,N=Object.getPrototypeOf;function B(e){return"function"==typeof e}var D=()=>{};function O(e){return e()}function F(e){for(var t=0;t<e.length;t++)e[t]()}var j=[],z=[];function U(){var e=j;j=[],F(e)}function q(e){0===j.length&&queueMicrotask(U),j.push(e)}function H(){var e;j.length>0&&U(),z.length>0&&(e=z,z=[],F(e))}function W(e){return e===this.v}function Q(e,t){return e!=e?t==t:e!==t||null!==e&&"object"==typeof e||"function"==typeof e}function G(e,t){return e!==t}function K(e){return!Q(e,this.v)}var Y=!1;var Z=new Set,X=new Map;function J(e){Z=e}function ee(e,t){var i={f:0,v:e,reactions:null,equals:W,rv:0,wv:0};return i}function te(e){return function(e){return null!==Ke&&!Ye&&!!(2&Ke.f)&&(null===et?function(e){et=e}([e]):et.push(e)),e}(ee(e))}function ie(e,t=!1){var i;let r=ee(e);return t||(r.equals=K),Y&&null!==ni&&null!==ni.l&&((i=ni.l).s??(i.s=[])).push(r),r}function re(e,t){return null!==Ke&&!Ye&&mi()&&!!(18&Ke.f)&&(null===et||!et.includes(e))&&function(){if(x){let e=new Error("state_unsafe_mutation\nUpdating state inside a derived or a template expression is forbidden. If the value should not be reactive, declare it without `$state`\nhttps://svelte.dev/e/state_unsafe_mutation");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/state_unsafe_mutation")}(),ae(e,t)}function ae(e,t){if(!e.equals(t)){var i=e.v;if(He?X.set(e,t):X.set(e,i),e.v=t,e.wv=lt(),se(e,2048),mi()&&null!==Xe&&!!(1024&Xe.f)&&!(96&Xe.f)&&(null===rt?function(e){rt=e}([e]):rt.push(e)),x&&Z.size>0){let e=Array.from(Z);for(let t of e)!!(1024&t.f)&&At(t,4096),ut(t)&&gt(t);Z.clear()}}return t}function se(e,t){var i=e.reactions;if(null!==i)for(var r=mi(),a=i.length,s=0;s<a;s++){var n=i[s],o=n.f;if(!(2048&o)&&(r||n!==Xe)){if(x&&262144&o){Z.add(n);continue}At(n,t),1280&o&&(2&o?se(n,4096):xt(n))}}}function ne(e){var t=2050,i=null!==Ke&&2&Ke.f?Ke:null;null===Xe||null!==i&&256&i.f?t|=256:Xe.f|=1048576;let r={ctx:ni,deps:null,effects:null,equals:W,f:t,fn:e,reactions:null,rv:0,v:null,wv:0,parent:i??Xe};return r}function oe(e){let t=ne(e);return t.equals=K,t}function le(e){var t=e.effects;if(null!==t){e.effects=null;for(var i=0;i<t.length;i+=1)zt(t[i])}}var ue=[];function de(e){var t,i=Xe;if(Je(function(e){for(var t=e.parent;null!==t;){if(!(2&t.f))return t;t=t.parent}return null}(e)),x){let r=Z;J(new Set);try{ue.includes(e)&&function(){if(x){let e=new Error("derived_references_self\nA derived value cannot reference itself recursively\nhttps://svelte.dev/e/derived_references_self");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/derived_references_self")}(),ue.push(e),le(e),t=ft(e)}finally{Je(i),J(r),ue.pop()}}else try{le(e),t=ft(e)}finally{Je(i)}return t}function ce(e){var t=de(e);At(e,(nt||256&e.f)&&null!==e.deps?4096:1024),e.equals(t)||(e.v=t,e.wv=lt())}var he="font-weight: bold",pe="font-weight: normal";function fe(e){x?console.warn(`%c[svelte] hydration_mismatch\n%c${e?`Hydration failed because the initial UI does not match what was rendered on the server. The error occurred near ${e}`:"Hydration failed because the initial UI does not match what was rendered on the server"}\nhttps://svelte.dev/e/hydration_mismatch`,he,pe):console.warn("https://svelte.dev/e/hydration_mismatch")}function me(e,t){x?console.warn(`%c[svelte] ownership_invalid_mutation\n%c${e?`${e} mutated a value owned by ${t}. This is strongly discouraged. Consider passing values to child components with \`bind:\`, or use a callback instead`:"Mutating a value outside the component that created it is strongly discouraged. Consider passing values to child components with `bind:`, or use a callback instead"}\nhttps://svelte.dev/e/ownership_invalid_mutation`,he,pe):console.warn("https://svelte.dev/e/ownership_invalid_mutation")}function ve(e){x?console.warn(`%c[svelte] state_proxy_equality_mismatch\n%cReactive \`$state(...)\` proxies and the values they proxy have different identities. Because of this, comparisons with \`${e}\` will produce unexpected results\nhttps://svelte.dev/e/state_proxy_equality_mismatch`,he,pe):console.warn("https://svelte.dev/e/state_proxy_equality_mismatch")}var ge,be,ye,we,Se,xe=!1;function $e(e){xe=e}function _e(e){if(null===e)throw fe(),b;return ge=e}function ke(){return _e(Ve(ge))}function Te(e){if(xe){if(null!==Ve(ge))throw fe(),b;ge=e}}function Ce(e=1){if(xe){for(var t=e,i=ge;t--;)i=Ve(i);ge=i}}function Ee(){for(var e=0,t=ge;;){if(8===t.nodeType){var i=t.data;if("]"===i){if(0===e)return t;e-=1}else("["===i||i===g)&&(e+=1)}var r=Ve(t);t.remove(),t=r}}function Ae(e,t=null,i){if("object"!=typeof e||null===e||$ in e)return e;let r=N(e);if(r!==R&&r!==V)return e;var a,s=new Map,n=C(e),o=ee(0);if(n&&s.set("length",ee(e.length)),x)if(a={parent:t,owners:null},i){let e=i.v?.[_]?.owners;a.owners=e?new Set(e):null}else a.owners=null===t?null!==ni?new Set([ni.function]):null:new Set;return new Proxy(e,{defineProperty(e,t,i){(!("value"in i)||!1===i.configurable||!1===i.enumerable||!1===i.writable)&&function(){if(x){let e=new Error("state_descriptors_fixed\nProperty descriptors defined on `$state` objects must contain `value` and always be `enumerable`, `configurable` and `writable`.\nhttps://svelte.dev/e/state_descriptors_fixed");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/state_descriptors_fixed")}();var r=s.get(t);return void 0===r?(r=ee(i.value),s.set(t,r)):re(r,Ae(i.value,a)),!0},deleteProperty(e,t){var i=s.get(t);if(void 0===i)t in e&&s.set(t,ee(y));else{if(n&&"string"==typeof t){var r=s.get("length"),a=Number(t);Number.isInteger(a)&&a<r.v&&re(r,a)}re(i,y),Le(o)}return!0},get(t,i,r){if(x&&i===_)return a;if(i===$)return e;var n=s.get(i),o=i in t;if(void 0===n&&(!o||M(t,i)?.writable)&&(n=ee(Ae(o?t[i]:y,a)),s.set(i,n)),void 0!==n){var l=Tt(n);if(x){var u=l?.[_];u&&u?.parent!==a&&ei(a,u)}return l===y?void 0:l}return Reflect.get(t,i,r)},getOwnPropertyDescriptor(e,t){var i=Reflect.getOwnPropertyDescriptor(e,t);if(i&&"value"in i){var r=s.get(t);r&&(i.value=Tt(r))}else if(void 0===i){var a=s.get(t),n=a?.v;if(void 0!==a&&n!==y)return{enumerable:!0,configurable:!0,value:n,writable:!0}}return i},has(e,t){if(x&&t===_||t===$)return!0;var i=s.get(t),r=void 0!==i&&i.v!==y||Reflect.has(e,t);if((void 0!==i||null!==Xe&&(!r||M(e,t)?.writable))&&(void 0===i&&(i=ee(r?Ae(e[t],a):y),s.set(t,i)),Tt(i)===y))return!1;return r},set(e,t,i,r){var l=s.get(t),u=t in e;if(n&&"length"===t)for(var d=i;d<l.v;d+=1){var c=s.get(d+"");void 0!==c?re(c,y):d in e&&(c=ee(y),s.set(d+"",c))}if(void 0===l?(!u||M(e,t)?.writable)&&(re(l=ee(void 0),Ae(i,a)),s.set(t,l)):(u=l.v!==y,re(l,Ae(i,a))),x){var h=i?.[_];h&&h?.parent!==a&&ei(a,h),function(e){if(ai)return;let t=function(){let e=function(){let e=(new Error).stack;if(!e)return null;let t=[];for(let i of e.split("\n")){let e=Yt.exec(i)??Zt.exec(i);e&&t.push({file:e[1],line:+e[2],column:+e[3]})}return t}()?.slice(4);if(!e)return null;for(let t=0;t<e.length;t++){let i=e[t],r=Kt[i.file];if(r)for(let e of r){if(null==e.end)return null;if(e.start.line<i.line&&e.end.line>i.line)return e.component}else if(0===t)return null}return null}();if(t&&!ii(e,t)){let i=ri(e);i[w]!==t[w]?me(t[w],i[w]):me()}}(a)}var p=Reflect.getOwnPropertyDescriptor(e,t);if(p?.set&&p.set.call(r,i),!u){if(n&&"string"==typeof t){var f=s.get("length"),m=Number(t);Number.isInteger(m)&&m>=f.v&&re(f,m+1)}Le(o)}return!0},ownKeys(e){Tt(o);var t=Reflect.ownKeys(e).filter((e=>{var t=s.get(e);return void 0===t||t.v!==y}));for(var[i,r]of s)r.v!==y&&!(i in e)&&t.push(i);return t},setPrototypeOf(){!function(){if(x){let e=new Error("state_prototype_fixed\nCannot set prototype of `$state` object\nhttps://svelte.dev/e/state_prototype_fixed");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/state_prototype_fixed")}()}})}function Le(e,t=1){re(e,e.v+t)}function Pe(e){return null!==e&&"object"==typeof e&&$ in e?e[$]:e}function Me(){if(void 0===be){be=window,document,ye=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype;we=M(t,"firstChild").get,Se=M(t,"nextSibling").get,e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0,Text.prototype.__t=void 0,x&&(e.__svelte_meta=null,function(){let e=Array.prototype,t=Array.__svelte_cleanup;t&&t();let{indexOf:i,lastIndexOf:r,includes:a}=e;e.indexOf=function(e,t){let r=i.call(this,e,t);if(-1===r)for(let i=t??0;i<this.length;i+=1)if(Pe(this[i])===e){ve("array.indexOf(...)");break}return r},e.lastIndexOf=function(e,t){let i=r.call(this,e,t??this.length-1);if(-1===i)for(let i=0;i<=(t??this.length-1);i+=1)if(Pe(this[i])===e){ve("array.lastIndexOf(...)");break}return i},e.includes=function(e,t){let i=a.call(this,e,t);if(!i)for(let t=0;t<this.length;t+=1)if(Pe(this[t])===e){ve("array.includes(...)");break}return i},Array.__svelte_cleanup=()=>{e.indexOf=i,e.lastIndexOf=r,e.includes=a}}())}}function Ie(e=""){return document.createTextNode(e)}function Re(e){return we.call(e)}function Ve(e){return Se.call(e)}function Ne(e,t){if(!xe)return Re(e);var i=Re(ge);if(null===i)i=ge.appendChild(Ie());else if(t&&3!==i.nodeType){var r=Ie();return i?.before(r),_e(r),r}return _e(i),i}function Be(e,t){if(!xe){var i=Re(e);return 8===i.nodeType&&""===i.data?Ve(i):i}if(t&&3!==ge?.nodeType){var r=Ie();return ge?.before(r),_e(r),r}return ge}function De(e,t=1,i=!1){let r=xe?ge:e;for(var a;t--;)a=r,r=Ve(r);if(!xe)return r;var s=r?.nodeType;if(i&&3!==s){var n=Ie();return null===r?a?.after(n):r.before(n),_e(n),n}return _e(r),r}function Oe(e){e.textContent=""}var Fe=new WeakSet,je=!1,ze=!1,Ue=null,qe=!1,He=!1;function We(e){He=e}var Qe=[],Ge=[],Ke=null,Ye=!1;function Ze(e){Ke=e}var Xe=null;function Je(e){Xe=e}var et=null;var tt=null,it=0,rt=null;var at=1,st=0,nt=!1,ot=null;function lt(){return++at}function ut(e){var t=e.f;if(2048&t)return!0;if(4096&t){var i=e.deps,r=!!(256&t);if(null!==i){var a,s,n=!!(512&t),o=r&&null!==Xe&&!nt,l=i.length;if(n||o){var u,d=e,c=d.parent;for(a=0;a<l;a++)s=i[a],(n||!s?.reactions?.includes(d))&&((u=s).reactions??(u.reactions=[])).push(d);n&&(d.f^=512),o&&null!==c&&!(256&c.f)&&(d.f^=256)}for(a=0;a<l;a++)if(ut(s=i[a])&&ce(s),s.wv>e.wv)return!0}(!r||null!==Xe&&!nt)&&At(e,1024)}return!1}function dt(e,t){for(var i=t;null!==i;){if(128&i.f)try{return void i.fn(e)}catch{i.f^=128}i=i.parent}throw je=!1,e}function ct(e){return!(16384&e.f||null!==e.parent&&128&e.parent.f)}function ht(e,t,i,r){if(je){if(null===i&&(je=!1),ct(t))throw e;return}if(null!==i&&(je=!0),!x||null===r||!(e instanceof Error)||Fe.has(e))return void dt(e,t);Fe.add(e);let a=[],s=t.fn?.name;s&&a.push(s);let n=r;for(;null!==n;){if(x){var o=n.function?.[w];if(o){let e=o.split("/").pop();a.push(e)}}n=n.p}let l=ye?"  ":"\t";P(e,"message",{value:e.message+`\n${a.map((e=>`\n${l}in ${e}`)).join("")}\n`}),P(e,"component_stack",{value:a});let u=e.stack;if(u){let t=u.split("\n"),i=[];for(let e=0;e<t.length;e++){let r=t[e];r.includes("svelte/src/internal")||i.push(r)}P(e,"stack",{value:i.join("\n")})}if(dt(e,t),ct(t))throw e}function pt(e,t,i=!0){var r=e.reactions;if(null!==r)for(var a=0;a<r.length;a++){var s=r[a];2&s.f?pt(s,t,!1):t===s&&(i?At(s,2048):!!(1024&s.f)&&At(s,4096),xt(s))}}function ft(e){var t=tt,i=it,r=rt,a=Ke,s=nt,n=et,o=ni,l=Ye,u=e.f;tt=null,it=0,rt=null,nt=!!(256&u)&&(Ye||!qe||null===Ke),Ke=96&u?null:e,et=null,oi(e.ctx),Ye=!1,st++;try{var d=(0,e.fn)(),c=e.deps;if(null!==tt){var h,p;if(vt(e,it),null!==c&&it>0)for(c.length=it+tt.length,p=0;p<tt.length;p++)c[it+p]=tt[p];else e.deps=c=tt;if(!nt)for(p=it;p<c.length;p++)((h=c[p]).reactions??(h.reactions=[])).push(e)}else null!==c&&it<c.length&&(vt(e,it),c.length=it);if(mi()&&null!==rt&&!Ye&&null!==c&&!(6146&e.f))for(p=0;p<rt.length;p++)pt(rt[p],e);return null!==a&&(st++,null!==rt&&(null===r?r=rt:r.push(...rt))),d}finally{tt=t,it=i,rt=r,Ke=a,nt=s,et=n,oi(o),Ye=l}}function mt(e,t){let i=t.reactions;if(null!==i){var r=E.call(i,e);if(-1!==r){var a=i.length-1;0===a?i=t.reactions=null:(i[r]=i[a],i.pop())}}null===i&&2&t.f&&(null===tt||!tt.includes(t))&&(At(t,4096),!(768&t.f)&&(t.f^=512),le(t),vt(t,0))}function vt(e,t){var i=e.deps;if(null!==i)for(var r=t;r<i.length;r++)mt(e,i[r])}function gt(e){var t=e.f;if(!(16384&t)){At(e,1024);var i=Xe,r=ni,a=qe;if(Xe=e,qe=!0,x){var s=li;ui(e.component_function)}try{16&t?function(e){for(var t=e.first;null!==t;){var i=t.next;!(32&t.f)&&zt(t),t=i}}(e):jt(e),Ft(e);var n=ft(e);e.teardown="function"==typeof n?n:null,e.wv=at;e.deps;x&&Ge.push(e)}catch(t){ht(t,e,i,r||e.ctx)}finally{qe=a,Xe=i,x&&ui(s)}}}function bt(){console.error("Last ten effects were: ",Ge.slice(-10).map((e=>e.fn))),Ge=[]}function yt(){try{!function(){if(x){let e=new Error("effect_update_depth_exceeded\nMaximum update depth exceeded. This can happen when a reactive block or effect repeatedly sets a new value. Svelte limits the number of nested updates to prevent infinite loops\nhttps://svelte.dev/e/effect_update_depth_exceeded");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}()}catch(e){if(x&&P(e,"stack",{value:""}),null===Ue)throw x&&bt(),e;if(x)try{ht(e,Ue,null,null)}catch(e){throw bt(),e}else ht(e,Ue,null,null)}}function wt(){var e=qe;try{var t=0;for(qe=!0;Qe.length>0;){t++>1e3&&yt();var i=Qe,r=i.length;Qe=[];for(var a=0;a<r;a++){St($t(i[a]))}}}finally{ze=!1,qe=e,Ue=null,x&&(Ge=[]),X.clear()}}function St(e){var t=e.length;if(0!==t)for(var i=0;i<t;i++){var r=e[i];if(!(24576&r.f))try{ut(r)&&(gt(r),null===r.deps&&null===r.first&&null===r.nodes_start&&(null===r.teardown?Ut(r):r.fn=null))}catch(e){ht(e,r,null,r.ctx)}}}function xt(e){ze||(ze=!0,queueMicrotask(wt));for(var t=Ue=e;null!==t.parent;){var i=(t=t.parent).f;if(96&i){if(!(1024&i))return;t.f^=1024}}Qe.push(t)}function $t(e){for(var t=[],i=e;null!==i;){var r=i.f,a=!!(96&r);if(!(a&&!!(1024&r)||8192&r)){if(4&r)t.push(i);else if(a)i.f^=1024;else{var s=Ke;try{Ke=i,ut(i)&&gt(i)}catch(e){ht(e,i,null,i.ctx)}finally{Ke=s}}var n=i.first;if(null!==n){i=n;continue}}var o=i.parent;for(i=i.next;null===i&&null!==o;)i=o.next,o=o.parent}return t}function _t(e){var t;for(e&&(ze=!0,wt(),t=e()),H();Qe.length>0;)ze=!0,wt(),H();return t}async function kt(){await Promise.resolve(),_t()}function Tt(e){var t=!!(2&e.f);if(null!==ot&&ot.add(e),null===Ke||Ye){if(t&&null===e.deps&&null===e.effects){var i=e,r=i.parent;null!==r&&!(256&r.f)&&(i.f^=256)}}else{null!==et&&et.includes(e)&&function(){if(x){let e=new Error("state_unsafe_local_read\nReading state that was created inside the same derived is forbidden. Consider using `untrack` to read locally created state\nhttps://svelte.dev/e/state_unsafe_local_read");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/state_unsafe_local_read")}();var a=Ke.deps;e.rv<st&&(e.rv=st,null===tt&&null!==a&&a[it]===e?it++:null===tt?tt=[e]:(!nt||!tt.includes(e))&&tt.push(e))}return t&&(ut(i=e)&&ce(i)),He&&X.has(e)?X.get(e):e.v}function Ct(e){var t=Ye;try{return Ye=!0,e()}finally{Ye=t}}var Et=-7169;function At(e,t){e.f=e.f&Et|t}function Lt(e,t=new Set){if(!("object"!=typeof e||null===e||e instanceof EventTarget||t.has(e))){t.add(e),e instanceof Date&&e.getTime();for(let i in e)try{Lt(e[i],t)}catch{}let i=N(e);if(i!==Object.prototype&&i!==Array.prototype&&i!==Map.prototype&&i!==Set.prototype&&i!==Date.prototype){let t=I(i);for(let i in t){let r=t[i].get;if(r)try{r.call(e)}catch{}}}}}function Pt(e){null===Xe&&null===Ke&&function(e){if(x){let t=new Error(`effect_orphan\n\`${e}\` can only be used inside an effect (e.g. during component initialisation)\nhttps://svelte.dev/e/effect_orphan`);throw t.name="Svelte error",t}throw new Error("https://svelte.dev/e/effect_orphan")}(e),null!==Ke&&!!(256&Ke.f)&&null===Xe&&function(){if(x){let e=new Error("effect_in_unowned_derived\nEffect cannot be created inside a `$derived` value that was not itself created inside an effect\nhttps://svelte.dev/e/effect_in_unowned_derived");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}(),He&&function(e){if(x){let t=new Error(`effect_in_teardown\n\`${e}\` cannot be used inside an effect cleanup function\nhttps://svelte.dev/e/effect_in_teardown`);throw t.name="Svelte error",t}throw new Error("https://svelte.dev/e/effect_in_teardown")}(e)}function Mt(e,t,i,r=!0){var a=Xe;if(x)for(;null!==a&&262144&a.f;)a=a.parent;var s,n={ctx:ni,deps:null,nodes_start:null,nodes_end:null,f:2048|e,first:null,fn:t,last:null,next:null,parent:a,prev:null,teardown:null,transitions:null,wv:0};if(x&&(n.component_function=li),i)try{gt(n),n.f|=32768}catch(e){throw zt(n),e}else null!==t&&xt(n);!(i&&null===n.deps&&null===n.first&&null===n.nodes_start&&null===n.teardown&&!(1048704&n.f))&&r&&(null!==a&&function(e,t){var i=t.last;null===i?t.last=t.first=e:(i.next=e,e.prev=i,t.last=e)}(n,a),null!==Ke&&2&Ke.f)&&((s=Ke).effects??(s.effects=[])).push(n);return n}function It(e){let t=Mt(8,null,!1);return At(t,1024),t.teardown=e,t}function Rt(e){Pt("$effect");var t,i=null!==Xe&&!!(32&Xe.f)&&null!==ni&&!ni.m;if(x&&P(e,"name",{value:"$effect"}),!i)return Vt(e);((t=ni).e??(t.e=[])).push({fn:e,effect:Xe,reaction:Ke})}function Vt(e){return Mt(4,e,!1)}function Nt(e){return Mt(8,e,!0)}function Bt(e,t=[],i=ne){let r=t.map(i),a=()=>e(...r.map(Tt));return x&&P(a,"name",{value:"{expression}"}),Dt(a)}function Dt(e,t=0){return Mt(24|t,e,!0)}function Ot(e,t=!0){return Mt(40,e,!0,t)}function Ft(e){var t=e.teardown;if(null!==t){let e=He,i=Ke;We(!0),Ze(null);try{t.call(null)}finally{We(e),Ze(i)}}}function jt(e,t=!1){var i=e.first;for(e.first=e.last=null;null!==i;){var r=i.next;64&i.f?i.parent=null:zt(i,t),i=r}}function zt(e,t=!0){var i=!1;if((t||524288&e.f)&&null!==e.nodes_start){for(var r=e.nodes_start,a=e.nodes_end;null!==r;){var s=r===a?null:Ve(r);r.remove(),r=s}i=!0}jt(e,t&&!i),vt(e,0),At(e,16384);var n=e.transitions;if(null!==n)for(let e of n)e.stop();Ft(e);var o=e.parent;null!==o&&null!==o.first&&Ut(e),x&&(e.component_function=null),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=null}function Ut(e){var t=e.parent,i=e.prev,r=e.next;null!==i&&(i.next=r),null!==r&&(r.prev=i),null!==t&&(t.first===e&&(t.first=r),t.last===e&&(t.last=i))}function qt(e,t){var i=[];Wt(e,i,!0),Ht(i,(()=>{zt(e),t&&t()}))}function Ht(e,t){var i=e.length;if(i>0){var r=()=>--i||t();for(var a of e)a.out(r)}else t()}function Wt(e,t,i){if(!(8192&e.f)){if(e.f^=8192,null!==e.transitions)for(let r of e.transitions)(r.is_global||i)&&t.push(r);for(var r=e.first;null!==r;){var a=r.next;Wt(r,t,!!(!!(65536&r.f)||!!(32&r.f))&&i),r=a}}}function Qt(e){Gt(e,!0)}function Gt(e,t){if(8192&e.f){e.f^=8192,!(1024&e.f)&&(e.f^=1024),ut(e)&&(At(e,2048),xt(e));for(var i=e.first;null!==i;){var r=i.next;Gt(i,!!(!!(65536&i.f)||!!(32&i.f))&&t),i=r}if(null!==e.transitions)for(let i of e.transitions)(i.is_global||t)&&i.in()}}var Kt={},Yt=/at (?:.+ \()?(.+):(\d+):(\d+)\)?$/,Zt=/@(.+):(\d+):(\d+)$/;var Xt=Symbol("ADD_OWNER");function Jt(e,t,i=!1,r=!1){if(e&&!i){let i=li,a=e[_];if(a&&!ii(a,i)){let e=ri(a);t&&t[w]!==i[w]&&!r&&function(e,t,i){x?console.warn(`%c[svelte] ownership_invalid_binding\n%c${e} passed a value to ${t} with \`bind:\`, but the value is owned by ${i}. Consider creating a binding between ${i} and ${e}\nhttps://svelte.dev/e/ownership_invalid_binding`,he,pe):console.warn("https://svelte.dev/e/ownership_invalid_binding")}(i[w],t[w],e[w])}}ti(e,t,new Set)}function ei(e,t){if(null!==t.owners)for(;e;){if(null===e.owners){t.owners=null;break}for(let i of e.owners)t.owners.add(i);e=e.parent}}function ti(e,t,i){let r=e?.[_];if(r)"owners"in r&&null!=r.owners&&(t?r.owners.add(t):r.owners=null);else if(e&&"object"==typeof e){if(i.has(e))return;if(i.add(e),Xt in e&&e[Xt])Nt((()=>{e[Xt](t)}));else{var a=N(e);if(a===Object.prototype)for(let r in e)if(Object.getOwnPropertyDescriptor(e,r)?.get){let a=y;Nt((()=>{let s=e[r];a!==s&&(a=s,ti(s,t,i))}))}else ti(e[r],t,i);else if(a===Array.prototype)for(let r=0;r<e.length;r+=1)ti(e[r],t,i)}}}function ii(e,t){return null===e.owners||(e.owners.has(t)||w in t&&[...e.owners].some((e=>e[w]===t[w]))||null!==e.parent&&ii(e.parent,t))}function ri(e){return e?.owners?.values().next().value??ri(e.parent)}var ai=!1;function si(e){if(x){let t=new Error(`lifecycle_outside_component\n\`${e}(...)\` can only be used during component initialisation\nhttps://svelte.dev/e/lifecycle_outside_component`);throw t.name="Svelte error",t}throw new Error("https://svelte.dev/e/lifecycle_outside_component")}var ni=null;function oi(e){ni=e}var li=null;function ui(e){li=e}function di(e){return vi("getContext").get(e)}function ci(e,t){let i=vi("setContext");return x&&Ct((()=>Jt(t,null,!0))),i.set(e,t),t}function hi(){return vi("getAllContexts")}function pi(e,t=!1,i){var r=ni={p:ni,c:null,d:!1,e:null,m:!1,s:e,x:null,l:null};Y&&!t&&(ni.l={s:null,u:null,r1:[],r2:ee(!1)}),It((()=>{r.d=!0})),x&&(ni.function=i,li=i)}function fi(e){let t=ni;if(null!==t){void 0!==e&&(t.x=e);let n=t.e;if(null!==n){var i=Xe,r=Ke;t.e=null;try{for(var a=0;a<n.length;a++){var s=n[a];Je(s.effect),Ze(s.reaction),Vt(s.fn)}}finally{Je(i),Ze(r)}}ni=t.p,x&&(li=t.p?.function??null),t.m=!0}return e||{}}function mi(){return!Y||null!==ni&&null===ni.l}function vi(e){var t;return null===ni&&si(e),(t=ni).c??(t.c=new Map(function(e){let t=e.p;for(;null!==t;){let e=t.c;if(null!==e)return e;t=t.p}return null}(ni)||void 0))}var gi=/\r/g;function bi(e){return e.endsWith("capture")&&"gotpointercapture"!==e&&"lostpointercapture"!==e}var yi=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function wi(e){return yi.includes(e)}var Si={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function xi(e){return e=e.toLowerCase(),Si[e]??e}var $i=["touchstart","touchmove"];function _i(e){return $i.includes(e)}var ki=["textarea","script","style","title"];var Ti=new Map;function Ci(e,t){if(t){let t=document.body;e.autofocus=!0,q((()=>{document.activeElement===t&&e.focus()}))}}function Ei(e){var t=Ke,i=Xe;Ze(null),Je(null);try{return e()}finally{Ze(t),Je(i)}}var Ai=new Set,Li=new Set;function Pi(e){if(!xe)return;e.onload&&e.removeAttribute("onload"),e.onerror&&e.removeAttribute("onerror");let t=e.__e;void 0!==t&&(e.__e=void 0,queueMicrotask((()=>{e.isConnected&&e.dispatchEvent(t)})))}function Mi(e,t,i,r={}){function a(e){if(r.capture||Vi.call(t,e),!e.cancelBubble)return Ei((()=>i?.call(this,e)))}return e.startsWith("pointer")||e.startsWith("touch")||"wheel"===e?q((()=>{t.addEventListener(e,a,r)})):t.addEventListener(e,a,r),a}function Ii(e,t,i,r,a){var s={capture:r,passive:a},n=Mi(e,t,i,s);(t===document.body||t===window||t===document)&&It((()=>{t.removeEventListener(e,n,s)}))}function Ri(e){for(var t=0;t<e.length;t++)Ai.add(e[t]);for(var i of Li)i(e)}function Vi(e){var t=this,i=t.ownerDocument,r=e.type,a=e.composedPath?.()||[],s=a[0]||e.target,n=0,o=e.__root;if(o){var l=a.indexOf(o);if(-1!==l&&(t===document||t===window))return void(e.__root=t);var u=a.indexOf(t);if(-1===u)return;l<=u&&(n=l)}if((s=a[n]||e.target)!==t){P(e,"currentTarget",{configurable:!0,get:()=>s||i});var d=Ke,c=Xe;Ze(null),Je(null);try{for(var h,p=[];null!==s;){var f=s.assignedSlot||s.parentNode||s.host||null;try{var m=s["__"+r];if(null!=m&&(!s.disabled||e.target===s))if(C(m)){var[v,...g]=m;v.apply(s,[e,...g])}else m.call(s,e)}catch(e){h?p.push(e):h=e}if(e.cancelBubble||f===t||null===f)break;s=f}if(h){for(let e of p)queueMicrotask((()=>{throw e}));throw h}}finally{e.__root=t,delete e.currentTarget,Ze(d),Je(c)}}}function Ni(e){var t=document.createElement("template");return t.innerHTML=e,t.content}function Bi(e,t){var i=Xe;null===i.nodes_start&&(i.nodes_start=e,i.nodes_end=t)}function Di(e,t){var i,r=!!(1&t),a=!!(2&t),s=!e.startsWith("<!>");return()=>{if(xe)return Bi(ge,null),ge;void 0===i&&(i=Ni(s?e:"<!>"+e),r||(i=Re(i)));var t=a||ye?document.importNode(i,!0):i.cloneNode(!0);r?Bi(Re(t),t.lastChild):Bi(t,t);return t}}function Oi(e,t,i="svg"){var r,a=!e.startsWith("<!>"),s=!!(1&t),n=`<${i}>${a?e:"<!>"+e}</${i}>`;return()=>{if(xe)return Bi(ge,null),ge;if(!r){var e=Re(Ni(n));if(s)for(r=document.createDocumentFragment();Re(e);)r.appendChild(Re(e));else r=Re(e)}var t=r.cloneNode(!0);s?Bi(Re(t),t.lastChild):Bi(t,t);return t}}function Fi(e=""){if(!xe){var t=Ie(e+"");return Bi(t,t),t}var i=ge;return 3!==i.nodeType&&(i.before(i=Ie()),_e(i)),Bi(i,i),i}function ji(){if(xe)return Bi(ge,null),ge;var e=document.createDocumentFragment(),t=document.createComment(""),i=Ie();return e.append(t,i),Bi(t,i),e}function zi(e,t){if(xe)return Xe.nodes_end=ge,void ke();null!==e&&e.before(t)}var Ui=!0;function qi(e){Ui=e}function Hi(e,t){var i,r=null==t?"":"object"==typeof t?t+"":t;r!==((i=e).__t??(i.__t=e.nodeValue))&&(e.__t=r,e.nodeValue=r+"")}function Wi(e,t){return Ki(e,t)}function Qi(e,t){Me(),t.intro=t.intro??!1;let i=t.target,r=xe,a=ge;try{for(var s=Re(i);s&&(8!==s.nodeType||"["!==s.data);)s=Ve(s);if(!s)throw b;$e(!0),_e(s),ke();let r=Ki(e,{...t,anchor:s});if(null===ge||8!==ge.nodeType||"]"!==ge.data)throw fe(),b;return $e(!1),r}catch(r){if(r===b)return!1===t.recover&&function(){if(x){let e=new Error("hydration_failed\nFailed to hydrate the application\nhttps://svelte.dev/e/hydration_failed");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/hydration_failed")}(),Me(),Oe(i),$e(!1),Wi(e,t);throw r}finally{$e(r),_e(a)}}var Gi=new Map;function Ki(e,{target:t,anchor:i,props:r={},events:a,context:s,intro:n=!0}){Me();var o=new Set,l=e=>{for(var i=0;i<e.length;i++){var r=e[i];if(!o.has(r)){o.add(r);var a=_i(r);t.addEventListener(r,Vi,{passive:a});var s=Gi.get(r);void 0===s?(document.addEventListener(r,Vi,{passive:a}),Gi.set(r,1)):Gi.set(r,s+1)}}};l(A(Ai)),Li.add(l);var u=void 0,d=function(e){let t=Mt(64,e,!0);return(e={})=>new Promise((i=>{e.outro?qt(t,(()=>{zt(t),i(void 0)})):(zt(t),i(void 0))}))}((()=>{var d=i??t.appendChild(Ie());return Ot((()=>{s&&(pi({}),ni.c=s);a&&(r.$$events=a),xe&&Bi(d,null),Ui=n,u=e(d,r)||{},Ui=!0,xe&&(Xe.nodes_end=ge),s&&fi()})),()=>{for(var e of o){t.removeEventListener(e,Vi);var r=Gi.get(e);0==--r?(document.removeEventListener(e,Vi),Gi.delete(e)):Gi.set(e,r)}Li.delete(l),d!==i&&d.parentNode?.removeChild(d)}}));return Yi.set(u,d),u}var Yi=new WeakMap;function Zi(e,t){let i=Yi.get(e);return i?(Yi.delete(e),i(t)):(x&&(x?console.warn("%c[svelte] lifecycle_double_unmount\n%cTried to unmount a component that was not mounted\nhttps://svelte.dev/e/lifecycle_double_unmount",he,pe):console.warn("https://svelte.dev/e/lifecycle_double_unmount")),Promise.resolve())}function Xi(e,t,[i,r]=[0,0]){xe&&0===i&&ke();var a=e,s=null,n=null,o=y,l=!1;let u=(e,t=!0)=>{l=!0,d(t,e)},d=(e,t)=>{if(o===(o=e))return;let l=!1;if(xe&&-1!==r){if(0===i){let e=a.data;"["===e?r=0:e===g?r=1/0:(r=parseInt(e.substring(1)))!=r&&(r=o?1/0:-1)}!!o===r>i&&(_e(a=Ee()),$e(!1),l=!0,r=-1)}o?(s?Qt(s):t&&(s=Ot((()=>t(a)))),n&&qt(n,(()=>{n=null}))):(n?Qt(n):t&&(n=Ot((()=>t(a,[i+1,r])))),s&&qt(s,(()=>{s=null}))),l&&$e(!0)};Dt((()=>{l=!1,t(u),l||d(null,null)}),i>0?65536:0),xe&&(a=ge)}function Ji(e,t,i){xe&&ke();var r,a=e,s=y,n=mi()?G:Q;Dt((()=>{n(s,s=t())&&(r&&qt(r),r=Ot((()=>i(a))))})),xe&&(a=ge)}var er,tr=null;function ir(e){tr=e}function rr(e,t){return t}function ar(e,t,i,r,a,s=null){var n=e,o={flags:t,items:new Map,first:null};if(!!(4&t)){var l=e;n=xe?_e(Re(l)):l.appendChild(Ie())}xe&&ke();var u=null,d=!1,c=oe((()=>{var e=i();return C(e)?e:null==e?[]:A(e)}));Dt((()=>{var e=Tt(c),l=e.length;if(d&&0===l)return;d=0===l;let h=!1;xe&&(n.data===g!==(0===l)&&(_e(n=Ee()),$e(!1),h=!0));if(xe){for(var p,f=null,m=0;m<l;m++){if(8===ge.nodeType&&"]"===ge.data){n=ge,h=!0,$e(!1);break}var v=e[m],b=r(v,m);p=or(ge,o,f,null,v,b,m,a,t,i),o.items.set(b,p),f=p}l>0&&_e(Ee())}xe||sr(e,o,n,a,t,r,i),null!==s&&(0===l?u?Qt(u):u=Ot((()=>s(n))):null!==u&&qt(u,(()=>{u=null}))),h&&$e(!0),Tt(c)})),xe&&(n=ge)}function sr(e,t,i,r,a,s,n){var o,l,u,d,c,h,p=!!(8&a),f=!!(3&a),m=e.length,v=t.items,g=t.first,b=null,y=[],w=[];if(p)for(h=0;h<m;h+=1)d=s(u=e[h],h),void 0!==(c=v.get(d))&&(c.a?.measure(),(l??(l=new Set)).add(c));for(h=0;h<m;h+=1)if(d=s(u=e[h],h),void 0!==(c=v.get(d))){if(f&&nr(c,u,h,a),!!(8192&c.e.f)&&(Qt(c.e),p&&(c.a?.unfix(),(l??(l=new Set)).delete(c))),c!==g){if(void 0!==o&&o.has(c)){if(y.length<w.length){var S,x=w[0];b=x.prev;var $=y[0],_=y[y.length-1];for(S=0;S<y.length;S+=1)lr(y[S],x,i);for(S=0;S<w.length;S+=1)o.delete(w[S]);ur(t,$.prev,_.next),ur(t,b,$),ur(t,_,x),g=x,b=_,h-=1,y=[],w=[]}else o.delete(c),lr(c,g,i),ur(t,c.prev,c.next),ur(t,c,null===b?t.first:b.next),ur(t,b,c),b=c;continue}for(y=[],w=[];null!==g&&g.k!==d;)!(8192&g.e.f)&&(o??(o=new Set)).add(g),w.push(g),g=g.next;if(null===g)continue;c=g}y.push(c),b=c,g=c.next}else{b=or(g?g.e.nodes_start:i,t,b,null===b?t.first:b.next,u,d,h,r,a,n),v.set(d,b),y=[],w=[],g=b.next}if(null!==g||void 0!==o){for(var k=void 0===o?[]:A(o);null!==g;)!(8192&g.e.f)&&k.push(g),g=g.next;var T=k.length;if(T>0){var C=4&a&&0===m?i:null;if(p){for(h=0;h<T;h+=1)k[h].a?.measure();for(h=0;h<T;h+=1)k[h].a?.fix()}!function(e,t,i,r){for(var a=[],s=t.length,n=0;n<s;n++)Wt(t[n].e,a,!0);var o=s>0&&0===a.length&&null!==i;if(o){var l=i.parentNode;Oe(l),l.append(i),r.clear(),ur(e,t[0].prev,t[s-1].next)}Ht(a,(()=>{for(var i=0;i<s;i++){var a=t[i];o||(r.delete(a.k),ur(e,a.prev,a.next)),zt(a.e,!o)}}))}(t,k,C,v)}}p&&q((()=>{if(void 0!==l)for(c of l)c.a?.apply()})),Xe.first=t.first&&t.first.e,Xe.last=b&&b.e}function nr(e,t,i,r){!!(1&r)&&ae(e.v,t),2&r?ae(e.i,i):e.i=i}function or(e,t,i,r,a,s,n,o,l,u){var d=tr,c=!!(1&l),h=c?!(16&l)?ie(a):ee(a):a,p=2&l?ee(n):n;x&&c&&(h.debug=()=>{var e="number"==typeof p?n:p.v;u()[e]});var f={i:p,v:h,k:s,a:null,e:null,prev:i,next:r};tr=f;try{return f.e=Ot((()=>o(e,h,p,u)),xe),f.e.prev=i&&i.e,f.e.next=r&&r.e,null===i?t.first=f:(i.next=f,i.e.next=f.e),null!==r&&(r.prev=f,r.e.prev=f.e),f}finally{tr=d}}function lr(e,t,i){for(var r=e.next?e.next.e.nodes_start:i,a=t?t.e.nodes_start:i,s=e.e.nodes_start;s!==r;){var n=Ve(s);a.before(s),s=n}}function ur(e,t,i){null===t?e.first=i:(t.next=i,t.e.next=i&&i.e),null!==i&&(i.prev=t,i.e.prev=t&&t.e)}function dr(e,t,i){if(!t||t===function(e){let t=5381,i=(e=e.replace(gi,"")).length;for(;i--;)t=(t<<5)-t^e.charCodeAt(i);return(t>>>0).toString(36)}(String(i??"")))return;let r,a=e.__svelte_meta?.loc;a?r=`near ${a.file}:${a.line}:${a.column}`:li?.[w]&&(r=`in ${li[w]}`),function(e){x?console.warn(`%c[svelte] hydration_html_changed\n%c${e?`The value of an \`{@html ...}\` block ${e} changed between server and client renders. The client value will be ignored in favour of the server value`:"The value of an `{@html ...}` block changed between server and client renders. The client value will be ignored in favour of the server value"}\nhttps://svelte.dev/e/hydration_html_changed`,he,pe):console.warn("https://svelte.dev/e/hydration_html_changed")}(function(e){return e?.replace(/\//g,"/​")}(r))}function cr(e,t,i,r,a){var s,n=e,o="";Dt((()=>{o!==(o=t()??"")?(void 0!==s&&(zt(s),s=void 0),""!==o&&(s=Ot((()=>{if(xe){for(var e=ge.data,t=ke(),s=t;null!==t&&(8!==t.nodeType||""!==t.data);)s=t,t=Ve(t);if(null===t)throw fe(),b;return x&&!a&&dr(t.parentNode,e,o),Bi(ge,s),void(n=_e(t))}var l=o+"";i?l=`<svg>${l}</svg>`:r&&(l=`<math>${l}</math>`);var u=Ni(l);if((i||r)&&(u=Re(u)),Bi(Re(u),u.lastChild),i||r)for(;Re(u);)n.before(Re(u));else n.before(u)})))):xe&&ke()}))}function hr(e,t,...i){var r,a=e,s=D;Dt((()=>{s!==(s=t())&&(r&&(zt(r),r=null),x&&null==s&&function(){if(x){let e=new Error("invalid_snippet\nCould not `{@render}` snippet due to the expression being `null` or `undefined`. Consider using optional chaining `{@render snippet?.()}`\nhttps://svelte.dev/e/invalid_snippet");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/invalid_snippet")}(),r=Ot((()=>s(a,...i))))}),65536),xe&&(a=ge)}function pr(e,t,i){xe&&ke();var r,a,s=e;Dt((()=>{r!==(r=t())&&(a&&(qt(a),a=null),r&&(a=Ot((()=>i(s,r)))))}),65536),xe&&(s=ge)}function fr(e,t,i,r,a,s){let n=xe;xe&&ke();var o,l,u=x&&s&&ni?.function[w],d=null;xe&&1===ge.nodeType&&(d=ge,ke());var c,h=xe?ge:e,p=tr;Dt((()=>{let e=t()||null;var n=a?a():i||"svg"===e?"http://www.w3.org/2000/svg":null;if(e!==o){var f=tr;ir(p),c&&(null===e?qt(c,(()=>{c=null,l=null})):e===l?Qt(c):(zt(c),qi(!1))),e&&e!==l&&(c=Ot((()=>{if(d=xe?d:n?document.createElementNS(n,e):document.createElement(e),x&&s&&(d.__svelte_meta={loc:{file:u,line:s[0],column:s[1]}}),Bi(d,d),r){xe&&function(e){return ki.includes(e)}(e)&&d.append(document.createComment(""));var t=xe?Re(d):d.appendChild(Ie());xe&&(null===t?$e(!1):_e(t)),r(d,t)}Xe.nodes_end=d,h.before(d)}))),(o=e)&&(l=o),qi(!0),ir(f)}}),65536),n&&($e(!0),_e(h))}var mr=(s=(0,p._)("_t"),n=(0,p._)("_e"),class{$set(e){(0,h._)(this,n)[n].$set(e)}$on(e,t){(0,h._)(this,s)[s][e]=(0,h._)(this,s)[s][e]||[];let i=(...e)=>t.call(this,...e);return(0,h._)(this,s)[s][e].push(i),()=>{(0,h._)(this,s)[s][e]=(0,h._)(this,s)[s][e].filter((e=>e!==i))}}$destroy(){(0,h._)(this,n)[n].$destroy()}constructor(e){Object.defineProperty(this,s,{writable:!0,value:void 0}),Object.defineProperty(this,n,{writable:!0,value:void 0});var t=new Map,i=(e,i)=>{var r=ie(i);return t.set(e,r),r};let r=new Proxy({...e.props||{},$$events:{}},{get:(e,r)=>Tt(t.get(r)??i(r,Reflect.get(e,r))),has:(e,r)=>r===k||(Tt(t.get(r)??i(r,Reflect.get(e,r))),Reflect.has(e,r)),set:(e,r,a)=>(re(t.get(r)??i(r,a),a),Reflect.set(e,r,a))});(0,h._)(this,n)[n]=(e.hydrate?Qi:Wi)(e.component,{target:e.target,anchor:e.anchor,props:r,context:e.context,intro:e.intro??!1,recover:e.recover}),(!e?.props?.$$host||!1===e.sync)&&_t(),(0,h._)(this,s)[s]=r.$$events;for(let e of Object.keys((0,h._)(this,n)[n]))"$set"===e||"$destroy"===e||"$on"===e||P(this,e,{get(){return(0,h._)(this,n)[n][e]},set(t){(0,h._)(this,n)[n][e]=t},enumerable:!0});(0,h._)(this,n)[n].$set=e=>{Object.assign(r,e)},(0,h._)(this,n)[n].$destroy=()=>{Zi((0,h._)(this,n)[n])}}});function vr(e,t){q((()=>{var i=e.getRootNode(),r=i.host?i:i.head??i.ownerDocument.head??er?.parentNode;if(!r?.querySelector("#"+t.hash)){let e=document.createElement("style");e.id=t.hash,e.textContent=t.code,r.appendChild(e),x&&function(e,t){var i=Ti.get(e);i||(i=new Set,Ti.set(e,i)),i.add(t)}(t.hash,e)}}))}function gr(e){var t,i,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(i=gr(e[t]))&&(r&&(r+=" "),r+=i)}else for(i in e)e[i]&&(r&&(r+=" "),r+=i);return r}function br(e){return"object"==typeof e?function(){for(var e,t,i=0,r="",a=arguments.length;i<a;i++)(e=arguments[i])&&(t=gr(e))&&(r&&(r+=" "),r+=t);return r}(e):e??""}var yr=[..." \t\n\r\f \v\ufeff"];function wr(e,t=!1){var i=t?" !important;":";",r="";for(var a in e){var s=e[a];null!=s&&""!==s&&(r+=" "+a+": "+s+i)}return r}function Sr(e){return"-"!==e[0]||"-"!==e[1]?e.toLowerCase():e}function xr(e,t,i,r,a,s){var n=e.__className;if(xe||n!==i){var o=function(e,t,i){var r=null==e?"":""+e;if(t&&(r=r?r+" "+t:t),i)for(var a in i)if(i[a])r=r?r+" "+a:a;else if(r.length)for(var s=a.length,n=0;(n=r.indexOf(a,n))>=0;){var o=n+s;0!==n&&!yr.includes(r[n-1])||o!==r.length&&!yr.includes(r[o])?n=o:r=(0===n?"":r.substring(0,n))+r.substring(o+1)}return""===r?null:r}(i,r,s);(!xe||o!==e.getAttribute("class"))&&(null==o?e.removeAttribute("class"):t?e.className=o:e.setAttribute("class",o)),e.__className=i}else if(s&&a!==s)for(var l in s){var u=!!s[l];(null==a||u!==!!a[l])&&e.classList.toggle(l,u)}return s}function $r(e,t={},i,r){for(var a in i){var s=i[a];t[a]!==s&&(null==i[a]?e.style.removeProperty(a):e.style.setProperty(a,s,r))}}function _r(e,t,i,r){var a=e.__style;if(xe||a!==t){var s=function(e,t){if(t){var i,r,a="";if(Array.isArray(t)?(i=t[0],r=t[1]):i=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var s=!1,n=0,o=!1,l=[];i&&l.push(...Object.keys(i).map(Sr)),r&&l.push(...Object.keys(r).map(Sr));var u=0,d=-1;let t=e.length;for(var c=0;c<t;c++){var h=e[c];if(o?"/"===h&&"*"===e[c-1]&&(o=!1):s?s===h&&(s=!1):"/"===h&&"*"===e[c+1]?o=!0:'"'===h||"'"===h?s=h:"("===h?n++:")"===h&&n--,!o&&!1===s&&0===n)if(":"===h&&-1===d)d=c;else if(";"===h||c===t-1){if(-1!==d){var p=Sr(e.substring(u,d).trim());l.includes(p)||(";"!==h&&c++,a+=" "+e.substring(u,c).trim()+";")}u=c+1,d=-1}}}return i&&(a+=wr(i)),r&&(a+=wr(r,!0)),""===(a=a.trim())?null:a}return null==e?null:String(e)}(t,r);(!xe||s!==e.getAttribute("style"))&&(null==s?e.removeAttribute("style"):e.style.cssText=s),e.__style=t}else r&&(Array.isArray(r)?($r(e,i?.[0],r[0]),$r(e,i?.[1],r[1],"important")):$r(e,i,r));return r}var kr=Symbol("class"),Tr=Symbol("style"),Cr=Symbol("is custom element"),Er=Symbol("is html");function Ar(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function Lr(e,t,i,r){var a=Mr(e);xe&&(a[t]=e.getAttribute(t),"src"===t||"srcset"===t||"href"===t&&"LINK"===e.nodeName)?r||function(e,t,i){x&&("srcset"===t&&function(e,t){var i=Nr(e.srcset),r=Nr(t);return r.length===i.length&&r.every((([e,t],r)=>t===i[r][1]&&(Vr(i[r][0],e)||Vr(e,i[r][0]))))}(e,i)||Vr(e.getAttribute(t)??"",i)||function(e,t,i){x?console.warn(`%c[svelte] hydration_attribute_changed\n%cThe \`${e}\` attribute on \`${t}\` changed its value between server and client renders. The client value, \`${i}\`, will be ignored in favour of the server value\nhttps://svelte.dev/e/hydration_attribute_changed`,he,pe):console.warn("https://svelte.dev/e/hydration_attribute_changed")}(t,e.outerHTML.replace(e.innerHTML,e.innerHTML&&"..."),String(i)))}(e,t,i??""):a[t]!==(a[t]=i)&&("loading"===t&&(e[T]=i),null==i?e.removeAttribute(t):"string"!=typeof i&&Rr(e).includes(t)?e[t]=i:e.setAttribute(t,i))}function Pr(e,t,i,r,a=!1){var s,n=Mr(e),o=n[Cr],l=!n[Er];let u=xe&&o;u&&$e(!1);var d=t||{},c="OPTION"===e.tagName;for(var h in t)h in i||(i[h]=null);i.class?i.class=br(i.class):(r||i[kr])&&(i.class=null),i[Tr]&&((s=i).style??(s.style=null));var p=Rr(e);for(let s in i){let u=i[s];if(c&&"value"===s&&null==u)e.value=e.__value="",d[s]=u;else if("class"!==s)if("style"!==s){var f=d[s];if(u!==f){d[s]=u;var m=s[0]+s[1];if("$$"!==m)if("on"===m){let t={},i="$$"+s,r=s.slice(2);var v=wi(r);if(bi(r)&&(r=r.slice(0,-7),t.capture=!0),!v&&f){if(null!=u)continue;e.removeEventListener(r,d[i],t),d[i]=null}if(null!=u)if(v)e[`__${r}`]=u,Ri([r]);else{let a=function(e){d[s].call(this,e)};d[i]=Mi(r,e,a,t)}else v&&(e[`__${r}`]=void 0)}else if("style"===s)Lr(e,s,u);else if("autofocus"===s)Ci(e,!!u);else if(o||"__value"!==s&&("value"!==s||null==u))if("selected"===s&&c)Ar(e,u);else{var g=s;l||(g=xi(g));var b="defaultValue"===g||"defaultChecked"===g;if(null!=u||o||b)b||p.includes(g)&&(o||"string"!=typeof u)?e[g]=u:"function"!=typeof u&&Lr(e,g,u,a);else if(n[s]=null,"value"===g||"checked"===g){let i=e,r=void 0===t;if("value"===g){let e=i.defaultValue;i.removeAttribute(g),i.defaultValue=e,i.value=i.__value=r?e:null}else{let e=i.defaultChecked;i.removeAttribute(g),i.defaultChecked=e,i.checked=!!r&&e}}else e.removeAttribute(s)}else e.value=e.__value=u}}else _r(e,u,t?.[Tr],i[Tr]),d[s]=u,d[Tr]=i[Tr];else xr(e,"http://www.w3.org/1999/xhtml"===e.namespaceURI,u,r,t?.[kr],i[kr]),d[s]=u,d[kr]=i[kr]}return u&&$e(!0),d}function Mr(e){var t;return(t=e).__attributes??(t.__attributes={[Cr]:e.nodeName.includes("-"),[Er]:"http://www.w3.org/1999/xhtml"===e.namespaceURI})}var Ir=new Map;function Rr(e){var t=Ir.get(e.nodeName);if(t)return t;Ir.set(e.nodeName,t=[]);for(var i,r=e,a=Element.prototype;a!==r;){for(var s in i=I(r))i[s].set&&t.push(s);r=N(r)}return t}function Vr(e,t){return e===t||new URL(e,document.baseURI).href===new URL(t,document.baseURI).href}function Nr(e){return e.split(",").map((e=>e.trim().split(" ").filter(Boolean)))}var Br=()=>performance.now(),Dr={tick:e=>requestAnimationFrame(e),now:()=>Br(),tasks:new Set};function Or(){let e=Dr.now();Dr.tasks.forEach((t=>{t.c(e)||(Dr.tasks.delete(t),t.f())})),0!==Dr.tasks.size&&Dr.tick(Or)}function Fr(e,t){Ei((()=>{e.dispatchEvent(new CustomEvent(t))}))}function jr(e){if("float"===e)return"cssFloat";if("offset"===e)return"cssOffset";if(e.startsWith("--"))return e;let t=e.split("-");return 1===t.length?t[0]:t[0]+t.slice(1).map((e=>e[0].toUpperCase()+e.slice(1))).join("")}function zr(e){let t={},i=e.split(";");for(let e of i){let[i,r]=e.split(":");if(!i||void 0===r)break;t[jr(i.trim())]=r.trim()}return t}var Ur=e=>e;function qr(e,t,i,r,a){var s=1===r;if(B(t)){var n,o=!1;return q((()=>{if(!o){var l=t({direction:s?"in":"out"});n=qr(e,l,i,r,a)}})),{abort:()=>{o=!0,n?.abort()},deactivate:()=>n.deactivate(),reset:()=>n.reset(),t:()=>n.t()}}if(i?.deactivate(),!t?.duration)return a(),{abort:D,deactivate:D,reset:D,t:()=>r};let{delay:l=0,css:u,tick:d,easing:c=Ur}=t;var h=[];if(s&&void 0===i&&(d&&d(0,1),u)){var p=zr(u(0,1));h.push(p,p)}var f=()=>1-r,m=e.animate(h,{duration:l});return m.onfinish=()=>{var s=i?.t()??1-r;i?.abort();var n=r-s,o=t.duration*Math.abs(n),l=[];if(o>0){var h=!1;if(u)for(var p=Math.ceil(o/16.666666666666668),v=0;v<=p;v+=1){var g=s+n*c(v/p),b=zr(u(g,1-g));l.push(b),h||(h="hidden"===b.overflow)}h&&(e.style.overflow="hidden"),f=()=>{var e=m.currentTime;return s+n*c(e/o)},d&&function(e){let t;0===Dr.tasks.size&&Dr.tick(Or),new Promise((i=>{Dr.tasks.add(t={c:e,f:i})}))}((()=>{if("running"!==m.playState)return!1;var e=f();return d(e,1-e),!0}))}(m=e.animate(l,{duration:o,fill:"forwards"})).onfinish=()=>{f=()=>r,d?.(r,1-r),a()}},{abort:()=>{m&&(m.cancel(),m.effect=null,m.onfinish=D)},deactivate:()=>{a=D},reset:()=>{0===r&&d?.(1,0)},t:()=>f()}}var Hr=(o=(0,p._)("_t"),l=(0,p._)("_e"),u=(0,p._)("_i"),d=(0,p._)("_o"),c=class{observe(e,t){var i=(0,h._)(this,o)[o].get(e)||new Set;return i.add(t),(0,h._)(this,o)[o].set(e,i),(0,h._)(this,d)[d]().observe(e,(0,h._)(this,u)[u]),()=>{var i=(0,h._)(this,o)[o].get(e);i.delete(t),0===i.size&&((0,h._)(this,o)[o].delete(e),(0,h._)(this,l)[l].unobserve(e))}}constructor(e){Object.defineProperty(this,d,{value:pv}),Object.defineProperty(this,o,{writable:!0,value:void 0}),Object.defineProperty(this,l,{writable:!0,value:void 0}),Object.defineProperty(this,u,{writable:!0,value:void 0}),(0,h._)(this,o)[o]=new WeakMap,(0,h._)(this,u)[u]=e}},c.entries=new WeakMap,c),Wr=new Hr({box:"border-box"});function Qr(e,t,i){var r=Wr.observe(e,(()=>i(e[t])));Vt((()=>(Ct((()=>i(e[t]))),r)))}function Gr(e,t){return e===t||e?.[$]===t}function Kr(e={},t,i,r){return Vt((()=>{var a,s;return Nt((()=>{a=s,s=r?.()||[],Ct((()=>{e!==i(...s)&&(t(e,...s),a&&Gr(i(...a),e)&&t(null,...a))}))})),()=>{q((()=>{s&&Gr(i(...s),e)&&t(null,...s)}))}})),e}function Yr(e=!1){let t=ni,i=t.l.u;if(!i)return;let r=()=>function(e){if("object"==typeof e&&e&&!(e instanceof EventTarget))if($ in e)Lt(e);else if(!Array.isArray(e))for(let t in e){let i=e[t];"object"==typeof i&&i&&$ in i&&Lt(i)}}(t.s);if(e){let e=0,i={},a=ne((()=>{let r=!1,a=t.s;for(let e in a)a[e]!==i[e]&&(i[e]=a[e],r=!0);return r&&e++,e}));r=()=>Tt(a)}i.b.length&&function(e){Pt("$effect.pre"),x&&P(e,"name",{value:"$effect.pre"}),Nt(e)}((()=>{Zr(t,r),F(i.b)})),Rt((()=>{let e=Ct((()=>i.m.map(O)));return()=>{for(let t of e)"function"==typeof t&&t()}})),i.a.length&&Rt((()=>{Zr(t,r),F(i.a)}))}function Zr(e,t){if(e.l.s)for(let t of e.l.s)Tt(t);t()}if(x){let e=function(e){if(!(e in globalThis)){let t;Object.defineProperty(globalThis,e,{configurable:!0,get:()=>{if(void 0!==t)return t;!function(e){if(x){let t=new Error(`rune_outside_svelte\nThe \`${e}\` rune is only available inside \`.svelte\` and \`.svelte.js/ts\` files\nhttps://svelte.dev/e/rune_outside_svelte`);throw t.name="Svelte error",t}throw new Error("https://svelte.dev/e/rune_outside_svelte")}(e)},set:e=>{t=e}})}};e("$state"),e("$effect"),e("$derived"),e("$inspect"),e("$props"),e("$bindable")}function Xr(e){null===ni&&si("onMount"),Y&&null!==ni.l?function(e){var t,i=e.l;return(t=i).u??(t.u={a:[],b:[],m:[]})}(ni).m.push(e):Rt((()=>{let t=Ct(e);if("function"==typeof t)return t}))}function Jr(e){null===ni&&si("onDestroy"),Xr((()=>()=>Ct(e)))}function ea(e,t,i){if(null==e)return t(void 0),i&&i(void 0),D;let r=Ct((()=>e.subscribe(t,i)));return r.unsubscribe?()=>r.unsubscribe():r}var ta=[];function ia(e,t){return{subscribe:ra(e,t).subscribe}}function ra(e,t=D){let i=null,r=new Set;function a(t){if(Q(e,t)&&(e=t,i)){let t=!ta.length;for(let t of r)t[1](),ta.push(t,e);if(t){for(let e=0;e<ta.length;e+=2)ta[e][0](ta[e+1]);ta.length=0}}}function s(t){a(t(e))}return{set:a,update:s,subscribe:function(n,o=D){let l=[n,o];return r.add(l),1===r.size&&(i=t(a,s)||D),n(e),()=>{r.delete(l),0===r.size&&i&&(i(),i=null)}}}}function aa(e,t,i){let r=!Array.isArray(e),a=r?[e]:e;if(!a.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");let s=t.length<2;return ia(i,((e,i)=>{let n=!1,o=[],l=0,u=D,d=()=>{if(l)return;u();let a=t(r?o[0]:o,e,i);s?e(a):u="function"==typeof a?a:D},c=a.map(((e,t)=>ea(e,(e=>{o[t]=e,l&=~(1<<t),n&&d()}),(()=>{l|=1<<t}))));return n=!0,d(),function(){F(c),u(),n=!1}}))}function sa(e){let t;return ea(e,(e=>t=e))(),t}var na=!1,oa=Symbol();function la(e,t,i){var r,a;let s=(r=i)[a=t]??(r[a]={store:null,source:ie(void 0),unsubscribe:D});if(s.store!==e&&!(oa in i))if(s.unsubscribe(),s.store=e??null,null==e)s.source.v=void 0,s.unsubscribe=D;else{var n=!0;s.unsubscribe=ea(e,(e=>{n?s.source.v=e:re(s.source,e)})),n=!1}return e&&oa in i?sa(e):Tt(s.source)}function ua(){let e={};return[e,function(){It((()=>{for(var t in e)e[t].unsubscribe();P(e,oa,{enumerable:!1,value:!0})}))}]}var da={get(e,t){if(!e.exclude.includes(t))return e.props[t]},set:(e,t)=>(x&&function(e){if(x){let t=new Error(`props_rest_readonly\nRest element properties of \`$props()\` such as \`${e}\` are readonly\nhttps://svelte.dev/e/props_rest_readonly`);throw t.name="Svelte error",t}throw new Error("https://svelte.dev/e/props_rest_readonly")}(`${e.name}.${String(t)}`),!1),getOwnPropertyDescriptor(e,t){if(!e.exclude.includes(t)&&t in e.props)return{enumerable:!0,configurable:!0,value:e.props[t]}},has:(e,t)=>!e.exclude.includes(t)&&t in e.props,ownKeys:e=>Reflect.ownKeys(e.props).filter((t=>!e.exclude.includes(t)))};function ca(e,t,i){return new Proxy(x?{props:e,exclude:t,name:i,other:{},to_proxy:[]}:{props:e,exclude:t},da)}var ha={get(e,t){let i=e.props.length;for(;i--;){let r=e.props[i];if(B(r)&&(r=r()),"object"==typeof r&&null!==r&&t in r)return r[t]}},set(e,t,i){let r=e.props.length;for(;r--;){let a=e.props[r];B(a)&&(a=a());let s=M(a,t);if(s&&s.set)return s.set(i),!0}return!1},getOwnPropertyDescriptor(e,t){let i=e.props.length;for(;i--;){let r=e.props[i];if(B(r)&&(r=r()),"object"==typeof r&&null!==r&&t in r){let e=M(r,t);return e&&!e.configurable&&(e.configurable=!0),e}}},has(e,t){if(t===$||t===k)return!1;for(let i of e.props)if(B(i)&&(i=i()),null!=i&&t in i)return!0;return!1},ownKeys(e){let t=[];for(let i of e.props){B(i)&&(i=i());for(let e in i)t.includes(e)||t.push(e)}return t}};function pa(...e){return new Proxy({props:e},ha)}function fa(e){return e.ctx?.d??!1}function ma(e,t,i,r){var a,s=!!(1&i),n=!Y||!!(2&i),o=!!(8&i),l=!!(16&i),u=!1;o?[a,u]=function(e){var t=na;try{return na=!1,[e(),na]}finally{na=t}}((()=>e[t])):a=e[t];var d,c=$ in e||k in e,h=o&&(M(e,t)?.set??(c&&t in e&&(i=>e[t]=i)))||void 0,p=r,f=!0,m=!1,v=()=>(m=!0,f&&(f=!1,p=l?Ct(r):r),p);if(void 0===a&&void 0!==r&&(h&&n&&function(e){if(x){let t=new Error(`props_invalid_value\nCannot do \`bind:${e}={undefined}\` when \`${e}\` has a fallback value\nhttps://svelte.dev/e/props_invalid_value`);throw t.name="Svelte error",t}throw new Error("https://svelte.dev/e/props_invalid_value")}(t),a=v(),h&&h(a)),n)d=()=>{var i=e[t];return void 0===i?v():(f=!0,m=!1,i)};else{var g=(s?ne:oe)((()=>e[t]));g.f|=131072,d=()=>{var e=Tt(g);return void 0!==e&&(p=void 0),void 0===e?p:e}}if(!(4&i))return d;if(h){var b=e.$$legacy;return function(e,t){return arguments.length>0?((!n||!t||b||u)&&h(t?d():e),e):d()}}var y=!1,w=!1,S=ie(a),_=ne((()=>{var e=d(),t=Tt(S);return y?(y=!1,w=!0,t):(w=!1,S.v=e)}));return o&&Tt(_),s||(_.equals=K),function(e,t){if(null!==ot&&(y=w,d(),Tt(S)),arguments.length>0){let i=t?Tt(_):n&&o?Ae(e):e;if(!_.equals(i)){if(y=!0,re(S,i),m&&void 0!==p&&(p=i),fa(_))return e;Ct((()=>Tt(_)))}return e}return fa(_)?_.v:Tt(_)}}function va(e,t,i,r){let a=i[e]?.type;if(!r||!i[e])return t;if("toAttribute"===r)switch(a){case"Object":case"Array":return null==t?null:JSON.stringify(t);case"Boolean":return t?"":null;case"Number":return t??null;default:return t}else switch(a){case"Object":case"Array":return t&&JSON.parse(t);case"Boolean":default:return t;case"Number":return null!=t?+t:t}}"function"==typeof HTMLElement&&HTMLElement;typeof window<"u"&&((a=(r=window).__svelte??(r.__svelte={})).v??(a.v=new Set)).add("5");var ga,ba={isMobile:void 0,debugLog:!1,devNullLog:!1,defaultLanguage:m.InterfaceLanguage.RU,downloadVKLanguages:!0,updateBuiltinLanguages:!0,isSmoothVideoRotate:!0,showSupport:!0,supportLink:"https://vk.com/support?act=new&from=v",showLogo:void 0,logoLink:"https://vk.com/video",logoType:"vk_video",volumeDefault:1,volumeMinRestore:.05,loaderDelay:500,minSubtitlesFontSize:13,autoSubtitlesTimeout:2e3,allowChangingFullscreenTarget:!0,trafficSavingLimit:m.VideoQuality.Q_480P,highQualityLimit:m.VideoQuality.Q_720P,episodeMinWidthPc:8,hideThumbTimerAfterTouch:!0,preventPauseOnVideoClick:!1,sentry:{dsn:"https://e349fd23c68f405388980d0868d0ff27@sentry.mvk.com/126",sampleRate:.01,whiteErrorCategoryList:[],blackErrorCategoryList:[],whiteErrorIdList:[],blackErrorIdList:[]},features:{autoplay:!0,statistics:!0,sentry:!0,preload:!0,subtitles:!0,episodes:!0,fullscreen:!0,timelinePreview:!0,mediaSession:!0,annotations:!0,slots:!0,annotationsInside:!1,pip:!0,dpip:!0,download:!0,liveRewind:!0,playbackRate:!0,trafficSaving:!0,episodesClustering:!0,copyVideoLink:!0,videoRotate:!0,interactiveGraph:!1,interactiveResponsiveUi:!1,seekToInteractive:!0,interactiveLastFrame:!1,interactiveTextPermanent:!0,interactiveHideTime:!0,interactivePlayPrevChapter:!0,interactiveTimeIndicator:!0,interactiveTimeOpenUri:!1,interactiveAreaControlShadow:!1,interactiveControlsExpectTimeBlinkAnimation:!1,thumbTimer:!0,hotKeyMapModal:!0,hotKeyHelpers:!0,saveDebugInfoToFile:!1,saveTraceInfoToFile:!1,additionalButtons:!0,additionalButtonsDesktopControlPanelRight:!0,additionalSettingsMenuItems:!0,additionalContextMenuItems:!0,contextMenuButton:!0,audioLanguages:!1,saveRate:!1,fullscreenInternalTargetPlayerContainer:!1,endScreen:!0,autoplayNext:!0,nextPrevButtons:!0,previewNoEmptySpace:!1,exposeInternalsToGlobal:!1,skipInitialPlaybackRateValue:!1,qualityDetailsSubMenuEnabled:!1,showSlowVideoNotification:!1,forceAutoQualityWhenSevereStallHappens:!1,timeoutShowSlowVideoNotification:0,maxCountShowSlowVideoNotification:1,forcePlayerDisplayBlock:!1,playbackStatusAnimationDuration:1e3,playbackStatusShow:!1,playbackStatusNextVideoShow:!1,playbackStatusNextVideoAnimationDuration:1e3},controls:{showOnStartupAtAutoplay:!0,hideTimeout:500,hideTimeoutMobile:3e3,hideTimeoutInitial:200,hideTimeoutFullscreen:3e3,hideTimeoutCursor:3e3,hideTimeoutTooltips:1e3,collapseMobileUnmute:6e3,hide360IconTimeout:3e3,hideHotKeyHelpers:2e3,playbackRateMin:.25,playbackRateMax:2,playbackRateStep:.25,volumeStepKeyboard:.05,volumeStepWheel:.05,volumeBarTimeout:300,seekStepKeyboard:1e4,seekStepMobile:15e3,seekStepFrame:400},ads:{enable:void 0,initTimeout:2e3,loadTimeout:2e3,runtimeTimeout:5e3,slot:void 0,preview:void 0,isMobileGoToSiteButton:!0,useAdmanFromNPM:!1,volumeMultiplier:1,isVsidOriginal:!1},interactive:{historyMaxLength:100,noInteractionEventTimeout:3e4},view:{timelineSliderColor:null,timelineSliderHandleColor:null,timelineSliderFilledColor:null,timelineSliderLoadedColor:null,volumeSliderColor:null,volumeSliderHandleColor:null,volumeSliderFilledColor:null,controlsTimeColor:null,timelineSliderFilledActiveLiveColor:null,timelineSliderHandleActiveLiveColor:null,buttonColor:null,buttonToggleOnColor:null,focusedColor:null}},ya=()=>di("ui-config"),wa="vk_player_debug_panel_opened",Sa="f",xa="k",$a="c",_a="m",ka=new Set(["ArrowLeft","ArrowRight","KeyL","KeyJ"]),Ta=new Set(["Tab","Space","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"]),Ca=new Set(["ShiftRight","ShiftLeft"]),Ea=["TIMELINE"],Aa=[...Ea,"GRAPH_BUTTON"],La=[...Ea,"PLAY_BUTTON"],Pa=[...Aa,"PLAY_BUTTON"],Ma=((ga=Ma||{}).XS="xs",ga.S="s",ga.M="m",ga.L="l",ga.XL="xl",ga),Ia={xs:0,s:1,m:2,l:3,xl:4},Ra="prod",Va="1.1.62",Na=(e,t,i)=>{let r=document.createElement("a");r.href=e,r.download=`${t}.${i}`,r.style.display="none",r.click()},Ba=Symbol("storeContext"),Da=Symbol("microStoresContext"),Oa=()=>{let e=di(Ba);return(0,m.assertNonNullable)(e,"Store context is empty!"),e},Fa=()=>{let e=di(Da);return(0,m.assertNonNullable)(e,"MicroStores context is empty!"),e},ja=(e,t)=>za(e,e.getValue(),t),za=(e,t,i)=>ia(t,(t=>{let r=e.subscribe((e=>{t(e),i?.(e)}));return()=>r.unsubscribe()})),Ua=class{async download(e){if(this.pendingDownloads.has(e))return null;this.pendingDownloads.add(e);try{let t=await fetch(e,{signal:this.destroyController.signal});if(t.ok)return await t.text();throw t}finally{this.pendingDownloads.delete(e)}}destroy(){this.destroyController.abort(),this.pendingDownloads.clear()}isDestroyed(){return this.destroyController.signal.aborted}constructor(){this.destroyController=new AbortController,this.pendingDownloads=new Set}},qa="vk_player_prefer_traffic_saving_enabled",Ha="vk_player_preferred_volume",Wa="vk_player_prefer_volume_mute",Qa="vk_player_preferred_quality",Ga="vk_player_preferred_default_quality_settings",Ka="vk_player_preferred_quality_settings_by_video",Ya="vk_player_preferred_stream_language",Za="vk_player_preferred_rate",Xa="vk_player_preferred_autoplay_next",Ja=e=>e>1?1:e<0?0:e,es=e=>m.safeStorage.set(Ha,Ja(e).toString(10)),ts=()=>{let e=m.safeStorage.get(Ha);return(0,m.isNullable)(e)?void 0:Ja(parseFloat(e))},is=(e,t)=>m.safeStorage.set(Qa,JSON.stringify({videoId:e,value:t})),rs=()=>m.safeStorage.remove(Qa),as=e=>{let t=m.safeStorage.get(Qa);if((0,m.isNullable)(t))return;let{videoId:i,value:r}=JSON.parse(t);if(e===i)return r;rs()},ss=(e,t)=>{t?m.safeStorage.set(e,"true"):m.safeStorage.remove(e)},ns=e=>"true"===m.safeStorage.get(e),os=e=>ss(Wa,e),ls=e=>ss(qa,e),us=()=>ns(qa),ds=e=>m.safeStorage.set(Ya,e),{getPreferredQualitySettings:cs,migrateSettingsToLegacyWay:hs,savePreferredQualitySettings:ps,savePreferredDefaultQualitySettings:fs,removePreferredQualitySettingsByVideo:ms,getPreferredDefaultQualitySettings:vs}=(()=>{let e=e=>{m.safeStorage.set(Ga,JSON.stringify(e))},t=()=>{try{let e=m.safeStorage.get(Ga);return e?JSON.parse(e):null}catch{return null}},i=e=>{m.safeStorage.set(Ka,JSON.stringify(e))},r=i=>{s(i);let r=i?(()=>{try{let e=m.safeStorage.get(Ka);return e?JSON.parse(e):null}catch{return null}})():null;if(r&&r?.videoId===i)return{...r,appliesTo:"to-video"};r&&a();let n=t();return n?{...n,appliesTo:"as-default"}:(e({type:"auto_quality"}),{type:"auto_quality",appliesTo:"as-default"})},a=()=>{m.safeStorage.remove(Ka)},s=t=>{let r=as(t);r?i({type:"exact_quality",videoId:t,quality:r}):(us()&&e({type:"traffic_saving",videoId:t}),ls(!1),rs())};return{getPreferredQualitySettings:r,migrateSettingsToLegacyWay:e=>{let t=r(e);if(t){switch(t.type){case"traffic_saving":ls(!0);break;case"exact_quality":is(e,t.quality)}a(),m.safeStorage.remove(Ga)}},savePreferredQualitySettings:(t,r="as-default")=>{"exact_quality"===t.type?i(t):"as-default"===r?e(t):i(t)},savePreferredDefaultQualitySettings:e,removePreferredQualitySettingsByVideo:a,getPreferredDefaultQualitySettings:t}})(),gs=Oi('<svg><!><g filter="url(#a)"><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M67 9.489A3.49 3.49 0 0 1 63.511 13 3.493 3.493 0 0 1 60 9.489 3.49 3.49 0 0 1 63.511 6 3.484 3.484 0 0 1 67 9.489m-5.003 0c0 .834.68 1.514 1.514 1.514.812 0 1.492-.68 1.492-1.514 0-.812-.68-1.492-1.492-1.492-.834 0-1.514.68-1.514 1.492" clip-rule="evenodd"></path><path fill="var(--btn-color, #fff)" d="M26.86 15.183c1.372-.492 2.534-1.711 2.534-3.61C29.394 8.922 27.185 7 24.07 7c-1.965 0-3.573.784-4.67 2.29l-.108.149a1.333 1.333 0 0 0 .268 1.855c.536.402 1.295.343 1.736-.162.09-.102.164-.19.205-.247.594-.81 1.431-1.306 2.5-1.306 1.534 0 2.604.915 2.604 2.251 0 1.36-1.093 2.275-2.651 2.275h-.583a1.231 1.231 0 0 0 0 2.462h.583c1.744 0 2.907.985 2.907 2.392 0 1.453-1.186 2.462-2.884 2.462-1.296 0-2.201-.552-2.883-1.603a10 10 0 0 0-.2-.287 1.403 1.403 0 0 0-2.052-.246c-.494.42-.65 1.13-.305 1.68.072.116.146.227.218.322C20.132 23.137 21.678 24 23.999 24c3.28 0 5.628-2.04 5.628-4.924 0-2.204-1.395-3.4-2.767-3.893"></path><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M37.732 12.675c-.465 0-1 .046-1.511.164l2.584-3.74a1.338 1.338 0 1 0-2.203-1.518l-3.753 5.469c-1.418 2.133-1.837 3.822-1.837 5.276 0 3.47 2.558 5.674 6.186 5.674 3.604 0 6.162-2.392 6.162-5.768 0-3.236-2.349-5.557-5.628-5.557m-.534 8.746c-1.977 0-3.326-1.267-3.326-3.142 0-1.853 1.349-3.142 3.326-3.142 1.953 0 3.302 1.29 3.302 3.142 0 1.875-1.35 3.142-3.302 3.142M58 15.512c0 5.041-2.697 8.441-6.627 8.441s-6.628-3.4-6.628-8.441 2.698-8.442 6.628-8.442S58 10.47 58 15.512m-10.348 0c0 3.564 1.488 5.862 3.72 5.862s3.721-2.298 3.721-5.862-1.488-5.862-3.72-5.862-3.72 2.298-3.72 5.862Z" clip-rule="evenodd"></path><path fill="var(--btn-color, #fff)" d="M67 23.5c0-1.318-1.201-3.094-4.199-4.673a1.5 1.5 0 1 1 1.398-2.654C67.452 17.886 70 20.433 70 23.5c0 3.126-2.556 5.554-6.088 7.27-3.633 1.766-8.825 3.062-15.259 3.722a1.5 1.5 0 0 1-.306-2.984c6.248-.641 11.057-1.882 14.253-3.436C65.897 26.47 67 24.8 67 23.5M38.879 35H38c-9.64 0-17.447-1.133-22.9-3.018-2.72-.941-4.94-2.099-6.506-3.468C7.019 27.138 6 25.445 6 23.5c0-1.64.785-3.073 1.908-4.255 1.119-1.179 2.66-2.205 4.42-3.086a1.5 1.5 0 1 1 1.343 2.682c-1.584.793-2.794 1.634-3.588 2.47C9.293 22.143 9 22.873 9 23.5c0 .807.407 1.74 1.568 2.755 1.17 1.022 2.996 2.02 5.513 2.892C21.106 30.885 28.55 32 38 32h.879l-1.44-1.44a1.5 1.5 0 0 1 2.122-2.12l3.999 3.998.01.011a1.5 1.5 0 0 1 .317 1.624 1.5 1.5 0 0 1-.326.488l-4 4a1.5 1.5 0 0 1-2.122-2.122L38.88 35Z"></path><path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-opacity=".12" stroke-width=".5" d="m7.908 19.245-.181-.173c1.146-1.206 2.714-2.248 4.49-3.137a1.75 1.75 0 1 1 1.566 3.13c-1.57.786-2.752 1.61-3.519 2.418-.762.802-1.014 1.474-1.014 2.017 0 .713.357 1.583 1.483 2.567 1.136.993 2.93 1.978 5.43 2.843 4.99 1.726 12.403 2.84 21.837 2.84h.275l-1.012-1.013a1.75 1.75 0 1 1 2.474-2.474l4 3.998h0l.012.013s0 0 0 0c.162.165.284.354.368.556q0 0 0 0l-.23.096A1.5 1.5 0 0 1 44 33.5q-.002.306-.113.573L7.907 19.245Zm0 0-.181-.173C6.576 20.284 5.75 21.775 5.75 23.5c0 2.04 1.07 3.796 2.68 5.202 1.599 1.398 3.85 2.569 6.589 3.516C20.506 34.116 28.343 35.25 38 35.25h.275zm29.824-6.82c-.3 0-.63.018-.965.063l2.244-3.247c.728-1.054-.026-2.491-1.306-2.491-.524 0-1.014.258-1.31.69l-3.752 5.468h0l-.002.003c-1.442 2.17-1.879 3.905-1.879 5.415 0 1.8.665 3.288 1.815 4.324 1.147 1.033 2.757 1.6 4.62 1.6 3.727 0 6.413-2.488 6.413-6.018 0-3.377-2.464-5.807-5.878-5.807m25.779.825c2.07 0 3.739-1.67 3.739-3.761 0-2.07-1.67-3.739-3.739-3.739a3.74 3.74 0 0 0-3.761 3.739 3.743 3.743 0 0 0 3.761 3.761m0-2.497a1.267 1.267 0 0 1-1.264-1.264c0-.671.566-1.242 1.264-1.242.674 0 1.242.568 1.242 1.242 0 .698-.57 1.264-1.242 1.264m-33.634 8.323c0-2.043-1.139-3.272-2.388-3.895 1.208-.629 2.155-1.846 2.155-3.609 0-2.82-2.357-4.822-5.575-4.822-2.04 0-3.724.818-4.871 2.392l-.109.149a1.583 1.583 0 0 0 .32 2.203c.635.476 1.542.411 2.074-.197.09-.103.17-.198.219-.264.553-.755 1.318-1.204 2.297-1.204.72 0 1.309.214 1.715.564.403.347.64.84.64 1.437 0 .608-.242 1.107-.653 1.457-.415.353-1.017.568-1.748.568h-.583a1.481 1.481 0 0 0 0 2.962h.583c.826 0 1.493.233 1.948.61.451.375.709.902.709 1.532 0 .654-.265 1.2-.718 1.586-.455.388-1.116.626-1.916.626-.61 0-1.117-.13-1.548-.375s-.801-.614-1.125-1.114a11 11 0 0 0-.206-.296 1.653 1.653 0 0 0-2.417-.292c-.577.49-.774 1.335-.356 2.004.075.119.152.236.23.339.704.945 1.462 1.652 2.352 2.121.892.47 1.9.692 3.094.692 3.383 0 5.877-2.121 5.877-5.174m7.32 2.095c-.934 0-1.7-.299-2.232-.8-.53-.5-.843-1.217-.843-2.092 0-.863.313-1.581.844-2.085s1.298-.807 2.232-.807c.92 0 1.682.303 2.21.807.529.503.842 1.222.842 2.085 0 .875-.314 1.593-.84 2.093-.53.5-1.29.799-2.212.799Zm14.176 3.032c2.044 0 3.772-.887 4.983-2.425 1.208-1.534 1.894-3.703 1.894-6.266s-.686-4.732-1.894-6.266c-1.211-1.539-2.94-2.426-4.983-2.426-2.044 0-3.773.887-4.984 2.426-1.208 1.534-1.894 3.703-1.894 6.266s.686 4.732 1.894 6.266c1.211 1.538 2.94 2.425 4.984 2.425m0-3.08c-1.017 0-1.874-.518-2.487-1.478-.618-.968-.984-2.382-.984-4.133 0-1.752.366-3.166.984-4.133.613-.96 1.47-1.48 2.487-1.48s1.873.52 2.486 1.48c.618.967.984 2.381.984 4.133 0 1.751-.366 3.165-.984 4.133-.613.96-1.47 1.479-2.486 1.479Zm11.312-2.075c2.975 1.567 4.065 3.279 4.065 4.452 0 1.148-.983 2.756-4.259 4.347-3.16 1.536-7.937 2.773-14.17 3.412a1.75 1.75 0 0 0 .358 3.482c6.45-.662 11.673-1.963 15.342-3.746 3.551-1.725 6.229-4.216 6.229-7.495 0-3.213-2.661-5.825-5.935-7.548a1.75 1.75 0 1 0-1.63 3.096"></path></g><defs><filter id="a" width="75" height="44" x=".5" y=".5" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset></feOffset><feGaussianBlur stdDeviation="2.5"></feGaussianBlur><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.16 0"></feColorMatrix><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_618_12297"></feBlend><feBlend in="SourceGraphic" in2="effect1_dropShadow_618_12297" result="shape"></feBlend></filter></defs></svg>');function bs(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=gs();let a;hr(Ne(r),(()=>t.children??D)),Ce(2),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"76",height:"45",fill:"none","data-testid":"video-360-icon",role:"img",...i}))),zi(e,r)}var ys={auto_quality_invariant:"Авто",auto_quality:"Авто ({actual})",auto_quality_option:"Авто",other_quality:"Другое",high_quality:"Высокое качество",high_quality_description:"Будет использовано больше трафика",auto_quality_limit:"Автоматически",traffic_saving_quality:"Экономия трафика",traffic_saving_quality_description:"Видео грузятся быстрее, но качество ниже",default_quality_for_any_video:"Качество для всех видео",quality_applience:"Качество по умолчанию можно {action}",quality_applience_action:"изменить",menu_quality:"Качество",menu_traffic_saving:"Экономия данных",menu_playback_rate:"Скорость",menu_report:"Сообщить о проблеме",menu_pip:"Картинка в картинке",menu_copy_video_link:"Скопировать ссылку на видео",menu_copy_video_link_with_timestamp:"Скопировать ссылку на кадр",menu_video_rotate:"Повернуть",menu_video_loop_on:"Включить повторение",menu_video_loop_off:"Отключить повторение",menu_chromecast:"Chromecast трансляция",menu_copy_debug:"Копировать данные для диагностики",menu_save_debug:"Сохранить данные для диагностики",menu_debug_overlay:"Техническая информация",menu_copy_embed_code:"Копировать код для встраивания",menu_audio_languages:"Звуковая дорожка",audio_stream_display_language_label:"{label} ({language})",audio_stream_display_language_label_index:"{label} {index} ({language})",audio_stream_display_label_index:"{label} {index}",audio_stream_display_language_index:"{language} {index}",audio_stream_display_unknown:"Дорожка {index}",pip_dummy_title:"Видео воспроизводится в режиме картинка в картинке",submenu_quality:"Качество",submenu_playback_rate:"Скорость",submenu_settings:"Настройки",submenu_traffic_saving:"Экономия данных",submenu_audio_languages:"Звуковая дорожка",mobile_unmute:"Включить звук",playing_ads:"Реклама {timeleft}",skip_ads_now:"Пропустить рекламу",skip_ads_after:"Пропустить {time}с",visit_advertiser:"Перейти на сайт",aria_timeline:"Ползунок временной шкалы",aria_timeline_value:"{position} (общая длительность {duration}",aria_open_settings:"Открыть настройки видеоплеера",doubletap_seek_step:"{seconds} секунд",playback_rate_1:"Обычная",playback_rate:"{multiplier}x",video360:"панорамное видео",subtitles_caption:"Субтитры",subtitles_auto:"{language} (Автоматические)",subtitles_off:"Выкл.",subtitles_auto_caption:"Автоматические субтитры",subtitles_turn_on:"Включить субтитры",subtitles_turn_off:"Выключить субтитры",traffic_saving_off:"Откл.",traffic_saving_on:"Вкл.",traffic_saving_disable:"Отключена",traffic_saving_enable:"Включена",traffic_saving_helper_text:"При включении качество видео будет снижено для экономии трафика",tooltip_button_disabled:"Кнопка недоступна",tooltip_previous:"Предыдущее видео",tooltip_restart:"Начать заново",tooltip_play:"Смотреть",tooltip_pause:"Пауза",tooltip_next:"Следующее видео",tooltip_interactive_go_back:"Вернуться к предыдущей главе",tooltip_interactive_go_back_disabled:"История прохождения недоступна",tooltip_interactive_go_back_disabled_first:"Вы смотрите первую главу",tooltip_interactive_go_back_disabled_limit:"Лимит возвратов исчерпан",tooltip_chapter_without_interactive:"В этой главе нет интерактива",tooltip_interactive_of_chapter_completed:"Интерактивы этой главы уже пройдены",tooltip_interactive_seek:"Перейти к интерактиву",tooltip_interactive_graph_off:"Показать карту сюжета",tooltip_interactive_graph_on:"Скрыть карту сюжета",tooltip_live:"Перемотать на актуальный лайв",tooltip_episodes:"Эпизоды",tooltip_volume:"Включить звук",tooltip_volume_muted:"Выключить звук",tooltip_subtitles_off:"Включить субтитры",tooltip_subtitles_on:"Выключить субтитры",tooltip_settings_off:"Открыть настройки",tooltip_settings_on:"Закрыть настройки",tooltip_fullscreen_off:"На весь экран",tooltip_fullscreen_on:"Выйти из полноэкранного режима",tooltip_chromecast_off:"Включить Chromecast",tooltip_chromecast_on:"Выключить Chromecast",tooltip_episode_finished:"Вы уже сделали свой выбор",tooltip_episode_unfinished:"Не пройдено",tooltip_disabled_when_interactive:"Интерактив уже идёт",tooltip_disabled_when_graph_on:"Кнопка недоступна во время просмотра карты",tooltip_interactive_interaction_time_indicator:"Нажмите на элемент интерактива",tooltip_vk_logo:"Открыть в VK Видео",tooltip_vk_video_logo:"Перейти в VK Видео",tooltip_autoplay_off:"Включить автовоспроизведение",tooltip_autoplay_on:"Отключить автовоспроизведение",download_video_caption:"Скачать видео",hotkey_helper_current_volume:"{value} %",hotkey_map_modal_title:"Быстрые клавиши",hotkey_map_modal_close_btn_text:"Закрыть",hotkey_map_group_title_common:"Общие",hotkey_map_group_title_playback:"Воспроизведение",hotkey_map_group_title_subtitles:"Субтитры",hotkey_map_group_title_episodes:"Эпизоды",hotkey_map_item_mute_description:"Включить или отключить звук",hotkey_map_item_mute_value:"m",hotkey_map_item_volume_up_description:"Увеличить громкость",hotkey_map_item_volume_up_value:"Стрелка вверх",hotkey_map_item_volume_down_description:"Уменьшить громкость",hotkey_map_item_volume_down_value:"Стрелка вниз",hotkey_map_item_pip_description:"Свернуть или развернуть мини-проигрыватель",hotkey_map_item_pip_value:"i",hotkey_map_item_full_screen_description:"Включить или выключить полноэкранный режим",hotkey_map_item_full_screen_value:"f",hotkey_map_item_show_context_menu_description:"Скрыть или показать контекстное меню",hotkey_map_item_show_context_menu_value:"Shift + !",hotkey_map_item_show_hotkey_map_description:"Скрыть или показать список горячих клавиш",hotkey_map_item_show_hotkey_map_value:"Shift + ?",hotkey_map_item_play_toggle_description:"Приостановить или продолжить воспроизведение",hotkey_map_item_play_toggle_value:"Пробел (или k)",hotkey_map_item_seek_backward_description:"Перемотать ролик на 10 секунд назад",hotkey_map_item_seek_backward_value:"Стрелка влево (или j)",hotkey_map_item_seek_forward_description:"Перемотать ролик на 10 секунд вперёд",hotkey_map_item_seek_forward_value:"Стрелка вправо (или l)",hotkey_map_item_fast_seek_backward_description:"Ускоренная перемотка назад",hotkey_map_item_fast_seek_backward_value:"Shift + Стрелка влево",hotkey_map_item_fast_seek_forward_description:"Ускоренная перемотка вперёд",hotkey_map_item_fast_seek_forward_value:"Shift + Стрелка вправо",hotkey_map_item_rate_down_description:"Уменьшить скорость воспроизведения",hotkey_map_item_rate_down_value:"< (Shift + ,)",hotkey_map_item_rate_up_description:"Увеличить скорость воспроизведения",hotkey_map_item_rate_up_value:"> (Shift + .)",hotkey_map_item_prev_frame_description:"Перейти к предыдущему кадру <br />(когда воспроизведение приостановлено)",hotkey_map_item_prev_frame_value:",",hotkey_map_item_next_frame_description:"Перейти к следующему кадру <br />(когда воспроизведение приостановлено)",hotkey_map_item_next_frame_value:".",hotkey_map_item_jump_seek_description:"Перейти к определённому моменту видео <br />(например, при нажатии на цифру «7» ролик будет перемотан до временной отметки, которая соответствует 70% от длительности видео)",hotkey_map_item_jump_seek_value:"0, 1, 2, 3, 4, 5, 6, 7, 8, 9",hotkey_map_item_subtitles_toggle_description:"Включить или отключить субтитры",hotkey_map_item_subtitles_toggle_value:"c",hotkey_map_item_prev_episode_description:"Перейти к предыдущему эпизоду",hotkey_map_item_prev_episode_pc_value:"Ctrl + Стрелка влево",hotkey_map_item_prev_episode_mac_value:"Option + Стрелка влево",hotkey_map_item_next_episode_description:"Перейти к следующему эпизоду",hotkey_map_item_next_episode_pc_value:"Ctrl + Стрелка вправо",hotkey_map_item_next_episode_mac_value:"Option + Стрелка вправо",hotkey_map_item_next_video_description:"Перейти к следующему видео",hotkey_map_item_next_video_value:"Shift + N",hotkey_map_item_prev_video_description:"Перейти к предыдущему видео",hotkey_map_item_prev_video_value:"Shift + P",waiting_live_day_value:"дн",waiting_live_hour_value:"ч",waiting_live_minute_value:"мин",waiting_live_second_value:"сек",waiting_live_colon:":",waiting_live_upcoming_title:"Трансляция еще не началась",waiting_live_timer_title:"До начала трансляции осталось",waiting_live_recover_title:"Трансляция приостановлена - она продолжится, когда автор вернётся",waiting_record_title:"Трансляция завершена - запись появится позже",aria_label_video_player:"Видео плеер",aria_label_spherical_control:"Контроллер для сферического видео. Используйте клавиши со стрелками для панорамирования видео.",aria_label_debug_panel:"Область с технической информацией, сделайте скриншот для техподдержки",aria_label_new_tab_alert:"Откроется в новой вкладке.",aria_label_context_menu_open:"Открыть контекстное меню",aria_label_context_menu_close:"Закрыть контекстное меню",aria_label_menu_quality:"Качество: {actual}",aria_label_menu_audio_languages:"Язык аудио: {actual}",aria_label_menu_rate:"Скорость: {actual}",aria_label_menu_subtitle:"Субтитры: {actual}",aria_label_menu_download:"Скачать видео",aria_label_menu_debug_overlay_enable:"Включить отображение технической информации",aria_label_menu_debug_overlay_disable:"Выключить отображение технической информации",aria_label_menu_rotate:"Повернуть видео на 90 градусов",aria_label_menu_loop:"Переключение режима повторения",aria_label_submenu_back:"Вернуться в меню настроек",aria_label_submenu_traffic_saving_off:"Выключить режим экономии данных",aria_label_submenu_traffic_saving_on:"Включить режим экономии данных",end_screen_next_video:"Следующее видео",end_screen_recommended_video:"Рекомендуемое видео",slow_video_notification_button:"Выбрать качество «Авто»",slow_video_notification_force_description:"Видео грузится слишком медленно,\nкачество изменено на «Авто»",slow_video_notification_suggest_description:"Видео загружается слишком медленно -\nпопробуйте изменить качество на «Авто»"},ws={mobile_unmute:"Unmute",auto_quality_invariant:"Auto",auto_quality:"Auto ({actual})",auto_quality_option:"Auto",other_quality:"Other",high_quality:"High quality",high_quality_description:"Uses more data",auto_quality_limit:"Auto",traffic_saving_quality:"Data saving",traffic_saving_quality_description:"Videos load faster but at lower quality",quality_applience:"You can {action} the default quality",quality_applience_action:"change",default_quality_for_any_video:"Quality for all videos",menu_quality:"Quality",menu_playback_rate:"Playback rate",menu_traffic_saving:"Data saving",menu_report:"Report a problem",menu_pip:"Picture in picture",menu_copy_video_link:"Copy video link",menu_copy_video_link_with_timestamp:"Copy link with timestamp",menu_video_rotate:"Rotate",menu_video_loop_on:"Enable loop",menu_video_loop_off:"Disable loop",menu_chromecast:"Chromecast stream",menu_copy_debug:"Copy debug info",menu_save_debug:"Save debug info",menu_debug_overlay:"Tech stats",menu_copy_embed_code:"Copy embed code",menu_audio_languages:"Audio track",audio_stream_display_language_label:"{label} ({language})",audio_stream_display_language_label_index:"{label} {index} ({language})",audio_stream_display_label_index:"{label} {index}",audio_stream_display_language_index:"{language} {index}",audio_stream_display_unknown:"Audio track {index}",pip_dummy_title:"Video plays in picture-in-picture mode",submenu_quality:"Quality",submenu_playback_rate:"Playback rate",submenu_traffic_saving:"Data saving",submenu_settings:"Settings",submenu_audio_languages:"Audio track",playing_ads:"Ads {timeleft}",skip_ads_after:"Skip ads",skip_ads_now:"Skip {time}s",visit_advertiser:"Visit site",aria_timeline:"Time scale slider",aria_timeline_value:"{position} out of {duration}",aria_open_settings:"Open video player settings",doubletap_seek_step:"{seconds} seconds",playback_rate_1:"Normal",playback_rate:"{multiplier}x",video360:"spherical video",subtitles_caption:"Subtitles",subtitles_auto:"{language} (Auto-generated)",subtitles_off:"Off",subtitles_auto_caption:"Auto subtitles",subtitles_turn_on:"Turn on subtitles",subtitles_turn_off:"Turn off subtitles",traffic_saving_off:"Off",traffic_saving_on:"On",traffic_saving_disable:"Disabled",traffic_saving_enable:"Enabled",traffic_saving_helper_text:"When turned on the video quality will be reduced to save data",tooltip_button_disabled:"Button disabled",tooltip_previous:"Previous video",tooltip_restart:"Watch again",tooltip_play:"Play",tooltip_pause:"Pause",tooltip_next:"Next video",tooltip_interactive_go_back:"Back to previous chapter",tooltip_interactive_go_back_disabled:"Interactive history unavailable",tooltip_interactive_go_back_disabled_first:"You're watching the first chapter",tooltip_interactive_go_back_disabled_limit:"Go-back limit exceeded",tooltip_chapter_without_interactive:"This chapter has no interactive segment",tooltip_interactive_of_chapter_completed:"Chapter's interactive segments already watched",tooltip_interactive_seek:"Go to interactive",tooltip_interactive_graph_off:"Show interactive graph",tooltip_interactive_graph_on:"Hide interactive graph",tooltip_live:"Go to the live edge",tooltip_episodes:"Episodes",tooltip_volume:"Turn volume off",tooltip_volume_muted:"Turn volume on",tooltip_subtitles_off:"Turn subtitles on",tooltip_subtitles_on:"Turn subtitles off",tooltip_settings_off:"Open settings",tooltip_settings_on:"Close settings",tooltip_fullscreen_off:"Enter fullscreen mode",tooltip_fullscreen_on:"Exit fullscreen mode",tooltip_chromecast_off:"Turn Chromecast on",tooltip_chromecast_on:"Turn Chromecast off",tooltip_episode_finished:"You have already viewed interactive episode",tooltip_episode_unfinished:"Interactive episode not finished",tooltip_disabled_when_interactive:"Interactive video in progress",tooltip_disabled_when_graph_on:"Button is disabled when graph is opened",tooltip_interactive_interaction_time_indicator:"Press the interactive element",tooltip_vk_logo:"Open in VK Video",tooltip_vk_video_logo:"Go to VK Video",tooltip_autoplay_off:"Turn autoplay on",tooltip_autoplay_on:"Turn autoplay off",download_video_caption:"Download video",hotkey_helper_current_volume:"{value} %",hotkey_map_modal_title:"Keyboard shortcuts",hotkey_map_modal_close_btn_text:"Close",hotkey_map_group_title_common:"Common",hotkey_map_group_title_playback:"Playback",hotkey_map_group_title_subtitles:"Subtitles",hotkey_map_group_title_episodes:"Episodes",hotkey_map_item_mute_description:"Toggle mute",hotkey_map_item_mute_value:"m",hotkey_map_item_volume_up_description:"Increase volume",hotkey_map_item_volume_up_value:"Arrow up",hotkey_map_item_volume_down_description:"Decrease volume",hotkey_map_item_volume_down_value:"Arrow down",hotkey_map_item_pip_description:"Toggle miniplayer",hotkey_map_item_pip_value:"i",hotkey_map_item_full_screen_description:"Toggle full screen",hotkey_map_item_full_screen_value:"f",hotkey_map_item_show_context_menu_description:"Hide or show context menu",hotkey_map_item_show_context_menu_value:"Shift + !",hotkey_map_item_show_hotkey_map_description:"Hide or show list of hotkeys",hotkey_map_item_show_hotkey_map_value:"Shift + ?",hotkey_map_item_play_toggle_description:"Toggle play/pause",hotkey_map_item_play_toggle_value:"Space (or k)",hotkey_map_item_seek_backward_description:"Rewind 10 seconds",hotkey_map_item_seek_backward_value:"Arrow left (or j)",hotkey_map_item_seek_forward_description:"Forward 10 seconds",hotkey_map_item_seek_forward_value:"Arrow right (or l)",hotkey_map_item_fast_seek_backward_description:"Fast rewind",hotkey_map_item_fast_seek_backward_value:"Shift + Arrow left",hotkey_map_item_fast_seek_forward_description:"Fast forward",hotkey_map_item_fast_seek_forward_value:"Shift + Arrow right",hotkey_map_item_rate_down_description:"Decrease playback rate",hotkey_map_item_rate_down_value:"< (Shift + ,)",hotkey_map_item_rate_up_description:"Increase playback rate",hotkey_map_item_rate_up_value:"> (Shift + .)",hotkey_map_item_prev_frame_description:"Previous frame (while paused)",hotkey_map_item_prev_frame_value:",",hotkey_map_item_next_frame_description:"Next frame (while paused)",hotkey_map_item_next_frame_value:".",hotkey_map_item_jump_seek_description:"Seek to specific point in the video (7 advances to 70% of duration)",hotkey_map_item_jump_seek_value:"0, 1, 2, 3, 4, 5, 6, 7, 8, 9",hotkey_map_item_subtitles_toggle_description:"Toggle captions ON/OFF",hotkey_map_item_subtitles_toggle_value:"c",hotkey_map_item_prev_episode_description:"Seek to previous episode",hotkey_map_item_prev_episode_pc_value:"Ctrl + Arrow left",hotkey_map_item_prev_episode_mac_value:"Option + Arrow left",hotkey_map_item_next_episode_description:"Seek to next episode",hotkey_map_item_next_episode_pc_value:"Ctrl + Arrow right",hotkey_map_item_next_episode_mac_value:"Option + Arrow right",hotkey_map_item_next_video_description:"Next video",hotkey_map_item_next_video_value:"Shift + N",hotkey_map_item_prev_video_description:"Previous video",hotkey_map_item_prev_video_value:"Shift + P",waiting_live_day_value:"d",waiting_live_hour_value:"h",waiting_live_minute_value:"min",waiting_live_second_value:"sec",waiting_live_colon:":",waiting_live_upcoming_title:"The broadcast hasn't started yet",waiting_live_timer_title:"Before the start of the broadcast left",waiting_live_recover_title:"The broadcast has been paused - it will resume when the author returns",waiting_record_title:"The broadcast completed - recording will appear later",aria_label_video_player:"Video player",aria_label_spherical_control:"Spherical video control. Use the arrow keys to pan the video.",aria_label_debug_panel:"Technical information area, take a screenshot for technical support",aria_label_new_tab_alert:"Opens in a new tab.",aria_label_context_menu_open:"Open context menu",aria_label_context_menu_close:"Close context menu",aria_label_menu_quality:"Quality: {actual}",aria_label_menu_audio_languages:"Audio language: {actual}",aria_label_menu_rate:"Rate: {actual}",aria_label_menu_subtitle:"Subtitles: {actual}",aria_label_menu_download:"Download video",aria_label_menu_debug_overlay_enable:"Enable display of technical information",aria_label_menu_debug_overlay_disable:"Disable display of technical information",aria_label_menu_rotate:"Rotate video 90 degrees",aria_label_menu_loop:"Toggle loop",aria_label_submenu_back:"Return to settings menu",aria_label_submenu_traffic_saving_off:"Disable data saving mode",aria_label_submenu_traffic_saving_on:"Enable data saving mode",end_screen_next_video:"Next video",end_screen_recommended_video:"Recommended video",slow_video_notification_button:"Select Auto quality",slow_video_notification_force_description:"The video is loading too slowly,\nso the quality was changed to Auto",slow_video_notification_suggest_description:"The video is loading too slowly.\nTry switching the quality to Auto."},Ss=new Map;Ss.set(m.InterfaceLanguage.EN,ws),Ss.set(m.InterfaceLanguage.RU,ys);var xs,$s,_s=new Map,ks=({language:e,pack:t,fallback:i})=>{if(Ss.has(e)){let i=Ss.get(e);Ss.set(e,{...i,...t})}else Ss.set(e,t);_s.set(e,i)},Ts=e=>Ss.has(e),Cs=(e,t,i,r)=>{let a=Ss.get(e)?.[t];if((0,m.isNullable)(a)){let i=_s.get(e)??r;a=(i?Ss.get(i):void 0)?.[t]}return(0,m.isNullable)(a)?t+Object.values(i??{}).join(" "):i?a.replaceAll(/{(\w+?)}/g,((e,t)=>i[t]??"")):a},Es=(e,t)=>{let{interfaceLanguage$:i}=Oa(),r=sa(i),a=ya();return Cs(r,e,t,a.defaultLanguage)};($s=xs||(xs={})).fatal="fatal",$s.error="error",$s.warning="warning",$s.log="log",$s.info="info",$s.debug="debug",$s.critical="critical";var As=/^\s*at (?:(.*?) ?\()?((?:file|https?|blob|chrome-extension|address|native|eval|webpack|<anonymous>|[-a-z]+:|.*bundle|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,Ls=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:file|https?|blob|chrome|webpack|resource|moz-extension).*?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js))(?::(\d+))?(?::(\d+))?\s*$/i,Ps=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,Ms="?",Is=/^(?:(\w+):)\/\/(?:([\w-]+)(?::(\w+))?@)([\w.-]+)(?::(\d+))?\/(.+)/;function Rs(e){return(e&&e.message||"No error message").split("\n").filter((e=>!!e))[0]}function Vs(e){try{let t=function(e){if(!e.stack)return null;let t,i,r=[],a=e.stack.split("\n");for(let s=0;s<a.length;++s){if(t=As.exec(a[s]))i={filename:t[2]&&0===t[2].indexOf("address at ")?t[2].substr(11):t[2],function:t[1]||Ms,lineno:t[3]?+t[3]:null,colno:t[4]?+t[4]:null};else if(t=Ps.exec(a[s]))i={filename:t[2],function:t[1]||Ms,lineno:+t[3],colno:t[4]?+t[4]:null};else{if(!(t=Ls.exec(a[s])))continue;0===s&&!t[5]&&void 0!==e.columnNumber&&(r[0].column=e.columnNumber+1),i={filename:t[3],function:t[1]||Ms,lineno:t[4]?+t[4]:null,colno:t[5]?+t[5]:null}}!i.function&&i.lineno&&(i.function=Ms),r.push(i)}return r.length?{value:Rs(e),type:e.name,stacktrace:{frames:r.reverse()}}:null}(e);if(t)return t}catch{}return{value:Rs(e),type:e&&e.name,stacktrace:{frames:[]}}}var Ns=class{prepare(e){return{...this.getRequestBlank(),exception:{values:[Vs(e)]}}}report(e){this.send(this.prepare(e))}send(e){!this.apiUrl||!e||this.createRequest(e)}createRequest(e){let t=new XMLHttpRequest;t.open("POST",this.apiUrl,!0),t.setRequestHeader("Content-type","application/json"),t.setRequestHeader("X-Sentry-Auth",this.authHeader||""),t.send(JSON.stringify(e))}getRequestBlank(){return{platform:"javascript",event_id:"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),sdk:{name:"micro-sentry.javascript.core",version:"0.0.0"},timestamp:Date.now()/1e3,environment:this.environment}}constructor(e){if(e&&e.dsn){let t=Is.exec(e.dsn),i=t?t.slice(1):[],r=i[5].split("/"),a=r.slice(0,-1).join("/");this.apiUrl=i[0]+"://"+i[3]+(i[4]?":"+i[4]:"")+(a?"/"+a:"")+"/api/"+r.pop()+"/store/",this.authHeader="Sentry sentry_version=7,sentry_key="+i[1]+(i[2]?",sentry_secret="+i[2]:"")}this.environment=e&&e.environment}};function Bs(e,t){return"[object RegExp]"===Object.prototype.toString.call(t)?t.test(e):"string"==typeof t&&-1!==e.indexOf(t)}var Ds=class e extends Ns{get state(){return this._state}clearState(){this._state={}}setTags(e){return this.setKeyState("tags",{...e}),this}setTag(e,t){return this.extendState({tags:{[e]:t}}),this}setExtra(e,t){return this.extendState({extra:{[e]:t}}),this}setExtras(e){return this.setKeyState("extra",{...e}),this}setUser(e){return this.setKeyState("user",{...e}),this}clone(){let t=new e({...this.options,plugins:[]});return t.extendState(this.state),t}withScope(e){let t=this.clone();e(t),t.destroy(),this.setBreadcrumbs(void 0)}addBreadcrumb(e){this.extendState({breadcrumbs:[{timestamp:Date.now()/1e3,...this.beforeBreadcrumb(e)}]})}setBreadcrumbs(e){this.setKeyState("breadcrumbs",e)}captureMessage(e,t){this.send({...this.getRequestBlank(),message:e,level:t})}destroy(){this.destroyed=!0,this.plugins.forEach((e=>{e.destroy&&e.destroy()}))}isIgnoredError(e){return!!this.ignoreErrors.length&&this.getPossibleEventMessages(e).some((e=>this.ignoreErrors.some((t=>Bs(e,t)))))}getRequestBlank(){return{request:{url:this.window.location.toString(),headers:{"User-Agent":this.window.navigator.userAgent}},...super.getRequestBlank(),sdk:{name:"micro-sentry.javascript.browser",version:"0.0.0"},...this.state}}send(e){this.destroyed||this.isDeniedUrl(e)||this.isIgnoredError(e)||(super.send(this.beforeSend({release:this.release,...e})),this.setBreadcrumbs(void 0))}getPossibleEventMessages(e){if(e.message)return[e.message];if(e.exception)try{let{type:t="",value:i=""}=e.exception.values&&e.exception.values[0]||{};return[`${i}`,`${t}: ${i}`]}catch{return[]}return[]}isDeniedUrl(e){if(!this.blacklistUrls.length)return!1;let t=this.getEventFilterUrl(e);return!!t&&this.blacklistUrls.some((e=>Bs(t,e)))}getEventFilterUrl(e){try{if(e.exception){let t=e.exception.values&&e.exception.values[0].stacktrace&&e.exception.values[0].stacktrace.frames;return t&&t[t.length-1].filename||null}return null}catch{return null}}extendState(e){this._state=Object.keys(e).reduce(((t,i)=>{let r=this._state[i],a=Array.isArray(r)?r:null,s=e[i],n=Array.isArray(s)?s:null;return{...t,[i]:a||n?[...a||[],...n||[]]:{..."string"!=typeof r?r:{},..."string"!=typeof s?s:{}}}}),this._state)}setKeyState(e,t){this._state[e]=t}constructor(e,t=function(){return window}()){super(e),this.options=e,this.window=t,this.destroyed=!1,this._state={};let{plugins:i=[],beforeSend:r=e=>e,beforeBreadcrumb:a=e=>e,blacklistUrls:s=[],ignoreErrors:n=[],release:o}=this.options||{};this.plugins=i.map((e=>new e(this))),this.beforeSend=r,this.beforeBreadcrumb=a,this.blacklistUrls=s,this.ignoreErrors=n,this.release=o}},Os=null,Fs=class{destroy(){this.sentryClient?.destroy(),this.sentrySubscription?.unsubscribe(),Os=null}logIError(e,t=!1){e.thrown&&this.report(e.thrown,{fatal:t,errorType:e.id,category:e.category},{message:e.message,errorData:e.data})}report(e,t={},i={}){let{sentryClient:r,context:a,options:s}=this,{sampleRate:n=0,whiteErrorIdList:o,whiteErrorCategoryList:l=[],blackErrorIdList:u,blackErrorCategoryList:d}=s,{errorType:c,category:h}=t;if(!((0,m.isNonNullable)(h)&&d.includes(h)||(0,m.isNonNullable)(c)&&u.includes(c))&&(Math.random()<=n||(0,m.isNonNullable)(h)&&l.includes(h)||(0,m.isNonNullable)(c)&&o.includes(c))){Object.keys(t).length&&r.setTags({version:this.version,...t}),(Object.keys(a).length||Object.keys(i).length)&&r.setExtras({...a,...i});try{c&&r.captureMessage(c,t.fatal?xs.fatal:xs.error),r.report(e)}catch(e){console.error(e)}}}static getInstance(){return Os}constructor(e,t,i={}){!Os&&e.dsn&&(this.sentryClient=new Ds({dsn:e.dsn,environment:t.env}),this.version=t.version,this.sentrySubscription=new m.Subscription,this.options=e,this.context=i,Os=this)}},js=(e=>(e.Thumb="thumb",e.Video="video",e.Ads="ads",e.Crashed="crashed",e.LiveWaitingStart="LiveWaitingStart",e.LiveWaitingRecover="LiveWaitingRecover",e.LiveWaitingRecord="LiveWaitingRecord",e))(js||{}),zs=e=>{if(e.requestFullscreen)return e.requestFullscreen();if(e.msRequestFullscreen)return e.msRequestFullscreen();if(e.webkitRequestFullscreen)return e.webkitRequestFullscreen();if(e.mozRequestFullScreen)return e.mozRequestFullScreen();let t=e.querySelector("video");return t?.webkitEnterFullscreen?t.webkitEnterFullscreen():Promise.reject()},Us=e=>e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.webkitExitFullscreen?e.webkitExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():Promise.reject(),qs=()=>{let e=document;return e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement},Hs=()=>!!qs(),Ws=e=>{document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("MSFullscreenChange",e)},Qs=e=>{document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e)},Gs=class{isSupported(){return document.pictureInPictureEnabled}isActive(){return this.isSupported()&&!!document.pictureInPictureElement}setContext(e){this.svelteContext=e}async revealPictureInPicture(){this.isRequested&&(this.unregistryEventHandlers(),await this.request(),this.registryEventHandlers())}async request(){if(this.isSupported()&&!this.isActive())try{await(this.videoElement?.requestPictureInPicture())}catch{this.isRequested=!1}}async remove(){!this.isSupported()||!this.isActive()||await document.exitPictureInPicture()}assignPlayerContainer(e){this.isSupported()&&(this.playerContainer=e)}updateVideoElement(){this.isSupported()&&(this.videoElement=this.playerContainer?.querySelector("video"))}registryEventHandlers(){this.videoElement?.addEventListener("enterpictureinpicture",this.eventHandlers.enterpictureinpicture),this.videoElement?.addEventListener("leavepictureinpicture",this.eventHandlers.leavepictureinpicture)}registryExternalEventHandlers(e){this.externalEventHandlers={...e}}unregistryEventHandlers(){this.videoElement?.removeEventListener("enterpictureinpicture",this.eventHandlers.enterpictureinpicture),this.videoElement?.removeEventListener("leavepictureinpicture",this.eventHandlers.leavepictureinpicture)}async dispose(){this.unregistryEventHandlers(),await this.remove()}onEnterPictureInPicture(e){let t=e.pictureInPictureWindow;t&&(this.info.isActive$.next(!0),this.isRequested=!0,t.addEventListener("resize",this.eventHandlers.resize),this.externalEventHandlers.enterpictureinpicture?.(e))}onLeavePictureInPicture(e){let t=e.pictureInPictureWindow;this.info.isActive$.next(!1),this.isRequested=!1,t?.removeEventListener("resize",this.eventHandlers.resize),this.externalEventHandlers.leavepictureinpicture?.(e),this.playerDummyElement?.$destroy()}onResize(e){this.externalEventHandlers.resize?.(e)}setEnabled(e){this.info.isEnabled$.next(e)}constructor({enabled:e=!0}={enabled:!0}){this.isRequested=!1,this.videoElement=void 0,this.playerContainer=void 0,this.externalEventHandlers={},this.eventHandlers={enterpictureinpicture:this.onEnterPictureInPicture.bind(this),leavepictureinpicture:this.onLeavePictureInPicture.bind(this),resize:(0,m.debounceFn)(this.onResize.bind(this),300)},this.info={isActive$:new m.ValueSubject(!1),isEnabled$:new m.ValueSubject(!1),type:0},this.info.isEnabled$=new m.ValueSubject(e)}};function Ks(e){return e instanceof Gs}Y=!0;var Ys=(e,t)=>{e.stopPropagation(),t()()},Zs=Di('<div class="skip svelte-1k4i25s"> <svg class="icon svelte-1k4i25s" width="7" height="12" viewBox="0 0 7 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M0.263627 0.263605C-0.0878444 0.615078 -0.0878429 1.18493 0.26363 1.5364L4.72723 5.99998L0.263627 10.4636C-0.0878444 10.8151 -0.0878429 11.3849 0.26363 11.7364C0.615103 12.0879 1.18495 12.0879 1.53642 11.7364L6.63642 6.63637C6.98789 6.2849 6.98789 5.71505 6.63642 5.36358L1.53642 0.263602C1.18495 -0.0878686 0.615098 -0.0878673 0.263627 0.263605Z"></path></svg></div>'),Xs=Di("<div><!></div>"),Js={hash:"svelte-1k4i25s",code:".container.svelte-1k4i25s {position:absolute;top:14px;right:16px;padding:6px 10px;font-size:13px;color:#fff;background:rgba(0, 0, 0, 0.56);border-radius:6px;transition:color .2s;}.container-mobile.svelte-1k4i25s {bottom:14px;top:unset;font-size:15px;max-width:142px;}.icon.svelte-1k4i25s {margin-left:4px;position:relative;top:2px;fill:var(--white);transition:fill .2s;}.skip.svelte-1k4i25s {width:86px;}.skippable.svelte-1k4i25s {cursor:pointer;color:var(--white);}.skippable.svelte-1k4i25s:hover {color:rgba(255, 255, 255, .75);}.skippable.svelte-1k4i25s:hover .icon:where(.svelte-1k4i25s) {fill:rgba(255, 255, 255, .75);}"};Ri(["click"]);var en=Di('<button class="svelte-1wy3dql"> </button>'),tn={hash:"svelte-1wy3dql",code:"button.svelte-1wy3dql {position:absolute;pointer-events:none;bottom:14px;left:16px;font-size:15px;background:white;border:none;padding:6px 10px;border-radius:6px;color:black;}"};var rn=Di('<div class="top-gradient-mobile svelte-354ajf"></div>'),an=Di('<div class="container svelte-354ajf"><!> <video style="width: 100%; height: 100%" playsinline=""></video> <!> <!> <!></div>',2),sn={hash:"svelte-354ajf",code:".container.svelte-354ajf {width:100%;height:100%;}.top-gradient-mobile.svelte-354ajf {position:absolute;width:100%;height:80px;top:0;left:0;pointer-events:none;background:linear-gradient(\n      360deg,\n      rgba(0, 0, 0, 0) 0%,\n      rgba(0, 0, 0, 0.05) 12%,\n      rgba(0, 0, 0, 0.15) 25%,\n      rgba(0, 0, 0, 0.3) 45%,\n      rgba(0, 0, 0, 0.4) 57%,\n      rgba(0, 0, 0, 0.5) 77%,\n      rgba(0, 0, 0, 0.55) 88%,\n      rgba(0, 0, 0, 0.65) 100%\n    );}"};function nn(e,t){pi(t,!0),vr(e,sn);let[i,r]=ua(),a=()=>la(w,"$adPlaybackState",i),s=()=>la(f,"$isMobile",i),n=ma(t,"adsSlotId",3,void 0),o=ma(t,"adsParams",3,void 0),l=ma(t,"adsPreviewParam",3,void 0),u=ma(t,"adsAutoplayParam",3,void 0),d=ma(t,"duration",3,0),c=Oa(),h=ya(),p=c.state.isEnded$,f=c.ui.isMobile,v=h.ads.isMobileGoToSiteButton,g=te(void 0),b=te(void 0),y=!1,w=c.ads.playbackState,S=c.ads.canSkip,x=c.ads.position,$=c.ads.secondsToWatchBeforeSkip,_=ne((()=>la(S,"$canSkipAd",i)&&"inactive"!==a())),k=ne((()=>s()&&"inactive"!==a()&&v));Xr((()=>{let e=c.getAdmanWrapper();if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ads_mount"],numbers:[(0,m.now)(),n()]}),!n())return void e.onAdmanLoadingError();let t=t=>{e.initAdman(t),y=!0},i=new AbortController,{width:r,height:a}=sa(c.ui.playerSize),s={width:r,height:a,isFullscreen:sa(c.ui.isFullscreen),isAutoplay:u()??sa(c.ui.isAutoplay),adsContainer:Tt(g),adsVideoElement:Tt(b),slotId:n(),params:o(),previewParam:l(),duration:d()};return window.AdmanHTML?t(s):e.loadAdman(i.signal).then((()=>{t(s)})).catch((()=>{e.onAdmanLoadingError()})),()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ads_unmount"],numbers:[(0,m.now)(),n()]}),!y&&i.abort()}}));var T=an(),C=Ne(T),E=e=>{zi(e,rn())};Xi(C,(e=>{s()&&e(E)}));var A=De(C,2);Kr(A,(e=>re(b,e)),(()=>Tt(b)));var L=De(A,2),P=e=>{!function(e,t){pi(t,!0),vr(e,Js);let[i,r]=ua(),a=ma(t,"position",3,0),s=ma(t,"secondsToWatchBeforeSkip",3,0),n=ma(t,"skipAd",3,m.noop),o=Oa().ui.isMobile,l=ne((()=>a()>0&&a()>=s()));var u=Xs();let d;var c=Ne(u),h=e=>{var t=Zs();t.__click=[Ys,n];var i=Ne(t);Ce(),Te(t),Bt((e=>Hi(i,`${e??""} `)),[()=>Es("skip_ads_now")]),zi(e,t)},p=e=>{var t=Fi();Bt((e=>Hi(t,e)),[()=>Es("skip_ads_after",{time:Math.ceil(s()-a()).toFixed(0)})]),zi(e,t)};Xi(c,(e=>{Tt(l)?e(h):e(p,!1)})),Te(u),Bt((e=>d=xr(u,1,"container svelte-1k4i25s",null,d,e)),[()=>({"container-mobile":la(o,"$isMobile",i),skippable:Tt(l)})]),zi(e,u),fi(),r()}(e,{get position(){return la(x,"$adPosition",i)},get secondsToWatchBeforeSkip(){return la($,"$secondsToWatchBeforeSkipAd",i)},get skipAd(){return c.actions.internal.skipAd}})};Xi(L,(e=>{Tt(_)&&e(P)}));var M=De(L,2),I=e=>{!function(e,t){pi(t,!1);let i=Oa();Xr((()=>{i.getAdmanWrapper().startPostroll()})),Yr(),fi()}(0,{})};Xi(M,(e=>{la(p,"$isVideoEnded",i)&&e(I)}));var R=De(M,2),V=e=>{!function(e,t){pi(t,!1),vr(e,tn),Yr();var i=en(),r=Ne(i,!0);Te(i),Bt((e=>Hi(r,e)),[()=>Es("visit_advertiser")],oe),zi(e,i),fi()}(e,{})};Xi(R,(e=>{Tt(k)&&e(V)})),Te(T),Kr(T,(e=>re(g,e)),(()=>Tt(g))),zi(e,T),fi(),r()}var on=e=>{if(!isFinite(e))return"00:00";let t=Math.round(e),i=Math.floor(t/3600);t-=3600*i;let r=Math.floor(t/60);t-=60*r;let a=[r,t].map((e=>String(e).padStart(2,"0"))).join(":");return i>0&&(a=`${i}:${a}`),a},ln=Oi('<svg><!><path fill="none" stroke="var(--btn-color, #fff)" stroke-width="2" d="M6.41 1A6.46 6.46 0 0 0 3 1.55 3.5 3.5 0 0 0 1.55 3 6.46 6.46 0 0 0 1 6.41v7.18A6.46 6.46 0 0 0 1.55 17 3.5 3.5 0 0 0 3 18.45a6.46 6.46 0 0 0 3.41.55h29.18a6.46 6.46 0 0 0 3.41-.55A3.5 3.5 0 0 0 40.45 17a6.46 6.46 0 0 0 .55-3.41V6.41A6.46 6.46 0 0 0 40.45 3 3.5 3.5 0 0 0 39 1.55 6.46 6.46 0 0 0 35.59 1z"></path><path fill="var(--btn-color, #f0f2f5)" fill-rule="evenodd" d="M8 5a1 1 0 0 1 1 1v7h3a1 1 0 0 1 1 .88V14a1 1 0 0 1-1 1H8a1 1 0 0 1-1-.77v-.11A.5.5 0 0 1 7 14V6a1 1 0 0 1 .88-1zm8 0a1 1 0 0 1 1 1v8a1 1 0 0 1-.88 1H16a1 1 0 0 1-1-1V6a1 1 0 0 1 .88-1zm18 0a1 1 0 0 1 1 .88V6a1 1 0 0 1-1 1h-3v2h3a1 1 0 0 1 1 .88V10a1 1 0 0 1-1 1h-3v2h3a1 1 0 0 1 1 .88V14a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-.77v-.11a.5.5 0 0 1 0-.12V6a1 1 0 0 1 .56-.9A1 1 0 0 1 30 5zm-8 0a1 1 0 0 1 1 1v.1a.9.9 0 0 1-.11.35l-2.47 7.57a1.48 1.48 0 0 1-1.32.98h-.2a1.48 1.48 0 0 1-1.31-.95l-2.47-7.57a.9.9 0 0 1-.12-.36V6a1 1 0 0 1 .88-1H20a1 1 0 0 1 1 1v-.1l2 6.4 2-6.4a1 1 0 0 1 1-.9"></path></svg>');var un=Oi('<svg><!><rect width="42" height="20" fill="var(--timeline-slider-filled-active-live-bg, #FF3347)" rx="5"></rect><path fill="#F2F3F5" fill-rule="evenodd" d="M8 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4a1 1 0 1 0 0-2H9V6a1 1 0 0 0-1-1m7 1a1 1 0 1 1 2 0v8a1 1 0 1 1-2 0zm15-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4a1 1 0 1 0 0-2h-3v-2h3a1 1 0 1 0 0-2h-3V7h3a1 1 0 1 0 0-2zm-8.325 9.31-2.55-7.824a1 1 0 0 1-.117-.363L19 6.1h.005a1 1 0 1 1 1.99-.199L21 5.9l2 6.4 2-6.4h.005a1 1 0 0 1 1.99.2H27l-.008.023a1 1 0 0 1-.118.363l-2.55 7.824a1 1 0 0 1-.95.69h-.748a1 1 0 0 1-.95-.69z" clip-rule="evenodd"></path></svg>');function dn(e,t){let i=ma(t,"isActive",3,!1);var r=ji(),a=Be(r),s=e=>{!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=un();let a;hr(Ne(r),(()=>t.children??D)),Ce(2),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"42",height:"20",fill:"none","aria-hidden":"true","data-testid":"live-active-icon",role:"img",...i}))),zi(e,r)}(e,{})},n=e=>{!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=ln();let a;hr(Ne(r),(()=>t.children??D)),Ce(2),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"42",height:"20","aria-hidden":"true","data-testid":"live-icon",role:"img",...i}))),zi(e,r)}(e,{})};Xi(a,(e=>{i()?e(s):e(n,!1)})),zi(e,r)}var cn=Di('<div class="thumb-timer-live-icon svelte-opbced"><!></div>'),hn=Di('<div role="timer" data-testid="thumb-timer"><div class="thumb-timer-equalizer svelte-opbced"><div class="col svelte-opbced"></div> <div class="col svelte-opbced"></div> <div class="col svelte-opbced"></div></div> <span class="thumb-timer-text svelte-opbced"><!></span></div>'),pn={hash:"svelte-opbced",code:".thumb-timer.svelte-opbced {position:absolute;z-index:var(--thumb-timer-z-index);bottom:0;right:0;margin:8px;padding:0 7px;border-radius:3px;background:var(--black-alpha-40);color:var(--white);font-size:12.5px;line-height:23px;height:23px;white-space:nowrap;transition:visibility var(--controls-transition-duration), opacity var(--controls-transition-duration);}.thumb-timer.live.svelte-opbced {font-size:0;line-height:20px;height:20px;border-radius:2px;background:var(--red);}.thumb-timer.hidden.svelte-opbced {visibility:hidden;opacity:0;}.thumb-timer.svelte-opbced:after {\n    /* safari fix */content:'';display:inline-block;vertical-align:middle;height:100%;}.thumb-timer-live-icon.svelte-opbced {display:inline-block;vertical-align:middle;width:42px;height:20px;margin:0 -7px;}.thumb-timer-equalizer.svelte-opbced {display:inline-block;vertical-align:middle;position:relative;width:10px;height:10px;margin-top:-4px;margin-right:4px;}.live.svelte-opbced .thumb-timer-equalizer:where(.svelte-opbced) {margin-top:-2px;}.thumb-timer-equalizer.svelte-opbced .col:where(.svelte-opbced) {width:2px;height:10px;margin-right:2px;background:var(--btn-color, --white);position:absolute;bottom:0;transform-origin:50% 100%;\n    animation: 1.5s infinite linear alternate;animation-play-state:paused;}.thumb-timer.playing.svelte-opbced .thumb-timer-equalizer:where(.svelte-opbced) .col:where(.svelte-opbced) {animation-play-state:running;}.thumb-timer-equalizer.svelte-opbced .col:where(.svelte-opbced):nth-child(1) {left:0;\n    animation-name: svelte-opbced-thumb-timer-equalizer-col1;}.thumb-timer-equalizer.svelte-opbced .col:where(.svelte-opbced):nth-child(2) {left:3px;\n    animation-name: svelte-opbced-thumb-timer-equalizer-col2;}.thumb-timer-equalizer.svelte-opbced .col:where(.svelte-opbced):nth-child(3) {left:6px;\n    animation-name: svelte-opbced-thumb-timer-equalizer-col3;}\n\n  @keyframes svelte-opbced-thumb-timer-equalizer-col1 {\n    0% {\n      transform: scaleY(0.1);\n    }\n\n    25% {\n      transform: scaleY(0.8);\n    }\n\n    50% {\n      transform: scaleY(0.4);\n    }\n\n    75% {\n      transform: scaleY(0.6);\n    }\n\n    100% {\n      transform: scaleY(0.1);\n    }\n  }\n\n  @keyframes svelte-opbced-thumb-timer-equalizer-col2 {\n    0% {\n      transform: scaleY(1);\n    }\n\n    25% {\n      transform: scaleY(0.3);\n    }\n\n    50% {\n      transform: scaleY(0.9);\n    }\n\n    75% {\n      transform: scaleY(0.6);\n    }\n\n    100% {\n      transform: scaleY(1);\n    }\n  }\n\n  @keyframes svelte-opbced-thumb-timer-equalizer-col3 {\n    0% {\n      transform: scaleY(0.6);\n    }\n\n    25% {\n      transform: scaleY(0.9);\n    }\n\n    50% {\n      transform: scaleY(0.1);\n    }\n\n    75% {\n      transform: scaleY(0.9);\n    }\n\n    100% {\n      transform: scaleY(0.6);\n    }\n  }.thumb-timer-text.svelte-opbced {display:inline-block;text-align:right;}"};function fn(e,t){pi(t,!0),vr(e,pn);let i=ma(t,"isHidden",3,!1),r=ma(t,"isLive",3,!1),a=ma(t,"isPlaying",3,!1);var s=hn();let n;var o=De(Ne(s),2),l=Ne(o),u=e=>{var t=cn();dn(Ne(t),{isActive:!0}),Te(t),zi(e,t)},d=e=>{var i=Fi();Bt((e=>Hi(i,e)),[()=>on(t.duration-t.position)]),zi(e,i)};Xi(l,(e=>{r()?e(u):e(d,!1)})),Te(o),Te(s),Bt((e=>n=xr(s,1,"thumb-timer svelte-opbced",null,n,e)),[()=>({live:r(),hidden:i(),playing:a()})]),zi(e,s),fi()}var mn=e=>{if(document.queryCommandSupported&&document.queryCommandSupported("copy")){let t=document.createElement("textarea");t.textContent=e,t.style.position="absolute",t.style.top="-9999px",document.body.appendChild(t),t.select();try{document.execCommand("copy")}finally{document.body.removeChild(t)}}},vn=e=>{e.stopPropagation(),e.preventDefault()},gn=e=>"Escape"===e.code,bn=(e,t=[])=>{let i=e.code;return["Enter","Space",...t].includes(i)},yn=e=>{if((e=>{let t=e.code;return"Tab"===t&&!e.shiftKey||"ArrowDown"===t})(e))return vn(e),void(e=>{let t=e.nextElementSibling;t||(t=e.parentNode?.firstElementChild),t?.focus()})(e.target);(e=>{let t=e.code;return"Tab"===t||"ArrowUp"===t})(e)&&(vn(e),(e=>{let t=e.previousElementSibling;t||(t=e.parentNode?.lastElementChild),t?.focus()})(e.target))},wn=e=>!f.clientChecker.device.isAndroid&&0===e?.detail||f.clientChecker.device.isAndroid&&""===e?.pointerType,Sn=async(e,t,i)=>{await kt(),e&&!e.classList.contains("opened")&&!t&&sa(i)&&(await kt(),i.set(!1),e.focus())},xn=async(e,t,i)=>{await kt(),e&&t&&i&&e.children[0]?.focus()},$n=(e,t)=>{yn(e),gn(e)&&(vn(e),t())},_n=async(e,t)=>{bn(e,["ArrowRight"])&&(vn(e),t())},kn=(e,t)=>{bn(e)&&(vn(e),t())},Tn=100,Cn=200,En=300,An=400,Ln=500,Pn=600,Mn=700,In=800,Rn=900,Vn=1e3,Nn=(e,t)=>{kn(e,(()=>t()))},Bn=Di('<li class="item svelte-1hm4mm9" role="menuitem" tabindex="0"> </li>'),Dn={hash:"svelte-1hm4mm9",code:".item.svelte-1hm4mm9 {padding:8px 16px;cursor:pointer;position:relative;display:block;color:rgba(255, 255, 255, 0.72);font-size:13px;line-height:18px;letter-spacing:-0.14px;white-space:nowrap;}.item.svelte-1hm4mm9:hover {background:rgba(66, 66, 66, .5);color:var(--white);}"};Ri(["click","keydown"]);var On=(e,t)=>e.weight-t.weight,Fn=(e=>(e.OPEN_SUB_MENU="OPEN_SUB_MENU",e.CLICK="CLICK",e.SWITCH="SWITCH",e))(Fn||{}),jn=(e,t)=>{$n(e,t)},zn=e=>{e.preventDefault()},Un=Di('<ul role="menu" class="svelte-1p5ukkp"></ul>'),qn={hash:"svelte-1p5ukkp",code:"ul.svelte-1p5ukkp {position:absolute;z-index:var(--context-menu-z-index);border-radius:8px;background:rgba(0, 0, 0, 0.72);transition:visibility .1s,opacity .1s;list-style:none;margin:0;padding:6px 0;max-height:100%;max-width:100%;overflow-x:hidden;overflow-y:auto;}"};function Hn(e,t){pi(t,!0),vr(e,qn);let[i,r]=ua(),a=()=>la(T,"$isLooped$",i),s=ma(t,"visible",3,!1),n=ma(t,"position",19,(()=>({top:0,left:0}))),o=ma(t,"playerContainerRef",3,void 0),l=ma(t,"controlsContainerRef",3,void 0),u=ma(t,"menuElementRef",15,void 0),d=te(0),c=te(0),h=Oa(),{pictureInPicture$:p}=Fa(),v=ya(),g=h.ui.contextMenu.visible$,b=h.ui.debugPanelVisible,y=h.ui.additionalContextMenuItems$,w=h.ui.t,S=h.actions.internal.togglePictureInPicture,x=h.state.chromecastState$,$=h.state.isLive$,_=h.state.positionExact$,k=h.state.isInteractive,T=h.state.looped$,{isEnabled$:C,isActive$:E}=p,A=ne((()=>v.features.copyVideoLink&&h.callbacks?.onCopyVideoLink)),L=ne((()=>Tt(A)&&!la($,"$isLive$",i)&&!k)),P=ne((()=>!!h.callbacks?.onCopyEmbedCodeClicked)),M=ne((()=>la(C,"$isPiPEnabled$",i)&&la(x,"$chromecastState$",i)!==f.ChromecastState.CONNECTED&&!k)),I=ne((()=>v.features.videoRotate&&!k)),R=ne((()=>v.showSupport&&!la(E,"$pictureInPictureApiIsActive$",i))),V=ne((()=>v.features.saveTraceInfoToFile)),N=()=>{g.set(!1),t.returnFocus?.()};Rt((()=>{(async()=>{if(u()&&o()&&l()){await kt();let{top:e,left:t,bottom:i,right:r}=n(),a=t??0,s=e??0,h=u().getBoundingClientRect();(0,m.isNullable)(t)&&!(0,m.isNullable)(r)&&(a=r-h.width),(0,m.isNullable)(e)&&!(0,m.isNullable)(i)&&(s=i-h.height),a=Math.max(a,0),s=Math.max(s,0),((e,t)=>{if(!u()||!o()||!l())return;let i=u().getBoundingClientRect(),r=o().getBoundingClientRect();re(d,e-r.left),re(c,t-r.top),Tt(d)+i.width>r.width&&re(d,r.width-i.width),Tt(c)+i.height>r.height&&re(c,r.height-i.height),re(d,Ae(Math.max(Tt(d),0))),re(c,Ae(Math.max(Tt(c),0)))})(a,s)}})()}));let B=()=>{h.actions.internal.videoRotate()},D=()=>{(0,m.isValidURL)(t.supportLink)&&window.open(t.supportLink,"_blank"),h.actions.internal.reportProblem(),h.actions.internal.pause()},O=()=>{let e=h.actions.internal.getDebugTextData();if(v.features.saveDebugInfoToFile){let t=new Blob([...e],{type:"plain/text"}),i=window.URL.createObjectURL(t);Na(i,"vk_player_debug_info","txt")}else mn(h.actions.internal.getDebugTextData())},F=()=>{let e=h.actions.internal.getTraceTextData(),t=new Blob([...e],{type:"application/json"}),i=window.URL.createObjectURL(t);Na(i,"vk_player_trace_info","json")},j=()=>{b.set(!0)},z=async()=>{try{S()}finally{t.returnFocus?.()}},U=()=>{h.actions.internal.setLooped(!a())},q=()=>{if(Tt(P)){let e=h.callbacks?.onCopyEmbedCodeClicked?.();e&&mn(e)}},H=(e=!1)=>{if(h.callbacks?.onCopyVideoLink){let t=h.callbacks?.onCopyVideoLink(e,la(_,"$positionExact$",i));t&&mn(t)}},W=ne((()=>v.features.saveDebugInfoToFile?w("menu_save_debug"):w("menu_copy_debug"))),Q=ne((()=>Tt(A)?{id:"copy-link",weight:Tn,label:w("menu_copy_video_link"),onClick:()=>H()}:void 0)),G=ne((()=>Tt(L)?{id:"copy-link-timestamp",weight:Cn,label:w("menu_copy_video_link_with_timestamp"),onClick:()=>H(!0)}:void 0)),K=ne((()=>Tt(P)?{id:"copy-embed-code",weight:En,label:w("menu_copy_embed_code"),onClick:q}:void 0)),Y=ne((()=>Tt(M)?{id:"pip",weight:An,label:w("menu_pip"),onClick:z}:void 0)),Z=ne((()=>({id:"video-loop",weight:Ln,label:a()?w("menu_video_loop_off"):w("menu_video_loop_on"),ariaLabel:w("aria_label_menu_loop"),onClick:U}))),X=ne((()=>Tt(I)?{id:"rotate",weight:Pn,label:w("menu_video_rotate"),ariaLabel:w("aria_label_menu_rotate"),onClick:B}:void 0)),J=ne((()=>Tt(R)?{id:"report",weight:Mn,label:w("menu_report"),ariaLabel:`${w("menu_report")}. ${w("aria_label_new_tab_alert")}`,onClick:D}:void 0)),ee=ne((()=>({id:"save-debug",weight:In,label:Tt(W),onClick:O}))),ie=ne((()=>Tt(V)?{id:"save-trace",weight:Rn,label:w("menu_save_debug"),onClick:F}:void 0)),ae=ne((()=>({id:"debug-info",weight:Vn,label:w("menu_debug_overlay"),ariaLabel:la(b,"$debugPanelVisible",i)?w("aria_label_menu_debug_overlay_disable"):w("aria_label_menu_debug_overlay_enable"),onClick:j}))),se=ne((()=>[Tt(Q),Tt(G),Tt(K),Tt(Y),Tt(Z),Tt(X),Tt(J),Tt(ee),Tt(ie),Tt(ae),...la(y,"$additionalContextMenuItems$",i)].filter((e=>!!e)).sort(On)));var oe=ji(),le=Be(oe),ue=e=>{var t=Un();t.__contextmenu=[zn],t.__keydown=[jn,N],ar(t,21,(()=>Tt(se)),(e=>e.id),((e,t)=>{!function(e,t){pi(t,!0),vr(e,Dn);let i=ma(t,"onClick",3,m.noop),r=ma(t,"closeContextMenu",3,m.noop),a=e=>{e?.stopPropagation(),i()(),r()()};var s=Bn();s.__click=a,s.__keydown=[Nn,a];var n=Ne(s,!0);Te(s),Bt((()=>{Lr(s,"aria-label",t.ariaLabel??t.label),Lr(s,"data-testid",t.id),Hi(n,t.label)})),zi(e,s),fi()}(e,{get id(){return Tt(t).id},get label(){return Tt(t).label},get ariaLabel(){return Tt(t).ariaLabel},get onClick(){return Tt(t).onClick},closeContextMenu:N})})),Te(t),Kr(t,(e=>u(e)),(()=>u())),Bt((()=>_r(t,`top: ${Tt(c)??""}px; left: ${Tt(d)??""}px;`))),zi(e,t)};Xi(le,(e=>{s()&&e(ue)})),zi(e,oe),fi(),r()}Ri(["contextmenu","keydown"]);var Wn=class{constructor(e){this.value=e,this.next=null}},Qn=class{push(e){let t=new Wn(e);this.top?(this.top.next=t,this.top=t):(this.top=t,this.bottom=t),this.size++,this.size>this.maxSize&&this.bottom&&(this.bottom=this.bottom.next)}getValuesFromBottom(){let e=[],t=this.bottom;for(;t;)e.push(t.value),t=t.next;return e}constructor(e){this.top=null,this.bottom=null,this.size=0,this.maxSize=e}},Gn=Di('<div class="container svelte-1ssl9eb"><canvas class="svelte-1ssl9eb"></canvas></div>'),Kn={hash:"svelte-1ssl9eb",code:".container.svelte-1ssl9eb {display:inline-block;width:120px;height:16px;}canvas.svelte-1ssl9eb {transform:scale(1, -1);margin-top:2px;}"};function Yn(e,t){pi(t,!0),vr(e,Kn);let i=ma(t,"values",19,(()=>[])),r=te(void 0),a=te(null);function s(e,t,i,r,a){0===a&&(a=1),e.fillStyle="#fff",e.fillRect(t,i,r,a)}Xr((()=>{Tt(r).width=120,Tt(r).height=16,re(a,Ae(Tt(r).getContext("2d")))})),Rt((()=>{let e="";if(Tt(a)){let t=i()[0];for(let e=1;e<i().length;e++)i()[e]>t&&(t=i()[e]);Tt(a).clearRect(0,0,120,16);let r=59;for(let n=i().length-1;n>=0;n--){let o=2*r,l=t>0?i()[n]/t*16:0;s(Tt(a),o,0,2,l),e=l+" "+e,r--}}}));var n=Gn();Kr(Ne(n),(e=>re(r,e)),(()=>Tt(r))),Te(n),zi(e,n),fi()}var Zn=(e,t)=>{e.stopPropagation(),m.safeStorage.remove(wa),t.set(!1)},Xn=Di('<div class="svelte-4deykz"><div class="svelte-4deykz">Video id</div> <span> </span></div>'),Jn=Di('<div class="svelte-4deykz"><div class="svelte-4deykz">VSID</div> <span> </span></div>'),eo=Di('<div class="svelte-4deykz"><div class="svelte-4deykz">Provider</div> <span> </span></div>'),to=Di('<div class="svelte-4deykz"><div class="svelte-4deykz">Streams</div> <span> </span></div>'),io=Di('<div class="svelte-4deykz"><div class="svelte-4deykz">Viewport</div> <span> </span></div>'),ro=Di('<div class="svelte-4deykz"><div class="svelte-4deykz">Video size</div> <span> </span></div>'),ao=Di('<div class="svelte-4deykz"><div class="svelte-4deykz">CDN host</div> <span> </span></div>'),so=Di('<div class="svelte-4deykz"><div class="svelte-4deykz">Volume</div> <span> </span></div>'),no=Di('<div class="svelte-4deykz"><div class="svelte-4deykz">Buffer</div> <span> </span></div>'),oo=Di('<div class="svelte-4deykz"><div class="svelte-4deykz">Live latency</div> <span> </span></div>'),lo=Di('<div class="svelte-4deykz"><div class="svelte-4deykz">Segment</div> <span> </span></div>'),uo=Di('<div class="svelte-4deykz"><div class="svelte-4deykz">Network</div> <!> <span> </span></div>'),co=Di('<div class="svelte-4deykz"><div class="svelte-4deykz">V bitrate</div> <!> <span> </span></div>'),ho=Di('<div role="region"><button class="close svelte-4deykz" title="закрыть">[x]</button> <div class="content svelte-4deykz"><div class="svelte-4deykz"><div class="svelte-4deykz">Version</div> <span> </span></div> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <div class="svelte-4deykz"><div class="svelte-4deykz">Dropped</div> <span> </span></div> <!> <!> <div class="svelte-4deykz"><div class="svelte-4deykz">FPS</div> <!> <span> </span></div></div></div>'),po={hash:"svelte-4deykz",code:".container.svelte-4deykz {background:rgba(28, 28, 28, 0.8);border-radius:4px;color:#fff;left:20px;position:absolute;z-index:var(--debug-panel-z-index);top:45px;min-width:160px;font-size:10px;text-align:left;user-select:text;}.container-mobile.svelte-4deykz {top:16px;left:16px;}button.svelte-4deykz {position:absolute;right:5px;top:3px;cursor:pointer;outline:0;border:none;background-color:transparent;padding:0;color:#fff;}.content.svelte-4deykz {padding:5px;}.content.svelte-4deykz > div:where(.svelte-4deykz) > div:where(.svelte-4deykz) {display:inline-block;text-align:right;width:60px;padding:0 5px;}"};function fo(e,t){pi(t,!0),vr(e,po);let[i,r]=ua(),a=Oa(),s=a.ui.debugPanelVisible,n=a.ui.isMobile,o=te(Ae(a.actions.internal.getDebugPanelData())),l=a.actions.internal.getVideoElement(),u=te(0),d=te(0),c=te(0),h=new Qn(60),p=new Qn(60),f=new Qn(60),v=te(Ae([])),g=te(Ae([])),b=te(Ae([])),y=Es("aria_label_debug_panel");Xr((()=>{m.safeStorage.set(wa,"true"),a.actions.internal.startLogging(),l&&(re(d,Ae(l.getVideoPlaybackQuality().droppedVideoFrames)),re(u,Ae(l.getVideoPlaybackQuality().totalVideoFrames)));let e,t=window.setInterval((()=>{re(o,Ae(a.actions.internal.getDebugPanelData()))}),500);return l&&(e=window.setInterval((()=>{if(l){re(d,Ae(l.getVideoPlaybackQuality().droppedVideoFrames));let e=l.getVideoPlaybackQuality().totalVideoFrames;re(c,e-Tt(u)),re(u,Ae(e)),h.push(Tt(c)),Tt(o).speed&&p.push(Tt(o).speed),Tt(o).bitrate&&f.push(Tt(o).bitrate),re(v,Ae(h.getValuesFromBottom())),re(g,Ae(p.getValuesFromBottom())),re(b,Ae(f.getValuesFromBottom()))}}),1e3)),()=>{a.actions.internal.stopLogging(),clearInterval(t),e&&clearInterval(e)}}));var w=ho();let S;Lr(w,"aria-label",y);var x=Ne(w);x.__click=[Zn,s];var $=De(x,2),_=Ne($),k=De(Ne(_),2),T=Ne(k,!0);Te(k),Te(_);var C=De(_,2),E=e=>{var t=Xn(),i=De(Ne(t),2),r=Ne(i,!0);Te(i),Te(t),Bt((()=>Hi(r,Tt(o).id))),zi(e,t)};Xi(C,(e=>{Tt(o).id&&e(E)}));var A=De(C,2),L=e=>{var t=Jn(),i=De(Ne(t),2),r=Ne(i,!0);Te(i),Te(t),Bt((()=>Hi(r,Tt(o).vsid))),zi(e,t)};Xi(A,(e=>{Tt(o).vsid&&e(L)}));var P=De(A,2),M=e=>{var t=eo(),i=De(Ne(t),2),r=Ne(i,!0);Te(i),Te(t),Bt((()=>Hi(r,Tt(o).provider))),zi(e,t)};Xi(P,(e=>{Tt(o).provider&&e(M)}));var I=De(P,2),R=e=>{var t=to(),i=De(Ne(t),2),r=Ne(i);Te(i),Te(t),Bt((()=>Hi(r,`Video: ${Tt(o).videoCodec||""} ${(Tt(o).hdr?"(HDR)":"")??""}\n          &\n          Audio: ${Tt(o).audioCodec||""} ${(Tt(o).audioLanguage?`(${Tt(o).audioLanguage})`:"")??""}`))),zi(e,t)};Xi(I,(e=>{(Tt(o).videoCodec||Tt(o).audioCodec)&&e(R)}));var V=De(I,2),N=e=>{var t=io(),i=De(Ne(t),2),r=Ne(i,!0);Te(i),Te(t),Bt((()=>Hi(r,Tt(o).viewport))),zi(e,t)};Xi(V,(e=>{Tt(o).viewport&&e(N)}));var B=De(V,2),D=e=>{var t=ro(),i=De(Ne(t),2),r=Ne(i,!0);Te(i),Te(t),Bt((()=>Hi(r,Tt(o).videoSize))),zi(e,t)};Xi(B,(e=>{Tt(o).videoSize&&e(D)}));var O=De(B,2),F=e=>{var t=ao(),i=De(Ne(t),2),r=Ne(i,!0);Te(i),Te(t),Bt((()=>Hi(r,Tt(o).cdn))),zi(e,t)};Xi(O,(e=>{Tt(o).cdn&&e(F)}));var j=De(O,2),z=e=>{var t=so(),i=De(Ne(t),2),r=Ne(i);Te(i),Te(t),Bt((()=>Hi(r,`${Tt(o).volume??""} %`))),zi(e,t)};Xi(j,(e=>{Tt(o).volume&&e(z)}));var U=De(j,2),q=e=>{var t=no(),i=De(Ne(t),2),r=Ne(i);Te(i),Te(t),Bt((e=>Hi(r,`${e??""} s`)),[()=>Tt(o).buffer.toFixed(2)]),zi(e,t)};Xi(U,(e=>{Tt(o).buffer&&e(q)}));var H=De(U,2),W=e=>{var t=oo(),i=De(Ne(t),2),r=Ne(i);Te(i),Te(t),Bt((e=>Hi(r,`${e??""} s`)),[()=>Tt(o).liveLatency.toFixed(2)]),zi(e,t)};Xi(H,(e=>{Tt(o).liveLatency&&e(W)}));var Q=De(H,2),G=e=>{var t=lo(),i=De(Ne(t),2),r=Ne(i,!0);Te(i),Te(t),Bt((e=>Hi(r,e)),[()=>[{value:Tt(o).currentVideoSegmentLength,title:"Video:"},{value:Tt(o).currentAudioSegmentLength,title:"Audio:"}].filter((({value:e})=>e)).map((({value:e,title:t})=>`${t} ${((e??0)/1e3).toFixed(2)} s`)).join(" & ")]),zi(e,t)};Xi(Q,(e=>{(Tt(o).currentVideoSegmentLength||Tt(o).currentAudioSegmentLength)&&e(G)}));var K=De(Q,2),Y=De(Ne(K),2),Z=Ne(Y);Te(Y),Te(K);var X=De(K,2),J=e=>{var t=uo(),i=De(Ne(t),2);Yn(i,{get values(){return Tt(g)}});var r=De(i,2),a=Ne(r);Te(r),Te(t),Bt((e=>Hi(a,`${e??""} Kbps`)),[()=>Tt(o).speed.toFixed(2)]),zi(e,t)};Xi(X,(e=>{Tt(o).speed&&e(J)}));var ee=De(X,2),ie=e=>{var t=co(),i=De(Ne(t),2);Yn(i,{get values(){return Tt(b)}});var r=De(i,2),a=Ne(r);Te(r),Te(t),Bt((e=>Hi(a,`${e??""} Kbps`)),[()=>Tt(o).bitrate.toFixed(2)]),zi(e,t)};Xi(ee,(e=>{Tt(o).bitrate&&e(ie)}));var ae=De(ee,2),se=De(Ne(ae),2);Yn(se,{get values(){return Tt(v)}});var ne=De(se,2),oe=Ne(ne,!0);Te(ne),Te(ae),Te($),Te(w),Bt((e=>{S=xr(w,1,"container svelte-4deykz",null,S,e),Hi(T,Tt(o).version),Hi(Z,`${Tt(d)??""} / ${Tt(u)??""} frames`),Hi(oe,Tt(c))}),[()=>({"container-mobile":la(n,"$isMobile",i)})]),zi(e,w),fi(),r()}Ri(["click"]);var mo=(e,t)=>{e.stopPropagation(),t()()},vo=Di('<div class="close svelte-1ome55p"></div>'),go={hash:"svelte-1ome55p",code:".close.svelte-1ome55p {cursor:pointer;opacity:0.8;transition:opacity 0.2s;position:relative;width:16px;height:16px;}.close.svelte-1ome55p:hover {opacity:1;}.close.svelte-1ome55p:before, .close.svelte-1ome55p:after {position:absolute;left:8px;content:' ';height:16px;width:2px;background-color:var(--white);}.close.svelte-1ome55p:before {transform:rotate(45deg);}.close.svelte-1ome55p:after {transform:rotate(-45deg);}"};function bo(e,t){pi(t,!0),vr(e,go);let i=ma(t,"onClick",3,m.noop);var r=vo();r.__click=[mo,i],zi(e,r),fi()}Ri(["click"]);var yo=Di('<div class="timer svelte-8jhsry"><canvas class="timer-canvas svelte-8jhsry" width="100" height="100"></canvas> <svg class="timer-play-icon svelte-8jhsry" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><g fill-rule="nonzero"><path class="_play" d="m8.13340613 5.10548415 10.49681277 6.24354325c.3559987.2117494.472936.6720001.2611866 1.0279989-.0638111.1072809-.1533894.1969388-.2606135.2608453l-10.4968128 6.256187c-.35581027.2120659-.81616483.095538-1.02823068-.2602722-.06921066-.1161237-.10574852-.2487949-.10574852-.3839792v-12.49973035c0-.41421357.33578644-.75.75-.75.13495801 0 .26741554.03641567.38340613.1054073z" fill="var(--btn-color, #fff)"></path></g></g></svg></div>'),wo={hash:"svelte-8jhsry",code:".timer.svelte-8jhsry {border-radius:50%;transition:background .2s;background:rgba(31, 31, 31, .65);width:50px;height:50px;display:flex;align-items:center;justify-content:space-around;}.timer.svelte-8jhsry:hover {background:rgba(31, 31, 31, .85)}.timer-canvas.svelte-8jhsry {width:50px;height:50px;position:absolute;}.timer-play-icon.svelte-8jhsry {width:22px;height:26px;}"};function So(e,t){pi(t,!0),vr(e,wo);let i,r,a,s=ma(t,"isRunning",3,!0),n=ma(t,"onTimerEnded",3,m.noop),o=te(void 0),l=te(0);Rt((()=>{s()&&(r=Date.now(),re(l,Ae(requestAnimationFrame(d))))}));let u=()=>{Tt(l)&&(cancelAnimationFrame(Tt(l)),re(l,0))},d=()=>{s()?(a=(Date.now()-r)/5e3,a<1?(i?.clearRect(0,0,100,100),i?.beginPath(),i?.arc(50,50,47,-Math.PI/2,-Math.PI/2+2*Math.PI*a),i?.stroke(),re(l,Ae(requestAnimationFrame(d)))):n()()):u()};Xr((()=>{if(i=Tt(o).getContext("2d"),i)return i.lineWidth=6,i.lineCap="round",i.strokeStyle="#fff",()=>{u()}})),Jr((()=>{u()}));var c=yo();Kr(Ne(c),(e=>re(o,e)),(()=>Tt(o))),Ce(2),Te(c),zi(e,c),fi()}var xo=(e,t,i)=>{t(!1),i()},$o=Di('<div class="overlay svelte-jfbaax"></div> <div class="next-video svelte-jfbaax"><div class="top svelte-jfbaax"><div class="caption svelte-jfbaax"> </div> <!></div> <div class="row svelte-jfbaax"><div class="column svelte-jfbaax"><div class="thumb svelte-jfbaax"><div></div> <!></div></div> <div class="column svelte-jfbaax"><div class="title svelte-jfbaax"> </div></div></div></div>',1),_o={hash:"svelte-jfbaax",code:".overlay.svelte-jfbaax {width:100%;height:100%;background:rgba(0, 0, 0, 0.72);position:absolute;}.next-video.svelte-jfbaax {position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);display:flex;width:362px;flex-direction:column;}.top.svelte-jfbaax {display:flex;justify-content:space-between;}.caption.svelte-jfbaax {font-size:11px;font-weight:bold;color:var(--white);text-transform:uppercase;opacity:0.8;}.row.svelte-jfbaax {height:102px;background:rgba(48, 48, 48, .8);cursor:pointer;margin-top:6px;display:flex;flex-direction:row;width:100%;}.column.svelte-jfbaax {display:flex;flex-direction:column;flex-basis:50%;}.thumb.svelte-jfbaax {width:100%;height:100%;background:no-repeat center;background-size:cover;display:flex;align-items:center;position:relative;justify-content:space-around;}.thumb-overlay.svelte-jfbaax {width:100%;height:100%;position:absolute;}.thumb-overlay.withOpacity.svelte-jfbaax {background:var(--black);opacity:0.3;}.title.svelte-jfbaax {padding:10px 16px;font-size:12px;font-weight:bold;color:var(--white);line-height:1.6;max-height:52px;overflow:hidden;}"};function ko(e,t){pi(t,!0),vr(e,_o);let[i,r]=ua(),a=()=>la(n,"$autoplayNextEnabled$",i),s=Oa(),n=s.ui.autoplayNextEnabled$,o=s.ui.timerNextVideoRunning$,l=s.actions.internal.nextVideoClick,u=s.actions.internal.nextVideoAnnouncementShow,d=s.actions.internal.nextVideoAnnouncementClick,c=s.actions.internal.nextVideoAnnouncementAuto,h=s.actions.internal.nextVideoAnnouncementCancel,p=()=>{a()&&(l(!1),c())},f=()=>{t.clickCloseIcon(),h()};Xr((()=>{t.isHide||u(),t.isHide&&a()&&(l(!1),c())}));var m=ji(),v=Be(m),g=e=>{var r=$o(),s=De(Be(r),2),n=Ne(s),u=Ne(n),c=Ne(u,!0);Te(u),bo(De(u,2),{onClick:f}),Te(n);var h=De(n,2);h.__click=[xo,l,d];var m=Ne(h),v=Ne(m),g=Ne(v);let b;var y=De(g,2),w=e=>{let t=ne((()=>la(o,"$timerNextVideoRunning$",i)&&a()));So(e,{get isRunning(){return Tt(t)},onTimerEnded:p})};Xi(y,(e=>{a()&&e(w)})),Te(v),Te(m);var S=De(m,2),x=Ne(S),$=Ne(x,!0);Te(x),Te(S),Te(h),Te(s),Bt(((e,i)=>{Hi(c,e),_r(v,`background-image: url('${t.thumb}')`),b=xr(g,1,"thumb-overlay svelte-jfbaax",null,b,i),Hi($,t.title)}),[()=>Es("end_screen_next_video"),()=>({withOpacity:a()})]),zi(e,r)};Xi(v,(e=>{t.isHide||e(g)})),zi(e,m),fi(),r()}Ri(["click"]);var To=(e,t)=>Math.min(+(e+t).toFixed(2),1),Co=(e,t)=>Math.max(+(e-t).toFixed(2),0),Eo=(e,t,i)=>{let r=To(t,i);t<1&&e.actions.internal.setVolume(r)},Ao=(e,t,i)=>{let r=Co(t,i);t>0&&e.actions.internal.setVolume(r)},Lo=({isAudioDisabled:e,audioDisabledHintCallback:t,isAudioAvailable:i,audioIsNotExistHintCallback:r})=>e?(t?.(),!1):!!i||(r?.(),!1),Po=Di('<div class="keyboard-controls svelte-10kkmxz" tabindex="-1" role="region"><!></div>'),Mo={hash:"svelte-10kkmxz",code:".keyboard-controls.svelte-10kkmxz {position:absolute;left:0;right:0;top:0;bottom:0;}"};function Io(e,t){pi(t,!0),vr(e,Mo);let[i,r]=ua(),a=()=>la(x,"$playbackState$",i),s=()=>la($,"$adPlaybackState",i),n=()=>la(C,"$disabledControls$",i),o=()=>la(_,"$positionExact$",i),l=()=>la(k,"$duration$",i),u=()=>la(j,"$isAudioAvailable$",i),d=()=>la(T,"$volume$",i),c=()=>la(P,"$availablePlaybackRates$",i),h=()=>la(L,"$currentPlaybackRate$",i),p=()=>la(A,"$currentSubtitle$",i),g=ma(t,"nextButtonActive",3,!1),b=ma(t,"prevButtonActive",3,!1),y=Oa(),w=ya(),S=y.getLogger().createComponentLog("KeyboardControls component"),x=y.state.playbackState$,$=y.ads.playbackState,_=y.state.positionExact$,k=y.state.duration$,T=y.state.volume$,C=y.ui.controls.disabledControls$,E=y.state.muted$,A=y.state.currentSubtitle$,L=y.state.currentPlaybackRate$,P=y.state.availablePlaybackRates$,M=y.ui.contextMenu.openedByHotKey$,I=y.ui.contextMenu.lastActiveElem$,R=y.ui.contextMenu.visible$,V=y.ui.contextMenu.position$,N=y.state.isEnded$,B=y.ui.overlayContainer$,O=y.callbacks?.onAudioDoesNotExistHint,F=y.callbacks?.onAudioDisabledHint,j=y.state.isAudioAvailable$,z=y.state.isAudioDisabled,U=y.state.isInteractiveTime$,{showInteractiveTimeIndicatorTooltip$:q}=Fa(),H=0,W=!0,Q=te(void 0),G=e=>(e!==W&&(W=e,H=0),H+=1,(w.controls.seekStepKeyboard+w.controls.seekStepKeyboard*H)/1e3),K=Es("aria_label_video_player");var Y=Po();Y.__keyup=e=>{let i=e.code;if(e.ctrlKey||e.altKey||e.metaKey)return;let r=a()===f.PlaybackState.PLAYING||a()===f.PlaybackState.PAUSED,n=t.isAds&&("paused"===s()||"playing"===s());if(r||n)switch(i){case"ShiftLeft":case"ShiftRight":H=0}},Y.__keydown=e=>{let r=e.target,x=r?.getAttribute("role")?.includes("menuitem"),$=r.classList.contains("btn"),_=e.code;if($&&"Space"===_)return;let k=Ta.has(_);if(x&&k)return;let T=!ka.has(_);if(e.ctrlKey&&T||e.altKey&&T||e.metaKey)return;let C=x&&"Escape"===_;Ca.has(_)||C||t.hideContextMenu();let A=a()===f.PlaybackState.PLAYING||a()===f.PlaybackState.PAUSED,L=t.isAds&&("paused"===s()||"playing"===s()),P=!L&&!n().has("TIMELINE");if(A||L)switch(S({message:`key down, code: ${_}`}),_){case"KeyJ":case"ArrowLeft":if(!P)break;if(e.ctrlKey||e.altKey){let i=y.actions.internal.getPrevEpisode();y.actions.internal.seekToPrevEpisode(i),i&&t.showHotKeyHelpers({type:"EPISODE_PREV",text:i.text}),e.preventDefault()}else{let i=e.shiftKey?G(!1):w.controls.seekStepKeyboard/1e3,r=Math.max(o()-i,0);o()>0&&(y.actions.internal.seekTime(r,v.SeekAction.DOUBLE_TAP),t.showHotKeyHelpers({type:"BACKWARD_SEEK",text:i.toString()}),e.preventDefault())}break;case"KeyL":case"ArrowRight":if(!P)break;if(e.ctrlKey||e.altKey){let i=y.actions.internal.getNextEpisode();y.actions.internal.seekToNextEpisode(i),i&&t.showHotKeyHelpers({type:"EPISODE_NEXT",text:i.text}),e.preventDefault()}else{let i=e.shiftKey?G(!0):w.controls.seekStepKeyboard/1e3,r=Math.min(o()+i,l());Math.round(o())<Math.round(l())&&(y.actions.internal.seekTime(r,v.SeekAction.DOUBLE_TAP),t.showHotKeyHelpers({type:"FORWARD_SEEK",text:i.toString()}),e.preventDefault())}break;case"ArrowUp":if(Lo({isAudioDisabled:z,audioDisabledHintCallback:F,isAudioAvailable:u(),audioIsNotExistHintCallback:O})){let e=d(),i=w.controls.volumeStepKeyboard,r=e<=1;if(Eo(y,e,i),r){let r=Math.round(100*To(e,i)).toString();t.showHotKeyHelpers({type:"VOLUME",t:{key:"hotkey_helper_current_volume",value:r}})}}e.preventDefault();break;case"ArrowDown":if(Lo({isAudioDisabled:z,audioDisabledHintCallback:F,isAudioAvailable:u(),audioIsNotExistHintCallback:O})){let e=d(),i=w.controls.volumeStepKeyboard,r=e>=0;if(Ao(y,e,i),r){let r=Math.round(100*Co(e,i)).toString();t.showHotKeyHelpers({type:"VOLUME",t:{key:"hotkey_helper_current_volume",value:r}})}}e.preventDefault();break;case"Comma":if(e.shiftKey){y.actions.internal.decrementPlaybackRate();let i=c().find((e=>e.value===h()));t.showHotKeyHelpers({type:"RATE_DOWN",text:i?.displayValue}),e.preventDefault()}else{if(L||a()!==f.PlaybackState.PAUSED)break;let i=Math.max(o()-w.controls.seekStepFrame/1e3,0);o()>0&&(t.showHotKeyHelpers({type:"BACKWARD_SEEK"}),y.actions.internal.clearDelayedBufferingCheckTimeout(),y.actions.internal.seekTime(i,v.SeekAction.DOUBLE_TAP),e.preventDefault())}break;case"Period":if(e.shiftKey){y.actions.internal.incrementPlaybackRate();let i=c().find((e=>e.value===h()));t.showHotKeyHelpers({type:"RATE_UP",text:i?.displayValue}),e.preventDefault()}else{if(L||a()!==f.PlaybackState.PAUSED)break;let i=Math.min(o()+w.controls.seekStepFrame/1e3,l());o()<l()&&(t.showHotKeyHelpers({type:"FORWARD_SEEK"}),y.actions.internal.clearDelayedBufferingCheckTimeout(),y.actions.internal.seekTime(i,v.SeekAction.DOUBLE_TAP),e.preventDefault())}break;case"KeyK":case"Space":if(!n().has("PLAY_BUTTON"))if(la(U,"$isInteractiveTime$",i)&&la(q,"$showInteractiveTimeIndicatorTooltip$",i)&&q.set(!1),t.fakePlayButtonHandler)t.fakePlayButtonHandler();else{y.actions.internal.togglePlay();let e="PLAY";a()===f.PlaybackState.PAUSED?e="PAUSE":la(N,"$isEnded$",i)&&(e="REPLAY"),t.showHotKeyHelpers({type:e})}e.preventDefault();break;case"KeyM":Lo({isAudioDisabled:z,audioDisabledHintCallback:F,isAudioAvailable:u(),audioIsNotExistHintCallback:O})&&(t.showHotKeyHelpers({type:la(E,"$muted$",i)?"VOLUME":"MUTE"}),y.actions.internal.toggleMuted()),e.preventDefault();break;case"KeyF":t.toggleFullscreen(),e.preventDefault();break;case"KeyC":y.actions.internal.toggleSubtitle(),"off"!==p().value?t.showHotKeyHelpers({type:"SUBTITLES_ON",text:p()?.displayValue}):t.showHotKeyHelpers({type:"SUBTITLES_OFF"}),e.preventDefault();break;case"KeyI":y.actions.internal.togglePictureInPicture(),e.preventDefault();break;case"Digit1":case"Numpad1":if(e.shiftKey){let t=(e=>{if(!e)return{top:0,left:0};let t=e.getBoundingClientRect(),i=t.left+8;return{bottom:t.bottom+-58,left:i}})(la(B,"$overlayContainer$",i));V.set(t),I.set(r),M.set(!0),R.set(!0),e.preventDefault();break}t.showHotKeyHelpers(),y.actions.internal.seekToPercent(.1,v.SeekAction.DOUBLE_TAP),e.preventDefault();break;case"Digit2":case"Numpad2":t.showHotKeyHelpers(),y.actions.internal.seekToPercent(.2,v.SeekAction.DOUBLE_TAP),e.preventDefault();break;case"Digit3":case"Numpad3":t.showHotKeyHelpers(),y.actions.internal.seekToPercent(.3,v.SeekAction.DOUBLE_TAP),e.preventDefault();break;case"Digit4":case"Numpad4":t.showHotKeyHelpers(),y.actions.internal.seekToPercent(.4,v.SeekAction.DOUBLE_TAP),e.preventDefault();break;case"Digit5":case"Numpad5":t.showHotKeyHelpers(),y.actions.internal.seekToPercent(.5,v.SeekAction.DOUBLE_TAP),e.preventDefault();break;case"Digit6":case"Numpad6":t.showHotKeyHelpers(),y.actions.internal.seekToPercent(.6,v.SeekAction.DOUBLE_TAP),e.preventDefault();break;case"Digit7":case"Numpad7":t.showHotKeyHelpers(),y.actions.internal.seekToPercent(.7,v.SeekAction.DOUBLE_TAP),e.preventDefault();break;case"Digit8":case"Numpad8":t.showHotKeyHelpers(),y.actions.internal.seekToPercent(.8,v.SeekAction.DOUBLE_TAP),e.preventDefault();break;case"Digit9":case"Numpad9":t.showHotKeyHelpers(),y.actions.internal.seekToPercent(.9,v.SeekAction.DOUBLE_TAP),e.preventDefault();break;case"Digit0":case"Numpad0":t.showHotKeyHelpers(),y.actions.internal.seekToPercent(0,v.SeekAction.DOUBLE_TAP),e.preventDefault();break;case"Slash":e.shiftKey&&w.features.hotKeyMapModal&&(t.showKeyMap(),e.preventDefault());break;case"KeyN":e.shiftKey&&g()&&y.actions.internal.nextVideoClick();break;case"KeyP":e.shiftKey&&b()&&y.actions.internal.prevVideoClick();break;case"ShiftLeft":case"ShiftRight":e.preventDefault();break;case"Tab":case"Escape":case"Enter":break;default:(0,m.checkNever)(_)}},Lr(Y,"aria-label",K),hr(Ne(Y),(()=>t.children??D)),Te(Y),Kr(Y,(e=>re(Q,e)),(()=>Tt(Q))),zi(e,Y);var Z=fi({focus:()=>Tt(Q)?.focus()});return r(),Z}Ri(["keyup","keydown"]);var Ro=Di('<div class="container svelte-1dbnjb1"><div class="dot svelte-1dbnjb1"></div> <div class="dot svelte-1dbnjb1"></div> <div class="dot svelte-1dbnjb1"></div></div>'),Vo={hash:"svelte-1dbnjb1",code:".container.svelte-1dbnjb1 {position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);pointer-events:none;display:flex;}.dot.svelte-1dbnjb1:nth-child(1) {animation-delay:calc(0 * 180ms);}.dot.svelte-1dbnjb1:nth-child(2) {animation-delay:calc(1 * 180ms);}.dot.svelte-1dbnjb1:nth-child(3) {animation-delay:calc(2 * 180ms);}\n\n  @keyframes svelte-1dbnjb1-dot_animation {\n    0% {\n      opacity: 0.2;\n    }\n    30% {\n      opacity: 1;\n    }\n    100% {\n      opacity: 0.2;\n    }\n  }.dot.svelte-1dbnjb1 {border-radius:4px;width:8px;height:8px;background:var(--btn-color);animation-duration:750ms;\n    animation-name: svelte-1dbnjb1-dot_animation;animation-iteration-count:infinite;}.dot.svelte-1dbnjb1 + .dot:where(.svelte-1dbnjb1) {margin-left:4px;}"};function No(e,t){vr(e,Vo);let i=ma(t,"style",3,"");var r=Ro();Bt((()=>_r(r,i()))),zi(e,r)}var Bo=Oi('<svg><!><g filter="url(#a)"><path fill="#fff" d="M7.536 6.264a.9.9 0 0 0-1.272 1.272L10.727 12l-4.463 4.464a.9.9 0 0 0 1.272 1.272L12 13.273l4.464 4.463a.9.9 0 1 0 1.272-1.272L13.273 12l4.463-4.464a.9.9 0 1 0-1.272-1.272L12 10.727z"></path><path stroke="#000" stroke-opacity=".12" stroke-width=".5" d="M7.713 6.087a1.15 1.15 0 1 0-1.626 1.626L10.374 12l-4.287 4.287a1.15 1.15 0 0 0 1.626 1.626L12 13.626l4.287 4.287a1.15 1.15 0 0 0 1.626-1.626L13.626 12l4.287-4.287a1.15 1.15 0 1 0-1.626-1.626L12 10.374z"></path></g><defs><filter id="a" width="23" height="23" x=".5" y=".5" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset></feOffset><feGaussianBlur stdDeviation="2.5"></feGaussianBlur><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.16 0"></feColorMatrix><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_2422_111980"></feBlend><feBlend in="SourceGraphic" in2="effect1_dropShadow_2422_111980" result="shape"></feBlend></filter></defs></svg>');var Do=e=>{e.stopPropagation()},Oo=Di("<button><!></button>"),Fo={hash:"svelte-wr0kwr",code:".btn.svelte-wr0kwr {padding:8px;margin:0;height:var(--controls-height);display:flex;flex-direction:row;align-items:center;justify-content:center;}\n\n   /* Ниже идут абстрактные и специфик классы для кнопок которые можно передать через параметр className */.w-max.svelte-wr0kwr {width:100%;}.btn--live.svelte-wr0kwr {padding:10px 4px;}.btn-jc-l.svelte-wr0kwr {justify-content:left;}\n\n\n  /* mobile */\n  /* container mobile */.btn-m.svelte-wr0kwr {position:absolute;left:12px;top:50%;transform:translateY(-50%);height:44px;width:44px;border-radius:12px;background-color:rgba(0, 0, 0, 0.56);transition:opacity var(--controls-transition-duration);display:flex;align-items:center;justify-content:center;}.btn-m--play.svelte-wr0kwr {width:var(--big-play-size);height:var(--big-play-size);display:flex;align-items:center;justify-content:center;position:relative;padding:16px;}.btn-m--play.svelte-wr0kwr svg {transform:scale(2);}.btn-m--prev.svelte-wr0kwr,\n  .btn-m--next.svelte-wr0kwr {position:absolute;width:50px;height:50px;}.btn-m--prev.svelte-wr0kwr {right:calc(100% + 35px);}.btn-m--next.svelte-wr0kwr {left:calc(100% + 35px);}.btn.svelte-wr0kwr:disabled {cursor:default;\n    /* нужно для того, чтобы не давать событиям клика отрабатывать на заблоченном элементе */pointer-events:none;}.btn.svelte-wr0kwr:not(.btn-full-opacity):disabled {opacity:0.4;}.btn.svelte-wr0kwr:not(:disabled):hover {opacity:0.8;}.pr-0.svelte-wr0kwr {padding-right:0;}.pl-0.svelte-wr0kwr {padding-left:0;}"};function jo(e,t){pi(t,!0),vr(e,Fo);let i=ma(t,"className",3,""),r=ma(t,"style",3,""),a=ma(t,"disabled",3,void 0),s=ma(t,"testId",3,void 0),n=ma(t,"ariaHidden",3,void 0),o=ma(t,"ariaLabel",3,void 0),l=ma(t,"ref",15,void 0),u=ma(t,"ariaKeyShortCut",3,void 0),d=ma(t,"ariaExpanded",3,void 0),c=ma(t,"tabIndex",3,0),h=ma(t,"click",3,m.noop),p=ma(t,"focus",3,m.noop),f=ma(t,"blur",3,m.noop),v=ne((()=>h()===m.noop?null:e=>{e.stopPropagation(),h()(e)})),g=ne((()=>p()===m.noop?null:e=>{e.preventDefault(),p()()})),b=ne((()=>f()===m.noop?null:e=>{e.preventDefault(),f()()}));var y=Oo();y.__pointerdown=[Do],y.__click=function(...e){Tt(v)?.apply(this,e)},hr(Ne(y),(()=>t.children??D)),Te(y),Kr(y,(e=>l(e)),(()=>l())),Bt((()=>{xr(y,1,`btn ${i()??""}`,"svelte-wr0kwr"),_r(y,r()||null),y.disabled=a()??null,Lr(y,"aria-hidden",n()??null),Lr(y,"aria-label",o()??null),Lr(y,"aria-keyshortcuts",u()??null),Lr(y,"aria-expanded",d()??null),Lr(y,"data-testid",s()??null),Lr(y,"tabindex",c())})),Ii("focus",y,(function(...e){Tt(g)?.apply(this,e)})),Ii("blur",y,(function(...e){Tt(b)?.apply(this,e)})),zi(e,y),fi()}Ri(["pointerdown","click"]);var zo=Di('<div class="modal-header svelte-1witlsj"><h3 class="modal-title svelte-1witlsj"> </h3> <!></div>'),Uo=Di('<div class="modal-overlay svelte-1witlsj"><div class="modal-container svelte-1witlsj"><!> <div class="modal-scroll svelte-1witlsj"><div class="modal-main svelte-1witlsj"><!></div></div></div></div>'),qo={hash:"svelte-1witlsj",code:".modal-overlay.svelte-1witlsj {position:absolute;top:0;bottom:0;left:0;right:0;background:transparent;display:flex;align-items:center;justify-content:center;}.modal-container.svelte-1witlsj {display:flex;flex-direction:column;width:calc(100% - 32px);max-width:600px;height:calc(100% - 24px);max-height:490px;background:var(--mobile-settings-bg);color:var(--white);border-radius:8px;}.modal-header.svelte-1witlsj {box-sizing:border-box;display:flex;justify-content:space-between;align-items:start;height:40px;padding:8px 10px;border-bottom:1px solid var(--white-alpha-24);}.modal-title.svelte-1witlsj {margin:3px 0 0 6px;color:var(--white);font-feature-settings:'clig' off, 'liga' off;font-size:13px;font-style:normal;font-weight:600;line-height:16px;}.modal-scroll.svelte-1witlsj {overflow-y:auto;overflow-x:hidden;margin:8px 4px 8px 0;height:100%;}.modal-scroll.svelte-1witlsj::-webkit-scrollbar {width:8px;}.modal-scroll.svelte-1witlsj::-webkit-scrollbar-track {box-shadow:none;background-color:transparent;border-radius:4px;margin-right:2px;}.modal-scroll.svelte-1witlsj::-webkit-scrollbar-thumb {min-height:40px;border-radius:5px;background-color:#666;border:1px solid transparent;background-clip:padding-box;}.modal-scroll.svelte-1witlsj::-webkit-scrollbar-thumb:hover {background-color:#777;}.modal-main.svelte-1witlsj {margin:-8px -4px 0 0;}"};function Ho(e,t){pi(t,!0),vr(e,qo);let i=ma(t,"showHeader",3,!0),r=ma(t,"showCloseCross",3,!0),a=Es("hotkey_map_modal_close_btn_text");var s=Uo(),n=Ne(s),o=Ne(n),l=e=>{var i=zo(),s=Ne(i),n=Ne(s,!0);Te(s);var o=De(s,2),l=e=>{jo(e,{get click(){return t.onClose},testId:"close-modal",style:"padding: 0; height: 24px; width: 24px",ariaLabel:a,children:(e,t)=>{!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=Bo();let a;hr(Ne(r),(()=>t.children??D)),Ce(2),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"cross-icon",role:"img",...i}))),zi(e,r)}(e,{})},$$slots:{default:!0}})};Xi(o,(e=>{r()&&e(l)})),Te(i),Bt((()=>Hi(n,t.title))),zi(e,i)};Xi(o,(e=>{i()&&e(l)}));var u=De(o,2),d=Ne(u);hr(Ne(d),(()=>t.children??D)),Te(d),Te(u),Te(n),Te(s),zi(e,s),fi()}var Wo=new Set(["BR"]),Qo=Di('<li class="hot-key-map-item svelte-quklnq"><span class="hot-key-map-item-description svelte-quklnq"><!></span> <span class="hot-key-map-item-value svelte-quklnq"> </span></li>'),Go=Di('<div class="hot-key-map-group svelte-quklnq"><h5 class="hot-key-map-group-title svelte-quklnq"> </h5> <ul class="hot-key-map-group-items svelte-quklnq"></ul></div>'),Ko=Di('<div class="hot-key-map svelte-quklnq"></div>'),Yo={hash:"svelte-quklnq",code:".hot-key-map.svelte-quklnq {color:var(--black);box-sizing:border-box;overflow-x:hidden;}.hot-key-map-group.svelte-quklnq {border-bottom:1px solid var(--white-alpha-24);margin:0 20px 0 16px;}.hot-key-map-group.svelte-quklnq:last-child {border-bottom:none;}.hot-key-map-group-title.svelte-quklnq {color:var(--white);font-feature-settings:'clig' off, 'liga' off;font-size:13px;font-style:normal;font-weight:600;line-height:16px;}.hot-key-map-group-title.svelte-quklnq,\n  .hot-key-map-item.svelte-quklnq {padding:12px 0;margin:0;width:100%;}.hot-key-map-group-items.svelte-quklnq {box-sizing:border-box;list-style:none;padding:0;margin:0;}.hot-key-map-item.svelte-quklnq {box-sizing:border-box;display:flex;justify-content:space-between;align-items:center;--videoplayer-hotkey-item-value-width: 156px;--videoplayer-hotkey-item-value-padding-left: 24px;}.hot-key-map-item-description.svelte-quklnq {color:var(--white-alpha-72);width:calc(100% - var(--videoplayer-hotkey-item-value-width) - var(--videoplayer-hotkey-item-value-padding-left));max-width:388px;}.hot-key-map-item-value.svelte-quklnq {color:var(--white);width:var(--videoplayer-hotkey-item-value-width);padding-left:var(--videoplayer-hotkey-item-value-padding-left);letter-spacing:-0.14px;}.hot-key-map-item-description.svelte-quklnq,\n  .hot-key-map-item-value.svelte-quklnq {font-feature-settings:'clig' off, 'liga' off;font-size:13px;font-style:normal;font-weight:400;line-height:16px;}"};function Zo(e,t){pi(t,!1),vr(e,Yo);let[i,r]=ua(),a=()=>la(n,"$data",i),s=Oa(),{data:n,show:o}=s.ui.modals.hotKeyMap;Yr(),Ho(e,{get title(){return a().title},onClose:()=>{o.set(!1)},children:(e,t)=>{var i=Ko();ar(i,5,(()=>a().groups),(({title:e,items:t})=>e),((e,t)=>{var i=Go(),r=Ne(i),a=Ne(r,!0);Te(r);var s=De(r,2);ar(s,5,(()=>Tt(t).items),(({description:e,value:t})=>t),((e,t)=>{var i=Qo(),r=Ne(i);cr(Ne(r),(()=>(e=>{let t=document.createElement("DIV");t.innerHTML=e;let i=t.querySelectorAll("*"),r=i.length;for(;r--;){let e=i[r],t=e.tagName;Wo.has(t)||e.parentElement?.removeChild(e)}return t.innerHTML})(Tt(t).description)),!1,!1),Te(r);var a=De(r,2),s=Ne(a,!0);Te(a),Te(i),Bt((()=>Hi(s,Tt(t).value))),zi(e,i)})),Te(s),Te(i),Bt((()=>Hi(a,Tt(t).title))),zi(e,i)})),Te(i),zi(e,i)},$$slots:{default:!0}}),fi(),r()}var Xo=Di('<div class="pillow svelte-1oe0j8n"><!></div>'),Jo={hash:"svelte-1oe0j8n",code:".pillow.svelte-1oe0j8n {background-color:#679FF8;color:var(--white);font-size:6px;font-weight:600;-webkit-font-smoothing:antialiased;padding:2px 4px;border-radius:12px;}"};var el=Oi('<svg><!><path fill="currentColor" d="M5.517 5c.325 0 .516-.198.516-.536v-.97l.492-.517 1.46 1.74c.16.205.304.283.516.283A.49.49 0 0 0 9 4.501c0-.14-.068-.287-.222-.478l-1.47-1.73L8.818.868C8.949.731 9 .618 9 .475A.474.474 0 0 0 8.515 0c-.171 0-.301.065-.445.222L6.064 2.25h-.03V.54c0-.342-.192-.54-.517-.54s-.516.198-.516.54v3.924c0 .338.191.536.516.536"></path><path fill="currentColor" fill-rule="evenodd" d="m2.551 1.052-1.51 2.052h1.51zM3.5 3.104V.832c0-.81-1.089-1.14-1.556-.48L.139 2.821a.75.75 0 0 0 .612 1.183h1.8v.55c0 .248.25.45.499.45a.45.45 0 0 0 .45-.45v-.55h.052a.45.45 0 0 0 0-.9z" clip-rule="evenodd"></path></svg>');function tl(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=el();let a;hr(Ne(r),(()=>t.children??D)),Ce(2),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"9",height:"5",fill:"none",role:"img",...i}))),zi(e,r)}var il=Oi('<svg><!><path fill="currentColor" d="M5.513 5c.323 0 .513-.198.513-.537v-.97l.49-.516L7.99 4.715c.16.205.302.284.513.284A.49.49 0 0 0 9 4.5c0-.14-.068-.287-.22-.478L7.293 2.293 8.82.868C8.949.731 9 .618 9 .475A.473.473 0 0 0 8.517 0c-.17 0-.299.065-.441.222L6.056 2.25h-.03V.54c0-.342-.19-.54-.513-.54S5 .198 5 .54v3.923c0 .339.19.537.513.537"></path><path fill="currentColor" fill-rule="evenodd" d="M2 0q-.53 0-.952.173a1.5 1.5 0 0 0-.654.484q-.23.312-.23.71c0 .423.208.756.613.995a1.46 1.46 0 0 0-.547.44q-.23.305-.23.71 0 .432.252.778l.001.001q.26.336.712.523Q1.418 5.001 2 5q.582 0 1.035-.186.451-.187.705-.524.26-.346.26-.777 0-.406-.23-.711a1.45 1.45 0 0 0-.552-.44c.409-.235.618-.569.618-.994a1.14 1.14 0 0 0-.238-.711 1.44 1.44 0 0 0-.653-.484A2.4 2.4 0 0 0 2 0m-.573.964C1.563.86 1.75.804 2 .804s.434.055.564.16h.001a.51.51 0 0 1 .204.43.52.52 0 0 1-.204.437c-.13.105-.315.161-.565.161s-.437-.056-.573-.161a.52.52 0 0 1-.203-.437q.002-.276.203-.43m-.345 2.522c0-.217.08-.381.233-.503.16-.122.385-.188.685-.188s.522.066.677.188q.24.181.24.503a.63.63 0 0 1-.24.523c-.155.122-.377.188-.677.188s-.524-.065-.684-.187a.64.64 0 0 1-.234-.524" clip-rule="evenodd"></path></svg>');function rl(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=il();let a;hr(Ne(r),(()=>t.children??D)),Ce(2),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"9",height:"5",fill:"none",role:"img",...i}))),zi(e,r)}var al=Oi('<svg><!><path fill="currentColor" d="M5.516 5h1.107C8.103 5 9 4.065 9 2.5S8.103 0 6.623 0H5.516C5.191 0 5 .2 5 .537V4.46c0 .342.191.54.516.54m.516-.854V.852H6.5C7.41.852 8 1.468 8 2.5c0 1.066-.577 1.646-1.5 1.646zM.516 5c.325 0 .516-.198.516-.536V2.922h1.936v1.542c0 .338.191.536.516.536S4 4.802 4 4.464V.54C4 .198 3.809 0 3.484 0s-.516.198-.516.54v1.531H1.032V.54C1.032.198.841 0 .516 0S0 .198 0 .54v3.989C0 4.867.191 5 .516 5"></path></svg>');function sl(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=al();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"9",height:"5",fill:"none",role:"img",...i}))),zi(e,r)}var nl=Oi('<svg><!><path fill="currentColor" d="M9.516 5h1.107C12.103 5 13 4.065 13 2.5S12.103 0 10.623 0H9.516C9.191 0 9 .2 9 .537V4.46c0 .342.191.54.516.54m.516-.854V.852h.468c.91 0 1.5.616 1.5 1.648 0 1.066-.577 1.646-1.5 1.646zM4.516 5c.325 0 .516-.198.516-.536V2.922h1.936v1.542c0 .338.191.536.516.536S8 4.802 8 4.464V.54C8 .198 7.809 0 7.484 0s-.516.198-.516.54v1.531H5.032V.54c0-.342-.191-.54-.516-.54S4 .198 4 .54v3.989c0 .338.191.471.516.471m-4 0c.325 0 .516-.198.516-.537V3h1.332c.27 0 .441-.154.441-.41 0-.253-.174-.407-.44-.407H1.031V.854h1.5c.28 0 .468-.16.468-.427C3 .161 2.815 0 2.532 0H.516C.191 0 0 .198 0 .537v3.926C0 4.802.191 5 .516 5"></path></svg>');function ol(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=nl();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"13",height:"5",fill:"none",role:"img",...i}))),zi(e,r)}var ll=Oi('<svg><!><path fill="currentColor" d="M11.516 5.75h1.107c1.48 0 2.377-.935 2.377-2.5s-.897-2.5-2.377-2.5h-1.107c-.325 0-.516.199-.516.537V5.21c0 .342.191.54.516.54m.516-.854V1.602h.468c.91 0 1.5.616 1.5 1.648 0 1.066-.577 1.646-1.5 1.646zm-5.516.854c.325 0 .516-.198.516-.536V3.672h1.936v1.542c0 .338.191.536.516.536S10 5.552 10 5.214V1.29c0-.342-.191-.54-.516-.54s-.516.198-.516.54v1.531H7.032V1.29c0-.342-.191-.54-.516-.54S6 .948 6 1.29v3.989c0 .338.191.471.516.471"></path><path fill="currentColor" fill-rule="evenodd" d="M3.338 5.659a4 4 0 0 1-.838.091C1.037 5.75 0 4.885 0 3.303 0 1.733 1.037.75 2.5.75 3.96.75 5 1.734 5 3.303c0 .863-.274 1.46-.778 1.88l.194.29a.5.5 0 0 1-.832.554zm-.52-.78-.234-.352a.5.5 0 1 1 .832-.554l.245.367c.184-.26.286-.615.286-1.037 0-1.036-.64-1.653-1.447-1.653-.81 0-1.447.617-1.447 1.653 0 1.032.637 1.596 1.447 1.596.08 0 .208-.007.318-.02" clip-rule="evenodd"></path></svg>');function ul(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=ll();let a;hr(Ne(r),(()=>t.children??D)),Ce(2),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"15",height:"7",fill:"none",role:"img",...i}))),zi(e,r)}var dl=e=>{switch(e){case m.VideoQuality.Q_720P:return sl;case m.VideoQuality.Q_1080P:return ol;case m.VideoQuality.Q_1440P:return ul;case m.VideoQuality.Q_2160P:return tl;case m.VideoQuality.Q_4320P:return rl}},cl=Oi('<svg><!><path fill="var(--btn-color, #fff)" d="M12.722 2.213c1.208.037 1.994.702 2.408 1.954l.065.215.051.191q.027.111.068.235l.058.159.034.017.069-.023.133-.051.156-.068c1.414-.658 2.502-.536 3.387.437l.125.145.82 1.017c.732.962.71 1.99-.004 3.1l-.125.187-.117.16a3 3 0 0 0-.142.205l-.07.115-.034.057.004.02.091.06.127.077.153.083c1.39.71 1.963 1.641 1.742 2.936l-.038.188-.244 1.058c-.158.685-.282 1.01-.77 1.454-.475.432-1.016.61-1.732.67l-.22.014-.198.006q-.116.002-.246.015l-.181.021.013.142.013.096.033.179c.323 1.526-.04 2.558-1.188 3.202l-.17.09-1.175.57c-1.102.495-2.099.242-3.02-.702l-.153-.164-.13-.15a3 3 0 0 0-.17-.186l-.097-.096-.05-.046-.09.087-.106.108-.118.133c-.952 1.134-1.957 1.54-3.176 1.067l-.175-.074-1.052-.51-.312-.16c-.476-.26-.743-.51-1.004-1.061-.275-.58-.294-1.15-.16-1.883l.044-.225q.024-.114.041-.242l.019-.172-.004-.004-.104-.014-.146-.013-.174-.008c-1.56-.028-2.484-.614-2.853-1.877l-.049-.185-.292-1.274c-.235-1.185.236-2.1 1.364-2.785l.194-.112.175-.093a3 3 0 0 0 .216-.12l.155-.102.004-.019-.063-.108-.08-.125-.103-.143c-.937-1.246-1.044-2.335-.276-3.404l.115-.153.824-1.013c.79-.915 1.8-1.107 3.034-.64l.208.083.181.081q.103.048.222.093l.136.048.036-.017.033-.089.045-.138.046-.166c.36-1.436 1.085-2.242 2.39-2.35l.19-.011h1.39Zm-.056 1.799h-1.333l-.14.01c-.285.037-.472.191-.652.832l-.041.156-.057.206a6.3 6.3 0 0 1-.468 1.134 6 6 0 0 0-1.147.558 6.5 6.5 0 0 1-1.16-.35l-.35-.154c-.248-.107-.435-.161-.583-.175l-.084-.003a.55.55 0 0 0-.408.193l-.068.074-.789.973-.095.125c-.183.264-.21.5.195 1.075l.228.316c.212.31.425.692.598 1.102q-.195.577-.27 1.201c-.334.29-.69.537-1.013.72l-.343.184c-.617.34-.695.563-.646.881l.013.075.28 1.22.04.152c.096.308.265.475.968.509l.388.014c.37.024.798.09 1.223.204q.337.526.776.968a6.3 6.3 0 0 1-.118 1.445c-.201.95-.014 1.102.383 1.3l1.126.547a.8.8 0 0 0 .337.089l.067-.006c.181-.028.382-.162.67-.485l.258-.295a6.5 6.5 0 0 1 .949-.837l.298.023L12 18l.302-.008.298-.022c.363.263.691.559.948.837l.258.295c.325.364.538.488.737.49l.066-.003a.8.8 0 0 0 .178-.046l.093-.039 1.126-.548.139-.073c.3-.175.42-.395.245-1.226a6.2 6.2 0 0 1-.117-1.445q.436-.442.775-.97a6.5 6.5 0 0 1 1.223-.202l.387-.014c.812-.04.912-.256 1.008-.66l.264-1.142c.09-.406.095-.643-.617-1.035l-.342-.183a6.4 6.4 0 0 1-1.014-.722 6 6 0 0 0-.27-1.201c.174-.41.386-.791.598-1.1l.228-.317c.406-.575.378-.81.195-1.075l-.045-.062-.787-.974c-.14-.171-.259-.294-.452-.322l-.076-.007c-.16-.003-.368.05-.667.178l-.35.155a6.4 6.4 0 0 1-1.158.348 6 6 0 0 0-1.15-.556 6.5 6.5 0 0 1-.454-1.093l-.113-.414c-.192-.678-.393-.805-.714-.828zM12 8.2a3.8 3.8 0 1 1 0 7.6 3.8 3.8 0 0 1 0-7.6m0 1.8a2 2 0 1 0 0 4 2 2 0 0 0 0-4"></path></svg>');var hl=Oi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M13.933 4.875a.6.6 0 0 0-.07-.658c-.327-.413-.45-.833-.574-1.253l-.039-.13C13 2 12.833 2 12.417 2h-.91c-.371.003-.6.052-.757.833-.148.738-.36 1.476-1.566 2.186a.5.5 0 0 1-.12.05c-1.27.324-1.905-.023-2.542-.37l-.12-.065c-.766-.412-.884-.294-1.178 0l-.643.644c-.26.264-.389.461.053 1.124.418.626.789 1.299.438 2.654a.5.5 0 0 1-.05.12c-.668 1.126-1.362 1.33-2.058 1.535l-.13.039C2 11 2 11.167 2 11.583v.91c.003.371.052.6.833.757.738.148 1.476.36 2.186 1.566a.5.5 0 0 1 .05.12c.324 1.27-.023 1.905-.37 2.542l-.065.12c-.412.766-.294.884 0 1.178l.644.643c.264.26.461.389 1.124-.053.626-.418 1.299-.789 2.654-.438q.063.016.12.05c1.126.668 1.33 1.362 1.535 2.058l.039.13c.25.834.417.834.833.834h.91c.371-.003.6-.052.757-.833.148-.738.36-1.476 1.566-2.186a.5.5 0 0 1 .12-.05c1.27-.324 1.905.023 2.542.37l.12.065c.766.412.884.294 1.178 0l.643-.644c.26-.264.389-.461-.053-1.124-.26-.39-.503-.799-.563-1.38a.6.6 0 0 0-.413-.519 7.5 7.5 0 0 1-1.918-.871.58.58 0 0 0-.758.134 4.75 4.75 0 1 1-3.163-7.68.58.58 0 0 0 .633-.44 7.5 7.5 0 0 1 .749-1.967" clip-rule="evenodd"></path><path fill="var(--btn-color, #fff)" d="M13.25 2.833c.225.751.383 1.502 1.63 2.222 1.399.38 2.082.003 2.718-.42.663-.443.86-.315 1.124-.054l.644.643c.294.294.412.412 0 1.178-.372.69-.792 1.333-.418 2.726.72 1.255 1.47 1.472 2.219 1.622.78.156.83.386.833.757v.91c0 .416 0 .583-.833.833-.751.225-1.502.383-2.222 1.63-.38 1.399-.003 2.082.42 2.718.443.663.315.86.054 1.124l-.643.644c-.294.294-.412.412-1.178 0-.69-.372-1.333-.792-2.726-.418-1.255.72-1.472 1.47-1.622 2.219-.156.78-.386.83-.757.833h-.91c-.416 0-.583 0-.833-.833-.225-.751-.383-1.502-1.63-2.222-1.399-.38-2.082-.003-2.718.42-.663.443-.86.315-1.124.054l-.644-.643c-.294-.294-.412-.412 0-1.178.372-.69.792-1.333.418-2.726-.72-1.255-1.47-1.472-2.219-1.622-.78-.156-.83-.386-.833-.757v-.91c0-.416 0-.583.833-.833.751-.225 1.502-.383 2.222-1.63.38-1.399.003-2.082-.42-2.718-.443-.663-.315-.86-.054-1.124l.643-.644c.294-.294.412-.412 1.178 0 .69.372 1.333.792 2.726.418 1.255-.72 1.472-1.47 1.622-2.219.156-.78.386-.83.757-.833h.91c.416 0 .583 0 .833.833M12 7.25a4.75 4.75 0 1 0 0 9.5 4.75 4.75 0 0 0 0-9.5" class="_full"></path></svg>');var pl=Di('<div aria-hidden="true"><!> <!></div>'),fl={hash:"svelte-8t5w85",code:'.icon.svelte-8t5w85 {display:flex;position:relative;width:24px;height:24px;}.icon.svelte-8t5w85 .pillow {position:absolute;top:1px;right:-9px;}.icon.triple.svelte-8t5w85 .pillow {right:-13px;}.icon.svelte-8t5w85 svg[data-testid="settings-icon--labeled"] ._full {visibility:hidden;opacity:0;}'};function ml(e,t){pi(t,!0),vr(e,fl);let i=ma(t,"isMobile",3,!1),r=ma(t,"currentQuality",3,void 0),a=ne((()=>dl(r()))),s=ne((()=>!!Tt(a)&&[ol,ul].includes(Tt(a))));var n=ji(),o=Be(n),l=e=>{!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=cl();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"settings-mobile-icon",role:"img",...i}))),zi(e,r)}(e,{})},u=e=>{var t=pl();let i;var r=Ne(t),n=e=>{!function(e,t){vr(e,Jo);var i=Xo();hr(Ne(i),(()=>t.children??D)),Te(i),zi(e,i)}(e,{children:(e,t)=>{var i=ji();pr(Be(i),(()=>Tt(a)),((e,t)=>{t(e,{})})),zi(e,i)},$$slots:{default:!0}})};Xi(r,(e=>{Tt(a)&&e(n)}));var o=De(r,2);let l=ne((()=>Tt(a)?"settings-icon--labeled":"settings-icon"));(function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=hl();let a;hr(Ne(r),(()=>t.children??D)),Ce(2),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","data-testid":"settings-icon",role:"img",...i}))),zi(e,r)})(o,{get"data-testid"(){return Tt(l)},fill:"var(--btn-color, #fff)"}),Te(t),Bt((e=>i=xr(t,1,"icon svelte-8t5w85",null,i,e)),[()=>({triple:Tt(s)})]),zi(e,t)};Xi(o,(e=>{i()?e(l):e(u,!1)})),zi(e,n),fi()}var vl=Di('<span class="settings-icon-wrapper svelte-d9t49t"><!></span>'),gl={hash:"svelte-d9t49t",code:".settings-icon-wrapper.svelte-d9t49t {position:relative;width:24px;}"};function bl(e,t){pi(t,!0),vr(e,gl);let[i,r]=ua(),a=()=>la(o,"$settingsMenuVisible",i),s=Oa(),n=s.state.currentQuality$,o=s.ui.settingsMenu.visible$,l=s.actions.internal.openSettingsMenu,u=s.actions.internal.closeSettingsMenu,d=s.ui.isMobile,c=s.ui.t,h=te(void 0);Rt((()=>{la(t.ref$,"$ref$",i)&&Ct((()=>{t.ref$.set(Tt(h))}))}));let p=ne((()=>a()?c("tooltip_settings_on"):c("tooltip_settings_off")));let f=ne((()=>a()?"opened":""));jo(e,{get className(){return Tt(f)},testId:"btn-settings",click:async function(e){let t=wn(e);a()?u():l(t,kt)},get ariaLabel(){return Tt(p)},get ariaExpanded(){return a()},get ref(){return Tt(h)},set ref(e){re(h,Ae(e))},children:(e,t)=>{var r=vl();ml(Ne(r),{get isMobile(){return la(d,"$isMobile",i)},get currentQuality(){return la(n,"$currentQuality",i)}}),Te(r),zi(e,r)},$$slots:{default:!0}}),fi(),r()}var yl=Oi('<svg><!><path fill="var(--btn-color, #fff)" d="M3 0h14a3 3 0 0 1 3 3v10a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3V3a3 3 0 0 1 3-3m1 9h2a1 1 0 0 0 0-2H4a1 1 0 0 0 0 2m5 0h7a1 1 0 1 0 0-2H9a1 1 0 0 0 0 2m-5 4h7a1 1 0 1 0 0-2H4a1 1 0 1 0 0 2m10 0h2a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2"></path></svg>');var wl=Oi('<svg><!><path fill="var(--btn-color, #fff)" d="M14.692.428c2.293 0 3.124.24 3.962.687a4.67 4.67 0 0 1 1.944 1.944c.449.839.687 1.67.687 3.962v3.958c0 2.292-.238 3.123-.687 3.961a4.67 4.67 0 0 1-1.944 1.944c-.838.449-1.67.687-3.962.687H7.307c-2.293 0-3.124-.238-3.962-.687A4.67 4.67 0 0 1 1.4 14.94c-.448-.838-.687-1.669-.687-3.961V7.02c0-2.292.239-3.123.687-3.962a4.67 4.67 0 0 1 1.944-1.944C4.183.667 5.015.428 7.307.428zm.243 1.716-7.628-.001c-1.832 0-2.484.126-3.154.484a2.96 2.96 0 0 0-1.24 1.24c-.343.64-.473 1.264-.484 2.912v4.2c0 1.83.125 2.483.483 3.153q.433.809 1.241 1.24c.67.36 1.322.485 3.154.485h7.385c1.832 0 2.484-.126 3.154-.484a2.96 2.96 0 0 0 1.24-1.241c.36-.67.485-1.322.485-3.153V7.02c0-1.831-.126-2.483-.484-3.153a2.96 2.96 0 0 0-1.241-1.24c-.64-.343-1.263-.473-2.911-.484ZM11 10.714a.857.857 0 1 1 0 1.714H5.857a.857.857 0 0 1 0-1.714zm5.142 0a.857.857 0 1 1 0 1.714h-1.714a.857.857 0 0 1 0-1.714zm0-3.428a.857.857 0 1 1 0 1.714H11a.857.857 0 1 1 0-1.714zm-8.571 0a.857.857 0 0 1 0 1.714H5.857a.857.857 0 0 1 0-1.714z"></path></svg>');function Sl(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=wl();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"18",fill:"none","aria-hidden":"true","data-testid":"subtitle-empty-icon",role:"img",...i}))),zi(e,r)}function xl(e,t){pi(t,!0);let i=ma(t,"isSubtitlesEnabled",3,!1),r=Oa().ui.t,a=ne((()=>i()?r("tooltip_subtitles_on"):r("tooltip_subtitles_off")));jo(e,{testId:"btn-Subtitles",get ariaLabel(){return Tt(a)},get click(){return t.click},get ariaKeyShortCut(){return $a},children:(e,t)=>{var r=ji(),a=Be(r),s=e=>{!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=yl();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"16",fill:"none","aria-hidden":"true","data-testid":"subtitle-pained-icon",role:"img",...i}))),zi(e,r)}(e,{})},n=e=>{Sl(e,{})};Xi(a,(e=>{i()?e(s):e(n,!1)})),zi(e,r)},$$slots:{default:!0}}),fi()}var $l=Di('<span class="duration svelte-sz9er7"> </span>'),_l=Di('<div><span class="current svelte-sz9er7"> </span> <!></div>'),kl={hash:"svelte-sz9er7",code:".time.svelte-sz9er7 {display:flex;align-items:center;font-weight:500;font-variant-numeric:tabular-nums;padding:12px 6px;color:var(--controls-time);}.time.mobile.svelte-sz9er7 {padding:0 0 0 8px;}.current.svelte-sz9er7 {position:relative;}.duration.svelte-sz9er7 {opacity:0.7;}.duration.svelte-sz9er7:before {content:' / ';white-space:pre;}"};function Tl(e,t){pi(t,!0),vr(e,kl);let i=ma(t,"isMobile",3,!1),r=ma(t,"showDuration",3,!0),a=ma(t,"ref",15),s=ne((()=>on(t.duration))),n=ne((()=>on(t.position)));var o=_l();let l;var u=Ne(o),d=Ne(u,!0);Te(u);var c=De(u,2),h=e=>{var t=$l(),i=Ne(t,!0);Te(t),Bt((()=>Hi(i,Tt(s)))),zi(e,t)};Xi(c,(e=>{r()&&e(h)})),Te(o),Kr(o,(e=>a(e)),(()=>a())),Bt((e=>{l=xr(o,1,"time svelte-sz9er7",null,l,e),Hi(d,Tt(n))}),[()=>({mobile:i()})]),zi(e,o),fi()}var Cl=Oi('<svg xmlns="http://www.w3.org/2000/svg" class="icon svelte-1n5yyua" aria-hidden="true"><g fill="var(--btn-color, #fff)" fill-rule="evenodd"><path class="wave2 svelte-1n5yyua" d="M12.98 18.823c-.031 1.207-.67 1.609-1.828.62-1.719-1.469-3.609-3.194-4.242-3.721-.632-.529-1.645-.62-3.073-.62-1.427 0-1.815-.621-1.815-1.241s-.014-1.83-.014-2.001c0-.055.005-.086.014-.13.02-.095-.058-.973 0-1.59.085-.906.388-1.241 1.815-1.241 1.428 0 2.44-.092 3.073-.62.633-.529 2.523-2.253 4.242-3.722 1.158-.989 1.797-.587 1.829.62.043 1.607 0 3.85 0 6.683 0 2.83.043 5.356 0 6.963zm2.901-8.704A.875.875 0 1 1 17.12 8.88c.176.177.41.47.64.872.384.671.616 1.425.616 2.247s-.232 1.576-.615 2.247a4.23 4.23 0 0 1-.641.872.875.875 0 1 1-1.238-1.238c.074-.073.214-.249.36-.503.241-.423.384-.887.384-1.378s-.143-.955-.385-1.378a2.597 2.597 0 0 0-.359-.503zm3-2A.875.875 0 1 1 20.12 6.88c.263.264.62.74.966 1.432.517 1.033.843 2.255.89 3.716-.047 1.403-.373 2.625-.89 3.658-.346.692-.703 1.168-.966 1.432a.875.875 0 1 1-1.238-1.238c.138-.137.383-.464.639-.976.407-.814.667-1.79.705-2.876-.038-1.144-.298-2.12-.705-2.934-.256-.512-.501-.839-.639-.976z"></path><path class="wave1 svelte-1n5yyua" d="M12.98 18.823c-.031 1.207-.67 1.609-1.828.62-1.719-1.469-3.609-3.194-4.242-3.721-.632-.529-1.645-.62-3.073-.62-1.427 0-1.815-.621-1.815-1.241s-.014-1.83-.014-2.001c0-.055.005-.086.014-.13.02-.095-.058-.973 0-1.59.085-.906.388-1.241 1.815-1.241 1.428 0 2.44-.092 3.073-.62.633-.529 2.523-2.253 4.242-3.722 1.158-.989 1.797-.587 1.829.62.043 1.607 0 3.85 0 6.683 0 2.83.043 5.356 0 6.963zm2.901-8.704A.875.875 0 1 1 17.12 8.88c.176.177.41.47.64.872.384.671.616 1.425.616 2.247s-.232 1.576-.615 2.247a4.23 4.23 0 0 1-.641.872.875.875 0 1 1-1.238-1.238c.074-.073.214-.249.36-.503.241-.423.384-.887.384-1.378s-.143-.955-.385-1.378a2.597 2.597 0 0 0-.359-.503z"></path><path class="cross svelte-1n5yyua" d="m20 10.763 2.381-2.382A.875.875 0 1 1 23.62 9.62L21.237 12l2.382 2.381a.875.875 0 1 1-1.238 1.238L20 13.237l-2.381 2.382a.875.875 0 1 1-1.238-1.238L18.763 12 16.38 9.619A.875.875 0 1 1 17.62 8.38zm-7.02 8.06c-.031 1.207-.67 1.609-1.828.62-1.719-1.469-3.609-3.194-4.242-3.721-.632-.529-1.645-.62-3.073-.62-1.427 0-1.815-.621-1.815-1.241s-.014-1.83-.014-2.001c0-.055.005-.086.014-.13.02-.095-.058-.973 0-1.59.085-.906.388-1.241 1.815-1.241 1.428 0 2.44-.092 3.073-.62.633-.529 2.523-2.253 4.242-3.722 1.158-.989 1.797-.587 1.829.62.043 1.607 0 3.85 0 6.683 0 2.83.043 5.356 0 6.963z"></path></g></svg>'),El={hash:"svelte-1n5yyua",code:".icon.svelte-1n5yyua {display:block;width:24px;height:24px;}.icon.svelte-1n5yyua .cross:where(.svelte-1n5yyua) {visibility:hidden;}.icon[data-value='off'].svelte-1n5yyua .wave1:where(.svelte-1n5yyua),\n  .icon[data-value='off'].svelte-1n5yyua .wave2:where(.svelte-1n5yyua) {visibility:hidden;}.icon[data-value='off'].svelte-1n5yyua .cross:where(.svelte-1n5yyua) {visibility:visible;}.icon[data-value='mid'].svelte-1n5yyua .wave2:where(.svelte-1n5yyua),\n  .icon[data-value='min'].svelte-1n5yyua .wave2:where(.svelte-1n5yyua) {visibility:hidden;}"};function Al(e,t){vr(e,El);let i=ma(t,"volume",3,1),r=ma(t,"muted",3,!1),a=ne((()=>((e,t)=>t?"off":e>.5?"max":e>.2?"mid":e>0?"min":"off")(i(),r())));var s=Cl();Bt((()=>{Lr(s,"data-value",Tt(a)),Lr(s,"data-testid",`volume-${Tt(a)??""}-icon`)})),zi(e,s)}var Ll=Di('<div class="overlay"><!></div>');function Pl(e,t){pi(t,!0);let[i,r]=ua(),a=()=>la(s,"$overlayContainer$",i),s=Oa().ui.overlayContainer$,n=te(void 0),o=e=>{!e||!Tt(n)||e.contains(Tt(n))||e.appendChild(Tt(n))};Rt((()=>{o(a())})),Xr((()=>(o(a()),()=>{var e;!(e=a())||!Tt(n)||!e.contains(Tt(n))||e.removeChild(Tt(n))})));var l=Ll();hr(Ne(l),(()=>t.children??D)),Te(l),Kr(l,(e=>re(n,e)),(()=>Tt(n))),zi(e,l),fi(),r()}var Ml=Di('<div class="tooltip svelte-hxlyne"><div class="content svelte-hxlyne"> </div> <div class="tooltip-pointer svelte-hxlyne"></div></div>'),Il=Di("<div><!></div> <!>",1),Rl={hash:"svelte-hxlyne",code:'.tooltip-wrapper.svelte-hxlyne {display:flex;flex-direction:column;min-width:0;}.full-width.svelte-hxlyne {width:100%;}.tooltip.svelte-hxlyne {position:absolute;opacity:0;visibility:hidden;transition:opacity 200ms, visibility 200ms;bottom:100%;left:0;}.content.svelte-hxlyne {display:inline-block;padding:6px 10px;border-radius:3px;color:var(--white);background-color:rgba(41, 41, 41, .8);}.tooltip-pointer.svelte-hxlyne {position:absolute;bottom:0;width:0;border-top:5px solid rgba(41, 41, 41, .8);border-right:5px solid transparent;border-left:5px solid transparent;content:" ";font-size:0;line-height:0;}'};function Vl(e,t){pi(t,!0),vr(e,Rl);let i,[r,a]=ua(),s=()=>la(k,"$overlayContainer$",r),n=ma(t,"isMobile",3,!1),o=ma(t,"content",3,""),l=ma(t,"active",15,!1),u=ma(t,"translateX",3,0),d=ma(t,"translateY",3,0),c=ma(t,"isFullWidthWrapper",3,!1),h=ma(t,"maxTooltipWidth",3,void 0),p=ma(t,"placement",3,"top"),f=ma(t,"onVisibilityChange",3,m.noop),v=te(void 0),g=te(void 0),b=te(0),y=te(0),w=te(0),S=te(0),x=ya(),$=Oa(),_=$.ui.playerSize,k=$.ui.overlayContainer$;Rt((()=>{Ct((()=>{f()(l())}))}));let T=$.getLogger().createComponentLog("Tooltip component"),C=()=>{if(!s()||!Tt(g)||!Tt(v))return;re(y,5);let e=s().getBoundingClientRect(),t=Tt(v).getBoundingClientRect(),i=t.width,a=Tt(g).clientWidth,n=la(_,"$containerSize",r).width,o=(i-a)/2,l=t.left+u()-e.left,c=l+o,h=t.top+d()-e.top,p=a/2-5,f=c+a>n-8;c<8&&(c=8,p=l+t.width/2-12.5),f&&(c=n-8-a,p=t.left-e.left+t.width/2-c-5),re(w,Ae(c)),re(S,h),re(b,Ae(p))},E=()=>{switch(p()){case"top":C();break;case"bottom":!s()||!Tt(g)||!Tt(v)||re(y,-5);break;case"left":(()=>{if(!s()||!Tt(g)||!Tt(v))return;re(b,5);let e=s().getBoundingClientRect(),t=Tt(v).getBoundingClientRect(),i=t.height,r=Tt(g).clientHeight,a=(i-r)/2+r,n=t.left+u()-e.left-Tt(g).clientWidth-5;n<8&&(n=8);let o=t.top+d()-e.top+a,l=2-a/2;re(w,Ae(n)),re(S,o),re(y,l),re(b,-3)})();break;default:!s()||!Tt(g)||!Tt(v)||re(b,-5)}},A=()=>{try{if(!s()||!Tt(v))return;E(),l(!0)}catch(e){T({message:String(e)})}},L=()=>{Tt(g)&&(i||(i=window.setTimeout(A,x.controls.hideTimeoutTooltips)),l()&&A())},P=()=>{l(!1),window.clearTimeout(i),i=void 0},M=ne((()=>((e,t,i)=>{let r="";switch(p()){case"top":default:r=`transform: translate(${e}px, ${t}px);`;break;case"bottom":r=`transform: translate(${e}px, ${t}px); top: auto; bottom: 100%;`;break;case"left":r=`transform: translate(${e}px, ${t}px); left: 0; right: auto;`}return r+=` max-width: ${void 0===h()?"auto":`${h()}px`};`,r+=` opacity: ${i?1:0}; visibility: ${i?"visible":"hidden"}`,r})(Tt(w),Tt(S),l()))),I=ne((()=>((e,t)=>{let i="";switch(p()){case"top":i=`transform: translate(${e}px, ${t}px) rotate(0); top: auto; bottom: 0;`;break;case"bottom":i=`transform: translate(${e}px, ${t}px) rotate(180deg); top: 0; bottom: auto;`;break;case"left":i=`transform: translate(${e}px, ${t}px) rotate(-90deg); left: 100%; top: auto; bottom: 0;`;break;default:i=`transform: translate(${e}px, ${t}px) rotate(90deg); right: 100%; top: auto; bottom: 0;`}return i})(Tt(b),Tt(y))));Xr(E),Jr((()=>window.clearTimeout(i)));var R=Il(),V=Be(R);let N;V.__mousemove=L,V.__mousedown=P,V.__mouseup=L,hr(Ne(V),(()=>t.children??D)),Te(V),Kr(V,(e=>re(v,e)),(()=>Tt(v)));var B=De(V,2),O=e=>{Pl(e,{children:(e,t)=>{var i=Ml(),r=Ne(i),a=Ne(r,!0);Te(r);var s=De(r,2);Te(i),Kr(i,(e=>re(g,e)),(()=>Tt(g))),Bt((()=>{_r(i,Tt(M)),Hi(a,o()),_r(s,Tt(I))})),zi(e,i)},$$slots:{default:!0}})};Xi(B,(e=>{o()&&!n()&&e(O)})),Bt((e=>N=xr(V,1,"tooltip-wrapper svelte-hxlyne",null,N,e)),[()=>({"full-width":c()})]),Ii("mouseenter",V,L),Ii("mouseleave",V,P),zi(e,R),fi(),a()}Ri(["mousemove","mousedown","mouseup"]);var Nl=e=>{e.stopPropagation()},Bl=Di("<div><!></div>"),Dl={hash:"svelte-p9r045",code:".btn-container.svelte-p9r045 {position:relative;display:flex;align-items:center;height:100%;transition:var(--button-hover-transition);will-change:opacity;-webkit-tap-highlight-color:transparent;}.w-max.svelte-p9r045 {width:100%;min-width:0;}"};function Ol(e,t){pi(t,!0),vr(e,Dl);let[i,r]=ua(),a=Oa(),s=Fa(),n=a.ui.isMobile,o=s.graphIsOpened$,l=a.ui.t,u=ma(t,"className",3,""),d=ma(t,"disabled",3,!1),c=ma(t,"hasTooltip",3,!0),h=ma(t,"ref",15,void 0),p=ma(t,"width",15,void 0),f=ma(t,"isFullWidthTooltip",3,!0),v=ma(t,"tooltipContent",3,""),g=ma(t,"tooltipActive",3,!1),b=ma(t,"tooltipPlacement",3,"top"),y=ma(t,"disabledTooltipContent",19,(()=>l("tooltip_button_disabled"))),w=ma(t,"isAriaHidden",3,!1),S=ma(t,"onTooltipVisibilityChange",3,m.noop),x=ma(t,"initialTranslateXPx",3,0),$=ma(t,"initialTranslateYPx",19,(()=>-18)),_=ma(t,"mouseEnter",3,m.noop),k=ma(t,"mouseLeave",3,m.noop),T=ne((()=>d()?la(o,"$isGraphOpened$",i)?l("tooltip_disabled_when_graph_on"):y():v()));var C=Bl();C.__pointerdown=[Nl],C.__click=[Nl];var E=Ne(C),A=e=>{Vl(e,{get content(){return Tt(T)},get translateX(){return x()},get translateY(){return $()},get isFullWidthWrapper(){return f()},get active(){return g()},get placement(){return b()},get onVisibilityChange(){return S()},children:(e,i)=>{var r=ji();hr(Be(r),(()=>t.children??D)),zi(e,r)},$$slots:{default:!0}})},L=e=>{var i=ji();hr(Be(i),(()=>t.children??D)),zi(e,i)};Xi(E,(e=>{c()&&Tt(T)&&!la(n,"$isMobile",i)?e(A):e(L,!1)})),Te(C),Kr(C,(e=>h(e)),(()=>h())),Bt((()=>{xr(C,1,`btn-container ${u()??""}`,"svelte-p9r045"),Lr(C,"aria-hidden",w()||null)})),Ii("mouseenter",C,(function(...e){_()?.apply(this,e)})),Ii("mouseleave",C,(function(...e){k()?.apply(this,e)})),Qr(C,"clientWidth",p),zi(e,C),fi(),r()}Ri(["pointerdown","click"]);var Fl=Oi('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><rect width="20" height="20" rx="10" fill="var(--btn-color, #fff)"></rect><path d="M12.5259 8.68864L12.587 8.87536L12.3702 8.23648C12.236 7.84095 11.8295 7.60563 11.4192 7.68593C10.9471 7.77831 10.6508 8.24892 10.7718 8.71381L10.8968 9.19361L10.6671 8.33855C10.5566 7.92714 10.1475 7.67011 9.72832 7.74872C9.32282 7.82476 9.04808 8.18606 9.06319 8.57993L8.34064 5.64592C8.21338 5.12912 7.64646 4.85578 7.1621 5.07767C6.79216 5.24715 6.59467 5.65495 6.69131 6.0498L7.98547 11.3373L6.87 10.178C6.52545 9.81987 5.94024 9.86103 5.64933 10.2638C5.44455 10.5474 5.44907 10.9312 5.66048 11.2098L7.89246 14.1518C7.89246 14.1518 9.12075 15.9833 12.1932 15.3769C14.6243 14.8972 15.4434 12.7097 14.7748 10.4997L14.2213 8.20869C14.0975 7.69621 13.5537 7.40646 13.0585 7.58916C12.614 7.75319 12.3788 8.23875 12.5259 8.68864Z"></path></svg>');function jl(e,t){var i=Fl(),r=Ne(i),a=De(r);Te(i),Bt((()=>{Lr(i,"data-testid",(t.completed,"interactive-episode-completed-icon")),Lr(r,"fill-opacity",t.completed?1:.24),Lr(a,"fill",t.completed?"var(--interactive-episode-complete)":"white")})),zi(e,i)}var zl=Di("<div><!></div>"),Ul={hash:"svelte-bklhpe",code:".interactive-episode-icon.svelte-bklhpe {width:20px;height:20px;position:absolute;transform:translateX(-50%);cursor:default;}.interactive-episode-icon.disabled.svelte-bklhpe {pointer-events:none;opacity:0.4;}"};var ql=Di('<div><div class="video-episode-inner svelte-1u6kv8l"><div class="video-episode-loaded svelte-1u6kv8l"></div> <div></div></div></div>'),Hl=Di('<div class="video-episodes-wrap svelte-1u6kv8l"></div>'),Wl={hash:"svelte-1u6kv8l",code:".video-episodes-wrap.svelte-1u6kv8l {position:absolute;width:100%;height:100%;}.video-episode.svelte-1u6kv8l {position:absolute;height:calc(3 * var(--slider-height));box-sizing:border-box;margin-top:calc(-1 * var(--slider-height));padding:var(--slider-height) var(--slider-video-episode-gap);transition:transform 0.2s;}.video-episode.svelte-1u6kv8l:not(.disabled):where(:hover, :active) {transform:scaleY(1.5);}.video-episode-inner.svelte-1u6kv8l,\n  .video-episode-loaded.svelte-1u6kv8l,\n  .video-episode-filled.svelte-1u6kv8l {position:absolute;height:var(--slider-height);border-radius:var(--slider-radius);}.video-episode-inner.svelte-1u6kv8l {position:absolute;overflow:hidden;width:calc(100% - 2 * var(--slider-video-episode-gap));background:var(--slider-bg);}.video-episode-loaded.svelte-1u6kv8l {position:absolute;left:-100%;width:100%;height:100%;border-radius:var(--slider-radius);background:var(--slider-loaded-bg);transition:transform 0.2s;}.video-episode-filled.svelte-1u6kv8l {position:absolute;left:-100%;width:100%;height:100%;border-radius:var(--slider-radius);background-color:var(--slider-filled-bg);}"};function Ql(e,t,i,r,a,s,n){if(e.preventDefault(),t()&&re(i,Ae(t().getBoundingClientRect())),r()||Tt(a)||!t())return;re(a,!0);let o=s(e.clientX,e.clientY);n()(o),t().setPointerCapture(e.pointerId)}function Gl(e,t,i,r,a,s,n,o){if(e.preventDefault(),t())return;let l=i(e.clientX,e.clientY),u=r(e.clientX);a()(l,u,Tt(s).width),Tt(n)&&o()(l)}function Kl(e,t,i,r,a){if(e.preventDefault(),t()||!Tt(i))return;re(i,!1);let s=r(e.clientX,e.clientY);a()(s)}function Yl(e,t,i,r){e.stopPropagation(),t()&&i()(r(e.clientX,e.clientY))}var Zl=Di("<div></div>"),Xl=Di('<div class="bars svelte-1tpemng"><div class="loaded svelte-1tpemng"></div> <div></div></div>'),Jl=Di('<!> <div role="slider" tabindex="0"><!> <div><div></div></div></div>',1),eu={hash:"svelte-1tpemng",code:".interactive-icons.svelte-1tpemng {position:absolute;width:calc(100% - 20px);top:-28px;}.interactive-icons.mobile.svelte-1tpemng {top:-10px;}.slider.svelte-1tpemng {position:relative;height:var(--slider-height);border-radius:var(--slider-radius);cursor:pointer;transition:visibility 0.2s, opacity 0.2s;will-change:opacity, transform;width:100%;touch-action:none;-webkit-tap-highlight-color:transparent;}.no-handle.svelte-1tpemng {cursor:default;}.slider.svelte-1tpemng:before {\n    /* hit area */content:'';position:absolute;left:0;right:0;top:calc(-1 * (var(--controls-height) / 2 - var(--slider-height)) / 2);height:calc(var(--controls-height) / 2);}.bars.svelte-1tpemng {position:absolute;width:100%;height:100%;border-radius:var(--slider-radius);overflow:hidden;background:var(--slider-bg);}.loaded.svelte-1tpemng {position:absolute;left:-100%;width:100%;height:100%;border-radius:var(--slider-radius);background:var(--slider-loaded-bg);transition:transform 0.2s;will-change:transform;}.filled.svelte-1tpemng {position:absolute;left:-100%;width:100%;height:100%;border-radius:var(--slider-radius);background-color:var(--slider-filled-bg);}.slider.square.svelte-1tpemng,\n  .slider.square.svelte-1tpemng > .bars:where(.svelte-1tpemng),\n  .slider.square.svelte-1tpemng .loaded:where(.svelte-1tpemng),\n  .slider.square.svelte-1tpemng .filled:where(.svelte-1tpemng) {border-radius:unset;}.filled.active-live.svelte-1tpemng {background-color:var(--timeline-slider-filled-active-live-bg);}.filled.ads.svelte-1tpemng {background-color:var(--slider-filled-ads);}.handleWrap.svelte-1tpemng {position:absolute;left:-100%;width:100%;}.handle.svelte-1tpemng {position:absolute;width:var(--slider-handle-size);height:var(--slider-handle-size);right:calc(-1 * var(--slider-handle-size) / 2);top:calc((var(--slider-height) - var(--slider-handle-size)) / 2);border-radius:50%;background-color:var(--slider-handle-bg);visibility:hidden;opacity:0;transform:scale(0);transition:opacity 0.2s, transform 0.2s, visibility 0.2s;will-change:opacity, transform;}.handle.active-live.svelte-1tpemng {background-color:var(--timeline-slider-handle-active-live-bg);}.slider.svelte-1tpemng:hover .handle:where(.svelte-1tpemng),\n  .slider-dragging.svelte-1tpemng .handle:where(.svelte-1tpemng) {visibility:visible;opacity:1;transform:scale(1);}.slider-dragging.svelte-1tpemng .handle:where(.svelte-1tpemng) {transform:scale(1.3);}.slider-vertical.svelte-1tpemng {position:absolute;left:-8px;top:-18px;transform-origin:0 0;transform:rotate(-90deg);}.slider.disabled.svelte-1tpemng {cursor:default;opacity:0.4;}"};function tu(e,t){pi(t,!0),vr(e,eu);let i=ma(t,"ref",15,void 0),r=ma(t,"className",3,""),a=ma(t,"testId",3,void 0),s=ma(t,"isHidden",3,!1),n=ma(t,"isVertical",3,!1),o=ma(t,"isActiveLive",3,!1),l=ma(t,"isMobile",3,!1),u=ma(t,"squareBorders",3,!1),d=ma(t,"videoEpisodes",19,(()=>[])),c=ma(t,"withWheelHandler",3,!1),h=ma(t,"isInteractive",3,!1),p=ma(t,"disabled",3,!1),f=ma(t,"hideHandel",3,!1),v=ma(t,"onPointerDown",3,m.noop),g=ma(t,"onHandleMove",3,m.noop),b=ma(t,"onPointerUp",3,m.noop),y=ma(t,"onPointerEnter",3,m.noop),w=ma(t,"onPointerMove",3,m.noop),S=ma(t,"onPointerLeave",3,m.noop),x=ma(t,"onWheelUp",3,m.noop),$=ma(t,"onWheelDown",3,m.noop),_=ma(t,"onWheelLeft",3,m.noop),k=ma(t,"onWheelRight",3,m.noop),T=ma(t,"onDisabledClick",3,m.noop),C=ma(t,"loadedProgress",3,0),E=ma(t,"filledProgress",3,0),A=ma(t,"handleProgress",3,0),L=ma(t,"ariaLabel",3,""),P=ma(t,"ariaValueMin",3,void 0),M=ma(t,"ariaValueMax",3,void 0),I=ma(t,"ariaValueNow",3,void 0),R=ma(t,"ariaValueText",3,""),V=ya(),N=te(void 0),B=te(!1),D=ne((()=>M()??0)),O=ne((()=>(0,m.isNonNullable)(d())&&d()[d().length-1]?.time<Tt(D))),F=ne((()=>(0,m.isNonNullable)(d())&&d().length&&Tt(O)&&Tt(D)?function(e,t){let i=V.features.episodesClustering&&!h()?V.episodeMinWidthPc:0,r=[],a=d()[0].time/Tt(D)*100,s=0,n=0;for(let o=1;o<d().length;o++)s=d()[o].time/Tt(D)*100,s-a>i&&(r.push({from:a,width:Math.max(0,s-a),loadedWidth:Math.max(0,Math.min(s,e)-a),filledWidth:Math.max(0,Math.min(s,t)-a),interactive:d()[o-1].interactive,completed:d()[o-1].completed}),a=d()[o].time/Tt(D)*100,n++);let o={from:a,width:Math.max(0,100-a),loadedWidth:Math.max(0,Math.min(e,100)-a),filledWidth:Math.max(0,Math.min(t,100)-a),interactive:d()[n].interactive,completed:d()[n].completed};100-a<i?(n-=1,r[n].width+=100-a,r[n].loadedWidth+=Math.max(0,Math.min(e,100)-a),r[n].filledWidth+=Math.max(0,Math.min(t,100)-a)):r[n]=o;let l=d()[0].time;if(0!==l){let i=l/Tt(D)*100;r.unshift({from:0,width:i,loadedWidth:Math.min(i,e),filledWidth:Math.min(i,t)})}return r}(100*C(),100*E()):[]));function j(e,t){return n()?Math.max(0,Math.min(1,(Tt(N).height-(t-Tt(N).top))/Tt(N).height)):Math.min(Math.max(e-Tt(N).x,0),Tt(N).width)/Tt(N).width}function z(e){return Math.min(Math.max(e-Tt(N).x,0),Tt(N).width)}var U=Jl(),q=Be(U),H=e=>{var t=Zl();let i;ar(t,21,(()=>Tt(F)),(e=>e.from),((e,t)=>{var i=ji(),r=Be(i),a=e=>{!function(e,t){pi(t,!0),vr(e,Ul);let i=Oa().ui.t,r=te(0),a=ne((()=>i(t.videoEpisode.completed?"tooltip_episode_finished":"tooltip_episode_unfinished")));Ol(e,{get tooltipContent(){return Tt(a)},initialTranslateXPx:-10,initialTranslateYPx:-10,get disabled(){return t.disabled},get width(){return Tt(r)},isAriaHidden:!0,isFullWidthTooltip:!1,children:(e,i)=>{var a=zl();let s;var n=Ne(a);let o=ne((()=>!!t.videoEpisode.completed));jl(n,{get completed(){return Tt(o)}}),Te(a),Bt((e=>{s=xr(a,1,"interactive-episode-icon svelte-bklhpe",null,s,e),_r(a,`left: ${t.videoEpisode.from+t.videoEpisode.width/2}%`)}),[()=>({disabled:t.disabled})]),Qr(a,"clientWidth",(e=>re(r,e))),zi(e,a)},$$slots:{default:!0}}),fi()}(e,{get videoEpisode(){return Tt(t)},get disabled(){return p()}})};Xi(r,(e=>{Tt(t).interactive&&e(a)})),zi(e,i)})),Te(t),Bt((e=>i=xr(t,1,"interactive-icons svelte-1tpemng",null,i,e)),[()=>({mobile:l(),hidden:l()&&!Tt(B)})]),zi(e,t)};Xi(q,(e=>{h()&&e(H)}));var W=De(q,2);let Q;W.__pointerdown=[Ql,i,N,p,B,j,v],W.__pointermove=[Gl,p,j,z,w,N,B,g],W.__pointerup=[Kl,p,B,j,b],W.__click=[Yl,p,T,j];var G=Ne(W),K=e=>{!function(e,t){vr(e,Wl);let i=ma(t,"videoEpisodes",19,(()=>[]));var r=Hl();ar(r,21,i,(e=>e.from),((e,i)=>{var r=ql();let a;var s=Ne(r),n=Ne(s),o=De(n,2);let l;Te(s),Te(r),Bt(((e,t)=>{a=xr(r,1,"video-episode svelte-1u6kv8l",null,a,e),_r(r,`left: ${Tt(i).from}%; width: ${Tt(i).width}%`),_r(n,`transform: translateX(${Tt(i).loadedWidth/Tt(i).width*100}%)`),l=xr(o,1,"video-episode-filled svelte-1u6kv8l",null,l,t),_r(o,`transform: translateX(${Tt(i).filledWidth/Tt(i).width*100}%)`)}),[()=>({disabled:t.disabled,mobile:t.isMobile}),()=>({mobile:t.isMobile})]),zi(e,r)})),Te(r),zi(e,r)}(e,{get videoEpisodes(){return Tt(F)},get disabled(){return p()},get isMobile(){return l()}})},Y=e=>{var t=Xl(),i=Ne(t),r=De(i,2);let a;Te(t),Bt((e=>{_r(i,`transform: translateX(${100*C()}%);`),a=xr(r,1,"filled svelte-1tpemng",null,a,e),_r(r,`transform: translateX(${100*E()}%);`)}),[()=>({"active-live":o()})]),zi(e,t)};Xi(G,(e=>{Tt(F).length?e(K):e(Y,!1)}));var Z=De(G,2);let X;var J=Ne(Z);let ee;Te(Z),Te(W),Kr(W,(e=>i(e)),(()=>i())),Bt(((e,t,i)=>{Q=xr(W,1,`slider ${r()??""}`,"svelte-1tpemng",Q,e),Lr(W,"aria-label",L()),Lr(W,"aria-valuemin",P()),Lr(W,"aria-valuemax",M()),Lr(W,"aria-valuenow",I()),Lr(W,"aria-valuetext",R()),Lr(W,"data-testid",a()??null),X=xr(Z,1,"handleWrap svelte-1tpemng",null,X,t),_r(Z,`transform: translateX(${100*A()}%);`),ee=xr(J,1,"handle svelte-1tpemng",null,ee,i)}),[()=>({disabled:p(),"slider-dragging":Tt(B),hidden:s(),"slider-vertical":n(),"no-handle":f(),square:u()}),()=>({hidden:f()}),()=>({"active-live":o()})]),Ii("pointerenter",W,(function(e){if(e.preventDefault(),i()&&re(N,Ae(i().getBoundingClientRect())),p())return;let t=j(e.clientX,e.clientY),r=z(e.clientX);y()(t,r,Tt(N).width)})),Ii("pointerleave",W,(function(e){e.preventDefault(),!p()&&S()()})),Ii("wheel",W,(function(e){p()||c()&&(e.preventDefault(),e.deltaY<0?x()():e.deltaY>0?$()():e.deltaX>0?k()():_()())})),zi(e,U),fi()}Ri(["pointerdown","pointermove","pointerup","click"]);var iu=(e,t)=>Ia[e]>=Ia[t],ru=(e,t)=>Ia[e]<=Ia[t],au=Di("<div><!></div>"),su=Di("<div><!> <!></div>"),nu={hash:"svelte-1auih1j",code:".volumeBar-container.svelte-1auih1j {display:flex;align-items:center;}.volumeBar-container.vertical.svelte-1auih1j, .vertical.svelte-1auih1j .tooltip-wrapper, .vertical.svelte-1auih1j .btn {width:40px;}.volumeBar.svelte-1auih1j {display:flex;align-items:center;margin:0 8px;position:relative;width:70px;--slider-height: var(--slider-volume-height);--slider-radius: var(--slider-volume-radius);--slider-handle-size: var(--slider-volume-handle-size);--slider-bg: var(--volume-slider-bg);--slider-filled-bg: var(--volume-slider-filled-bg);--slider-handle-bg: var(--volume-slider-handle-bg);}.volumeBar-slider-vertical {width:50px !important;}.volumeBar-vertical.svelte-1auih1j {padding:0 8px 0 0;width:0;}"};function ou(e,t){pi(t,!0),vr(e,nu);let i,[r,a]=ua(),s=()=>la(b,"$isAudioAvailable$",r),n=()=>la(u,"$volume$",r),o=Oa(),l=ya(),u=o.state.volume$,d=o.state.muted$,{setVolume:c,startVolumeChanging:h,stopVolumeChanging:p}=o.actions.internal,f=o.ui.currentGridType$,v=o.callbacks?.onAudioDoesNotExistHint,g=o.callbacks?.onAudioDisabledHint,b=o.state.isAudioAvailable$,y=o.state.isAudioDisabled,w=o.ui.t,S=te(!1),x=ne((()=>!s()||la(d,"$muted$",r)||0===n())),$=ne((()=>ru(la(f,"$currentGridType$",r),"s"))),_=ne((()=>Tt($)?"":Tt(x)?w("tooltip_volume"):w("tooltip_volume_muted"))),k=ne((()=>Tt(x)?w("tooltip_volume"):w("tooltip_volume_muted"))),T=ne((()=>Tt(x)?0:n())),C=!1,E=ne((()=>s()?y&&!g:!v));function A(e){h(),c(e)}function L(){Eo(o,n(),l.controls.volumeStepWheel)}function P(){Ao(o,n(),l.controls.volumeStepWheel)}function M(e){c(e)}function I(e){c(e),p()}function R(){C=!0}function V(){C=!1,D()}function N(){clearTimeout(i),re(S,!0)}function B(){D()}function D(){i=window.setTimeout((()=>{C||re(S,!1)}),l.controls.volumeBarTimeout)}var O=su();let F;var j=Ne(O);Vl(j,{get content(){return Tt(_)},translateY:-18,children:(e,i)=>{let r=ne((()=>Tt($)?"btn-volume-vertical":"btn-volume-horizontal"));jo(e,{className:"btn-full-opacity",get disabled(){return Tt(E)},get testId(){return Tt(r)},get ariaLabel(){return Tt(k)},get click(){return t.click},get ariaKeyShortCut(){return _a},children:(e,t)=>{Al(e,{get volume(){return n()},get muted(){return Tt(x)}})},$$slots:{default:!0}})},$$slots:{default:!0}});var z=De(j,2),U=e=>{var t=au();let i;var r=Ne(t);let a=ne((()=>Tt($)?"volumeBar-slider-vertical":"")),s=ne((()=>Tt($)&&!Tt(S))),n=ne((()=>Tt($)?R:m.noop)),o=ne((()=>Tt($)?V:m.noop)),l=ne((()=>Math.round(100*Tt(T)))),u=ne((()=>`${Math.round(100*Tt(T))}%`)),d=ne((()=>Tt($)?"volume-slider-vertical":"volume-slider"));tu(r,{get className(){return Tt(a)},get isHidden(){return Tt(s)},get isVertical(){return Tt($)},withWheelHandler:!0,onWheelUp:L,onWheelDown:P,onPointerDown:A,onHandleMove:M,onPointerUp:I,get onPointerEnter(){return Tt(n)},get onPointerLeave(){return Tt(o)},ariaLabel:"Ползунок громкости",ariaValueMin:0,ariaValueMax:100,get ariaValueNow(){return Tt(l)},get ariaValueText(){return Tt(u)},get filledProgress(){return Tt(T)},get handleProgress(){return Tt(T)},get testId(){return Tt(d)}}),Te(t),Bt((e=>i=xr(t,1,"volumeBar svelte-1auih1j",null,i,e)),[()=>({"volumeBar-vertical":Tt($)})]),zi(e,t)};Xi(z,(e=>{s()&&e(U)})),Te(O),Bt((e=>F=xr(O,1,"volumeBar-container svelte-1auih1j",null,F,e)),[()=>({vertical:Tt($)})]),Ii("mouseenter",O,(function(...e){(Tt($)?N:m.noop)?.apply(this,e)})),Ii("mouseleave",O,(function(...e){(Tt($)?B:m.noop)?.apply(this,e)})),Ii("wheel",O,(function(e){e.preventDefault(),e.deltaY<0?L():e.deltaY>0&&P()})),zi(e,O),fi(),a()}var lu=Oi('<svg><!><g fill-rule="evenodd"><path d="M4.58 13.979a.99.99 0 0 1 .99-.99h4.451a.99.99 0 0 1 .99.99v4.452a.99.99 0 0 1-1.98 0v-2.05l-3.319 3.322a1 1 0 0 1-1.414 0v-.001a1 1 0 0 1 0-1.414l3.32-3.32H5.57a.99.99 0 0 1-.99-.99m10.388-6.36 3.32-3.322a1 1 0 0 1 1.414 0v.001a1 1 0 0 1 0 1.414l-3.32 3.32h2.049a.99.99 0 0 1 0 1.979h-4.442a1 1 0 0 1-1-1V5.569a.99.99 0 1 1 1.98 0z" class="_exit"></path><path d="M10.5 19a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-4.5a1 1 0 0 1 2 0v2.072l3.363-3.365a1 1 0 0 1 1.414 0l.016.016a1 1 0 0 1 0 1.414L7.429 18H9.5a1 1 0 0 1 1 1M18 7.429l-3.363 3.364a1 1 0 0 1-1.414 0l-.016-.016a1 1 0 0 1 0-1.414L16.571 6H14.5a1 1 0 0 1 0-2H19a1 1 0 0 1 1 1v4.5a1 1 0 0 1-2 0z" class="_enter"></path></g></svg>');var uu={hash:"svelte-17t966y",code:'svg[data-testid="close-fullscreen-icon"] ._enter,\n  svg[data-testid="open-fullscreen-icon"] ._exit {visibility:hidden;opacity:0;}'};function du(e,t){vr(e,uu);let i=ma(t,"isFullscreen",8,!1),r=oe((()=>i()?"close-fullscreen-icon":"open-fullscreen-icon"));!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=lu();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"var(--btn-color, #fff)","aria-hidden":"true",role:"img",...i}))),zi(e,r)}(e,{get"data-testid"(){return Tt(r)},fill:"var(--btn-color, #fff)"})}function cu(e,t){pi(t,!0);let i=ma(t,"isFullscreen",3,!1),r=ma(t,"click",3,m.noop),a=Oa(),s=a.ui.isFullscreenOpenedByKeyboard,n=a.ui.t,o=ne((()=>i()?n("tooltip_fullscreen_on"):n("tooltip_fullscreen_off")));jo(e,{testId:"btn-fullscreen",get ariaLabel(){return Tt(o)},click:e=>{let t=wn(e);s.set(t),r()()},get ariaKeyShortCut(){return Sa},children:(e,t)=>{du(e,{get isFullscreen(){return i()}})},$$slots:{default:!0}}),fi()}var hu=Oi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M4.265 4.265C3 5.531 3 7.567 3 11.64v.72c0 4.073 0 6.11 1.265 7.375C5.531 21 7.567 21 11.64 21h.72c4.073 0 6.11 0 7.375-1.265C21 18.469 21 16.433 21 12.36v-.72c0-4.073 0-6.11-1.265-7.375C18.469 3 16.433 3 12.36 3h-.72C7.567 3 5.53 3 4.265 4.265M6 8.5c.096 4.682 2.556 7.5 6.61 7.5h.235v-2.679c1.476.15 2.577 1.254 3.026 2.679H18c-.578-2.132-2.075-3.31-3.005-3.76.93-.558 2.246-1.908 2.556-3.74h-1.937c-.406 1.49-1.615 2.84-2.77 2.968V8.5h-1.968v5.197c-1.197-.3-2.759-1.757-2.823-5.197z" clip-rule="evenodd"></path></svg>');var pu=Oi('<svg><!><path fill="var(--btn-color, #fff)" d="M32.55 17.042h2.494L38.707 7h-1.81l-2.936 8.276h-.286L30.84 7H29zM48.075 17.042l-4.619-5.199L47.718 7h-2.11l-3.563 4.088h-.413V7h-1.71v10.042h1.71V12.74h.427l3.764 4.302z"></path><path fill="var(--btn-color, #fff)" d="M57.888 11.886c.883-.342 1.44-1.125 1.44-2.151C59.327 8.14 58.001 7 56.062 7h-3.92v10.042h4.205c1.953 0 3.279-1.14 3.279-2.806 0-1.168-.656-2.037-1.74-2.35m-4.034-3.39h2.21c.911 0 1.539.555 1.539 1.381 0 .812-.628 1.368-1.54 1.368h-2.21zm2.494 7.05h-2.494V12.74h2.494c.898 0 1.525.57 1.525 1.396 0 .84-.627 1.41-1.525 1.41M61.188 17.042h2.323l2.766-5.498h.228v5.498h1.568V9.635h-2.324l-2.765 5.498h-.228V9.635h-1.568zM69.146 19.25h1.64v-2.208h5.33v2.208h1.64v-3.703h-1.283V9.635h-5.431l-.37 3.79c-.13 1.338-.528 2.121-1.34 2.121h-.186zm2.494-3.703c.4-.385.57-1.04.685-2.151l.228-2.265h2.28v4.416zM86.025 13.253c0-2.136-1.597-3.76-3.849-3.76s-3.848 1.61-3.848 3.846 1.596 3.846 3.848 3.846c1.54 0 2.994-.727 3.55-2.137l-1.54-.256c-.356.527-1.04.897-1.91.897-1.254 0-2.081-.77-2.238-1.909h5.958c.015-.156.029-.327.029-.527m-3.849-2.336c1.027 0 1.796.655 2.067 1.581h-4.105c.27-.954 1.04-1.58 2.038-1.58M90.837 17.185c2.324 0 3.963-1.596 3.963-3.846s-1.64-3.846-3.963-3.846-3.962 1.595-3.962 3.846c0 2.25 1.639 3.846 3.962 3.846m0-1.496c-1.34 0-2.252-.954-2.252-2.35s.912-2.35 2.252-2.35 2.252.954 2.252 2.35-.912 2.35-2.252 2.35" class="_ru"></path><path fill="var(--btn-color, #fff)" d="M35.02 17.36h-2.484L29 7.422h1.832l2.826 8.188h.284l2.925-8.188h1.803zM43.43 12.215l4.6 5.144h-2.243l-3.749-4.256h-.426v4.256h-1.704V7.423h1.704v4.045h.412l3.55-4.045h2.101zM56.808 17.36h-2.485l-3.536-9.937h1.832l2.826 8.188h.284l2.925-8.188h1.803zM63.257 17.36h-1.633v-7.33h1.633zm-.809-8.373q-.455 0-.738-.268a.97.97 0 0 1-.284-.718.97.97 0 0 1 .284-.72q.297-.28.738-.281.44 0 .724.282a.97.97 0 0 1 .284.719.97.97 0 0 1-.284.718q-.284.268-.724.268M68.382 17.5q-1.037 0-1.86-.48a3.5 3.5 0 0 1-1.293-1.352q-.454-.874-.454-1.973t.454-1.96a3.37 3.37 0 0 1 1.293-1.352 3.55 3.55 0 0 1 1.86-.494q.894 0 1.59.367.696.352 1.136.888V7.423h1.633v9.936h-1.22l-.342-1.184a4 4 0 0 1-1.164.944q-.71.381-1.633.381m.397-1.452q1.038 0 1.676-.648.654-.663.653-1.705 0-1.044-.653-1.692-.639-.662-1.675-.662-1.023 0-1.662.662-.639.649-.639 1.692t.64 1.705q.638.648 1.66.648M81.929 13.61q0 .211-.029.522h-5.935q.113.86.71 1.38.597.508 1.52.508.624 0 1.121-.24.51-.24.781-.648l1.534.254a3 3 0 0 1-1.378 1.564q-.965.55-2.158.55-1.108 0-1.988-.48a3.6 3.6 0 0 1-1.363-1.352q-.483-.874-.483-1.973t.483-1.96a3.5 3.5 0 0 1 1.363-1.352q.88-.495 1.988-.494 1.107 0 1.974.494.88.478 1.363 1.339.497.845.497 1.888M78.095 11.3q-.738 0-1.292.423-.54.422-.739 1.141h4.09a2.17 2.17 0 0 0-.767-1.127q-.54-.437-1.292-.437M86.751 17.5q-1.136 0-2.044-.48a3.66 3.66 0 0 1-1.406-1.352q-.497-.874-.497-1.973t.497-1.96q.511-.873 1.406-1.352.909-.495 2.044-.494 1.137 0 2.031.494a3.4 3.4 0 0 1 1.406 1.353q.51.86.511 1.959 0 1.098-.511 1.973a3.53 3.53 0 0 1-1.406 1.353q-.894.48-2.03.479m0-1.48q.995 0 1.62-.634.624-.648.624-1.691t-.625-1.678q-.624-.648-1.619-.648-.993 0-1.618.648-.625.634-.625 1.678 0 1.043.625 1.69.625.636 1.618.635" class="_en"></path><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M7 8.6c0-1.96 0-2.94.381-3.689a3.5 3.5 0 0 1 1.53-1.53C9.66 3 10.64 3 12.6 3h1.36c2.464 0 3.696 0 4.638.48a4.4 4.4 0 0 1 1.922 1.922c.48.942.48 2.174.48 4.638v3.92c0 2.464 0 3.696-.48 4.638a4.4 4.4 0 0 1-1.922 1.922c-.942.48-2.174.48-4.638.48H12.6c-1.96 0-2.94 0-3.689-.381a3.5 3.5 0 0 1-1.53-1.53C7 18.34 7 17.36 7 15.4zm9.265 1.744c.901.539 1.352.808 1.505 1.157.133.304.133.65 0 .954-.153.349-.604.618-1.505 1.157l-2.386 1.425c-.943.563-1.414.844-1.802.807a1.2 1.2 0 0 1-.847-.48C11 15.05 11 14.5 11 13.403v-2.85c0-1.098 0-1.647.23-1.96.201-.274.51-.45.847-.481.388-.037.86.244 1.802.807zM5 9.04c0-2.464 0-3.696.48-4.638a4.4 4.4 0 0 1 .955-1.253 3.7 3.7 0 0 0-1.033.33A4.4 4.4 0 0 0 3.48 5.403C3 6.344 3 7.576 3 10.04v3.92c0 2.464 0 3.696.48 4.638a4.4 4.4 0 0 0 1.922 1.922c.304.155.637.26 1.033.33a4.4 4.4 0 0 1-.955-1.252C5 18.656 5 17.424 5 14.96z" clip-rule="evenodd"></path></svg>');var fu={hash:"svelte-1nhjml",code:'svg[data-testid="vk-video-logo-icon--short"] ._ru,\n  svg[data-testid="vk-video-logo-icon--short"] ._en,\n  svg[data-testid="vk-video-logo-icon"] ._en,\n  svg[data-testid="vk-video-logo-icon--en"] ._ru {visibility:hidden;opacity:0;}'};function mu(e,t){vr(e,fu);let i=ma(t,"short",3,!1),r=ma(t,"isCyrillic",3,!0),a=ne((()=>r()||i()?i()?21:95:91)),s=ne((()=>r()||i()?i()?"vk-video-logo-icon--short":"vk-video-logo-icon":"vk-video-logo-icon--en")),n=ne((()=>`0 0 ${Tt(a)+1} 24`));!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=pu();let a;hr(Ne(r),(()=>t.children??D)),Ce(4),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"95",height:"24",fill:"none","aria-hidden":"true",role:"img",...i}))),zi(e,r)}(e,{get width(){return Tt(a)},height:"24",get viewBox(){return Tt(n)},get"data-testid"(){return Tt(s)}})}function vu(e,t){pi(t,!0);let[i,r]=ua(),a=ma(t,"ref",15,void 0),s=ma(t,"logoClickable",3,!1),n=ma(t,"targetUrl",3,""),o=ya(),l=Oa(),u=l.ui.currentGridType$,d=l.ui.isMobile,c=l.ui.t,h=l.isCyrillicRelatedInterface$,p=ne((()=>"vk_video"===o.logoType?c("tooltip_vk_video_logo"):c("tooltip_vk_logo"))),f=ne((()=>"vk_video"===o.logoType||"vk_video_mobile"===o.logoType)),m=ne((()=>(la(d,"$isMobile",i)||ru(la(u,"$currentGridType$",i),"l"))&&Tt(f))),v=ne((()=>!s())),g=ne((()=>Tt(f)?"btn-vk-video-logo":"btn-vk-logo"));jo(e,{className:"btn-full-opacity",get disabled(){return Tt(v)},click:()=>{t.click(),l.callbacks?.onLogoClicked?l.callbacks?.onLogoClicked():n()&&window.open(n(),"_blank")},get testId(){return Tt(g)},get ariaLabel(){return Tt(p)},get ref(){return a()},set ref(e){a(e)},children:(e,t)=>{var r=ji(),a=Be(r),s=e=>{mu(e,{get short(){return Tt(m)},get isCyrillic(){return la(h,"$isCyrillicRelatedInterface$",i)}})},n=e=>{!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=hu();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"vk-logo-icon",role:"img",...i}))),zi(e,r)}(e,{})};Xi(a,(e=>{Tt(f)?e(s):e(n,!1)})),zi(e,r)},$$slots:{default:!0}}),fi(),r()}var gu=Oi('<svg width="24" height="24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" data-testid="chromecast-mobile-icon" class="svelte-8z1bf5"><g filter="url(#b)" clip-path="url(#a)" class="svelte-8z1bf5"><mask id="c" maskUnits="userSpaceOnUse" x="1.1" y="3.1" width="22" height="18" fill="#000" class="svelte-8z1bf5"><path d="M1.1 3.1h22v18h-22z" class="svelte-8z1bf5"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M16.2 5.9c.855 0 1.442 0 1.897.038.445.036.683.103.856.19a2.1 2.1 0 0 1 .918.919c.088.172.155.411.191.856.037.455.038 1.042.038 1.897v4.4c0 .855 0 1.442-.038 1.897-.036.445-.103.683-.19.856a2.1 2.1 0 0 1-.919.918c-.172.088-.411.155-.856.191-.455.037-1.042.038-1.897.038H15a.9.9 0 0 0 0 1.8h1.238c.808 0 1.469 0 2.006-.044.556-.045 1.058-.142 1.527-.381a3.9 3.9 0 0 0 1.704-1.704c.239-.47.336-.971.381-1.527.044-.537.044-1.198.044-2.006V9.762c0-.808 0-1.469-.044-2.006-.045-.556-.142-1.058-.381-1.527a3.9 3.9 0 0 0-1.704-1.704c-.47-.239-.971-.336-1.527-.381-.537-.044-1.198-.044-2.006-.044H6a3.901 3.901 0 0 0-3.678 2.6.9.9 0 0 0 1.697.6A2.101 2.101 0 0 1 6 5.9h10.2ZM3.069 11.52a6.9 6.9 0 0 1 7.413 7.413.9.9 0 0 0 1.795.137 8.7 8.7 0 0 0-9.344-9.344.9.9 0 0 0 .136 1.794Zm.533 3.58c-.161 0-.32.011-.474.034a.9.9 0 1 1-.256-1.782A5.1 5.1 0 0 1 8.65 19.13a.9.9 0 1 1-1.782-.256A3.3 3.3 0 0 0 3.602 15.1Zm-1.5 3.3a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z" class="svelte-8z1bf5"></path></mask><path fill-rule="evenodd" clip-rule="evenodd" d="M16.2 5.9c.855 0 1.442 0 1.897.038.445.036.683.103.856.19a2.1 2.1 0 0 1 .918.919c.088.172.155.411.191.856.037.455.038 1.042.038 1.897v4.4c0 .855 0 1.442-.038 1.897-.036.445-.103.683-.19.856a2.1 2.1 0 0 1-.919.918c-.172.088-.411.155-.856.191-.455.037-1.042.038-1.897.038H15a.9.9 0 0 0 0 1.8h1.238c.808 0 1.469 0 2.006-.044.556-.045 1.058-.142 1.527-.381a3.9 3.9 0 0 0 1.704-1.704c.239-.47.336-.971.381-1.527.044-.537.044-1.198.044-2.006V9.762c0-.808 0-1.469-.044-2.006-.045-.556-.142-1.058-.381-1.527a3.9 3.9 0 0 0-1.704-1.704c-.47-.239-.971-.336-1.527-.381-.537-.044-1.198-.044-2.006-.044H6a3.901 3.901 0 0 0-3.678 2.6.9.9 0 0 0 1.697.6A2.101 2.101 0 0 1 6 5.9h10.2ZM3.069 11.52a6.9 6.9 0 0 1 7.413 7.413.9.9 0 0 0 1.795.137 8.7 8.7 0 0 0-9.344-9.344.9.9 0 0 0 .136 1.794Zm.533 3.58c-.161 0-.32.011-.474.034a.9.9 0 1 1-.256-1.782A5.1 5.1 0 0 1 8.65 19.13a.9.9 0 1 1-1.782-.256A3.3 3.3 0 0 0 3.602 15.1Zm-1.5 3.3a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z" class="svelte-8z1bf5"></path><path d="m18.097 5.938-.04.498.04-.498Zm.856.19-.227.446.227-.445Zm.918.919-.445.227.445-.227Zm.191.856-.498.04.498-.04Zm0 8.194-.498-.04.498.04Zm-.19.856-.446-.227.445.227Zm-.919.918-.227-.445.227.445Zm-.856.191.04.498-.04-.498Zm-1.86 1.838v-.5.5Zm2.007-.044.04.498-.04-.498Zm1.527-.381-.227-.446.227.446Zm1.704-1.704.445.227-.445-.227Zm.381-1.527.498.04-.498-.04Zm.044-2.006h-.5.5Zm0-4.476h-.5.5Zm-.044-2.006.498-.04-.498.04Zm-.381-1.527.445-.227-.445.227ZM19.77 4.525l-.227.446.227-.446Zm-1.527-.381.04-.498-.04.498ZM16.238 4.1v.5-.5ZM6 4.1v-.5.5ZM2.322 6.7l-.471-.167.471.167Zm1.697.6-.471-.167.471.167ZM6 5.9v-.5.5Zm-2.931 5.62-.038-.498.038.498Zm7.413 7.413.498.038-.498-.038Zm1.795.137.498.038-.498-.038ZM2.931 9.725l-.038-.498.038.498Zm-.829.966.499-.038-.499.038Zm1.025 4.443-.071-.495.071.495Zm-1.019-.763.495-.071-.495.07Zm.763-1.02.071.496-.07-.495ZM8.65 19.13l.495.072-.495-.072Zm-1.019.764-.07.494.07-.494Zm-.763-1.02.495.072-.495-.071ZM18.138 5.44c-.48-.04-1.091-.04-1.938-.04v1c.863 0 1.426.001 1.856.036l.082-.996Zm1.042.243c-.255-.13-.567-.205-1.042-.243l-.082.996c.414.034.58.092.67.138l.454-.89Zm1.137 1.137a2.6 2.6 0 0 0-1.137-1.137l-.454.891a1.6 1.6 0 0 1 .7.7l.89-.454Zm.244 1.042c-.04-.475-.114-.787-.244-1.042l-.891.454c.046.09.104.256.138.67l.997-.082ZM20.6 9.8c0-.846 0-1.458-.04-1.938l-.996.082c.035.43.036.993.036 1.856h1Zm0 4.4V9.8h-1v4.4h1Zm-.04 1.938c.04-.48.04-1.092.04-1.938h-1c0 .863-.001 1.426-.036 1.856l.997.082Zm-.243 1.042c.13-.255.205-.567.244-1.042l-.997-.082c-.034.414-.092.58-.138.67l.89.454Zm-1.137 1.137a2.6 2.6 0 0 0 1.137-1.137l-.891-.454a1.6 1.6 0 0 1-.7.7l.454.89Zm-1.042.244c.475-.04.787-.114 1.042-.244l-.454-.891c-.09.046-.256.104-.67.138l.082.997ZM16.2 18.6c.847 0 1.458 0 1.938-.04l-.082-.996c-.43.035-.993.036-1.856.036v1Zm-1.2 0h1.2v-1H15v1Zm-.4.4c0-.22.18-.4.4-.4v-1a1.4 1.4 0 0 0-1.4 1.4h1Zm.4.4a.4.4 0 0 1-.4-.4h-1a1.4 1.4 0 0 0 1.4 1.4v-1Zm1.238 0H15v1h1.238v-1Zm1.965-.042c-.512.042-1.15.042-1.965.042v1c.8 0 1.484 0 2.046-.045l-.081-.997Zm1.34-.329c-.386.198-.815.286-1.34.329l.081.997c.587-.049 1.163-.154 1.714-.435l-.454-.89Zm1.486-1.485a3.4 3.4 0 0 1-1.485 1.485l.454.891a4.4 4.4 0 0 0 1.922-1.922l-.89-.454Zm.329-1.341c-.043.525-.131.954-.329 1.34l.891.455c.281-.552.386-1.127.434-1.714l-.996-.081Zm.042-1.965c0 .815 0 1.453-.042 1.965l.997.081c.045-.561.045-1.246.045-2.046h-1Zm0 0h1-1Zm0-4.476v4.476h1V9.762h-1Zm0 0h1-1Zm-.042-1.965c.042.512.042 1.15.042 1.965h1c0-.8 0-1.484-.045-2.046l-.997.081Zm-.329-1.34c.198.386.286.815.329 1.34l.997-.081c-.049-.587-.154-1.162-.435-1.714l-.89.454ZM19.544 4.97a3.4 3.4 0 0 1 1.485 1.485l.891-.454a4.4 4.4 0 0 0-1.922-1.922l-.454.89Zm-1.341-.329c.525.043.954.132 1.34.329l.455-.891c-.552-.281-1.127-.387-1.714-.434l-.081.996ZM16.238 4.6c.815 0 1.453 0 1.965.042l.081-.996c-.562-.046-1.246-.046-2.046-.046v1Zm0 0v-1 1ZM6 4.6h10.238v-1H6v1Zm0-1v1-1Zm0 0a4.401 4.401 0 0 0-4.15 2.933l.944.334A3.401 3.401 0 0 1 6 4.6v-1ZM1.85 6.533a1.4 1.4 0 0 0 .854 1.787l.333-.943a.4.4 0 0 1-.243-.51l-.943-.334Zm.854 1.787a1.4 1.4 0 0 0 1.787-.853l-.943-.334a.4.4 0 0 1-.51.244l-.334.943Zm1.787-.853A1.601 1.601 0 0 1 6 6.4v-1c-1.131 0-2.095.722-2.452 1.733l.943.334ZM16.2 5.4H6v1h10.2v-1ZM3.602 11c-.192 0-.383.007-.571.022l.076.997A6.53 6.53 0 0 1 3.602 12v-1Zm7.4 7.4a7.4 7.4 0 0 0-7.4-7.4v1a6.4 6.4 0 0 1 6.4 6.4h1Zm-.022.571c.015-.188.022-.379.022-.571h-1c0 .167-.006.332-.019.495l.997.076Zm.369.43a.4.4 0 0 1-.369-.43l-.997-.076a1.4 1.4 0 0 0 1.29 1.502l.076-.997Zm.429-.37a.4.4 0 0 1-.43.37l-.075.996a1.4 1.4 0 0 0 1.502-1.29l-.997-.075Zm.024-.631c0 .213-.008.423-.024.632l.997.076c.018-.234.027-.47.027-.708h-1Zm-8.2-8.2a8.2 8.2 0 0 1 8.2 8.2h1a9.2 9.2 0 0 0-9.2-9.2v1Zm-.632.024c.209-.016.42-.024.632-.024v-1c-.238 0-.474.01-.708.027l.076.997Zm-.368.43a.4.4 0 0 1 .368-.43l-.076-.997a1.4 1.4 0 0 0-1.29 1.502l.998-.076Zm.429.368a.4.4 0 0 1-.43-.369l-.996.076a1.4 1.4 0 0 0 1.502 1.29l-.076-.997Zm.168 4.607c.13-.02.265-.029.403-.029v-1c-.185 0-.367.013-.545.039l.142.99Zm-1.585-1.187A1.4 1.4 0 0 0 3.2 15.629l-.142-.99a.4.4 0 0 1-.453-.34l-.99.143Zm1.187-1.585a1.4 1.4 0 0 0-1.187 1.585l.99-.142a.4.4 0 0 1 .34-.453l-.143-.99Zm.801-.057c-.271 0-.538.02-.8.057l.141.99c.216-.031.436-.047.659-.047v-1Zm5.6 5.6a5.6 5.6 0 0 0-5.6-5.6v1a4.6 4.6 0 0 1 4.6 4.6h1Zm-.057.8c.038-.262.057-.529.057-.8h-1c0 .223-.016.443-.047.659l.99.142ZM7.56 20.389A1.4 1.4 0 0 0 9.145 19.2l-.99-.142a.4.4 0 0 1-.453.34l-.142.99Zm-1.187-1.585a1.4 1.4 0 0 0 1.187 1.584l.142-.99a.4.4 0 0 1-.339-.452l-.99-.142Zm.029-.403c0 .138-.01.272-.029.403l.99.142c.026-.178.039-.36.039-.545h-1Zm-2.8-2.8a2.8 2.8 0 0 1 2.8 2.8h1a3.8 3.8 0 0 0-3.8-3.8v1Zm0 .8a2 2 0 0 0-2 2h1a1 1 0 0 1 1-1v-1Zm2 2a2 2 0 0 0-2-2v1a1 1 0 0 1 1 1h1Zm-2 2a2 2 0 0 0 2-2h-1a1 1 0 0 1-1 1v1Zm-2-2a2 2 0 0 0 2 2v-1a1 1 0 0 1-1-1h-1Z" fill="#000" fill-opacity=".12" mask="url(#c)" class="svelte-8z1bf5"></path></g><defs class="svelte-8z1bf5"><clipPath id="a" class="svelte-8z1bf5"><path d="M0 0h24v24H0z" class="svelte-8z1bf5"></path></clipPath><filter id="b" x="-3.4" y="-1.4" width="30.8" height="26.802" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB" class="svelte-8z1bf5"><feFlood flood-opacity="0" result="BackgroundImageFix" class="svelte-8z1bf5"></feFlood><feColorMatrix in="SourceAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" class="svelte-8z1bf5"></feColorMatrix><feOffset class="svelte-8z1bf5"></feOffset><feGaussianBlur stdDeviation="2.5" class="svelte-8z1bf5"></feGaussianBlur><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.16 0" class="svelte-8z1bf5"></feColorMatrix><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_4085_178456" class="svelte-8z1bf5"></feBlend><feBlend in="SourceGraphic" in2="effect1_dropShadow_4085_178456" result="shape" class="svelte-8z1bf5"></feBlend></filter></defs></svg>'),bu=Oi('<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" data-testid="chromecast-icon"><g fill="none" fill-rule="evenodd" class="svelte-8z1bf5"><path class="wave wave1 svelte-8z1bf5" d="M1 18v3h3c0-1.66-1.34-3-3-3z" fill="var(--btn-color, #fff)"></path><path class="wave wave2 svelte-8z1bf5" d="M1 14v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7z" fill="var(--btn-color, #fff)"></path><path class="wave wave3 svelte-8z1bf5" d="M1 10v2a9 9 0 0 1 9 9h2c0-6.08-4.93-11-11-11z" fill="var(--btn-color, #fff)"></path><path d="M21 3H3c-1.1 0-2 .9-2 2v3h2V5h18v14h-7v2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z" fill="var(--btn-color, #fff)" class="svelte-8z1bf5"></path><path d="M0 0h24v24H0z" class="svelte-8z1bf5"></path><path d="M5.667 7.44H18.5v9.167h-5.161a11.947 11.947 0 0 0-7.673-7.672V7.44Z" fill="var(--btn-color, #fff)"></path></g></svg>'),yu={hash:"svelte-8z1bf5",code:".connecting.svelte-8z1bf5 .wave:where(.svelte-8z1bf5) {animation-duration:1s;animation-iteration-count:infinite;}.connecting.svelte-8z1bf5 .wave1:where(.svelte-8z1bf5) {\n    animation-name: svelte-8z1bf5-wave1;}.connecting.svelte-8z1bf5 .wave2:where(.svelte-8z1bf5) {\n    animation-name: svelte-8z1bf5-wave2;}.connecting.svelte-8z1bf5 .wave3:where(.svelte-8z1bf5) {\n    animation-name: svelte-8z1bf5-wave3;}\n\n  @keyframes svelte-8z1bf5-wave1 {\n    0% {\n      opacity: 0.3;\n    }\n    33% {\n      opacity: 1;\n    }\n    66% {\n      opacity: 1;\n    }\n    100% {\n      opacity: 1;\n    }\n  }\n\n  @keyframes svelte-8z1bf5-wave2 {\n    0% {\n      opacity: 0.3;\n    }\n    33% {\n      opacity: 0.3;\n    }\n    66% {\n      opacity: 1;\n    }\n    100% {\n      opacity: 1;\n    }\n  }\n\n  @keyframes svelte-8z1bf5-wave3 {\n    0% {\n      opacity: 0.3;\n    }\n    33% {\n      opacity: 0.3;\n    }\n    66% {\n      opacity: 0.3;\n    }\n    100% {\n      opacity: 1;\n    }\n  }"};function wu(e,t){pi(t,!0);let i=ma(t,"ref",15,void 0),r=ma(t,"isMobile",3,!1),a=ma(t,"click",3,m.noop),s=Oa().ui.t,n=ne((()=>t.state===f.ChromecastState.CONNECTED?s("tooltip_chromecast_on"):s("tooltip_chromecast_off")));jo(e,{get ariaLabel(){return Tt(n)},get click(){return a()},testId:"btn-chromecast",get ref(){return i()},set ref(e){i(e)},children:(e,i)=>{!function(e,t){pi(t,!0),vr(e,yu);let i=ma(t,"isMobile",3,!1),r=ne((()=>t.iconState===f.ChromecastState.CONNECTED)),a=ne((()=>t.iconState===f.ChromecastState.CONNECTING));var s=ji(),n=Be(s),o=e=>{var t=gu(),i=Ne(t),a=Ne(i),s=Ne(a);Ce(),Te(a);var n=De(a);Ce(),Te(i);var o=De(i),l=Ne(o),u=Ne(l);Te(l),Ce(),Te(o),Te(t),Bt((()=>{Lr(s,"fill",Tt(r)?"#2688EB":"var(--btn-color, #fff)"),Lr(n,"fill",Tt(r)?"#2688EB":"var(--btn-color, #fff)"),Lr(u,"fill",Tt(r)?"#2688EB":"var(--btn-color, #fff)")})),zi(e,t)},l=e=>{var t=bu();let i;var s=Ne(t),n=De(Ne(s),5);let o;Te(s),Te(t),Bt(((e,r)=>{i=xr(t,0,"svelte-8z1bf5",null,i,e),o=xr(n,0,"svelte-8z1bf5",null,o,r)}),[()=>({connecting:Tt(a)}),()=>({hidden:!Tt(r)})]),zi(e,t)};Xi(n,(e=>{i()?e(o):e(l,!1)})),zi(e,s),fi()}(e,{get isMobile(){return r()},get iconState(){return t.state}})},$$slots:{default:!0}}),fi()}var Su=Di('<div class="tooltip-wrapper svelte-5ygsa2"><div><!></div></div>'),xu={hash:"svelte-5ygsa2",code:'.tooltip-wrapper.svelte-5ygsa2 {position:relative;display:block;}.tooltip.svelte-5ygsa2 {position:absolute;opacity:0;visibility:hidden;transition:opacity 200ms, visibility 200ms;bottom:100%;transform:translateX(-50%);}.pointer.svelte-5ygsa2:after {position:absolute;bottom:0;left:50%;width:0;border-top:5px solid rgba(41, 41, 41, .8);border-right:5px solid transparent;border-left:5px solid transparent;content:" ";font-size:0;line-height:0;transform:translate(-50%, 5px);}.tooltip.active.svelte-5ygsa2 {opacity:1;visibility:visible;}'};function $u(e,t){vr(e,xu);let i=ma(t,"active",3,!1),r=ma(t,"pointer",3,!1),a=ma(t,"translateXPx",3,0),s=ma(t,"translateYPx",3,0),n=te(void 0),o=te(void 0);let l=ne((()=>function(e){if(!Tt(o))return 0;let{width:i}=Tt(o).getBoundingClientRect(),r=i/2;return e<r?r:e>t.containerWidth-r?t.containerWidth-r:e}(a())));var u=Su(),d=Ne(u);let c;hr(Ne(d),(()=>t.children??D)),Te(d),Kr(d,(e=>re(o,e)),(()=>Tt(o))),Te(u),Kr(u,(e=>re(n,e)),(()=>Tt(n))),Bt((e=>{_r(u,`transform: translate(${Tt(l)}px, ${s()}px);`),c=xr(d,1,"tooltip svelte-5ygsa2",null,c,e),_r(d,`opacity: ${i()?1:0}; visibility: ${i()?"visible":"hidden"}`)}),[()=>({active:i(),pointer:r()})]),zi(e,u)}var _u=(e,t,i)=>i.filter((i=>i.time<=e*t)).pop(),ku=Di('<div class="preview svelte-1wqg760"></div>'),Tu=Di('<div class="time svelte-1wqg760"> </div>'),Cu=Di('<div><!> <div class="episode svelte-1wqg760"><!></div> <!></div>'),Eu={hash:"svelte-1wqg760",code:".timeline-preview.svelte-1wqg760 {bottom:18px;border-radius:2px;pointer-events:none;}.timeline-preview.mobile.svelte-1wqg760 {bottom:72px;}.preview.svelte-1wqg760 {background-color:var(--timeline-preview-bg);box-shadow:0 0 2px var(--timeline-preview-shadow), 0 8px 24px var(--timeline-preview-shadow);border-radius:8px;border:1px solid var(--white);}.episode.svelte-1wqg760 {margin-top:10px;margin-bottom:4px;font-size:13px;line-height:16px;text-shadow:0 8px 24px var(--timeline-preview-shadow), 0 0 2px var(--timeline-preview-shadow);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-align:center;font-weight:500;}.time.svelte-1wqg760 {font-size:13px;line-height:16px;text-align:center;color:var(--white);text-shadow:0 8px 24px var(--timeline-preview-shadow), 0 0 2px var(--timeline-preview-shadow);font-weight:500;}"};function Au(e,t){pi(t,!0),vr(e,Eu);let[i,r]=ua(),a=()=>la(f,"$rotateAlpha",i),s=150,n=278,o=ma(t,"time",3,""),l=ma(t,"isMobile",3,!1),u=ma(t,"videoEpisodes",19,(()=>[])),d=ma(t,"progress",3,0),c=ma(t,"duration",3,0),h=ma(t,"isInteractive",3,!1),p=Oa(),f=p.ui.rotateAlpha,m=p.ui.playerSize,v=te(0),g=te(0),b=te(""),y=te(0),w=te(0),S=te(0),x=te(0),$=ne((()=>_u(d(),c(),u()))),_=ne((()=>(e=>!!(Math.round(Math.abs(e)/90)%2))(a()))),k=ne((()=>(e=>Math.abs(e)/90%4==1)(a()))),T=ne((function(){let e=l()?s:n,{isVertical:t}=A(),r=30;return Tt($)?.text&&(r+=16),(t||Tt(_))&&(r+=18,r+=50),Math.min(Math.max(la(m,"$playerSize",i).height-r,0),e)})),C=ne((()=>(Tt(k)?1:-1)*(Tt(v)/2-Tt(g)/2))),E=ne((()=>-1*Tt(C)));function A(){let e=t.previewThumbsData.frameWidth,i=t.previewThumbsData.frameHeight,r=i>e;return{width:e,height:i,isHorizontal:!r,isVertical:r}}Rt((()=>{var e;e=function(){let{height:e,isHorizontal:t,isVertical:i,width:r}=A();return t&&(e=e/r*Tt(T),r=Tt(T)),i&&(r=r/e*Tt(T),e=Tt(T)),{width:r,height:e}}(),re(v,Ae(e.width)),re(g,Ae(e.height))})),Rt((()=>{var e;e=function(e){let i;i=t.previewThumbsData.isUV?Math.floor(c()*e/t.previewThumbsData.frequency):Math.min(t.previewThumbsData.countTotal,Math.max(0,Math.floor(t.previewThumbsData.countTotal*e)));let r=Math.floor(i/t.previewThumbsData.countPerImage),a=Math.floor(i%t.previewThumbsData.countPerImage/t.previewThumbsData.countPerRow),s=i%t.previewThumbsData.countPerRow,n=Math.floor(t.previewThumbsData.countPerImage/t.previewThumbsData.countPerRow);!t.previewThumbsData.isUV&&r===Math.floor(t.previewThumbsData.countTotal/t.previewThumbsData.countPerImage)&&(n=Math.floor(t.previewThumbsData.countTotal%t.previewThumbsData.countPerImage/t.previewThumbsData.countPerRow),t.previewThumbsData.countTotal%t.previewThumbsData.countPerImage%t.previewThumbsData.countPerRow>0&&n++);let o=t.previewThumbsData.countPerRow;!t.previewThumbsData.isUV&&r===Math.floor(t.previewThumbsData.countTotal/t.previewThumbsData.countPerImage)&&t.previewThumbsData.countTotal%t.previewThumbsData.countPerImage>0&&(o=Math.min(t.previewThumbsData.countPerRow,t.previewThumbsData.countTotal%t.previewThumbsData.countPerImage));let l=Tt(v)*o,u=Tt(g)*n,d=-s*Tt(v),h=-a*Tt(g);return{imgSrc:t.previewThumbsData.links[r],imgWidth:l,imgHeight:u,imgOffsetX:d,imgOffsetY:h}}(d()),re(b,Ae(e.imgSrc)),re(y,Ae(e.imgWidth)),re(w,Ae(e.imgHeight)),re(S,Ae(e.imgOffsetX)),re(x,Ae(e.imgOffsetY))}));var L=Cu();let P;var M=Ne(L),I=e=>{var t=ku();Bt((()=>_r(t,`width: ${Tt(v)}px; height: ${Tt(g)}px; background-image: url(${Tt(b)}); background-size: ${Tt(y)}px ${Tt(w)}px; background-position: ${Tt(S)}px ${Tt(x)}px;\n    transform: rotate(${a()}deg) ${Tt(_)?`translate(${Tt(C)}px, ${Tt(E)}px)`:""};\n    `))),zi(e,t)};Xi(M,(e=>{Tt(b)&&e(I)}));var R=De(M,2),V=Ne(R),N=e=>{var t=ji(),i=Be(t),r=e=>{var t=Fi();Bt((e=>Hi(t,e)),[()=>Es("tooltip_episode_unfinished")]),zi(e,t)},a=e=>{var t=Fi();Bt((()=>Hi(t,Tt($).text||""))),zi(e,t)};Xi(i,(e=>{h()&&!1===Tt($).completed?e(r):e(a,!1)})),zi(e,t)};Xi(V,(e=>{Tt($)&&e(N)})),Te(R);var B=De(R,2),D=e=>{var t=Tu(),i=Ne(t,!0);Te(t),Bt((()=>Hi(i,o()))),zi(e,t)};Xi(B,(e=>{h()||e(D)})),Te(L),Bt((e=>{P=xr(L,1,"timeline-preview svelte-1wqg760",null,P,e),_r(L,`width: ${Tt(_)?Tt(g):Tt(v)}px;`)}),[()=>({mobile:l()})]),zi(e,L),fi(),r()}var Lu=Di('<span class="time svelte-1jr6obn"> </span>'),Pu=Di("<!> <!>",1),Mu={hash:"svelte-1jr6obn",code:".time.svelte-1jr6obn {display:inline-block;padding:6px 10px;border-radius:3px;color:var(--white);background-color:rgba(41, 41, 41, .8);}.timeline-slider {--slider-bg: var(--timeline-slider-bg);--slider-filled-bg: var(--timeline-slider-filled-bg);--slider-handle-bg: var(--timeline-slider-handle-bg);--slider-loaded-bg: var(--timeline-slider-loaded-bg);}"};function Iu(e,t){pi(t,!0),vr(e,Mu);let[i,r]=ua(),a=()=>la(m,"$duration$",i),s=()=>la(f,"$position$",i),n=()=>la($,"$isInteractiveTime$",i),o=()=>la(v,"$isLive$",i),l=()=>la(b,"$isMobile",i),u=ma(t,"showTimeline",3,!1),d=ma(t,"ref",15,void 0),c=Oa(),h=ya(),p=c.state.bufferedProgress$,f=c.state.positionWithScrubbing$,m=c.state.duration$,v=c.state.isLive$,g=c.state.isActiveLive$,b=c.ui.isMobile,y=h.features.episodes?c.actions.internal.getVideoEpisodes():void 0,w=c.actions.internal.getPreviewThumbsData(),S=c.state.interactiveEpisodes$,x=c.state.isInteractive,$=c.state.isInteractiveTime$,_=c.state.isInteractiveExpectation$,k=c.actions.internal.correctSeekTimeToInteractive,T=c.callbacks?.onDisabledTimelineClick,C=c.ui.controls.disabledControls$,E=c.ui.t,A=h.features.interactiveResponsiveUi,L=ne((()=>x?la(S,"$interactiveEpisodes$",i):y)),P=ne((()=>on(a()))),M=ne((()=>on(s()))),I=ne((()=>s()/a())),R=ne((()=>la(_,"$isInteractiveExpectation$",i)||n())),V=te(!1),N=te(""),B=te(0),D=te(0),O=te(0),F=ne((()=>({containerWidth:Tt(D),translateXPx:Tt(B),translateYPx:x&&w?-36:-16,active:Tt(V)&&u()&&!Tt(R)&&!A,pointer:!h.features.timelinePreview||!w||o()}))),j=E("aria_timeline"),z=ne((()=>E("aria_timeline_value",{position:Tt(M),duration:Tt(P)})));function U(e){return k&&x?k(e*a())/a():e}function q(e,t,i){re(O,Ae(U(e))),re(B,Ae(t)),i&&re(D,Ae(i)),re(N,Ae(function(e){let t=on((o()?1-e:e)*a());return o()?`-${t}`:t}(e)))}var H=Pu(),W=Be(H);$u(W,pa((()=>Tt(F)),{children:(e,t)=>{var i=ji(),r=Be(i),s=e=>{Au(e,{get time(){return Tt(N)},get isMobile(){return l()},get videoEpisodes(){return Tt(L)},previewThumbsData:w,get progress(){return Tt(O)},get duration(){return a()},isInteractive:x})},n=e=>{var t=Lu(),i=Ne(t,!0);Te(t),Bt((()=>Hi(i,Tt(N)))),zi(e,t)};Xi(r,(e=>{h.features.timelinePreview&&w&&!o()?e(s):e(n,!1)})),zi(e,i)},$$slots:{default:!0}}));var Q=De(W,2);let G=ne((()=>Math.round(100*Tt(I)))),K=ne((()=>la(C,"$disabledControls$",i).has("TIMELINE")));tu(Q,{className:"timeline-slider",get isActiveLive(){return la(g,"$isActiveLive$",i)},get isMobile(){return l()},ariaLabel:j,ariaValueMin:0,get ariaValueMax(){return a()},get ariaValueNow(){return Tt(G)},get ariaValueText(){return Tt(z)},get loadedProgress(){return la(p,"$bufferedProgress$",i)},get filledProgress(){return Tt(I)},get handleProgress(){return Tt(I)},get videoEpisodes(){return Tt(L)},onPointerDown:function(e){c.actions.internal.startScrubbing(U(e))},onHandleMove:function(e){n()||c.actions.internal.progressScrubbing(U(e))},onPointerMove:function(e,t,i){q(e,t,i),re(V,!0)},onPointerUp:function(e){c.actions.internal.completeScrubbing(U(e)),re(V,!1)},onPointerEnter:function(e,t,i){q(e,t,i),re(V,!0)},onPointerLeave:function(){re(V,!1)},onDisabledClick:T,isInteractive:x,get disabled(){return Tt(K)},get hideHandel(){return n()},get ref(){return d()},set ref(e){d(e)}}),zi(e,H),fi(),r()}var Ru={hash:"svelte-1yate8h",code:".timeline-ads-slider {--slider-bg: var(--timeline-slider-bg);--slider-filled-bg: var(--timeline-slider-filled-bg);--slider-handle-bg: var(--timeline-slider-handle-bg);--slider-loaded-bg: var(--timeline-slider-loaded-bg);}"};function Vu(e,t){pi(t,!0),vr(e,Ru);let[i,r]=ua(),a=ma(t,"position",3,0),s=ma(t,"duration",3,0),n=Oa(),o=n.ui.isMobile,l=n.ui.t,u=ne((()=>on(s()))),d=ne((()=>on(a()))),c=ne((()=>a()/s())),h=ne((()=>l("aria_timeline_value",{position:Tt(d),duration:Tt(u)}))),p=ne((()=>Math.round(100*Tt(c))));tu(e,{className:"timeline-ads-slider",ariaValueMin:0,get ariaValueMax(){return s()},get ariaValueNow(){return Tt(p)},get ariaValueText(){return Tt(h)},get filledProgress(){return Tt(c)},hideHandel:!0,get squareBorders(){return la(o,"$isMobile",i)}}),fi(),r()}var Nu=Di("<div><!></div>"),Bu=Di("<div></div>"),Du={hash:"svelte-1gqonyf",code:".timeline.svelte-1gqonyf {position:relative;pointer-events:all;display:flex;align-items:center;bottom:0;width:100%;min-width:86px;padding:3px 10px 4px;box-sizing:border-box;}.timeline.mobile.svelte-1gqonyf {height:16px;padding:6px 12px 7px;margin-top:6px;}.timeline-stub.svelte-1gqonyf {width:100%;min-width:20px;}.timeline-stub.mobile.svelte-1gqonyf {height:8px;}"};function Ou(e,t){pi(t,!0),vr(e,Du);let[i,r]=ua(),a=()=>la(d,"$isLive$",i),s=()=>la(p,"$isMobile",i),n=ma(t,"isAds",3,!1),o=ma(t,"isHidden",3,!1),l=ma(t,"ref",15,void 0),u=Oa(),d=u.state.isLive$,c=u.ads.duration,h=u.ads.position,p=u.ui.isMobile,f=ne((()=>!o()&&(!a()||a()&&t.canRewindLive&&t.isRewindableLive||n())));var m=ji(),v=Be(m),g=e=>{var t=Nu();let r;var a=Ne(t),o=e=>{Vu(e,{get position(){return la(h,"$adPosition",i)},get duration(){return la(c,"$adDuration",i)}})},u=e=>{Iu(e,{get showTimeline(){return Tt(f)},get ref(){return l()},set ref(e){l(e)}})};Xi(a,(e=>{n()?e(o):e(u,!1)})),Te(t),Bt((e=>r=xr(t,1,"timeline svelte-1gqonyf",null,r,e)),[()=>({mobile:s()})]),zi(e,t)},b=e=>{var t=Bu();let i;Bt((e=>i=xr(t,1,"timeline-stub svelte-1gqonyf",null,i,e)),[()=>({mobile:s()})]),zi(e,t)};Xi(v,(e=>{Tt(f)?e(g):e(b,!1)})),zi(e,m),fi(),r()}var Fu=Oi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="m21.616 16.495-.012.07c-.156.852-.282 1.541-.427 2.093-.148.569-.333 1.063-.64 1.5a4.4 4.4 0 0 1-2.507 1.732c-.52.133-1.046.131-1.63.069-.568-.06-1.257-.187-2.11-.343l-4.34-.794c-.853-.156-1.542-.282-2.094-.426-.568-.149-1.062-.334-1.5-.642a4.4 4.4 0 0 1-1.731-2.507c-.133-.518-.131-1.045-.069-1.63.06-.567.187-1.257.343-2.11l.012-.068c.156-.853.282-1.542.427-2.095.148-.568.333-1.062.641-1.5a4.4 4.4 0 0 1 2.507-1.731c.518-.133 1.045-.131 1.63-.069.567.06 1.256.187 2.109.343l4.34.794c.853.156 1.542.282 2.094.426.568.149 1.062.334 1.5.642a4.4 4.4 0 0 1 1.731 2.506c.133.52.131 1.046.069 1.63-.06.568-.187 1.258-.343 2.11m-1.446-2.3c.052-.483.035-.769-.022-.993a2.6 2.6 0 0 0-1.023-1.481c-.19-.133-.45-.25-.921-.373-.48-.125-1.102-.24-1.997-.404l-4.272-.781c-.895-.164-1.518-.277-2.01-.33-.483-.051-.769-.035-.993.023-.6.153-1.125.516-1.481 1.023-.133.19-.25.45-.373.92-.125.48-.24 1.103-.403 1.998s-.277 1.518-.33 2.01c-.051.484-.035.77.023.994.153.6.516 1.125 1.023 1.481.189.133.45.25.92.373.48.125 1.102.24 1.997.404l4.272.781c.895.164 1.518.277 2.01.33.483.051.77.035.993-.023a2.6 2.6 0 0 0 1.481-1.023c.133-.19.25-.45.373-.92.125-.48.24-1.103.403-1.998s.278-1.518.33-2.01Z" clip-rule="evenodd"></path><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M18.187 7.488a.9.9 0 0 1-1.045-.727c-.145-.807-.199-1.086-.28-1.296A2.6 2.6 0 0 0 14.504 3.8c-.224-.006-.505.036-1.315.169l-5.846.962c-1.366.224-1.834.313-2.174.492A2.6 2.6 0 0 0 3.837 7.18c-.08.376-.039.85.114 2.226l.011.1a.9.9 0 1 1-1.787.198l-.01-.093-.019-.17c-.129-1.147-.217-1.937-.068-2.636A4.4 4.4 0 0 1 4.332 3.83c.633-.333 1.417-.461 2.556-.648l.163-.027 5.846-.961.098-.016c.674-.111 1.138-.188 1.556-.177a4.4 4.4 0 0 1 3.99 2.819c.15.39.234.853.355 1.526l.017.097a.9.9 0 0 1-.726 1.045" clip-rule="evenodd"></path><path fill="var(--btn-color, #fff)" d="M12.724 12.414a.415.415 0 0 0-.69.231l-.72 4.18a.4.4 0 0 0 .025.221c.085.21.327.311.539.226l3.669-1.467a.406.406 0 0 0 .127-.68z"></path></svg>');var ju=Oi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M4.146 3.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L6.793 6.5 4.146 3.854a.5.5 0 0 1 0-.708" clip-rule="evenodd" opacity=".7"></path></svg>');var zu=Di('<span class="text mobile svelte-1yhs2ga"> </span> <div class="chevron-episodes svelte-1yhs2ga"><!></div>',1),Uu=Di('<span class="text svelte-1yhs2ga"> </span>'),qu=Di('<span class="text count svelte-1yhs2ga"> </span>'),Hu=Di("<!> <!>",1),Wu={hash:"svelte-1yhs2ga",code:".text.svelte-1yhs2ga {padding:0 8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}.text.count.svelte-1yhs2ga {overflow:visible;}.text.mobile.svelte-1yhs2ga {padding:0 3px 0 4px;}.chevron-episodes.svelte-1yhs2ga {margin-bottom:-4px;}"};function Qu(e,t){pi(t,!0),vr(e,Wu);let[i,r]=ua(),a=()=>la(p,"$currentGridType$",i),s=()=>la(v,"$panelOpened$",i),n=()=>la(g,"$isMobile",i),o=ma(t,"position",3,0),l=ma(t,"duration",3,0),u=ma(t,"timeCodes",19,(()=>[])),d=Oa(),c=d.callbacks?.onEpisodeChanged??m.noop,h=!!d.callbacks?.onEpisodeClicked,p=d.ui.currentGridType$,f=d.ui.episodes.openedByKeyboard$,v=d.ui.episodes.panelOpened$,g=d.ui.isMobile,b=d.ui.t,y=te(void 0),w=e=>{if(d.callbacks?.onEpisodeClicked){let t=wn(e);f.set(t),v.set(!0),d.callbacks?.onEpisodeClicked?.(t)}},S=te(null),x=ne((()=>o()/l()));Rt((()=>{let e=_u(Tt(x),l(),u());e?Tt(S)?.time!==e.time&&(c(e),re(S,Ae(e))):re(S,null)}));let $=ne((()=>Tt(S)?.text||"")),_=ne((()=>iu(a(),"xl")?"FULL":iu(a(),"m")&&((e,t)=>Ia[e]<Ia[t])(a(),"xl")?"COUNT":"SHORT")),k=ne((()=>`${b("tooltip_episodes")}: ${Tt($)}`));Rt((()=>{(async(e,t,i)=>{await kt(),"false"===e?.getAttribute("aria-expanded")&&t&&!i&&Ct((()=>{f.set(!1),e.focus()}))})(Tt(y),la(f,"$openedByKeyboard$",i),s())}));var T=ji(),C=Be(T),E=e=>{let t=ne((()=>n()?"px-0":""));jo(e,{get className(){return`w-max btn-full-opacity btn-jc-l ${Tt(t)??""}`},testId:"btn-episodes",click:w,disabled:!h,get ariaExpanded(){return s()},get ariaLabel(){return Tt(k)},get ref(){return Tt(y)},set ref(e){re(y,Ae(e))},children:(e,t)=>{var i=ji(),r=Be(i),a=e=>{var t=zu(),i=Be(t),r=Ne(i,!0);Te(i);var a=De(i,2);(function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=ju();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"13",fill:"none","aria-hidden":"true","data-testid":"chevron-light-icon",role:"img",...i}))),zi(e,r)})(Ne(a),{}),Te(a),Bt((()=>Hi(r,Tt($)))),zi(e,t)},s=e=>{var t=Hu(),i=Be(t);!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=Fu();let a;hr(Ne(r),(()=>t.children??D)),Ce(3),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"episodes-icon",style:"flex-shrink:0",role:"img",...i}))),zi(e,r)}(i,{});var r=De(i,2),a=e=>{var t=Uu(),i=Ne(t,!0);Te(t),Bt((()=>Hi(i,Tt($)))),zi(e,t)},s=(e,t)=>{var i=e=>{var t=qu(),i=Ne(t,!0);Te(t),Bt((()=>Hi(i,u().length))),zi(e,t)};Xi(e,(e=>{"COUNT"===Tt(_)&&e(i)}),t)};Xi(r,(e=>{"FULL"===Tt(_)?e(a):e(s,!1)})),zi(e,t)};Xi(r,(e=>{n()?e(a):e(s,!1)})),zi(e,i)},$$slots:{default:!0}})};Xi(C,(e=>{Tt(S)&&e(E)})),zi(e,T),fi(),r()}var Gu,Ku,Yu,Zu=(e,t)=>e<400||t<225?5:e<640||t<360?0:e<960||t<540?1:e<1280||t<720?2:3,Xu=class{init(e,t,i){this.actions=e,this.adsState=t,this.playerState=i}onAdmanLoadingError(){this.onAdError("adman loading error")}initAdman(e){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_init","already inited: "+!!this.adman],numbers:[(0,m.now)(),e.slotId]}),this.adman)return;this.events.init$.next(),this.startWatchDog();let t,{width:i,height:r,isFullscreen:a,isAutoplay:s,adsContainer:n,adsVideoElement:o,slotId:l,params:u={},duration:d,previewParam:c}=e,h=this.playerState&&sa(this.playerState.vsid);h&&(t=this.isVsidOriginal?h:parseInt(h,36));let{isEmbed:p,immediateOrigin:f}=(0,m.detectEmbed)(),v=(p?f:window.location.href)??window.location.href,g={...u,dl:encodeURIComponent(v),autoplay:s?1:0,player_width:i,player_height:r,preview:c,...t?{request_id:t}:{},duration:d,puid10:Zu(i,r),puid11:a?0:1};c||delete g.preview;let b={slot:l,wrapper:n,videoEl:o,videoQuality:r,params:g,browser:{mobile:!1}};try{let e=new window.AdmanHTML;e.setDebug(!1),e.onReady(this.onAdsReady),e.onStarted(this.onAdStarted),e.onPlayed(this.onAdPlayed),e.onPaused(this.onAdPaused),e.adMidrollPoint(this.onAdMidrollPoint),e.onClosed(this.onAdClosed),e.onSkipped(this.onAdSkipped),e.onClicked(this.onAdClicked),e.onTimeRemained(this.onAdTimeRemained),e.onCompleted(this.onAdCompleted),e.onError(this.onAdError),e.init(b),this.adman=e,this.videoElement=o,this.events.slotRequested$.next(),this.log({message:`adman init, config: ${JSON.stringify(b)}`})}catch(e){m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_init_threw",String(e)],numbers:[(0,m.now)()]}),this.onAdError("could not init adman")}}switchToVideo(e=!1){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_switch_to_video",this.currentAdSection??"","force: "+e],numbers:[(0,m.now)()]}),null===this.currentAdSection&&!e)return void this.log({message:"switch to video, no currentAdSection. can't switch"});let t="postroll"===this.currentAdSection;if(this.actions){if(this.adsState&&this.playerState)this.adsState.playbackState.set("inactive"),this.currentAdSection=null,this.playerState.mobileUnmuteButtonVisible.set(!1),this.log({message:`switch to video, isPostroll: ${t}`}),t&&(this.adsState.postrollPassed.set(!0),this.log({message:"postroll passed"}));else{let e="Switch to video: Adman state was not updated correctly";this.log({message:e}),this.events.error$.next(e)}this.actions.switchFromAdsToVideo?.(!t)}}togglePlay(){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_toggle_play",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.adsState){this.log({message:"toggle play"});let e=sa(this.adsState.playbackState);"playing"===e?this.pause():"paused"===e&&this.play()}else this.onAdError("Can not toggle play: Adman state is not initialized")}setInitialVolume(e){this.log({message:`set initial volume ${e}`}),this.initialVolume=e}setVolume(e){let t=e*this.volumeMultiplier;if(this.log({message:`set volume ${t}`}),this.adman)try{this.adman.setVolume(t)}catch{this.onAdError("could not set ad volume")}this.videoElement&&(this.videoElement.volume=t)}setFullscreen(e){if(this.log({message:`set fullscreen ${e}`}),this.adman)try{this.adman.setFullscreen(e)}catch{this.onAdError("could not set ad fullscreen")}}startPreroll(){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_start_preroll"],numbers:[(0,m.now)()]}),this.adman){if(!this.isDestroyed){this.log({message:"start preroll"}),this.setVolume(this.initialVolume),this.currentAdSection="preroll",this.startWatchDog();try{this.adman.start("preroll")}catch{this.onAdError("could not start preroll")}}}else this.onAdError("Can not start preroll: Adman is not initialized")}startPostroll(){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_start_postroll",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.adman&&this.actions){this.log({message:"start postroll"}),this.actions.switchFromVideoToAds(),this.currentAdSection="postroll",this.startWatchDog();try{this.adman.start("postroll")}catch{this.onAdError("could not start postroll")}}else this.onAdError("Can not start postroll: Adman is not initialized")}startWatchDog(){this.watchDogTimeout&&clearTimeout(this.watchDogTimeout),this.watchDogTimeout=window.setTimeout((()=>this.onAdError("Watchdog timeout")),this.runtimeTimeout)}stopWatchDog(){clearTimeout(this.watchDogTimeout)}play(){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_pplay",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.adman){this.log({message:"ad play"}),this.startWatchDog();try{this.adman.resume(),this.events.resumed$.next()}catch{this.onAdError("could not resume ad")}}else this.onAdError("Can not play: Adman is not initialized")}pause(){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_pause",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.adman){this.stopWatchDog(),this.log({message:"ad pause"});try{this.adman.pause(),this.events.paused$.next()}catch{this.onAdError("could not pause ad")}}else this.onAdError("Can not pause: Adman is not initialized")}skip(){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_skip",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.adman){this.stopWatchDog(),this.log({message:"ad skip"});try{this.adman.skip(),this.events.skipped$.next()}catch{this.onAdError("could not skip ad")}}else this.onAdError("Can not skip: Adman is not initialized")}setPosition(e,t){this.adman?.setPosition(Math.floor(e),Math.floor(t))}destroy(){m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_destroy"],numbers:[(0,m.now)()]}),this.log({message:"destroy"}),this.stopWatchDog(),this.adman?.onReady(void 0),this.adman?.onStarted(void 0),this.adman?.onPlayed(void 0),this.adman?.onPaused(void 0),this.adman?.adMidrollPoint(void 0),this.adman?.onClosed(void 0),this.adman?.onSkipped(void 0),this.adman?.onClicked(void 0),this.adman?.onTimeRemained(void 0),this.adman?.onCompleted(void 0),this.adman?.onError(void 0),this.adman?.destroy(),this.videoElement&&(0,m.clearVideoElement)(this.videoElement),this.isDestroyed=!0}constructor(e,t){this.adman=null,this.initialVolume=1,this.videoElement=null,this.currentAdSection=null,this.actions=null,this.adsState=null,this.playerState=null,this.events={init$:new m.Subject,loadStarted$:new m.Subject,loadEnded$:new m.Subject,loadError$:new m.Subject,ready$:new m.Subject,slotRequested$:new m.Subject,started$:new m.Subject,timeRemained$:new m.Subject,paused$:new m.Subject,resumed$:new m.Subject,ended$:new m.Subject,empty$:new m.Subject,skipped$:new m.Subject,clicked$:new m.Subject,closed$:new m.Subject,error$:new m.Subject},this.loadAdman=e=>(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_load_start",this.useAdmanFromNPM?"npm":"http"],numbers:[(0,m.now)()]}),this.useAdmanFromNPM?this.loadAdmanNPM(e):this.loadAdmanMailRu(e)),this.loadAdmanMailRu=e=>new Promise(((t,r)=>{let a;this.events.loadStarted$.next();let s=()=>{clearTimeout(a),delete window.admanAsyncInit,window.AdmanHTML?(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_async_init_done","http"],numbers:[(0,m.now)()]}),t(),this.events.loadEnded$.next()):(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_init_timed_out","http"],numbers:[(0,m.now)()]}),r())};(0,m.addScript)("//ad.mail.ru/static/admanhtml/rbadman-html5.min.js",e,this.loadTimeout).then((()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_script_loaded","http"],numbers:[(0,m.now)()]}),window.AdmanHTML?(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_already_inited","http"],numbers:[(0,m.now)()]}),t(),this.events.loadEnded$.next()):(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_wait_async_init","http"],numbers:[(0,m.now)()]}),i._dG("admanAsyncInit",s),a=window.setTimeout(s,this.initTimeout))})).catch((e=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_script_load_error","http",String(e)],numbers:[(0,m.now)()]}),r(),clearTimeout(a)}))})),this.loadAdmanNPM=e=>new Promise(((t,r)=>{let a;this.events.loadStarted$.next();let s=()=>{clearTimeout(a),delete window.admanAsyncInit,window.AdmanHTML?(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_init_done","npm"],numbers:[(0,m.now)()]}),t(),this.events.loadEnded$.next()):(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_init_timed_out","npm"],numbers:[(0,m.now)()]}),r())},n=()=>{o=!0,r()},o=!1,l=window.setTimeout((()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_load_timed_out","npm"],numbers:[(0,m.now)()]}),n()}),this.loadTimeout);e.addEventListener("abort",n),e.aborted&&(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_load_aborted","npm"],numbers:[(0,m.now)()]}),n()),i._dG("AdmanHTML",window.AdmanHTML||null),Promise.all([i.e(25153),i.e("langs/web/25153")]).then(i.t.bind(i,25153,19)).then((()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_chunk_imorted","npm","failed: "+String(o)],numbers:[(0,m.now)()]}),!o&&(window.AdmanHTML?(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_already_inited","npm"],numbers:[(0,m.now)()]}),t(),this.events.loadEnded$.next()):(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_wait_async_init","npm"],numbers:[(0,m.now)()]}),i._dG("admanAsyncInit",s),a=window.setTimeout(s,this.initTimeout)))}),n).finally((()=>{clearTimeout(a),clearTimeout(l),e.removeEventListener("abort",n)}))})),this.onAdsReady=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ads_ready"],numbers:[(0,m.now)()]}),this.log({message:"ads ready"}),this.events.ready$.next(),this.startPreroll()},this.onAdStarted=(e,t)=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_started",e,"muted: "+t.muted],numbers:[(0,m.now)(),t.bannerID]}),this.adsState&&this.playerState&&this.actions?(this.log({message:`ad started, section: ${e}, banner: ${JSON.stringify(t)}`}),this.events.started$.next(e),t.muted&&(this.setVolume(0),this.actions.setMuted(!0),this.log({message:"ad muted start"}),sa(this.playerState.isMobile)&&this.playerState.mobileUnmuteButtonVisible.set(!0)),this.adsState.duration.set(t.duration),this.adsState.playbackState.set("playing"),this.adsState.canSkip.set(t.allowClose),this.adsState.secondsToWatchBeforeSkip.set(t.allowCloseDelay),this.startWatchDog()):this.onAdError("Started callback failed: Adman is not initialized")},this.onAdTimeRemained=e=>{this.adsState?(this.adsState.position.set(e.currentTime),this.events.timeRemained$.next(e),this.startWatchDog()):this.onAdError("TimeRemained callback failed: Adman state is not initialized")},this.onAdPaused=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_pased",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.stopWatchDog(),this.adsState?(this.log({message:"ad paused"}),this.adsState.playbackState.set("paused")):this.onAdError("Paused callback failed: Adman state is not initialized")},this.onAdPlayed=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_played",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.startWatchDog(),this.adsState?(this.log({message:"ad played"}),this.adsState.playbackState.set("playing")):this.onAdError("Player callback failed: Adman is not initialized")},this.onAdMidrollPoint=()=>{if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_midroll_pioint"],numbers:[(0,m.now)()]}),this.adman&&this.actions){this.log({message:"midroll point"}),this.actions.switchFromVideoToAds(),this.currentAdSection="midroll",this.startWatchDog();try{this.adman.start("midroll")}catch{this.onAdError("could not start midroll")}}else this.onAdError("Midroll callback failed: Adman is not initialized")},this.onAdSkipped=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_skipped",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.log({message:"ad skipped"}),this.stopWatchDog()},this.onAdClosed=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_closed",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.log({message:"ad closed"}),this.currentAdSection&&this.events.closed$.next(this.currentAdSection),this.stopWatchDog(),this.switchToVideo()},this.onAdCompleted=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_completed",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.log({message:"ad completed"}),this.currentAdSection?this.events.ended$.next(this.currentAdSection):this.events.empty$.next(),this.switchToVideo(),this.stopWatchDog()},this.onAdClicked=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_clicked",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.log({message:"ad clicked"}),this.videoElement?.pause(),this.currentAdSection&&this.events.clicked$.next(this.currentAdSection),this.stopWatchDog()},this.onAdError=(e="ad error")=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_error",e],numbers:[(0,m.now)()]}),this.log({message:e}),this.events.error$.next(e),this.switchToVideo(!0),this.stopWatchDog()},this.log=e.createComponentLog("AdmanWrapper"),m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_created"],numbers:[(0,m.now)()]}),this.loadTimeout=t.loadTimeout,this.initTimeout=t.initTimeout,this.runtimeTimeout=t.runtimeTimeout,this.useAdmanFromNPM=t.useAdmanFromNPM,this.volumeMultiplier=Math.max(0,Math.min(t.volumeMultiplier,1)),this.isVsidOriginal=t.isVsidOriginal}},Ju=e=>{let t=Math.round(e);return isNaN(t)||t<40?"":t>=40&&t<55?50:t>=55&&t<90?60:t>=90&&t<180?120:t>=180?240:""},ed=class{parse(e){let t={startTime:0,endTime:0},i=this.timingRegExp.exec(e);return i&&(t.startTime=this.calcTime(i[1],i[2],i[3],i[4]),t.endTime=this.calcTime(i[6],i[7],i[8],i[9])),t}parseTime(e){let t=this.timeRegExp.exec(e);return t?this.calcTime(t[1],t[2],t[3],t[4]):0}isTime(e){return this.timeRegExp.test(e)}calcTime(e="0",t="0",i="0",r="0"){return 60*Number(e)*60+60*Number(t)+Number(i)+ +`0.${r}`}constructor(){this.timeRegExp=/(\d{2,})?:?(\d{2}):(\d{2}).(\d{2,3})/,this.timingRegExp=new RegExp(`${this.timeRegExp.source}( ?--\x3e ?)${this.timeRegExp.source}`)}},td=class{parse(e){let t={texts:[]},i=e.replace(new RegExp(this.letterTagRegExp,"g"),"").split({[Symbol.split](e){let t=0,i=[];for(;t<e.length;){let r=["<",">"].reduce(((i,r)=>{let a=e.indexOf(r,t);return-1===i||i>a?a:i}),-1);if(-1===r){i.push(e.substring(t));break}i.push(e.substring(t,r)),t=r+1}return i}}),r=new ed;for(let e of i)r.isTime(e)?t.texts.push({type:"timestamp",value:r.parseTime(e)}):t.texts.push({type:"text",value:e});return t}constructor(){this.letterTagRegExp=/<[a-z]*>|<\/[a-z]*>/}},id=class{parse(e,t){let i=[],r=e.split(this.twoLinesRegExp);for(let e of r){let r={startTime:0,endTime:0,texts:[],lang:t},a=e.split(this.oneLineRegExp);for(let e of a)if(r.startTime||r.endTime){if(""!==e.trim()){let t=new td,{texts:i}=t.parse(e);r.texts=[...r.texts,...i]}}else{let t=new ed,{startTime:i,endTime:a}=t.parse(e);r.startTime=i,r.endTime=a}(r.startTime||r.endTime)&&r.texts.length>0&&i.push(r)}return i}constructor(){this.oneLineRegExp=/\r\n|\n|\r/,this.twoLinesRegExp=/\r\n\r\n|\n\n|\r\r/}},rd=0,ad=!1,sd="",nd=(e,t=0,i=0)=>e<t&&e<i,od=(e,t=0,i=0)=>e>=t&&e<=i,ld={ru:"Русский",en:"English",uk:"Українська",be:"Беларуская (тарашкевiца)",es:"Español",fi:"Suomi",de:"Deutsch",it:"Italiano",bg:"Български",hr:"Hrvatski",hu:"Magyar",sr:"Српски",pt:"Português",el:"Ελληνικά",pl:"Polski",fr:"Français",ko:"한국어","zh-CN":"汉语",lt:"Lietuvių",ja:"日本語",cs:"Čeština",et:"Eesti",tt:"Татарча",ba:"Башҡортса",cv:"Чăвашла",sk:"Slovenčina",ro:"Română",no:"Norsk",lv:"Latviešu",az:"Azərbaycan dili",hy:"Հայերեն",sv:"Svenska",nl:"Nederlands",tk:"Türkmen",ka:"ქართული",da:"Dansk",uz:"O‘zbek",th:"ภาษาไทย",id:"Bahasa Indonesia",tg:"Тоҷикӣ",sl:"Slovenščina",bs:"Bosanski","pt-BR":"Português brasileiro",fa:"فارسی",vi:"Tiếng Việt",hi:"हिन्दी",si:"සිංහල",bn:"বাংলা",tl:"Tagalog",mn:"Монгол",my:"ဗမာစာ",tr:"Türkçe",ne:"नेपाली",ur:"اردو",ky:"Кыргыз тили",pa:"پنجابی",os:"Ирон",kn:"ಕನ್ನಡ",sw:"Kiswahili",kk:"Қазақша",ar:"العربية",he:"עברית",ab:"Аҧсшәа",eu:"Euskara",eo:"Esperanto"},ud={abk:"as",ara:"ar",aze:"az",bak:"ba",bel:"be",ben:"bn",bos:"bs",bul:"bg",ces:"cs",chv:"cv",dan:"da",deu:"de",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",fas:"fa",fin:"fi",fra:"fr",heb:"he",hin:"hi",hrv:"hr",hun:"hu",hye:"hy",ind:"id",ita:"it",jpn:"ja",kan:"kn",kat:"ka",kaz:"kk",kir:"ky",kor:"ko",lav:"lv",lit:"lt",mon:"mn",mya:"my",nep:"ne",nld:"nl",nor:"no",oss:"os",pan:"pa",pol:"pl",por:"pt",ron:"ro",rus:"ru",sin:"si",slk:"sk",slv:"sl",spa:"es",srp:"sr",swa:"sw",swe:"sv",tat:"tt",tgk:"tg",tgl:"tl",tha:"th",tuk:"tk",tur:"tr",ukr:"uk",urd:"ur",uzb:"uz",vie:"vi"},dd=e=>ld[e]??ld[ud[e]]??void 0,cd=class{destroy(){this.oneStat.destroy(),this.statSubscription.unsubscribe()}constructor(e,t=new m.Subscription){this.oneStat=e,this.statSubscription=t}},hd=((Yu=hd||{}).DESKTOP_CONTROL_PANEL_LEFT="desktop-control-panel-left",Yu.DESKTOP_CONTROL_PANEL_RIGHT="desktop-control-panel-right",Yu),pd=e=>e??0,fd=(e,t)=>{let i=e?.getBoundingClientRect?.(),r=t?.getBoundingClientRect?.();return{top:Math.round(pd(i?.top)-pd(r?.top)),left:Math.round(pd(i?.left)-pd(r?.left)),bottom:Math.round(pd(i?.bottom)-pd(r?.top)),right:Math.round(pd(i?.right)-pd(r?.left))}},md=e=>{let t=e?.getBoundingClientRect?.();return{width:pd(t?.width),height:pd(t?.height)}},vd=({interfaceLanguage:e,isCyrillicRelatedInterface:t,videoId:i,isClip:r,isLiveCatchUpMode:a,statAuthToken:s,isAudioDisabled:n,canDownload:o,callbacks:l,webApi:u,videoEpisodes:d,previewThumbsData:c,uiConfig:h,coreConfig:p,player:g,disabledControls:b,isInteractive:y,interactiveRanges$:w,isInteractiveTime$:S,replayInteractive:x,stopPlayer:$,hasInteractiveBranches:_,playPrevChapterDisabledTooltip:k,additionalButtons:T,additionalSettingsMenuItems:C,additionalContextMenuItems:E,playPrevVideo:A,playNextVideo:L,looped:P=!1,statistics:M,saveRate:I,internalsExposure:R})=>{let V={...p,configName:[...p.configName??[],"ui"],isAudioDisabled:n,live:{...p.live??{},isLiveCatchUpMode:!!a}},N=h,B=m.Tracer.createRootTracer(N.features.saveTraceInfoToFile),D=B.createComponentTracer("Store"),O=g||new f.Player(V,B);R?.expose({corePlayer:O});let F,j,z=new m.Logger,U=new Xu(z,{loadTimeout:N.ads.loadTimeout,initTimeout:N.ads.initTimeout,runtimeTimeout:N.ads.runtimeTimeout,useAdmanFromNPM:N.ads.useAdmanFromNPM,volumeMultiplier:N.ads.volumeMultiplier,isVsidOriginal:N.ads.isVsidOriginal}),q=Fs.getInstance(),H=u?.pictureInPictureApi,W=u?.annotationsApi,Q=z.createComponentLog("Store"),G={},K=new Ua,Y=M?ja(M.oneStat.vsid$):ia(void 0),Z=ra(Hs()),X=ra(!1),J=H?.info.isActive$??new m.ValueSubject(!1),ee=ra(0),te=ra([]),ie=(0,m.merge)(O.events.fatalError$,O.events.managedError$).subscribe((e=>te.update((t=>[...t,e])))),re=ia(!1,(e=>{let t=O.events.fatalError$.subscribe((()=>e(!0)));return()=>t.unsubscribe()})),ae=async e=>{let t=Object.values(m.InterfaceLanguage).includes(e);if(N.downloadVKLanguages&&(t&&N.updateBuiltinLanguages||!Ts(e))){let t;try{t=await(0,m.loadVKLangPack)(e,"videoplayer","videoplayer")}catch(e){M?.oneStat?.logError({errorType:"VKLangPack",fatal:!1}),q?.report(e,{errorType:"VKLangPack",fatal:!1})}t&&(ks({language:e,pack:t,fallback:N.defaultLanguage}),se.set(e))}Ts(e)&&se.set(e)},se=ra(e),ne=ra(t);ae(e);let oe=(e,t)=>{let i=sa(se);return Cs(i,e,t,N.defaultLanguage)},le=ra("thumb"),ue=(()=>{let e=aa([re,le],(([e,t])=>e?"crashed":t));return{...e,is:t=>sa(e)===t}})(),de=(()=>{let e=ra(new Set(b));return{...e,add:t=>{e.update((e=>new Set([...e].concat(t))))},remove:t=>{e.update((e=>{let i=[...e];return new Set(Array.isArray(t)?i.filter((e=>!t.includes(e))):i.filter((e=>e!==t)))}))},includes:t=>{let i=sa(e);return Array.isArray(t)?t.every((e=>i.has(e))):i.has(t)}}})();D.log("create store"),Q({message:"create store"});let ce=new m.Subject,he=new m.Subject,pe=new m.Subject,fe=new m.Subject,me=null,ve={actionRewind$:he,actionSeek$:pe,inPiP$:J,inFullscreen$:new m.Observable((e=>Z.subscribe((t=>e.next(t))))),actionSetSubtitle$:fe,nextMovie$:ce};if(M){let{oneStat:e,statSubscription:t}=M;y||t.add(e.attachTo(O)),t.add(e.attachToUi(ve)),t.add(e.attachToAds(U.events)),e.authorize(s).catch((e=>{Q({message:`onestat auth error ${String(e)}`})}))}if(q){let e=new m.Subscription,t=(t,i)=>e.add(t.subscribe(i));if(t(O.events.managedError$,(e=>{q.logIError(e)})),t(O.events.fatalError$,(e=>{q.logIError(e,!0)})),M){let{oneStat:e}=M;t(e.experimental.error$,(e=>{q.logIError(e)}))}q.sentrySubscription.add(e)}let ge=()=>{f.clientChecker.device.isIOS&&j&&(e=>{let t=e;return t?.webkitExitFullscreen?t?.webkitExitFullscreen():Promise.reject()})(j).catch((e=>{Q({message:`exitIosSafariFullscreen failed: ${e}`})}))},be=(new m.Subscription).add(O.experimental.element$.subscribe((e=>{e&&(j=e,e.classList.add("player-media"),Ks(H)&&(H.updateVideoElement(),H.registryEventHandlers()),y&&e.setAttribute("pip","false"))}))).add(O.events.ended$.subscribe((()=>{ge(),l?.onEnded?.()}))).add(O.events.looped$.subscribe((()=>{l?.onLooped?.()}))).add(O.events.started$.subscribe((async()=>{Ks(H)&&await(H?.revealPictureInPicture());let e=O.info.muted$.getValue();l?.onStarted?.(),G.onStarted?.(e)}))).add(O.events.willSeek$.subscribe((({from:e,to:t})=>{l?.onSeek?.(e,t)}))).add(O.events.autoplaySoundProhibited$.subscribe((()=>{l?.onAutoplaySoundProhibited?.()}))).add(O.info.position$.subscribe((e=>{let t=O.info.duration$.getValue();isFinite(t)&&t>0&&(l?.onTimeupdate?.(t,e),U.setPosition(e,t))}))).add(O.events.fatalError$.subscribe((e=>{l?.onCrashed?.(e?`${e.id}: ${e.message}`:void 0)}))).add(O.events.fetcherRecoverableError$.subscribe((e=>{l?.onRecoverableError?.(e?`${e.id}: ${e.message}`:void 0)}))).add(O.events.loadedMetadata$.subscribe((()=>{wi.state.loadedMetadata$.set(!0)}))).add(O.info.is3DVideo$.subscribe((e=>{wi.ui.is3DVideo.set(e)}))).add(O.info.isEnded$.subscribe((e=>{y&&(e?(S?.getValue()&&de.add(Pa),de.add("PLAY_BUTTON")):de.remove("PLAY_BUTTON"))}))).add(O.info.liveTime$.subscribe((e=>{l?.onLiveTime?.(e)}))).add(O.info.isStalled$.subscribe((e=>{l?.onStalledChanged?.(e)}))).add(O.info.isLiveEnded$.subscribe((e=>e&&l?.onLiveEnded?.()))).add(U.events.loadStarted$.subscribe((()=>l?.adsInfo?.onLoadStarted?.()))).add(U.events.loadEnded$.subscribe((()=>l?.adsInfo?.onLoadEnded?.()))).add(U.events.loadError$.subscribe((()=>l?.adsInfo?.onLoadError?.()))).add(U.events.init$.subscribe((()=>l?.adsInfo?.onInit?.()))).add(U.events.ready$.subscribe((()=>l?.adsInfo?.onReady?.()))).add(U.events.started$.subscribe((e=>l?.adsInfo?.onStarted?.(e)))).add(U.events.timeRemained$.subscribe((e=>l?.adsInfo?.onTimeRemained?.(e)))).add(U.events.ended$.subscribe((e=>l?.adsInfo?.onCompleted?.(e)))).add(U.events.empty$.subscribe((()=>l?.adsInfo?.onEmpty?.()))).add(U.events.clicked$.subscribe((e=>l?.adsInfo?.onClicked?.(e)))).add(U.events.closed$.subscribe((e=>l?.adsInfo?.onClosed?.(e)))).add(U.events.error$.subscribe((e=>l?.adsInfo?.onError?.(e)))).add(U.events.paused$.subscribe((()=>l?.adsInfo?.onPaused?.()))).add(U.events.resumed$.subscribe((()=>l?.adsInfo?.onResumed?.()))),ye=new m.Subscription,we=ia(O.info.position$.getValue(),(e=>{let t,i,r=()=>{let a=O.info.playbackState$.getValue(),s=O.info.isLive$.getValue(),n=O.info.duration$.getValue(),o=O.info.position$.getValue();if(a&&[f.PlaybackState.PLAYING,f.PlaybackState.PAUSED].includes(a)){let t=s?o-n:O.getExactTime();t!==i&&e(t),i=t}t=requestAnimationFrame(r)};return r(),()=>cancelAnimationFrame(t)})),Se=ja(O.info.playbackState$),xe=ja(O.info.currentBuffer$),$e=ja(O.info.isEnded$),_e=ja(O.info.isLive$),ke=N.features.playbackRate?ja(O.info.canChangePlaybackSpeed$):ia(!1),Te=ja(O.info.liveBufferTime$),Ce=ja(O.info.volume$),Ee=ja(O.info.muted$),Ae=za(O.info.predefinedQualityLimitType$.pipe((0,m.map)((e=>e===f.PredefinedQualityLimits.TRAFFIC_SAVING))),O.info.predefinedQualityLimitType$.getValue()===f.PredefinedQualityLimits.TRAFFIC_SAVING),Le=za(O.info.predefinedQualityLimitType$.pipe((0,m.map)((e=>e===f.PredefinedQualityLimits.HIGH_QUALITY))),O.info.predefinedQualityLimitType$.getValue()===f.PredefinedQualityLimits.HIGH_QUALITY),Pe=ja(O.info.autoQualityLimitingAvailable$),Me=ja(O.info.availableQualities$),Ie=ja(O.info.availableQualitiesFps$),Re=ja(O.info.chromecastState$),Ve=ja(O.info.chromecastDeviceName$),Ne=ja(O.info.currentFormat$),Be=ja(O.info.throughputEstimation$),De=ja(O.info.videoBitrate$),Oe=ja(O.info.intrinsicVideoSize$),Fe=ja(O.info.duration$),je=ja(O.info.isAudioAvailable$),ze=null,Ue=O.info.isBuffering$,qe=ia(Ue.getValue(),(e=>{let t=Ue.subscribe((t=>{t&&null===ze?ze=window.setTimeout((()=>{e(Ue.getValue()),ze=null}),N.loaderDelay):e(t)}));return()=>{t.unsubscribe(),ze&&clearTimeout(ze)}})),He=aa([Fe,_e],(([e,t])=>t?-e:e)),We=aa([Se],(([e])=>e===f.PlaybackState.PLAYING)),Qe=ja(O.info.atLiveEdge$),Ge=ja(O.info.atLiveDurationEdge$),Ke=ja(O.info.position$),Ye=aa([Ke,Fe],(([e,t])=>isFinite(e)&&isFinite(t)&&!!t)),Ze=aa([Re],(([e])=>e===f.ChromecastState.CONNECTED)),Xe=ja(O.info.availableVideoStreams$),Je=N.features.audioLanguages?ja(O.info.availableAudioStreams$):ia([]),et=ja(O.info.currentVideoStream$),tt=ja(O.info.currentAudioStream$),it=e=>{let t;if(1===e.length&&(t=e.at(0)),t??(t=e.find((e=>"isDefault"in e&&e.isDefault))),t)return t;let i=m.safeStorage.get(Ya);return i&&(t=e.find((({language:e})=>i===e))),t??(t=e.at(0)),t},rt=!1;be.add(O.info.availableAudioStreams$.subscribe((e=>{if(!rt&&e.length){let t=it(e);t&&(O.setAudioStream(t),rt=!0)}})));let at=!1;be.add(O.info.availableVideoStreams$.subscribe((e=>{if(!at&&e.length){let t=it(e);t&&(O.setVideoStream(t),at=!0)}})));let st=ra(void 0),nt=ja(O.info.isAutoQualityEnabled$,(e=>e&&st.set(void 0))),ot=ja(O.info.currentQuality$,(()=>st.set(void 0))),lt=aa([st,ot],(([e,t])=>e??t)),ut=aa(Ne,(e=>e!==f.VideoFormat.MPEG)),dt=aa([Me,Ie,nt,lt,ut],(([e,t,i,r,a])=>{let s=[];a&&s.push({value:"auto",displayValue:oe("auto_quality_option"),selected:i});let n=e.filter((e=>!(0,m.isInvariantQuality)(e)));for(let e of n){let a=t[e];s.push({value:e,displayValue:`${e}${a?Ju(a):""}`,selected:!i&&e===r})}return s})),ct=ja(O.info.currentPlaybackRate$),ht=aa([ct,Qe,Ge],(([e,t,i])=>{let r=i||y?1:N.controls.playbackRateMin,a=t?1:N.controls.playbackRateMax,s=N.controls.playbackRateStep,n=[];for(let t=r;t<=a;t+=s)n.push({value:t,displayValue:1===t?oe("playback_rate_1"):oe("playback_rate",{multiplier:t.toString(10)}),selected:e===t});return n})),pt={displayValue:oe("subtitles_off"),value:"off"},ft=ra({...pt}),mt=N.features.subtitles?ja(O.info.availableTextTracks$):ia([]),vt=(()=>{let e=[],t=0;return{add:(i,r)=>{e[t]=[i,r],t=(t+1)%10},find:t=>e.find((([e])=>e===t))}})(),gt=aa([mt,ft],(([e,t],i)=>{let r=[],a=e.find((({id:e})=>e===t.value));if(a?.url){let[,e]=vt.find(a.url)??[];if(e)return void i(e);K.download(a.url).then((e=>{if(!e||K.isDestroyed())return;let s=new id,n=a.language;if(n){let t=!!a.isAuto,i=s.parse(e,n);r.push({lang:n,subtitles:i,isAuto:t,id:a.id})}vt.add(a.url,r),sa(ft).value===t.value&&i(r)})).catch((e=>{M?.oneStat?.logError({errorType:"Subtitles download",fatal:!1}),q?.report(e,{errorType:"Subtitles download",fatal:!1})}))}i(r)})),bt=aa([ct,We,ft],(([e,t,i],r)=>{let a;if(O.info.isLive$.getValue()&&t&&i.value!==pt.value){let t=()=>{a=setTimeout(t,1e3/(3*e)),r(Date.now())};return t(),()=>clearTimeout(a)}})),yt=aa([mt,ft],(([e,t])=>{if(!e.length)return[];let i=[];for(let{language:r,isAuto:a,id:s}of e){let e=r&&dd(r);r&&e&&i.push({displayValue:a?oe("subtitles_auto",{language:e}):e,value:s,selected:t?.value===s,isAuto:a})}return i.length?(i.unshift({...pt,selected:t?.value===pt.value}),i):[]})),wt={available:[],prev:[]},St=aa([we,ft,gt,bt],(([e,t,i,r])=>{let a=O.info.isLive$.getValue();if(a&&wt.prev!==i){let e=i.find((({id:e})=>e===t.value)),r=wt.prev.find((({id:e})=>e===t.value));if(e){let t={...e,subtitles:[...r?.subtitles??[],...e.subtitles]};wt.available=[t],wt.prev=i}}if(t&&t.value!==pt.value){let r=a?O.experimental.getCurrentTime$.getValue()?.()??j?.currentTime??0:e,s=a?wt.available:i;return((e,t,i,r=!1)=>{let a=i.find((({id:e})=>e===t.value))?.subtitles;if(r)return a?.find((({startTime:t,endTime:i})=>od(e,t,i)));let s=e>=rd,n=e<rd;return rd=e,n&&(ad=!1),(0,m.isNonNullable)(Gu)&&od(e,Gu.startTime,Gu.endTime)&&sd===t.value?Gu:(0,m.isNonNullable)(Ku)||!a?.length||ad?od(e,Ku?.startTime,Ku?.endTime)?(Gu=Ku,Ku=void 0,sd=t.value,Gu):void((s&&((e,t=0,i=0)=>e>t&&e>i)(e,Ku?.startTime,Ku?.endTime)||n&&nd(e,Ku?.startTime,Ku?.endTime))&&(Ku=void 0)):(Ku=a.find((({startTime:t,endTime:i})=>od(e,t,i)||s&&nd(e,t,i))),Gu=void 0,void(!(0,m.isNonNullable)(Ku)&&a[a.length-1].endTime<e&&(ad=!0)))})(r,t,s,a)}})),xt=aa([St],(([e])=>e?.texts?e.texts:[])),$t=ra(!0),_t=aa([xe,He,Ke,Te],(([e,t,i,r])=>{let a=e?.end??0;return r?(a-(-i+r-t))/t:a/t})),kt=ja(O.info.availableSources$),Tt=aa([kt],(([e])=>Object.keys(e?.[f.VideoFormat.MPEG]||{}).length>0)),Ct=()=>{let e=Math.max(N.volumeMinRestore,ts()??0);return 0===e?N.volumeDefault:e},Et=e=>{let t=0===e?Ct():e,i=O.info.muted$.getValue();Q({message:`set volume, volume: ${e}, preferredVolume: ${t}`}),i&&e>0&&!n&&(i=!1,os(!1)),O.setVolume(e,i),U.setVolume(e),es(t)},At=e=>{let t=O.info.volume$.getValue();if(Q({message:`set muted, currentVolume: ${t}, mute: ${e}`}),O.setMuted(e),U.setVolume(e?0:t),os(e),!e&&0===t){let e=Ct();O.setVolume(e),es(e),U.setVolume(e)}},Lt=ra(!1),Pt=e=>{D.log("set looped",{isLooped:e}),Lt.set(e),O.setLooped(e)};Pt(P);let Mt,It,Rt=e=>{let{isMobile:t,features:{playbackStatusNextVideoShow:i,playbackStatusShow:r}}=N;return!(!i||!r||t)&&(wi.ui.aboutToGoNextVideo.set(e),wi.ui.userActionsDisabled.set(!0),!0)},Vt=(e,{changeReason:t="default",appliesTo:r="to-video"}={})=>{Q({message:`set quality, quality: ${e}`}),D.log("set quality",{quality:e}),O.setAutoQuality("auto"===e),"auto"!==e?(N.features.qualityDetailsSubMenuEnabled?(ps({type:"exact_quality",quality:e,videoId:i},r),rs(),O.setPredefinedQualityLimits(f.PredefinedQualityLimits.UNKNOWN)):is(i,e),st.set(e),O.setQuality(e)):N.features.qualityDetailsSubMenuEnabled?"default"===t&&(Ot("auto_quality",r),sa(Ae)&&Nt(!1),sa(Le)&&Bt(!1)):rs()},Nt=(e,t="as-default")=>{Q({message:`set trafficSavingEnabled, value: ${e}`}),D.log("set traffic saving enabled",{trafficSavingEnabled:e});let i=e?f.PredefinedQualityLimits.TRAFFIC_SAVING:f.PredefinedQualityLimits.UNKNOWN;N.features.qualityDetailsSubMenuEnabled?(Dt(i,t),ls(!1)):(O.setPredefinedQualityLimits(i),ls(e))},Bt=(e,t="as-default")=>{Q({message:`set highQualityEnabled, value: ${e}`}),D.log("set high quality enabled",{highQualityEnabled:e}),Dt(e?f.PredefinedQualityLimits.HIGH_QUALITY:f.PredefinedQualityLimits.UNKNOWN,t)},Dt=(e,t)=>{e!==f.PredefinedQualityLimits.UNKNOWN&&(sa(Pe)&&!sa(nt)&&Vt("auto",{appliesTo:t,changeReason:"limit-changed"}),Ot(e,t)),O.setPredefinedQualityLimits(e)},Ot=(e,t)=>{ps({type:e,videoId:i},t),"as-default"===t&&ps({type:e,videoId:i},"to-video")},Ft=e=>{D.log("set playback rate",{playbackRate:e}),O.setPlaybackRate(e),N.features.saveRate&&I&&!O.info.isLive$.getValue()&&(e=>{m.safeStorage.set(Za,JSON.stringify({rate:e}))})(e)},jt=(e={...pt,selected:!1})=>{D.log("set subtitles",{...e}),e&&e.value!==pt.value&&fe.next(e.isAuto?e.value+"_auto":e.value),ft.set(e)},zt=(e,t,i=!0)=>{if(Q({message:`seek to time, time: ${e}`}),D.log("seek to time",{time:e,action:t,forcePrecise:i}),pe.next(t),O.info.isLive$.getValue()){let t=O.info.duration$.getValue(),r=Math.min(0,t+e);O.seekTime(r,i)}else{if(S?.getValue())return;O.info.isEnded$.getValue()&&(Q({message:"seek after ended, call callbacks.onPlay"}),l?.onPlay?.()),O.seekTime(yi(e),i)}},Ut=(e,t)=>{Q({message:`seek to percent, percent: ${e}`}),D.log("seek to percent",{percent:e,action:t});let i=sa(He)*e;zt(i,t,!1)},qt=ra(void 0),Ht=ra(!1),Wt=e=>{qt.set(e)},Qt=()=>{qt.set(void 0),Ht.set(!1)},Gt=()=>{clearTimeout(It),clearTimeout(Mt),Mt=window.setTimeout((()=>{Qt()}),500),j?.removeEventListener("seeked",Gt)},Kt=aa([we,He,qt],(([e,t,i],r)=>{r((0,m.isNonNullable)(i)?i*t:e)})),Yt=ra(!1),Zt=ra({width:0,height:0}),Xt=aa([Zt],(([{width:e}],t)=>{let i=(e=>e>699?"xl":e>599?"l":e>509?"m":e>320?"s":"xs")(e);t(i)})),Jt=ra(!1),ei=T.filter((e=>(e=>!e.type)(e))),ti=aa([Xt,Jt],(([e,t])=>t?ei.filter((e=>!e.hideOnMobile)):ei.filter((t=>!t.hideOnDesktopGridTypes?.includes(e))))),ii=ra(T.filter((e=>(e=>!!e.type)(e)))),ri=aa([ii,Xt],(([e,t])=>e.filter((e=>!e.hideOnDesktopGridTypes?.includes(t))))),ai=aa([ri,ti],(([e,t])=>[...N.features.additionalButtonsDesktopControlPanelRight?e.filter((e=>"desktop-control-panel-right"===e.type)):[],...N.features.additionalButtons?t.map(((e,t)=>({id:t,weight:t,type:"desktop-control-panel-right",testId:e.testId,icon:e.iconUrl,onClick:e.onClick,ariaLabel:e.ariaLabel??e.tooltip,tooltipText:e.tooltip}))):[]])),si=ra(C),ni=aa([si],(([e])=>N.features.additionalSettingsMenuItems?e.map((e=>"SWITCH"===e.type?{...e,onClick:e.onChangeEnabled}:e)):[])),oi=ra(E),li=aa([oi],(([e])=>N.features.additionalContextMenuItems?e:[])),ui=aa([Jt,re],(([e,t],i)=>{i(e&&t)})),di=()=>j,ci=e=>{if((0,m.assertNonNullable)(wi),O.info.isEnded$.getValue())return;let t=!e;if("ads"===sa(wi.playerPhase))return Q({message:`pause ads, internalCall: ${t}`}),D.log("pause ads",{internalCall:t}),void U.pause();Q({message:`pause video, internalCall: ${t}`}),D.log("pause video",{internalCall:t}),t&&l?.onPause?.(),O.pause()},hi=e=>{(0,m.assertNonNullable)(wi);let t=!e;if("ads"===sa(wi.playerPhase))return Q({message:`play ads, internalCall: ${t}`}),D.log("play ads",{internalCall:t}),void U.play();Q({message:`play video, internalCall: ${t}`}),D.log("play video",{internalCall:t}),t&&l?.onPlay?.(),O.play()},pi=(e,t)=>{(0,m.assertNonNullable)(wi),Q({message:`first start, show ads: ${e}, internalCall: ${!t}`}),D.log("first start",{showAds:e,external:t}),e?le.set("ads"):(le.set("video"),t?O.play():wi.actions.internal.togglePlay())},fi=()=>(Q({message:"getting time codes"}),d),mi=()=>{let e=fi();if(!e||[0,1].includes(e.length))return;let t=O.info.position$.getValue();return e.find((e=>e.time>t))},vi=()=>{let e=fi();if(!e||[0,1].includes(e.length))return;let t=O.info.position$.getValue(),i=e.findIndex((e=>e.time>t)),r=-1===i?e.length-2:i-2;return r<0?void 0:e[r]},gi=ra([]);w?.subscribe((e=>{let t=[];for(let i=0;i<e.length;i++){let{range:[r,a],subjects:s}=e[i];0===i&&0!==r&&t.push({time:0,text:"",interactive:!1,completed:!0}),t.push({time:r/1e3,text:"",interactive:!0,completed:N.features.interactiveTimeOpenUri?!s.length||s.every((e=>e.isRemoved)):!s.length}),a!==1/0&&t.push({time:a/1e3,text:"",interactive:!1,completed:!0})}gi.set(t)}));let bi=ra(!1);S?.subscribe((e=>{e&&sa(Ht)&&Qt()}));let yi=e=>{if(!y)return e;let t=sa(gi),i=sa(He),r=sa(Ke)/i,a=t.find((e=>e.interactive&&!e.completed&&e.time>r));return"number"==typeof a?.time?Math.min(e,a.time-.05):e},wi={interfaceLanguage$:se,isCyrillicRelatedInterface$:ne,initVideo:e=>{Q({message:`init video, config: ${JSON.stringify(e)}`}),y?(e=>{let t=e.container;t.append(O.experimental.element$.getValue()),me=new MutationObserver((e=>{let{removedNodes:i}=e[0];i.length&&t.append(O.experimental.element$.getValue())})),me.observe(t,{childList:!0})})(e):(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","core_init_video"],numbers:[(0,m.now)()]}),O.initVideo(e)),D.log("init video",{isInteractive:y}),e.subtitles&&O.setExternalTextTracks(e.subtitles),F=e},videoId:i,isClip:r,playerPhase:ue,vsid:Y,state:{positionExact$:we,positionWithScrubbing$:Kt,duration$:He,playbackState$:Se,isPlaying$:We,isLoaderVisible:qe,bufferedProgress$:_t,isLive$:_e,canChangePlaybackSpeed$:ke,isActiveLive$:Qe,isOldestAvailableLive$:Ge,isRewindableLive$:Ye,isEnded$:$e,muted$:Ee,volume$:Ce,trafficSavingEnabled$:Ae,highQualityEnabled$:Le,autoQualityLimitingAvailable$:Pe,availableVideoStreams$:Xe,availableAudioStreams$:Je,videoStream$:et,audioStream$:tt,currentQuality$:lt,isAutoQualityEnabled$:nt,availableQualities$:dt,currentPlaybackRate$:ct,availablePlaybackRates$:ht,currentSubtitle$:ft,availableTextTracks$:mt,availableSubtitlesList$:yt,currentSubtitleCaptions$:xt,isAutoSubtitleCaptionVisible$:$t,chromecastState$:Re,chromecastDeviceName$:Ve,chromecastConnected$:Ze,currentFormat$:Ne,throughputEstimation$:Be,videoBitrate$:De,videoSize$:Oe,errorLog$:te,crashed$:re,isAudioAvailable$:je,isAudioDisabled:!!n,canDownload:N.features.download&&!!o,availableSources$:kt,hasMpegSources$:Tt,isInteractive:y,showInteractiveGraph:N.features.interactiveGraph,showSeekToInteractive:N.features.seekToInteractive,showPlayPrevChapter:N.features.interactivePlayPrevChapter,showInteractiveTimeIndicator:N.features.interactiveTimeIndicator&&!!sa(gi).length,interactiveEpisodes$:gi,isInteractiveTime$:S?ja(S):ra(!1),isInteractiveExpectation$:bi,hasInteractiveBranches:_,playPrevChapterDisabledTooltip:k,looped$:Lt,loadedMetadata$:ra(!1),isAutoQualityAvailable$:ut},ui:{t:oe,controlsVisible:ra(!1),touched:ra(!1),controls:{prevButton:ra(void 0),playButton:ra(void 0),replayButton:ra(void 0),nextButton:ra(void 0),playPrevChapterButton:ra(void 0),seekToInteractiveButton:ra(void 0),interactiveGraphButton:ra(void 0),liveButton:ra(void 0),time:ra(void 0),episodes:ra(void 0),volume:ra(void 0),subtitles:ra(void 0),settings:ra(void 0),context:ra(void 0),chromecast:ra(void 0),pip:ra(void 0),fullscreen:ra(void 0),vkLogo:ra(void 0),interactiveTimeIndicator:ra(void 0),timeline:ra(void 0),autoplayNextToggle:ra(void 0),additionalButtons:T.length?T.reduce((e=>[...e,ra(void 0)]),[]):[],disabledControls$:de},modals:{hotKeyMap:{show:ra(!1),data:ra({title:"",closeBtnText:"",groups:[]})}},isFullscreen:Z,isFullscreenOpenedByKeyboard:X,rotateAlpha:ee,isAutoplay:ra(!1),debugPanelVisible:ra(!1),episodes:{panelOpened$:ra(!1),openedByKeyboard$:ra(!1)},contextMenu:{visible$:ra(!1),btnRef$:ra(void 0),openedByBtnKeyboard$:ra(!1),openedByHotKey$:ra(!1),lastActiveElem$:ra(void 0),showContextMenuBtn$:ra(!1),position$:ra({top:0,left:0})},playerSize:Zt,isMobile:Jt,mobileNotReportControlHidden$:ui,mobileUnmuteButtonExpanded:ra(!1),mobileUnmuteButtonVisible:ra(!1),icon3DVideoVisible:ra(!1),scrubbingInProgress:Ht,volumeChangingInProgress:Yt,is3DVideo:ra(!1),currentGridType$:Xt,additionalButtonsDeprecated$:ti,additionalDesktopControlPanelRightButtons$:ai,additionalSettingsMenuItems$:ni,additionalContextMenuItems$:li,interactiveHideMobileControls:ra(!1),overlayContainer$:ra(void 0),startedByKeyboard$:ra(!1),autoplayNextEnabled$:ra(!1),timerNextVideoRunning$:ra(!0),settingsMenu:{visible$:ra(!1),ref$:ra(void 0),openedByBtnKeyboard$:ra(!1)},settingsSubMenu:{visible$:ra(!1),ref$:ra(void 0),name$:ra(void 0)},aboutToGoNextVideo:ra(void 0),userActionsDisabled:ra(!1)},ads:{position:ra(0),duration:ra(0),playbackState:ra("inactive"),canSkip:ra(!1),secondsToWatchBeforeSkip:ra(0),postrollPassed:ra(!1)},webApi:{pictureInPictureApi:H,annotationsApi:W},actions:{internal:{preload:()=>{O.prepare()},firstStart:e=>pi(e,!1),play:()=>hi(!1),pause:()=>ci(!1),togglePlay:()=>{(0,m.assertNonNullable)(wi);let e=sa(wi.ui.controls.disabledControls$),t=sa(wi.playerPhase),i={playerPhase:t,isInteractive:y,isVideoEnded:!1,action:"none"};if(e.has("PLAY_BUTTON"))return;if(Q({message:"toggle play"}),"ads"===t)return i.action="play",D.log("toggle adman play",i),void U.togglePlay();let r=()=>{Q({message:"toggle play, call player.play"}),i.action="play",O.play(),l?.onPlay?.()};if(O.info.isEnded$.getValue()){if(Q({message:"toggle play, video ended, seek to 0"}),he.next(),pe.next(v.SeekAction.REWIND),y)return void x?.();O.seekTime(0),r()}else O.info.playbackState$.getValue()!==f.PlaybackState.PLAYING?r():(Q({message:"toggle play, call player.pause"}),i.action="pause",O.pause(),l?.onPause?.());D.log("toggle play",i)},toggleMuted:()=>{Q({message:"toggle muted"});let e=O.info.muted$.getValue();0!==O.info.volume$.getValue()||e?At(!e):Et(Ct())},openSettingsMenu:async(e,t=()=>Promise.resolve())=>{wi.ui.settingsMenu.openedByBtnKeyboard$.set(!!e),wi.ui.settingsMenu.visible$.set(!0),await t();let i=sa(wi.ui.settingsMenu.ref$),r=di();if(l?.uiInfo?.onSettingsMenu&&i&&r){let e=md(i),t=fd(i,r);l.uiInfo.onSettingsMenu({visible:!0,size:e,position:t,name:"settings"})}D.log("open settings menu",{wasOpenedByKeyboard:e})},closeSettingsMenu:()=>{if(wi.ui.settingsMenu.visible$.set(!1),!sa(wi.ui.settingsSubMenu.visible$)){let e=sa(wi.ui.settingsMenu.ref$);if(l?.uiInfo?.onSettingsMenu&&e){let t=md(e),i={top:0,left:0,bottom:0,right:0};l.uiInfo.onSettingsMenu({visible:!1,size:t,position:i,name:"settings"})}}D.log("close settings menu")},openSettingsSubMenu:(e,t)=>{wi.ui.settingsSubMenu.visible$.set(!0),wi.ui.settingsSubMenu.ref$.set(t),wi.ui.settingsSubMenu.name$.set(e);let i=di();if(l?.uiInfo?.onSettingsMenu&&t&&i){let r=md(t),a=fd(t,i);l.uiInfo.onSettingsMenu({visible:!0,name:e,size:r,position:a})}D.log("open settings sub menu",{name:e})},closeSettingsSubMenu:(e,t=!1)=>{wi.ui.settingsSubMenu.visible$.set(!1);let i=sa(wi.ui.settingsMenu.ref$),r=di(),a=sa(wi.ui.settingsMenu.visible$);if(l?.uiInfo?.onSettingsMenu&&i&&r)if(a&&!t){let e=md(i),t=fd(i,r);l.uiInfo.onSettingsMenu({visible:!0,size:e,position:t,name:"settings"})}else{let t=md(e),i={top:0,left:0,bottom:0,right:0},r=sa(wi.ui.settingsSubMenu.name$);l.uiInfo.onSettingsMenu({visible:!1,size:t,position:i,name:r})}D.log("close settings sub menu")},setVolume:Et,startVolumeChanging:()=>{Yt.set(!0)},stopVolumeChanging:()=>{Yt.set(!1)},setVideoStream:e=>{e.language&&ds(e.language),O.setVideoStream(e)},setAudioStream:e=>{e.language&&ds(e.language),O.setAudioStream(e)},setQuality:Vt,setTrafficSavingEnabled:Nt,setHighQualityEnabled:Bt,setPlaybackRate:Ft,incrementPlaybackRate:()=>{let e=sa(ht),t=e.findIndex((({selected:e})=>e));if(t===e.length-1)return;let i=e[t+1];Ft(i.value)},decrementPlaybackRate:()=>{let e=sa(ht),t=e.findIndex((({selected:e})=>e));if(0===t)return;let i=e[t-1];Ft(i.value)},setSubtitle:jt,toggleSubtitle:()=>{D.log("toggle subtitles");let e=sa(yt),t=sa(ft),i=sa(se);if(t?.value===pt.value){let t=e.filter((e=>e.value!==pt.value)).find((e=>e.value===i))||e[1];jt(t)}else jt()},togglePictureInPicture:async()=>{let e=H?.isActive(),t="none";H?.isActive()?(t="remove",await(H?.remove())):(t="request",await(H?.request())),D.log("toggle picture in picture",{isActive:e,action:t})},startScrubbing:e=>{Q({message:`start scrubbing, progress: ${e}`}),D.log("start scrubbing",{progress:e}),Ht.set(!0),Wt(e)},progressScrubbing:Wt,completeScrubbing:e=>{Q({message:`complete scrubbing, progress: ${e}`}),D.log("complete scrubbing",{progress:e}),Ut(e,v.SeekAction.SLIDER),sa(wi.ui.isMobile)&&sa(wi.state.currentFormat$)===f.VideoFormat.HLS?(j?.addEventListener("seeked",Gt),It=window.setTimeout((()=>{Gt()}),300)):Qt()},toggleChromecast:()=>{Q({message:"toggle chromecast"}),D.log("toggle chromecast"),O.toggleChromecast()},switchToActiveLive:()=>{pe.next(v.SeekAction.LIVE),Q({message:"switch to active live"}),D.log("switch to active live"),O.seekTime(0),O.info.playbackState$.getValue()!==f.PlaybackState.PLAYING&&wi.actions.internal.togglePlay()},switchFromAdsToVideo:(e=!0)=>{(0,m.assertNonNullable)(wi),Q({message:`switch from ads to video, callPlay: ${e}`}),D.log("switch from ads to video",{callPlay:e}),le.set("video"),e&&O.play()},switchFromVideoToAds:()=>{(0,m.assertNonNullable)(wi),Q({message:"switch from video to ads"}),D.log("switch from video to ads"),wi.actions.internal.pause(),ge(),le.set("ads")},skipAd:()=>{D.log("skip adman"),U.skip()},setLiveWaitingStart:e=>{(0,m.assertNonNullable)(wi);let t=e?"LiveWaitingStart":"thumb";D.log("set live waiting start",{state:e,playerPhase:t}),le.set(t)},setLiveWaitingRecover:e=>{(0,m.assertNonNullable)(wi);let t=e?"LiveWaitingRecover":"thumb";D.log("set live waiting recover",{state:e,playerPhase:t}),le.set(t)},setLiveWaitingRecord:e=>{(0,m.assertNonNullable)(wi);let t=e?"LiveWaitingRecord":"thumb";D.log("set live waiting record",{state:e,playerPhase:t}),le.set(t)},getDebugTextData:()=>((0,m.assertNonNullable)(wi),D.log("get debug text data"),((e,t,i)=>{let r=e.info,{width:a,height:s}=sa(i.ui.playerSize),n=r.throughputEstimation$.getValue()?.toFixed(0)??0,o=r.rttEstimation$.getValue()?.toFixed(0)??0,l=r.isAutoQualityEnabled$.getValue()?"auto":"manual",u=`${Va} (core: ${f.VERSION}, stat: ${v.VERSION}, shared: ${m.VERSION})`,d=sa(i.state.errorLog$),c=d.length?"\n"+d.map(((e,t)=>`${t}) Type: ${e.id}\nMessage: ${e.message} (${e.thrown})\nTrace: ${e.thrown?.stack}\n`)).join("\n"):void 0,h=i.state.isAudioDisabled?"disabled":sa(i.state.isAudioAvailable$)?void 0:"unavailable",p=e.info.currentVideoStream$.getValue(),g=e.info.currentAudioStream$.getValue(),b=[];p&&b.push(`Video: ${p?.codec??""}`+(p?.hdr?" (HDR)":"")),g&&b.push(`Audio: ${g?.codec??""}`+(g?.language?` (${g.language})`:""));let y={Version:u,Browser:navigator.userAgent,Config:e.experimental.tuningConfigName$.getValue().join(", "),"United video id":String(i.videoId),VSID:sa(i.vsid),"Content host":r.hostname$.getValue(),"Connection type":r.httpConnectionType$.getValue()+(r.httpConnectionReused$.getValue()?" (reused)":""),Throughput:`${n}Kbps @ ${o}ms RTT`,Format:r.currentFormat$.getValue(),"Available Formats":Object.keys(t.sources).join(", "),Streams:b.join(", "),Quality:`${l} ${r.currentQuality$.getValue()}`,"Available qualities":r.availableQualities$.getValue().join(", "),Audio:h,Position:`${sa(i.state.positionExact$)}s`,State:`${sa(i.playerPhase)} ${r.playbackState$.getValue()}`,"Player size":`${a}x${s}`,URL:window.location.href,Errors:c};return Object.entries(y).filter((([e,t])=>void 0!==t)).map((([e,t])=>`${e}: ${t}`)).join("\n")})(O,F,wi)),getTraceTextData:()=>((0,m.assertNonNullable)(wi),JSON.stringify(B.getFinishedSpans())),getDebugPanelData:()=>((0,m.assertNonNullable)(wi),((e,t,i)=>{let r=e.info,{width:a,height:s}=sa(i.ui.playerSize),n={version:Va,viewport:`${a}x${s}`,volume:Math.round(100*sa(i.state.volume$))};n.id=i.videoId,r.currentFormat$.getValue()&&(n.provider=r.currentFormat$.getValue()),r.hostname$.getValue()&&(n.cdn=r.hostname$.getValue());let o=r.intrinsicVideoSize$.getValue();o&&(n.videoSize=`${o.width}x${o.height}`);let l=r.currentBuffer$.getValue(),u=r.isLive$.getValue(),d=r.liveBufferTime$.getValue();l&&(n.buffer=u&&d?l.end-d:Math.max(l.end-sa(i.state.positionExact$),0));let c=r.throughputEstimation$.getValue();c&&(n.speed=c);let h=r.videoBitrate$.getValue();h&&(n.bitrate=h);let p=r.liveLatency$.getValue();p&&(n.liveLatency=p);let f=r.currentVideoSegmentLength$.getValue();f&&(n.currentVideoSegmentLength=f);let m=r.currentAudioSegmentLength$.getValue();m&&(n.currentAudioSegmentLength=m);let v=sa(i.vsid);"string"==typeof v&&(n.vsid=v);let g=e.info.currentVideoStream$.getValue()?.codec;g&&(n.videoCodec=g);let b=e.info.currentAudioStream$.getValue()?.codec;b&&(n.audioCodec=b),e.info.currentVideoStream$.getValue()?.hdr&&(n.hdr=!0);let y=e.info.currentAudioStream$.getValue()?.language;return y&&(n.audioLanguage=y),n})(O,0,wi)),getVideoElement:di,seekTime:(e,t,i)=>zt(e,t,i),clearDelayedBufferingCheckTimeout:()=>{ze&&clearTimeout(ze),ze=null},seekEpisodeStartTime:e=>{Q({message:`seek to episode start time: ${e}`}),D.log("seek to episode start time",{time:e}),zt(e,v.SeekAction.EPISODE,!0)},seekToPercent:Ut,getNextEpisode:mi,seekToNextEpisode:e=>{let t=e;t||(t=mi());let i=O.info.position$.getValue();D.log("seek to next episode",{currentTime:i,...t}),t&&(Q({message:"seek to next episode"}),zt(t.time,v.SeekAction.EPISODE,!0))},getPrevEpisode:vi,seekToPrevEpisode:e=>{let t=e;t||(t=vi());let i=O.info.position$.getValue();D.log("seek to prev episode",{currentTime:i,...t}),t&&(Q({message:"seek to prev episode"}),zt(t.time,v.SeekAction.EPISODE,!0))},startLogging:()=>{let e,{debugLog:t}=N,i="#9df7b7",r="#efd169";if(t&&!0!==t){let{colors:a}=t;e=t.tag,i=a?.[0]??i,r=a?.[1]??a?.[0]??r}let a=e?`: ${e}`:"";ye.add(O.events.log$.subscribe((e=>{console.debug(`%c sdk${a} `,`background:${i};`,`sdk component: ${e.component}`,e.message)}))).add(z.log$.subscribe((e=>{console.debug(`%c ui${a} `,`background:${r};`,`ui component: ${e.component}.`,e.message)})))},stopLogging:()=>{ye.unsubscribe()},startCameraManualRotation:(e,t)=>{D.log("start camera manual rotation",{mx:e,my:t}),O.startCameraManualRotation(e,t)},stopCameraManualRotation:(e=!1)=>{D.log("stop camera manual rotation",{immediate:e}),O.stopCameraManualRotation(e)},moveCameraFocusPX:(e,t,i)=>{D.log("move camera focus px",{xpx:e,ypx:t,dt:i}),O.moveCameraFocusPX(e,t,i)},holdCamera:()=>{O.holdCamera()},releaseCamera:()=>{O.releaseCamera()},getVideoEpisodes:fi,getPreviewThumbsData:()=>(Q({message:"getting preview thumbs data"}),D.log("get preview thumbs data",{...c}),c),downloadVideo:()=>{let e=(()=>{let e=Object.keys(O.info.availableSources$?.getValue()?.[f.VideoFormat.MPEG]||{}),t=(0,m.getHighestQuality)(e)||m.VideoQuality.Q_144P;return F.sources[f.VideoFormat.MPEG]?.[t]})();if(e)D.log("download video",{url:e}),((e,t)=>{Na(e,t,"mp4")})(e,F?.meta?.title||"video");else{let e="There is no URL for download video";D.log("download video",{message:e}),Q({message:e})}},addLanguage:ks,setLanguage:ae,nextMovie:e=>ce.next(e),videoRotate:(e=-90)=>{D.log("rotate video",{alphaDiff:e}),ee.update((t=>t+e))},correctSeekTimeToInteractive:yi,replayInteractive:x,setLooped:Pt,reportProblem:()=>{l?.uiInfo?.onReportProblem?.()},setAutoplayNextEnabled:(e,t=!1)=>{Q({message:`set autoplayNextEnabled, value: ${e}`}),D.log("set autoplay next enabled",{autoplayNextEnabled:e}),wi.ui.autoplayNextEnabled$.set(e),(e=>{ss(Xa,e)})(e),t&&l?.onSetAutoplayNextEnabled?.(e)},setTimerNextVideoRunning:e=>{Q({message:`set timerNextVideoRunning, value: ${e}`}),D.log("set timer next video running",{timerNextVideoRunning:e}),wi.ui.timerNextVideoRunning$.set(e)},prevVideoClick:(e=!0)=>{let t=!0;if(e&&l?.onPrevVideoClick)try{t=l?.onPrevVideoClick?.()}catch{Q({message:"onPrevVideoClick callback failed to execute"})}t&&(e&&Rt("prev")||A())},nextVideoClick:(e=!0)=>{let t=!0;if(e&&l?.onNextVideoClick)try{t=l?.onNextVideoClick?.()}catch{Q({message:"onNextVideoClick callback failed to execute"})}t&&(e&&Rt("next")||L())},nextVideoAnnouncementShow:()=>{l?.onNextVideoAnnouncementShow?.()},nextVideoAnnouncementClick:()=>{l?.onNextVideoAnnouncementClick?.()},nextVideoAnnouncementAuto:()=>{l?.onNextVideoAnnouncementAuto?.()},nextVideoAnnouncementCancel:()=>{l?.onNextVideoAnnouncementCancel?.()}},external:{firstStart:e=>pi(e,!0),play:()=>hi(!0),pause:()=>ci(!0),stop:()=>(e=>{(0,m.assertNonNullable)(wi);let t=!e;"ads"!==sa(wi.playerPhase)?(Q({message:`player will be stopped, internalCall: ${t}`}),$?.()):Q({message:"player cannot be stopped during ads via external method"})})(!0),seekTime:e=>(e=>{Q({message:`seek external, time: ${e}`}),D.log("seek external",{time:e}),pe.next(v.SeekAction.UNKNOWN),O.seekTime(O.info.isLive$.getValue()?-e:e)})(e),seekEpisodeStartTime:e=>(e=>{Q({message:`seek external to episode start time: ${e}`}),D.log("seek external to episode start time",{time:e}),zt(e,v.SeekAction.EPISODE,!0)})(e),setPlaybackRate:e=>(e=>{Q({message:`set playback rate to: ${e}`}),D.log("set playback rate external",{playbackRate:e}),O.setPlaybackRate(e)})(e),setAutoQualityLimits:e=>(e=>{let t=e.max??"none",i=e.min??"none";Q({message:`set auto quality limitation. Max: ${t}. Min: ${i}`}),D.log("set auto quality limits",{max:t,min:i}),O.setAutoQualityLimits(e)})(e),setMuted:At,setVolume:Et,returnFocusToEpisodes:()=>{wi.ui.episodes.panelOpened$.set(!1)},updateAdditionalSettingsItem:(e,t)=>{let i=sa(si).map((i=>i.id!==e?i:{...i,...t}));si.set(i)},addAdditionalSettingsItem:e=>{let t=sa(si);t.some((t=>t.id===e.id))?Q({message:`Settings menu item with id: "${e.id}" was exist! Can't add more with the same id`}):(t.push(e),si.set(t))},removeAdditionalSettingsItem:e=>{let t=sa(si);t.some((t=>t.id===e))?(t=t.filter((t=>t.id!==e)),si.set(t)):Q({message:`Can't find settings menu item with id: "${e}"! Can't remove item with this id`})},updateAdditionalContextItem:(e,t)=>{let i=sa(oi).map((i=>i.id!==e?i:{...i,...t}));oi.set(i)},addAdditionalContextItem:e=>{let t=sa(oi);t.some((t=>t.id===e.id))?Q({message:`Context menu item with id: "${e.id}" was exist! Can't add more with the same id`}):(t.push(e),oi.set(t))},removeAdditionalContextItem:e=>{let t=sa(oi);t.some((t=>t.id===e))?(t=t.filter((t=>t.id!==e)),oi.set(t)):Q({message:`Can't find context menu item with id: "${e}"! Can't remove item with this id`})},updateAdditionalButton:(e,t)=>{let i=sa(ii).map((i=>i.id!==e?i:{...i,...t}));ii.set(i)},addAdditionalButton:e=>{let t=sa(ii);t.some((t=>t.id===e.id))?Q({message:`Additional button with id: "${e.id}" was exist! Can't add more with the same id`}):(t.push(e),ii.set(t))},removeAdditionalButton:e=>{let t=sa(ii);t.some((t=>t.id===e))?(t=t.filter((t=>t.id!==e)),ii.set(t)):Q({message:`Can't find additional button with id: "${e}"! Can't remove item with this id`})},setLiveLowLatency:e=>{pe.next(v.SeekAction.LIVE),Q({message:"live switch to low latency "+e}),D.log("live switch to low latency "+e),O.setLiveLowLatency(e)}}},callbacks:l,setUiCallbacks:e=>{G={...e}},getAdmanWrapper:()=>U,getLogger:()=>z,getPlayer:()=>O,destroy:()=>{D.log("destroy store"),clearTimeout(It),clearTimeout(Mt),be.unsubscribe(),ye.unsubscribe(),O.destroy(),U.destroy(),M?.destroy(),q?.destroy(),ie.unsubscribe(),me?.disconnect(),me=null,K.destroy()}};return wi};function gd(e,t,i,r){let a=t[i]?.getBoundingClientRect(),s=(r||["interactiveTimeIndicator"].includes(i))&&!!a&&!!(a.right-a.left),{top:n,left:o,bottom:l,right:u}=fd(t[i],e||void 0);return{left:s?o:0,right:s?u:0,top:s?n:0,bottom:s?l:0,isDisplayed:s}}var bd=(e,t,i,r)=>{if(e)for(let[a,s]of Object.entries(t))["tooltipPointerOffsetX","disabledControls$","additionalButtons"].includes(a)||s.set(gd(e,i,a,r))},yd=async(e,t,i)=>{await kt(),t&&i&&(i.focus(),e.set(!1))},wd=Oi('<svg><!><path fill="var(--btn-color, #fff)" d="M18 10c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m-6 4c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m-6 0c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"></path></svg>');function Sd(e,t){pi(t,!0);let[i,r]=ua(),a=()=>la(l,"$contextMenuVisible$",i),s=ma(t,"disabled",3,!1),n=ma(t,"ariaLabel",3,""),o=Oa(),l=o.ui.contextMenu.visible$,u=o.ui.contextMenu.openedByBtnKeyboard$,d=o.ui.contextMenu.showContextMenuBtn$,c=o.ui.contextMenu.position$,h=o.ui.contextMenu.btnRef$,p=te(void 0);Rt((()=>{Tt(p)&&Ct((()=>{h.set(Tt(p))}))}));let f=ne((()=>a()?"opened":""));jo(e,{get className(){return Tt(f)},testId:"btn-context-menu",get disabled(){return s()},get ariaLabel(){return n()},click:e=>{let t=wn(e),i=(e=>{let t=e.getBoundingClientRect();return{right:t.left+t.width,bottom:t.top+-14}})(Tt(p));c.set(i),u.set(t),l.set(!a())},focus:()=>{d.set(!0)},blur:()=>{d.set(!1)},get ariaExpanded(){return a()},get ref(){return Tt(p)},set ref(e){re(p,Ae(e))},children:(e,t)=>{!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=wd();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"dots-icon",role:"img",...i}))),zi(e,r)}(e,{})},$$slots:{default:!0}}),fi(),r()}var xd=e=>{e.stopPropagation()},$d=Di("<div><!> <div></div> <div></div></div>"),_d={hash:"svelte-od3veb",code:".interactive-episode-icon-animated.svelte-od3veb {position:absolute;top:16px;right:16px;width:32px;height:32px;transition:0.3s;opacity:1;}.interactive-episode-icon-animated.icon-small.svelte-od3veb {width:28px;height:28px;}.invisible.svelte-od3veb {opacity:0;visibility:hidden;}.fullscreen.svelte-od3veb:not(.mobile) {width:40px;top:19px;right:23px;height:40px;}.mobile.svelte-od3veb {width:28px;height:28px;top:12px;right:14px;}.fullscreen.mobile.svelte-od3veb {width:32px;height:32px;}\n\n  @media screen and (orientation: portrait) {.interactive-episode-icon-animated.mobile.fullscreen.svelte-od3veb {top:40px;right:16px;}\n  }\n\n  @keyframes svelte-od3veb-pulse {\n    0% {\n      transform: scale(1);\n      border-width: 1px;\n      opacity: 0;\n    }\n    10% {\n      opacity: 1;\n    }\n    50% {\n      transform: scale(1.5);\n      border-width: 1px;\n      opacity: 0.5;\n    }\n    100% {\n      transform: scale(1.5);\n      border-width: 0.5px;\n      opacity: 0;\n    }\n  }.pulse.svelte-od3veb {display:block;content:'';border:1px solid #fff;position:absolute;top:0;left:0;right:0;bottom:0;border-radius:100%;transform:scale(1.8);\n    animation: 1s svelte-od3veb-pulse infinite;transition:0.3s;pointer-events:none;}.pulse.paused.svelte-od3veb {animation-play-state:paused;}.interactive-episode-icon-animated svg {width:100%;height:100%;}.ref-block.svelte-od3veb {position:absolute;top:0;width:100%;height:100%;visibility:hidden;}.hidden.svelte-od3veb {display:none;}"};function kd(e,t){pi(t,!0),vr(e,_d);let[i,r]=ua(),a=()=>la(c,"$isMobile",i),s=()=>la(f,"$showInteractiveTimeIndicatorTooltip$",i),n=ma(t,"ref",15,void 0),o=te(void 0),l=Oa(),u=Fa(),{interactiveControlsOpacity$:d}=u,c=l.ui.isMobile,h=l.ui.isFullscreen,p=l.state.isInteractiveTime$,f=u.showInteractiveTimeIndicatorTooltip$,m=l.ui.controlsVisible,v=l.callbacks?.onInteractiveTimeIndicatorClick,g=l.ui.currentGridType$,b=ne((()=>!a()&&la(m,"$areControlsVisible",i))),y=ne((()=>ru(la(g,"$currentGridType$",i),"s"))),w=ne((()=>!la(p,"$isInteractiveTime$",i)||!!la(d,"$interactiveControlsOpacity$",i)||Tt(b))),S=te(!1);Rt((()=>{re(S,Ae(Tt(w)))}));let x=()=>{re(S,!0)},$=()=>{re(S,!1),Tt(o)?.removeEventListener("animationiteration",x)},_=ne((()=>s()&&!Tt(w)));Rt((()=>{s()?($(),Tt(o)?.addEventListener("animationiteration",x,{once:!0})):$()}));Jr((()=>{f.clearTimeout(),$()}));let k=Es("tooltip_interactive_interaction_time_indicator");var T=$d();let C;T.__mousemove=[xd],T.__click=()=>{Tt(w)||(f.set(!0),v?.())};var E=Ne(T);Ol(E,{tooltipContent:k,get tooltipActive(){return Tt(_)},initialTranslateYPx:72,tooltipPlacement:"bottom",onTooltipVisibilityChange:e=>{f.set(e)},get ref(){return n()},set ref(e){n(e)},children:(e,t)=>{jl(e,{completed:!0})},$$slots:{default:!0}});var A=De(E,2);let L;Kr(A,(e=>n(e)),(()=>n()));var P=De(A,2);let M;Kr(P,(e=>re(o,e)),(()=>Tt(o))),Te(T),Bt(((e,t,i)=>{C=xr(T,1,"interactive-episode-icon-animated svelte-od3veb",null,C,e),L=xr(A,1,"ref-block svelte-od3veb",null,L,t),M=xr(P,1,"pulse svelte-od3veb",null,M,i)}),[()=>({mobile:a(),fullscreen:la(h,"$isFullscreen",i),invisible:Tt(w),"icon-small":Tt(y)}),()=>({hidden:Tt(w)}),()=>({paused:Tt(S)})]),Ii("mouseleave",T,(()=>{f.set(!1)})),zi(e,T),fi(),r()}function Td(e,t){pi(t,!0);let i=ma(t,"tooltipEnabled",3,!0),r=ma(t,"disabled",3,!1),a=ma(t,"className",3,void 0),s=ma(t,"ref",15);Ol(e,{get disabled(){return r()},get tooltipContent(){return t.tooltipText},get disabledTooltipContent(){return t.disabledTooltipContent},get hasTooltip(){return i()},get mouseEnter(){return t.mouseEnter},get mouseLeave(){return t.mouseLeave},get className(){return a()},get ref(){return s()},set ref(e){s(e)},children:(e,i)=>{var r=ji();let a=ne((()=>t.buttonComponent));pr(Be(r),(()=>Tt(a)),((e,i)=>{i(e,pa((()=>t.buttonComponentProps??{})))})),zi(e,r)},$$slots:{default:!0}}),fi()}Ri(["mousemove","click"]);var Cd=100,Ed=200,Ad=300,Ld=400,Pd=500,Md=600,Id=700,Rd=800,Vd=Oi('<svg><!><path fill="var(--btn-color, #fff)" d="M16 10.835V7.5a1 1 0 1 1 2 0v9a1 1 0 0 1-2 0v-3.335l-8.149 4.67C7.03 18.304 6 17.715 6 16.772V7.227c0-.943 1.029-1.533 1.851-1.061L16 10.834z"></path></svg>');function Nd(e,t){let i=ma(t,"isPrev",3,!1),r=ma(t,"isMobile",3,!1),a=ma(t,"width",3,"24"),s=ma(t,"height",3,"24"),n=ne((()=>i()&&r()?"transform: scaleX(-1) scale(1.3333);":i()?"transform: scaleX(-1);":r()?"transform: scale(1.3333);":void 0)),o=ne((()=>i()?"prev-icon":"next-icon"));!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=Vd();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"24",fill:"none","aria-hidden":"true",role:"img",...i}))),zi(e,r)}(e,{get style(){return Tt(n)},get width(){return a()},get height(){return s()},get viewBox(){return t.viewBox},get"data-testid"(){return Tt(o)}})}var Bd=Di('<div class="icon-background-mobile svelte-xtk2k4"></div>'),Dd=Di("<!> <!>",1),Od={hash:"svelte-xtk2k4",code:".icon-background-mobile.svelte-xtk2k4 {position:absolute;top:0;left:0;width:100%;height:100%;border-radius:var(--big-play-radius);background-color:var(--big-play-bg-color);}"};function Fd(e,t){pi(t,!0),vr(e,Od);let i=ma(t,"ref",15,void 0),r=ma(t,"isMobile",3,!1),a=ma(t,"disabled",3,!1),s=Oa().ui.t,n=ne((()=>"prev"===t.type?s("tooltip_previous"):s("tooltip_next"))),o=ne((()=>"prev"===t.type?s("hotkey_map_item_prev_video_value"):s("hotkey_map_item_next_video_value"))),l=ne((()=>`btn-${r()?"m":"d"}--${t.type}`));jo(e,{get className(){return Tt(l)},get testId(){return`btn-${t.type??""}`},get disabled(){return a()},get ariaLabel(){return Tt(n)},get click(){return t.click},get ariaKeyShortCut(){return Tt(o)},get ref(){return i()},set ref(e){i(e)},children:(e,i)=>{var a=Dd(),s=Be(a),n=e=>{zi(e,Bd())};Xi(s,(e=>{r()&&e(n)}));var o=De(s,2);let l=ne((()=>"prev"===t.type));Nd(o,{get isMobile(){return r()},get isPrev(){return Tt(l)}}),zi(e,a)},$$slots:{default:!0}}),fi()}var jd=Oi('<svg><!><path fill="var(--btn-color, #fff)" d="M12 10.096a.4.4 0 0 1-.67.296L7.044 6.493a.67.67 0 0 1 0-.986l4.288-3.899a.4.4 0 0 1 .669.296V5a8 8 0 1 1-8 8 1 1 0 1 1 2 0 6 6 0 1 0 6-6z"></path></svg>');function zd(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=jd();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"replay-icon",role:"img",...i}))),zi(e,r)}var Ud=Di('<div class="icon-background-mobile svelte-1ot3duq"></div>'),qd=Di("<!> <div><!></div>",1),Hd={hash:"svelte-1ot3duq",code:".mobile.svelte-1ot3duq {position:relative;display:flex;align-items:center;justify-content:center;}.mobile.svelte-1ot3duq svg {transform:scale(2);}.icon-background-mobile.svelte-1ot3duq {position:absolute;top:16px;left:16px;border-radius:var(--big-play-radius);background-color:var(--big-play-bg-color);width:calc(100% - 32px);height:calc(100% - 32px);}"};function Wd(e,t){pi(t,!0),vr(e,Hd);let i=ma(t,"ref",15,void 0),r=ma(t,"isMobile",3,!1),a=ma(t,"disabled",3,!1),s=ma(t,"className",3,""),n=ma(t,"click",3,m.noop),o=Es("tooltip_restart"),l=ne((()=>`${r()?"btn-m--play":""} ${s()}`));jo(e,{get className(){return Tt(l)},testId:"btn-replay",ariaLabel:o,get disabled(){return a()},get click(){return n()},get ariaKeyShortCut(){return xa},get ref(){return i()},set ref(e){i(e)},children:(e,t)=>{var i=qd(),a=Be(i),s=e=>{zi(e,Ud())};Xi(a,(e=>{r()&&e(s)}));var n=De(a,2);let o;zd(Ne(n),{}),Te(n),Bt((e=>o=xr(n,1,"svelte-1ot3duq",null,o,e)),[()=>({mobile:r()})]),zi(e,i)},$$slots:{default:!0}}),fi()}var Qd=Oi('<svg fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" data-testid="play-icon"><path d="M17.671 10.923c.82.483.82 1.67 0 2.154l-8.787 5.175A1.25 1.25 0 0 1 7 17.174V6.826a1.25 1.25 0 0 1 1.884-1.078l8.787 5.175z"></path></svg>');function Gd(e,t){let i=ma(t,"width",3,"24"),r=ma(t,"height",3,"24"),a=ma(t,"viewBox",3,"0 0 24 24"),s=ma(t,"fill",3,"var(--btn-color)");var n=Qd(),o=Ne(n);Te(n),Bt((()=>{Lr(n,"width",i()),Lr(n,"height",r()),Lr(n,"viewBox",a()),Lr(o,"fill",s())})),zi(e,n)}var Kd=Oi('<svg fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" data-testid="pause-icon"><path d="M8.712 5c.448 0 .61.047.774.134a.913.913 0 0 1 .38.38c.087.164.134.326.134.774v11.424c0 .448-.047.61-.134.774a.914.914 0 0 1-.38.38c-.164.087-.326.134-.774.134H6.788c-.448 0-.61-.047-.774-.134a.914.914 0 0 1-.38-.38c-.087-.164-.134-.326-.134-.774V6.288c0-.448.047-.61.134-.774a.913.913 0 0 1 .38-.38C6.178 5.047 6.34 5 6.788 5h1.924zm8 0c.448 0 .61.047.774.134a.914.914 0 0 1 .38.38c.087.164.134.326.134.774v11.424c0 .448-.047.61-.134.774a.914.914 0 0 1-.38.38c-.164.087-.326.134-.774.134h-1.924c-.448 0-.61-.047-.774-.134a.914.914 0 0 1-.38-.38c-.087-.164-.134-.326-.134-.774V6.288c0-.448.047-.61.134-.774a.914.914 0 0 1 .38-.38c.164-.087.326-.134.774-.134h1.924z"></path></svg>');function Yd(e,t){let i=ma(t,"width",3,"24"),r=ma(t,"height",3,"24"),a=ma(t,"viewBox",3,"0 0 24 24"),s=ma(t,"fill",3,"var(--btn-color)");var n=Kd(),o=Ne(n);Te(n),Bt((()=>{Lr(n,"width",i()),Lr(n,"height",r()),Lr(n,"viewBox",a()),Lr(o,"fill",s())})),zi(e,n)}var Zd=Di('<div class="icon-background-mobile svelte-1ot3duq"></div>'),Xd=Di("<!> <div><!></div>",1),Jd={hash:"svelte-1ot3duq",code:".mobile.svelte-1ot3duq {position:relative;display:flex;align-items:center;justify-content:center;}.mobile.svelte-1ot3duq svg {transform:scale(2);}.icon-background-mobile.svelte-1ot3duq {position:absolute;top:16px;left:16px;border-radius:var(--big-play-radius);background-color:var(--big-play-bg-color);width:calc(100% - 32px);height:calc(100% - 32px);}"};function ec(e,t){pi(t,!0),vr(e,Jd);let[i,r]=ua(),a=()=>la(s,"$fakeIsPlaying$",i),{fakeIsPlaying$:s}=Fa(),n=ma(t,"ref",15,void 0),o=ma(t,"isMobile",3,!1),l=ma(t,"isPlaying",3,!1),u=ma(t,"disabled",3,!1),d=ma(t,"className",3,""),c=ma(t,"click",3,m.noop),h=Oa().ui.t,{toggle:p}=s,f=ne((()=>p)),v=ne((()=>null!==a())),g=ne((()=>Tt(v)?a():l())),b=ne((()=>Tt(g)?h("tooltip_pause"):h("tooltip_play"))),y=ne((()=>Tt(g)?Yd:Gd)),w=ne((()=>`${o()?"btn-m--play":""} ${d()}`)),S=ne((()=>Tt(v)?Tt(f):c()));jo(e,{get className(){return Tt(w)},testId:"btn-play",get click(){return Tt(S)},get disabled(){return u()},get ariaLabel(){return Tt(b)},get ariaKeyShortCut(){return xa},get ref(){return n()},set ref(e){n(e)},children:(e,t)=>{var i=Xd();let r=ne((()=>Tt(y)));var a=Be(i),s=e=>{zi(e,Zd())};Xi(a,(e=>{o()&&e(s)}));var n=De(a,2);let l;pr(Ne(n),(()=>Tt(r)),((e,t)=>{t(e,{})})),Te(n),Bt((e=>l=xr(n,1,"svelte-1ot3duq",null,l,e)),[()=>({mobile:o()})]),zi(e,i)},$$slots:{default:!0}}),fi(),r()}var tc=Oi('<svg><!><path fill="var(--btn-color, #fff)" d="M12.583 12.917v2.496a1 1 0 0 1-1.522.853l-5.583-3.413a1 1 0 0 1 0-1.706l5.583-3.413a1 1 0 0 1 1.522.853v2.496l5.478-3.349a1 1 0 0 1 1.522.853v6.826a1 1 0 0 1-1.522.853z"></path></svg>');function ic(e,t){pi(t,!0);let i=ma(t,"ref",15,void 0),r=ma(t,"hidden",3,!1),a=ma(t,"disabled",3,!1),s=Es("tooltip_interactive_go_back"),n=ne((()=>r()?"hidden":""));jo(e,{get className(){return Tt(n)},testId:"btn-play-prev-chapter",ariaLabel:s,get disabled(){return a()},get click(){return t.click},get ref(){return i()},set ref(e){i(e)},children:(e,t)=>{!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=tc();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","data-testid":"play-prev-chapter-icon",role:"img",...i}))),zi(e,r)}(e,{})},$$slots:{default:!0}}),fi()}var rc=Di('<span class="gutter svelte-et3q1q"><span><!></span></span>'),ac={hash:"svelte-et3q1q",code:".gutter.svelte-et3q1q {--gutterWidth: 32px;--gutterHeight: 12px;--togglerWidth: 18px;--togglerHeight: 18px;--togglerGap: calc(var(--togglerWidth) / 6);position:relative;width:var(--gutterWidth);height:var(--gutterHeight);background-color:rgba(255, 255, 255, 0.3);border-radius:50px;}.toggler.svelte-et3q1q {position:absolute;top:calc(((var(--togglerHeight) - var(--gutterHeight)) / 2) * -1);left:0;display:flex;align-items:center;justify-content:center;width:var(--togglerWidth);height:var(--togglerHeight);background-color:rgba(98, 99, 100, 1);border-radius:50%;transform:translateX(calc(var(--togglerGap) * -1));transition-property:background-color, transform;transition-duration:0.2s;transition-timing-function:ease;}.toggler.enabled.svelte-et3q1q {background-color:var(--toggle-color-autoplay-on);transform:translateX(calc(var(--gutterWidth) - var(--togglerWidth) + var(--togglerGap)));}"};function sc(e,t){pi(t,!0),vr(e,ac);let[i,r]=ua(),a=()=>la(o,"$autoplayNextEnabled$",i),s=ma(t,"ref",15,void 0),n=Oa(),o=n.ui.autoplayNextEnabled$,l=n.actions.internal.setAutoplayNextEnabled;jo(e,{click:()=>{l(!a(),!0)},get ref(){return s()},set ref(e){s(e)},children:(e,t)=>{var i=rc(),r=Ne(i);let s;var n=Ne(r),o=e=>{Gd(e,{width:"14",height:"14",fill:"#000"})},l=e=>{Yd(e,{width:"14",height:"14",fill:"#000"})};Xi(n,(e=>{a()?e(o):e(l,!1)})),Te(r),Te(i),Bt((e=>s=xr(r,1,"toggler svelte-et3q1q",null,s,e)),[()=>({enabled:a()})]),zi(e,i)},$$slots:{default:!0}}),fi(),r()}var nc=Oi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M16.726 4.845C16.187 4.8 15.496 4.8 14.5 4.8H7.9a.9.9 0 1 1 0-1.8h6.639c.947 0 1.713 0 2.333.05.64.053 1.204.163 1.726.43a4.4 4.4 0 0 1 1.923 1.922c.266.523.377 1.087.429 1.726.05.62.05 1.386.05 2.334v5.076c0 .948 0 1.714-.05 2.334-.052.64-.163 1.203-.43 1.726a4.4 4.4 0 0 1-1.922 1.922c-.522.267-1.086.377-1.726.43-.62.05-1.386.05-2.333.05H7.9a.9.9 0 1 1 0-1.8h6.6c.995 0 1.687 0 2.226-.045.528-.043.828-.123 1.055-.238a2.6 2.6 0 0 0 1.136-1.137c.115-.226.195-.527.239-1.055.044-.538.044-1.23.044-2.225v-5c0-.995 0-1.687-.044-2.226-.043-.527-.124-.828-.239-1.054a2.6 2.6 0 0 0-1.136-1.137c-.227-.115-.527-.195-1.055-.238" clip-rule="evenodd"></path><path fill="var(--btn-color, #fff)" d="M7.76 11.169V8.908c0-.708.704-1.143 1.252-.774l4.594 3.093c.525.353.525 1.193 0 1.546l-4.594 3.093c-.548.369-1.252-.066-1.252-.774v-2.261l-4.508 3.035C2.704 16.235 2 15.8 2 15.091V8.908c0-.708.704-1.143 1.252-.774z"></path></svg>');function oc(e,t){pi(t,!0);let i=ma(t,"ref",15,void 0),r=ma(t,"hidden",3,!1),a=ma(t,"disabled",3,!1),s=Es("tooltip_interactive_seek"),n=ne((()=>r()?"hidden":""));jo(e,{get className(){return Tt(n)},testId:"btn-seek-to-interactive",ariaLabel:s,get disabled(){return a()},get click(){return t.click},get ref(){return i()},set ref(e){i(e)},children:(e,t)=>{!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=nc();let a;hr(Ne(r),(()=>t.children??D)),Ce(2),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"seek-to-interactive-icon",role:"img",...i}))),zi(e,r)}(e,{})},$$slots:{default:!0}}),fi()}var lc=Oi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M16.777 3h1.419c.31 0 .596 0 .834.02.258.02.539.068.817.21.397.2.72.523.923.918.141.277.19.557.21.814.02.237.02.521.02.83V7.19c0 .31 0 .594-.02.831-.02.256-.069.537-.21.813a2.1 2.1 0 0 1-.923.92c-.278.14-.56.188-.817.21-.238.019-.524.019-.834.019h-1.419c-.31 0-.596 0-.834-.02a2.15 2.15 0 0 1-.817-.21 2.1 2.1 0 0 1-.923-.919 2.1 2.1 0 0 1-.21-.813 8 8 0 0 1-.02-.63l-2.198-.002c-.495-.001-.81 0-1.05.018-.23.019-.309.05-.343.067a.8.8 0 0 0-.352.35c-.017.034-.049.113-.068.341-.02.24-.02.554-.02 1.046v5.57c0 .49 0 .804.02 1.043.019.228.05.306.068.34.077.15.2.273.35.35.035.017.113.049.342.067.24.02.555.021 1.048.022l2.203.003a8 8 0 0 1 .02-.627c.02-.256.069-.537.21-.813.203-.396.526-.718.923-.92.278-.14.56-.189.817-.21.238-.019.524-.019.834-.019h1.419c.31 0 .596 0 .834.02.258.02.539.068.817.21.397.201.72.523.923.919.141.276.19.557.21.813.02.237.02.522.02.831v1.397c0 .31 0 .594-.02.831-.02.256-.069.537-.21.814a2.1 2.1 0 0 1-.923.919c-.278.14-.56.189-.817.21-.238.019-.524.019-.834.019h-1.419c-.31 0-.596 0-.834-.02a2.15 2.15 0 0 1-.817-.21 2.1 2.1 0 0 1-.923-.918 2.1 2.1 0 0 1-.21-.814 8 8 0 0 1-.02-.63l-2.24-.002c-.449 0-.839-.001-1.16-.028-.341-.028-.684-.09-1.016-.259a2.6 2.6 0 0 1-1.14-1.137c-.17-.33-.231-.672-.259-1.011-.026-.321-.026-.71-.026-1.156v-1.921H2.905A.903.903 0 0 1 2 11.992c0-.498.405-.901.905-.901h5.227V9.177c0-.448 0-.837.026-1.159.028-.34.09-.682.26-1.013a2.6 2.6 0 0 1 1.144-1.138c.332-.168.676-.23 1.017-.257.323-.025.714-.025 1.164-.024l2.23.003a8 8 0 0 1 .02-.627c.02-.257.069-.537.21-.814.203-.395.526-.717.923-.919.278-.14.56-.189.817-.21C16.18 3 16.467 3 16.777 3m-.833 1.837a1 1 0 0 1 .146-.02 10 10 0 0 1 .72-.014h1.354c.353 0 .563 0 .719.013a1 1 0 0 1 .146.021.3.3 0 0 1 .126.126 1 1 0 0 1 .021.145c.013.156.014.365.014.716v1.334c0 .352 0 .561-.014.716a1 1 0 0 1-.02.146.3.3 0 0 1-.127.125 1 1 0 0 1-.146.022c-.156.012-.366.013-.719.013H16.81c-.353 0-.563 0-.719-.013a1 1 0 0 1-.146-.022.3.3 0 0 1-.126-.125 1 1 0 0 1-.021-.146 10 10 0 0 1-.014-.716V5.824c0-.351.001-.56.014-.716a1 1 0 0 1 .021-.145.3.3 0 0 1 .126-.126Zm0 11.018a1 1 0 0 1 .146-.022c.156-.012.366-.013.72-.013h1.354c.353 0 .563 0 .719.013a1 1 0 0 1 .146.022.3.3 0 0 1 .126.125 1 1 0 0 1 .021.146c.013.155.014.364.014.716v1.334c0 .351 0 .56-.014.716a1 1 0 0 1-.02.145.3.3 0 0 1-.127.126 1 1 0 0 1-.146.02c-.156.014-.366.014-.719.014H16.81c-.353 0-.563 0-.719-.013a1 1 0 0 1-.146-.021.3.3 0 0 1-.126-.126 1 1 0 0 1-.021-.145 10 10 0 0 1-.014-.716v-1.334c0-.352.001-.561.014-.716a1 1 0 0 1 .021-.146.3.3 0 0 1 .126-.125Z" clip-rule="evenodd"></path><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M15.2 5.899v1.203c0 .594 0 .892.115 1.119.102.2.265.362.464.463.227.116.525.116 1.12.116H18.1c.595 0 .892 0 1.12-.116.199-.101.361-.264.463-.463.116-.227.116-.525.116-1.12V5.9c0-.595 0-.892-.116-1.12a1.06 1.06 0 0 0-.464-.463c-.227-.116-.524-.116-1.119-.116h-1.203c-.594 0-.892 0-1.119.116-.2.102-.362.264-.464.464-.115.227-.115.524-.115 1.119Zm-.051 11.03v1.143c0 .605 0 .908.118 1.139.103.203.268.368.472.472.23.117.533.117 1.138.117H18.1c.605 0 .907 0 1.138-.117a1.08 1.08 0 0 0 .472-.472c.118-.231.118-.534.118-1.139v-1.144c0-.605 0-.907-.118-1.138a1.08 1.08 0 0 0-.472-.472c-.231-.118-.534-.118-1.138-.118h-1.224c-.605 0-.907 0-1.138.118a1.08 1.08 0 0 0-.472.472c-.118.23-.118.533-.118 1.138Z" class="_closed" clip-rule="evenodd"></path></svg>');var uc={hash:"svelte-17ceof5",code:'svg[data-testid="graph-open-icon"] ._closed {visibility:hidden;opacity:0;}'};function dc(e,t){vr(e,uc);let i=ma(t,"isOpened",3,!1),r=ne((()=>i()?"graph-close-icon":"graph-open-icon"));!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=lc();let a;hr(Ne(r),(()=>t.children??D)),Ce(2),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true",role:"img",...i}))),zi(e,r)}(e,{get"data-testid"(){return Tt(r)}})}function cc(e,t){pi(t,!0);let i=ma(t,"ref",15,void 0),r=ma(t,"hidden",3,!1),a=ma(t,"disabled",3,!1),s=ma(t,"graphIsOpened",3,!1),n=Oa().ui.t,o=ne((()=>s()?n("tooltip_interactive_graph_on"):n("tooltip_interactive_graph_off"))),l=ne((()=>r()?"hidden":""));jo(e,{get className(){return Tt(l)},testId:"btn-graph",get disabled(){return a()},get ariaLabel(){return Tt(o)},get click(){return t.click},get ref(){return i()},set ref(e){i(e)},children:(e,t)=>{let i=ne((()=>!!s()));dc(e,{get isOpened(){return Tt(i)}})},$$slots:{default:!0}}),fi()}function hc(e,t){pi(t,!0);let[i,r]=ua(),a=()=>la(u,"$playbackState$",i),s=ma(t,"isMobile",3,!1),n=ma(t,"isLiveActive",3,!1),o=ma(t,"ariaLabel",3,""),l=Oa(),u=l.state.playbackState$,d=l.actions.internal.switchToActiveLive,c=l.actions.internal.togglePlay,h=ne((()=>()=>{n()?a()===f.PlaybackState.PAUSED&&c():d()})),p=ne((()=>s()?"":"btn--live btn-full-opacity")),m=ne((()=>n()?"btn-live":"btn-live-offset")),v=ne((()=>n()&&a()===f.PlaybackState.PLAYING));jo(e,{get className(){return Tt(p)},get testId(){return Tt(m)},get disabled(){return Tt(v)},get ariaLabel(){return o()},get click(){return Tt(h)},children:(e,t)=>{dn(e,{get isActive(){return n()}})},$$slots:{default:!0}}),fi(),r()}var pc=Di('<div class="icon icon-error-stub"><div class="inner"></div></div>'),fc=Di('<img class="icon" aria-hidden="true">');function mc(e,t){let i=te(!1),r=()=>{re(i,!0)};var a=ji(),s=Be(a),n=e=>{zi(e,pc())},o=e=>{var i=fc();Bt((()=>Lr(i,"src",t.icon))),Ii("error",i,r),Pi(i),zi(e,i)};Xi(s,(e=>{Tt(i)?e(n):e(o,!1)})),zi(e,a)}var vc=100,gc=200,bc=300,yc=400,wc=500,Sc=600,xc=700,$c=800,_c=Di('<div><!> <div class="controls svelte-1iedtj3"><div class="controls-left svelte-1iedtj3"><!> <!> <!></div> <div class="controls-right svelte-1iedtj3"></div></div></div> <!>',1),kc={hash:"svelte-1iedtj3",code:".wrapper-bottom.svelte-1iedtj3 {pointer-events:none;position:absolute;z-index:var(--controls-container-z-index);width:100%;bottom:0;left:0;height:var(--controls-gradient-height);background:var(--controls-gradient);transition:transform var(--controls-transition-duration) var(--controls-transition-fn);display:flex;flex-direction:column;justify-content:flex-end;box-sizing:border-box;}.wrapper-bottom.svelte-1iedtj3 > :where(.svelte-1iedtj3) {pointer-events:auto;}.controls.svelte-1iedtj3 {width:100%;display:flex;align-items:center;justify-content:space-between;height:var(--controls-height);white-space:nowrap;font-size:13px;transition:transform var(--controls-transition-duration) var(--controls-transition-fn);will-change:transform;padding:0 8px 4px;box-sizing:border-box;}.controls-left.svelte-1iedtj3, .controls-right.svelte-1iedtj3 {display:flex;align-content:center;}.controls-left.svelte-1iedtj3 {flex-grow:1;min-width:0;overflow:hidden;}.controls-left.svelte-1iedtj3 > *:not(:first-child), .controls-right.svelte-1iedtj3 > * {margin-left:var(--controls-desktop-item-margin-left);}.controls-hidden.svelte-1iedtj3 {visibility:visible; /* if hidden then slider will lose focus (if was focused) */transform:translateY(100%);}.wrapper-bottom.no-smooth.svelte-1iedtj3 {transition:none;}"};function Tc(e,t){pi(t,!0),vr(e,kc);let[i,r]=ua(),a=()=>la(ke,"$disabledControls$",i),s=()=>la(ue,"$playbackState$",i),n=()=>la(he,"$isEnded$",i),o=()=>la(je,"$currentGridType$",i),l=()=>la(pe,"$isLive$",i),u=()=>la(xe,"$chromecastState$",i),d=()=>la(ve,"$isPictureInPictureActive",i),c=()=>la(ge,"$pictureInPictureType$",i),h=()=>la(Fe,"$playerSize",i),p=()=>la(me,"$isRewindableLive$",i),v=()=>la(it,"$graphIsOpened$",i),g=()=>la(Oe,"$isFullscreen",i),b=()=>la(Tt(Gt),"$prevButton",i),y=()=>la(Tt(Kt),"$replayButton",i),w=()=>la(Tt(Yt),"$playButton",i),S=()=>la(Tt(Zt),"$nextButton",i),x=()=>la(Tt(Xt),"$playPrevChapterButton",i),$=()=>la(Tt(Jt),"$seekToInteractiveButton",i),_=()=>la(Tt(ei),"$interactiveGraphButton",i),k=()=>la(Tt(ti),"$liveButton",i),T=()=>la(Tt(ii),"$time",i),C=()=>la(Tt(ri),"$episodes",i),E=()=>la(Tt(ai),"$vkLogo",i),A=()=>la(Tt(si),"$volume",i),L=()=>la(Tt(ni),"$subtitles",i),P=()=>la(Tt(oi),"$settings",i),M=()=>la(Tt(li),"$context",i),I=()=>la(Tt(ui),"$fullscreen",i),R=()=>la(Tt(di),"$chromecast",i),V=()=>la(ze,"$additionalDesktopControlPanelRightButtons$",i),N=()=>la(be,"$settingsMenuVisible",i),B=()=>la(bi,"$settingButtonRef$",i),D=()=>la(Pe,"$startedByKeyboard$",i),O=()=>la(G,"$fakeIsPlaying$",i),F=()=>la(le,"$position$",i),j=()=>la(oe,"$duration$",i),z=ma(t,"playerControlsWrapperRef",15,void 0),U=ma(t,"playerControlsRef",15,void 0),q=ma(t,"isAds",3,!1),H=ma(t,"logoTargetUrl",3,""),W=ma(t,"isOneVideoPlaylist",3,!1),Q=ma(t,"customFullscreenSupported",3,!0),{fakeIsPlaying$:G}=Fa(),K=Oa(),Y=Fa(),Z=ya(),X=K.actions.internal.toggleMuted,J=K.actions.internal.togglePlay,ee=K.actions.internal.pause,ie=K.actions.internal.toggleSubtitle,ae=K.callbacks?.onAudioDoesNotExistHint,se=K.callbacks?.onAudioDisabledHint,oe=K.state.duration$,le=K.state.positionWithScrubbing$,ue=K.state.playbackState$,de=K.state.isAudioAvailable$,ce=K.state.isAudioDisabled,he=K.state.isEnded$,pe=K.state.isLive$,fe=K.state.isActiveLive$,me=K.state.isRewindableLive$,{isActive$:ve,type$:ge}=Y.pictureInPicture$,be=K.ui.settingsMenu.visible$,ye=K.ui.settingsMenu.openedByBtnKeyboard$,we=K.ui.controls,Se=K.actions.internal.getVideoEpisodes(),xe=K.state.chromecastState$,$e=K.state.availableSubtitlesList$,_e=K.state.currentSubtitle$,ke=we.disabledControls$,Ce=K.ui.contextMenu.visible$,Ee=K.ui.contextMenu.showContextMenuBtn$,Le=K.ui.contextMenu.openedByBtnKeyboard$,Pe=K.ui.startedByKeyboard$,Me=K.ui.t,Ie=K.ads.duration,Re=K.ads.position,Ve=K.ads.playbackState,Oe=K.ui.isFullscreen,Fe=K.ui.playerSize,je=K.ui.currentGridType$,ze=K.ui.additionalDesktopControlPanelRightButtons$,Ue=K.ui.autoplayNextEnabled$,qe=K.actions.internal.getVideoElement,He=K.actions.internal.replayInteractive,We=K.actions.internal.prevVideoClick,Qe=K.actions.internal.nextVideoClick,Ge=K.state.isInteractive,Ke=K.state.isInteractiveTime$,Ye=K.state.showInteractiveGraph,Ze=K.state.showSeekToInteractive,Xe=K.state.showPlayPrevChapter,Je=K.state.showInteractiveTimeIndicator,et=K.state.playPrevChapterDisabledTooltip,tt=Y.seekToInteractiveDisabledTooltip$,it=Y.graphIsOpened$,rt=Z.features.interactiveResponsiveUi,at=ne((()=>a().has("EPISODE_BUTTON"))),st=ne((()=>a().has("GRAPH_BUTTON"))),nt=ne((()=>a().has("SEEK_TO_INTERACTIVE_BUTTON"))),ot=ne((()=>a().has("PLAY_BUTTON"))),lt=ne((()=>a().has("REPLAY_BUTTON"))),ut=ne((()=>a().has("PLAY_PREV_CHAPTER_BUTTON"))),dt=()=>K.actions.internal.toggleChromecast(),ct=ne((()=>q()?"playing"===la(Ve,"$adPlaybackState",i):s()===f.PlaybackState.PLAYING)),ht=ne((()=>"off"!==la(_e,"$currentSubtitle$",i).value)),pt=ne((()=>n()&&!q()||Ge)),ft=ne((()=>rt?Tt(pt)&&iu(o(),"m"):Tt(pt))),mt=ne((()=>!n()||Ge||q())),vt=ne((()=>iu(o(),"m"))),gt=ne((()=>t.showNextPrevButtons&&iu(o(),"m")&&!q()&&t.nextButtonActive)),bt=ne((()=>t.showNextPrevButtons&&iu(o(),"m")&&!q()&&t.prevButtonActive)),yt=ne((()=>!q()&&!!l())),wt=ne((()=>u()!==f.ChromecastState.NOT_AVAILABLE&&!(d()&&1===c())&&iu(o(),"m")&&!Ge)),St=ne((()=>t.showAutoplayNext&&!W()&&iu(o(),"s"))),xt=ne((()=>la($e,"$availableSubtitlesList$",i).length>0&&iu(o(),"m"))),$t=ne((()=>la(Le,"$contextMenuOpenedByKeyboard$",i)||la(Ee,"$showContextMenuBtn$",i))),_t=ne((()=>iu(o(),"s")&&!q())),kt=ne((()=>!t.logoHidden&&!q())),Et=ne((()=>Z.features.fullscreen&&(t.logoHidden||iu(o(),rt?"xs":"s"))&&!(d()&&1===c())&&(!Ge||Q()))),At=ne((()=>(!l()||q())&&!(Z.features.interactiveHideTime&&Ge))),Lt=ne((()=>h().width>100)),Pt=ne((()=>Ye&&iu(o(),"m"))),Mt=ne((()=>rt?Ze&&iu(o(),"s"):Ze)),It=ne((()=>rt?Xe&&iu(o(),"s"):Xe)),Vt=ne((()=>!q()&&!l()&&!!Se?.length&&Tt(vt)&&!Tt(at))),Nt=ne((()=>!p()||!!la(fe,"$isActiveLive$",i))),Dt=ne((()=>v()?Me("tooltip_interactive_graph_on"):Me("tooltip_interactive_graph_off"))),Ot=ne((()=>la(Ce,"$contextMenuVisible$",i)?Me("aria_label_context_menu_close"):Me("aria_label_context_menu_open"))),Ft=ne((()=>((e,t)=>e?t&&t===f.PlaybackState.PAUSED?Me("tooltip_play"):"":Me("tooltip_live"))(Tt(Nt),s()))),jt=ne((()=>"vk_video"===Z.logoType?Me("tooltip_vk_video_logo"):Me("tooltip_vk_logo"))),zt=ne((()=>Tt(ht)?Me("tooltip_subtitles_on"):Me("tooltip_subtitles_off"))),Ut=ne((()=>g()?Me("tooltip_fullscreen_on"):Me("tooltip_fullscreen_off"))),qt=ne((()=>u()===f.ChromecastState.CONNECTED?Me("tooltip_chromecast_on"):Me("tooltip_chromecast_off"))),Ht=ne((()=>la(Ue,"$autoplayNextEnabled",i)?Me("tooltip_autoplay_on"):Me("tooltip_autoplay_off"))),Wt=te(0),Qt=Ae({}),Gt=ne((()=>we.prevButton)),Kt=ne((()=>we.replayButton)),Yt=ne((()=>we.playButton)),Zt=ne((()=>we.nextButton)),Xt=ne((()=>we.playPrevChapterButton)),Jt=ne((()=>we.seekToInteractiveButton)),ei=ne((()=>we.interactiveGraphButton)),ti=ne((()=>we.liveButton)),ii=ne((()=>we.time)),ri=ne((()=>we.episodes)),ai=ne((()=>we.vkLogo)),si=ne((()=>we.volume)),ni=ne((()=>we.subtitles)),oi=ne((()=>we.settings)),li=ne((()=>we.context)),ui=ne((()=>we.fullscreen)),di=ne((()=>we.chromecast)),ci=ne((()=>({prevButton:b()?b().right-b().left:0,replayButton:y()?y().right-y().left:0,playButton:w()?w().right-w().left:0,nextButton:S()?S().right-S().left:0,playPrevChapterButton:x()?x().right-x().left:0,seekToInteractiveButton:$()?$().right-$().left:0,interactiveGraphButton:_()?_().right-_().left:0,liveButton:k()?k().right-k().left:0,time:T()?T().right-T().left:0,episodes:C()?C().right-C().left:0,vkLogo:E()?E().right-E().left:0,volume:A()?A().right-A().left:0,subtitles:L()?L().right-L().left:0,settings:P()?P().right-P().left:0,context:M()?M().right-M().left:0,fullscreen:I()?I().right-I().left:0,chromecast:R()?R().right-R().left:0,additionalButtons:V().length?V().reduce((e=>[...e,40]),[]):[]}))),hi=te(0);Rt((()=>{(!Tt(hi)||Tt(hi)<Tt(ci).time)&&Ct((()=>re(hi,Ae(Tt(ci).time))))}));let mi=te(!1);Rt((()=>{let e=0;Tt(Vt)&&(e=iu(o(),"xl")?Tt(ci).time:60);let t=Tt(ci).prevButton+Tt(ci).playButton+Tt(ci).nextButton+Tt(ci).seekToInteractiveButton+Tt(ci).interactiveGraphButton+Tt(ci).liveButton+Tt(hi)+e;re(mi,Ae(Tt(At)&&Tt(Wt)>=t))}));let vi=ne((()=>Tt(mi)&&iu(o(),"m"))),gi=(0,m.debounceFn)(bd,260);Rt((()=>{h(),la(Ke,"$isInteractiveTime$",i),gi(qe(),we,Qt,t.showControls)}));let bi=ra();function yi(){Lo({isAudioDisabled:ce,audioDisabledHintCallback:se,isAudioAvailable:la(de,"$isAudioAvailable$",i),audioIsNotExistHintCallback:ae})&&X()}Rt((()=>{N(),B()&&Ct((()=>Sn(B(),N(),ye)))})),Rt((()=>{D(),Ct((()=>yd(Pe,D(),undefined)))}));let wi=Ge?He:J,Si=ne((()=>null!==O())),xi=ne((()=>Tt(Si)?O():Tt(ct))),$i=ne((()=>Tt(xi)?Me("tooltip_pause"):Me("tooltip_play"))),_i=Me("tooltip_episodes"),ki=ne((()=>Tt(bt)?{id:"prevButton",type:"desktop-control-panel-left",weight:Cd,buttonComponent:Fd,buttonComponentProps:{disabled:!t.prevButtonActive,type:"prev",click:We.bind(null,!0)},tooltipEnabled:!K.callbacks?.uiInfo?.onPrevButtonMouseEnter&&!K.callbacks?.uiInfo?.onPrevButtonMouseLeave,mouseEnter:()=>{K.callbacks?.uiInfo?.onPrevButtonMouseEnter?.(gd(qe(),Qt,"prevButton",t.showControls))},mouseLeave:()=>{K.callbacks?.uiInfo?.onPrevButtonMouseLeave?.(gd(qe(),Qt,"prevButton",t.showControls))},tooltipText:Me("tooltip_previous"),disabled:!t.prevButtonActive}:void 0)),Ti=ne((()=>Tt(ft)?{id:"replayButton",type:"desktop-control-panel-left",weight:Ed,buttonComponent:Wd,buttonComponentProps:{disabled:Tt(lt),click:wi},tooltipText:Me("tooltip_restart"),disabled:Tt(lt)}:void 0)),Ci=ne((()=>Tt(mt)?{id:"playButton",type:"desktop-control-panel-left",weight:Ad,buttonComponent:ec,buttonComponentProps:{disabled:Tt(ot),isPlaying:Tt(ct),click:J},tooltipText:Tt($i),disabled:Tt(ot)}:void 0)),Ei=ne((()=>Tt(gt)?{id:"nextButton",type:"desktop-control-panel-left",weight:Ld,buttonComponent:Fd,buttonComponentProps:{disabled:!t.nextButtonActive,type:"next",click:Qe.bind(null,!0)},tooltipEnabled:!K.callbacks?.uiInfo?.onNextButtonMouseEnter&&!K.callbacks?.uiInfo?.onNextButtonMouseLeave,mouseEnter:()=>{K.callbacks?.uiInfo?.onNextButtonMouseEnter?.(gd(qe(),Qt,"nextButton",t.showControls))},mouseLeave:()=>{K.callbacks?.uiInfo?.onNextButtonMouseLeave?.(gd(qe(),Qt,"nextButton",t.showControls))},tooltipText:Me("tooltip_next"),disabled:!t.nextButtonActive}:void 0)),Ai=ne((()=>Ge&&Tt(It)?{id:"playPrevChapterButton",type:"desktop-control-panel-left",weight:Pd,buttonComponent:ic,buttonComponentProps:{disabled:Tt(ut),click:t.playPrevChapter},tooltipText:Me("tooltip_interactive_go_back"),disabledTooltipContent:Me(et),disabled:Tt(ut)}:void 0)),Li=ne((()=>Ge&&Tt(Mt)?{id:"seekToInteractiveButton",type:"desktop-control-panel-left",weight:Md,buttonComponent:oc,buttonComponentProps:{disabled:Tt(nt),click:t.seekToInteractive},tooltipText:Me("tooltip_interactive_seek"),disabled:Tt(nt),disabledTooltipContent:Me(la(tt,"$seekToInteractiveDisabledTooltip$",i))}:void 0)),Pi=ne((()=>Ge&&Tt(Pt)?{id:"interactiveGraphButton",type:"desktop-control-panel-left",weight:Id,buttonComponent:cc,buttonComponentProps:{disabled:Tt(st),click:it.toggle,graphIsOpened:v()},tooltipText:Tt(Dt)}:void 0)),Mi=ne((()=>Tt(yt)?{id:"liveButton",type:"desktop-control-panel-left",weight:Rd,buttonComponent:hc,buttonComponentProps:{isLiveActive:Tt(Nt),ariaLabel:Tt(Ft)},tooltipText:Tt(Ft),disabled:Tt(Nt)&&s()===f.PlaybackState.PLAYING}:void 0)),Ii=ne((()=>[Tt(ki),Tt(Ti),Tt(Ci),Tt(Ei),Tt(Ai),Tt(Li),Tt(Pi),Tt(Mi)].filter((e=>!!e)).sort(On))),Ri=ne((()=>Tt(kt)?{id:"vkLogo",type:"desktop-control-panel-right",weight:vc,buttonComponent:vu,buttonComponentProps:{targetUrl:H(),logoClickable:t.logoClickable,click:ee},tooltipText:Tt(jt),disabledTooltipContent:"",disabled:!t.logoClickable}:void 0)),Vi=ne((()=>Tt(St)?{id:"autoplayNext",type:"desktop-control-panel-right",weight:gc,buttonComponent:sc,tooltipText:Tt(Ht)}:void 0)),Ni=ne((()=>({id:"volume",type:"desktop-control-panel-right",weight:bc,buttonComponent:ou,buttonComponentProps:{click:yi}}))),Bi=ne((()=>Tt(xt)?{id:"subtitles",type:"desktop-control-panel-right",weight:yc,buttonComponent:xl,buttonComponentProps:{isSubtitlesEnabled:Tt(ht),click:ie},tooltipText:Tt(zt)}:void 0)),Di=ne((()=>Tt(_t)?{id:"settings",type:"desktop-control-panel-right",weight:wc,buttonComponent:bl,buttonComponentProps:{ref$:bi},tooltipText:N()?void 0:Me("tooltip_settings_off")}:void 0)),Oi=ne((()=>Z.features.contextMenuButton?{id:"context",type:"desktop-control-panel-right",weight:Sc,buttonComponent:Sd,buttonComponentProps:{click:t.toggleFullscreen,ariaLabel:Tt(Ot)},className:Tt($t)?"":"out-of-view",tooltipText:Tt(Ot)}:void 0)),Fi=ne((()=>Tt(Et)?{id:"fullscreen",type:"desktop-control-panel-right",weight:xc,buttonComponent:cu,buttonComponentProps:{isFullscreen:g(),click:t.toggleFullscreen},tooltipText:Tt(Ut)}:void 0)),Ui=ne((()=>Tt(wt)?{id:"chromecast",type:"desktop-control-panel-right",weight:$c,buttonComponent:wu,buttonComponentProps:{state:u(),click:dt},tooltipText:Tt(qt)}:void 0)),qi=ne((()=>[Tt(Ri),Tt(Vi),Tt(Ni),Tt(Bi),Tt(Di),Tt(Oi),Tt(Fi),Tt(Ui),...V()].filter((e=>!!e)).sort(On)));var Hi=_c(),Wi=Be(Hi);let Qi;var Gi=Ne(Wi);let Ki=ne((()=>!Tt(Lt)));Ou(Gi,{get isHidden(){return Tt(Ki)},get isAds(){return q()},get canRewindLive(){return t.canRewindLive},get isRewindableLive(){return p()},get ref(){return Qt.timeline},set ref(e){Qt.timeline=e}});var Yi=De(Gi,2),Zi=Ne(Yi),Ji=Ne(Zi);ar(Ji,17,(()=>Tt(Ii)),(e=>e.id),((e,t)=>{Td(e,{get buttonComponent(){return Tt(t).buttonComponent},get buttonComponentProps(){return Tt(t).buttonComponentProps},get tooltipText(){return Tt(t).tooltipText},get disabledTooltipContent(){return Tt(t).disabledTooltipContent},get disabled(){return Tt(t).disabled},get className(){return Tt(t).className},get tooltipEnabled(){return Tt(t).tooltipEnabled},get mouseEnter(){return Tt(t).mouseEnter},get mouseLeave(){return Tt(t).mouseLeave},get ref(){return Qt[Tt(t).id]},set ref(e){Qt[Tt(t).id]=e}})}));var er=De(Ji,2),tr=e=>{let t=ne((()=>q()?la(Re,"$adPosition",i):F())),r=ne((()=>q()?la(Ie,"$adDuration",i):j()));Tl(e,{isMobile:!1,get showDuration(){return Tt(vi)},get position(){return Tt(t)},get duration(){return Tt(r)},get ref(){return Qt.time},set ref(e){Qt.time=e}})};Xi(er,(e=>{Tt(At)&&e(tr)}));var ir=De(er,2);let rr=ne((()=>!Tt(Vt)));Ol(ir,{className:"w-max",get disabled(){return Tt(rr)},tooltipContent:_i,get ref(){return Qt.episodes},set ref(e){Qt.episodes=e},children:(e,t)=>{var i=ji(),r=Be(i),a=e=>{Qu(e,{get position(){return F()},get duration(){return j()},timeCodes:Se})};Xi(r,(e=>{Tt(Vt)&&e(a)})),zi(e,i)},$$slots:{default:!0}}),Te(Zi);var sr=De(Zi,2);ar(sr,21,(()=>Tt(qi)),(e=>e.id),((e,t)=>{var i=ji(),r=Be(i),a=e=>{Td(e,{get buttonComponent(){return Tt(t).buttonComponent},get buttonComponentProps(){return Tt(t).buttonComponentProps},get tooltipText(){return Tt(t).tooltipText},get disabledTooltipContent(){return Tt(t).disabledTooltipContent},get disabled(){return Tt(t).disabled},get className(){return Tt(t).className},get ref(){return Qt[Tt(t).id]},set ref(e){Qt[Tt(t).id]=e}})},s=e=>{let i=ne((()=>!!Tt(t).disabled));!function(e,t){pi(t,!0);let i=ma(t,"disabled",3,!1),r=ma(t,"onClick",3,m.noop),a=ma(t,"ref",15),s=ne((()=>r()===m.noop)),n=ne((()=>Tt(s)||i())),o=ne((()=>Tt(s)?"btn-full-opacity":""));Ol(e,{get disabled(){return Tt(n)},get tooltipContent(){return t.tooltipText},get disabledTooltipContent(){return t.disabledTooltipContent},width:40,get ref(){return a()},set ref(e){a(e)},children:(e,i)=>{let a=ne((()=>t.testId??t.id));jo(e,{get className(){return Tt(o)},get ariaLabel(){return t.ariaLabel},get click(){return r()},get disabled(){return Tt(n)},get testId(){return Tt(a)},children:(e,i)=>{mc(e,{get icon(){return t.icon}})},$$slots:{default:!0}})},$$slots:{default:!0}}),fi()}(e,{get id(){return Tt(t).id},get testId(){return Tt(t).testId},get icon(){return Tt(t).icon},get ariaLabel(){return Tt(t).ariaLabel},get tooltipText(){return Tt(t).tooltipText},get disabledTooltipContent(){return Tt(t).disabledTooltipContent},get disabled(){return Tt(i)},get onClick(){return Tt(t).onClick},get ref(){return Qt[Tt(t).id]},set ref(e){Qt[Tt(t).id]=e}})};Xi(r,(e=>{(e=>!!e.buttonComponent)(Tt(t))?e(a):e(s,!1)})),zi(e,i)})),Te(sr),Te(Yi),Kr(Yi,(e=>U(e)),(()=>U())),Te(Wi),Kr(Wi,(e=>z(e)),(()=>z()));var nr=De(Wi,2),or=e=>{kd(e,{get ref(){return Qt.interactiveTimeIndicator},set ref(e){Qt.interactiveTimeIndicator=e}})};Xi(nr,(e=>{Je&&e(or)})),Bt((e=>Qi=xr(Wi,1,"wrapper-bottom svelte-1iedtj3",null,Qi,e)),[()=>({hidden:t.bottomHidden,"controls-hidden":!t.showControls,"no-smooth":t.bottomNoSmooth})]),Qr(Zi,"clientWidth",(e=>re(Wt,e))),zi(e,Hi),fi(),r()}var Cc=Di('<div class="icon icon-error-stub svelte-167ouw6"><div class="inner svelte-167ouw6"></div></div>'),Ec=Di('<img class="icon svelte-167ouw6" aria-hidden="true">'),Ac={hash:"svelte-167ouw6",code:".icon.svelte-167ouw6 {width:24px !important;height:24px !important;}.inner.svelte-167ouw6 {width:16px;height:16px;background-color:var(--white);}"};var Lc=Oi('<svg><!><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z"></path><path fill="var(--btn-color, #fff)" d="M8.695 8.105 5.301 4.71a1 1 0 0 1 1.414-1.415L20.7 17.285a1 1 0 0 1-1.414 1.415L16 15.41V20a1 1 0 0 1-1 1c-.641 0-1.258-.25-1.72-.695L7.79 15H5a2 2 0 0 1-2-2v-2a2 2 0 0 1 2-2h2.765zm2.88-2.77 1.704-1.642A2.48 2.48 0 0 1 15 3a1 1 0 0 1 1 1v5.76l-4.426-4.426Z"></path></g></svg>');function Pc(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=Lc();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24","aria-hidden":"true","data-testid":"muted-icon",role:"img",...i}))),zi(e,r)}var Mc=Di('<span class="text svelte-6gmlbk"> </span>'),Ic=Di('<div aria-hidden="true"><!> <!></div>'),Rc={hash:"svelte-6gmlbk",code:".container.svelte-6gmlbk {display:flex;align-items:center;}.expanded.svelte-6gmlbk {background-color:rgba(0, 0, 0, 0.56);border-radius:6px;}.text.svelte-6gmlbk {font-size:15px;margin-left:8px;}"};function Vc(e,t){pi(t,!0),vr(e,Rc);let i=ma(t,"muted",3,!1),r=ma(t,"expanded",3,!1),a=ma(t,"click",3,m.noop),s=ma(t,"ref",15,void 0),n=Oa().ui.t,o=ne((()=>i()?n("tooltip_volume"):n("tooltip_volume_muted"))),l=ne((()=>r()?Al:Pc)),u=ne((()=>r()?"btn-mobile-unmuted":"btn-mobile-muted"));jo(e,{get testId(){return Tt(u)},get click(){return a()},get ariaLabel(){return Tt(o)},get ref(){return s()},set ref(e){s(e)},children:(e,t)=>{var i=Ic();let a,s=ne((()=>Tt(l)));var o=Ne(i);pr(o,(()=>Tt(s)),((e,t)=>{t(e,{})}));var u=De(o,2),d=e=>{var t=Mc(),i=Ne(t,!0);Te(t),Bt((e=>Hi(i,e)),[()=>n("mobile_unmute")]),zi(e,t)};Xi(u,(e=>{r()&&e(d)})),Te(i),Bt((e=>a=xr(i,1,"container svelte-6gmlbk",null,a,e)),[()=>({expanded:r()})]),zi(e,i)},$$slots:{default:!0}}),fi()}var Nc=Oi('<svg><!><path fill="var(--btn-color, #fff)" d="M7.662 4h6.676c.808 0 1.469 0 2.006.044.556.045 1.058.142 1.526.381a3.9 3.9 0 0 1 1.705 1.704c.239.47.336.971.381 1.527C20 8.193 20 8.854 20 9.662V11.1a.9.9 0 0 1-1.8 0V9.7c0-.855 0-1.442-.038-1.897-.036-.445-.103-.684-.19-.856a2.1 2.1 0 0 0-.919-.918c-.172-.088-.411-.155-.856-.191C15.742 5.8 15.155 5.8 14.3 5.8H7.7c-.855 0-1.442 0-1.897.038-.445.036-.684.103-.856.19a2.1 2.1 0 0 0-.918.919c-.088.172-.155.411-.191.856C3.8 8.258 3.8 8.845 3.8 9.7v2.646c0 .855 0 1.442.038 1.897.036.445.103.683.19.856a2.1 2.1 0 0 0 .919.918c.172.088.411.155.856.191.455.037 1.042.038 1.897.038h2.4a.9.9 0 0 1 0 1.8H7.662c-.808 0-1.469 0-2.006-.044-.556-.045-1.058-.142-1.527-.381a3.9 3.9 0 0 1-1.704-1.704c-.239-.47-.336-.972-.381-1.527C2 13.852 2 13.192 2 12.384V9.662c0-.808 0-1.469.044-2.006.045-.556.142-1.058.381-1.527A3.9 3.9 0 0 1 4.13 4.425c.47-.239.971-.336 1.527-.381C6.193 4 6.854 4 7.662 4M13 16.8c0-.98 0-1.47.19-1.845a1.75 1.75 0 0 1 .766-.764C14.33 14 14.82 14 15.8 14h3.4c.98 0 1.47 0 1.845.19.329.168.596.436.764.766.191.374.191.864.191 1.844v.4c0 .98 0 1.47-.19 1.845a1.75 1.75 0 0 1-.765.764C20.67 20 20.18 20 19.2 20h-3.4c-.98 0-1.47 0-1.845-.19a1.75 1.75 0 0 1-.764-.765C13 18.67 13 18.18 13 17.2z" clip-rule="evenodd"></path><path fill="var(--btn-color, #fff)" d="m11.643 12.37-.007-.006L9.073 9.8H10.1a.9.9 0 1 0 0-1.8H6.9a.9.9 0 0 0-.9.9v3.2a.9.9 0 0 0 1.8 0v-1.022l2.53 2.524.134.134a.9.9 0 0 0 1.272-1.272z" class="hidden-not-active"></path><path fill="var(--btn-color, #fff)" d="m6.357 9.63.007.006L8.927 12.2H7.9a.9.9 0 1 0 0 1.8h3.2a.9.9 0 0 0 .9-.9V9.9a.9.9 0 0 0-1.8 0v1.022L7.67 8.397l-.134-.133a.9.9 0 0 0-1.272 1.272z" class="hidden-active"></path></svg>');var Bc={hash:"svelte-tmam00",code:'svg[data-testid="pip-icon--active"] .hidden-active,\n  svg[data-testid="pip-icon"] .hidden-not-active {visibility:hidden;opacity:0;}'};function Dc(e,t){vr(e,Bc);let i=ma(t,"isActive",3,!1),r=ne((()=>i()?"color: #2688EB;":"color: #fff;")),a=ne((()=>i()?"pip-icon--active":"pip-icon"));!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=Nc();let a;hr(Ne(r),(()=>t.children??D)),Ce(3),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",role:"img",...i}))),zi(e,r)}(e,{get style(){return Tt(r)},get"data-testid"(){return Tt(a)}})}var Oc=(e,t,i,r)=>{Tt(t)&&i.onDisabledPlayPrevChapterClick(Tt(r))},Fc=(e,t,i,r)=>{Tt(t)&&i.onDisabledSeekToInteractiveClick(Tt(r))},jc=Di("<div><!></div>"),zc=Di("<div><!></div>"),Uc=Di("<div><!></div>"),qc=Di("<!> <!> <!>",1),Hc=Di("<div></div> <div><!></div> <div><!> <!> <!> <!> <!> <!></div> <div><!> <!> <!> <!></div> <!>",1),Wc=Di("<div><!></div>"),Qc=Di('<div class="wrapper-middle svelte-1afsgkw"><!></div>'),Gc=Di("<!>  <!> <div><!></div>",1),Kc=Di('<div aria-hidden="true">·</div> <!>',1),Yc=Di("<!> <!> <div><div><div><!> <!> <!> <!> <!> <!></div> <!></div></div> <!>",1),Zc={hash:"svelte-1afsgkw",code:".wrapper-bottom.svelte-1afsgkw {pointer-events:none;position:absolute;z-index:var(--controls-container-z-index);width:100%;bottom:0;left:0;height:var(--controls-gradient-height);background:var(--controls-gradient);transition:transform var(--controls-transition-duration) var(--controls-transition-fn);display:flex;flex-direction:column;justify-content:flex-end;box-sizing:border-box;padding:0 4px 8px;}.wrapper-bottom.svelte-1afsgkw > :where(.svelte-1afsgkw) {pointer-events:auto;}.wrapper-bottom.ads-timeline-mobile.svelte-1afsgkw {height:9px;padding:0 4px 4px;}.wrapper-middle.svelte-1afsgkw {position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transition:opacity var(--controls-transition-duration);display:flex;align-items:center;z-index:var(--controls-container-z-index);}.wrapper-top-right.svelte-1afsgkw {position:absolute;top:4px;right:8px;transition:opacity var(--controls-transition-duration);display:flex;z-index:var(--controls-container-z-index);}.wrapper-top-left.svelte-1afsgkw {position:absolute;top:4px;left:8px;z-index:var(--controls-container-z-index);}.wrapper-middle-left.svelte-1afsgkw,\n  .wrapper-middle-left-second.svelte-1afsgkw,\n  .wrapper-middle-right.svelte-1afsgkw {position:absolute;top:50%;transform:translateY(-50%);height:44px;width:44px;border-radius:12px;background-color:rgba(0, 0, 0, 0.56);transition:opacity var(--controls-transition-duration);display:flex;align-items:center;justify-content:center;}.wrapper-middle-left.svelte-1afsgkw {left:12px;}.wrapper-middle-left-second.svelte-1afsgkw {left:64px;}.wrapper-middle-right.svelte-1afsgkw {right:12px;}.controls.svelte-1afsgkw {width:100%;display:flex;align-items:center;height:var(--controls-height);white-space:nowrap;font-size:13px;transition:transform var(--controls-transition-duration) var(--controls-transition-fn);will-change:transform;padding:0 4px;box-sizing:border-box;}.controls.svelte-1afsgkw > *:not(:first-child) {margin-left:8px;}.hidden.svelte-1afsgkw {visibility:hidden;opacity:0;}.controls-hidden.svelte-1afsgkw {visibility:visible; /* if hidden then slider will lose focus (if was focused) */transform:translateY(100%);}.wrapper-bottom.no-smooth.svelte-1afsgkw {transition:none;}.overlay-mobile.svelte-1afsgkw {position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0, 0, 0, .3);pointer-events:none;transition:opacity var(--controls-transition-duration);}\n\n  @media screen and (orientation: portrait) {.wrapper-top-right.fullscreen.svelte-1afsgkw {top:16px;}.wrapper-top-left.fullscreen.svelte-1afsgkw {top:16px;}.controls-wrapper.fullscreen.svelte-1afsgkw {position:absolute;bottom:30px;width:calc(100% - 8px);}\n  }\n\n  @media screen and (orientation: landscape) {.wrapper-top-left.fullscreen.svelte-1afsgkw {top:12px;left:44px;}.wrapper-top-right.fullscreen.svelte-1afsgkw {top:12px;right:44px;}.wrapper-middle-left.fullscreen.svelte-1afsgkw {left:44px;}.wrapper-middle-left-second.fullscreen.svelte-1afsgkw {left:96px;}.wrapper-middle-right.fullscreen.svelte-1afsgkw {right:44px;}.controls-wrapper.fullscreen.svelte-1afsgkw {position:absolute;left:36px;right:36px;bottom:32px;width:calc(100% - 72px);}\n  }"};function Xc(e,t){pi(t,!0),vr(e,Zc);let[i,r]=ua(),a=()=>la(we,"$disabledControls$",i),s=()=>la(Y,"$playbackState$",i),n=()=>la(ke,"$adPlaybackState",i),o=()=>la(J,"$isEnded$",i),l=()=>la(Ee,"$playerSize",i),u=()=>la(oe,"$scrubbingInProgress",i),d=()=>la(be,"$chromecastState$",i),c=()=>la(ue,"$isPictureInPictureActive",i),h=()=>la(de,"$pictureInPictureType$",i),p=()=>la(le,"$mobileNotReportControlHidden$",i),v=()=>la(xe,"$currentGridType$",i),g=()=>la(ee,"$isLive$",i),b=()=>la(pe,"$settingsMenuVisible",i),y=()=>la(se,"$isRewindableLive$",i),w=()=>la(Z,"$isAudioAvailable$",i),S=()=>la(_t,"$settingButtonRef$",i),x=()=>la(Ce,"$isFullscreen",i),$=()=>la(he,"$mobileUnmuteButtonVisible",i),_=()=>la(ie,"$muted$",i),k=()=>la(Le,"$additionalButtons$",i),T=()=>la(Ue,"$graphIsOpened$",i),C=()=>la(_e,"$adPosition",i),E=()=>la($e,"$adDuration",i),A=()=>la(K,"$position$",i),L=()=>la(G,"$duration$",i),P=ma(t,"playerControlsWrapperRef",15,void 0),M=ma(t,"playerControlsRef",15,void 0),I=ma(t,"isAds",3,!1),R=ma(t,"logoTargetUrl",3,""),V=ma(t,"isOneVideoPlaylist",3,!1),N=ma(t,"customFullscreenSupported",3,!0),B=Oa(),D=Fa(),O=ya(),F=B.actions.internal.toggleMuted,j=B.actions.internal.togglePlay,z=B.actions.internal.pause,U=B.actions.internal.prevVideoClick,q=B.actions.internal.nextVideoClick,H=B.callbacks?.onAudioDoesNotExistHint,W=B.callbacks?.onAudioDisabledHint,Q=B.playerPhase,G=B.state.duration$,K=B.state.positionWithScrubbing$,Y=B.state.playbackState$,Z=B.state.isAudioAvailable$,X=B.state.isAudioDisabled,J=B.state.isEnded$,ee=B.state.isLive$,ie=B.state.muted$,ae=B.state.isActiveLive$,se=B.state.isRewindableLive$,oe=B.ui.scrubbingInProgress,le=B.ui.mobileNotReportControlHidden$,{isActive$:ue,type$:de}=D.pictureInPicture$,ce=B.ui.mobileUnmuteButtonExpanded,he=B.ui.mobileUnmuteButtonVisible,pe=B.ui.settingsMenu.visible$,fe=B.ui.settingsMenu.openedByBtnKeyboard$,me=B.ui.controls,ve=B.actions.internal.getVideoEpisodes(),ge=B.webApi.pictureInPictureApi,be=B.state.chromecastState$,ye=B.state.crashed$,we=me.disabledControls$,Se=B.ui.startedByKeyboard$,xe=B.ui.currentGridType$,$e=B.ads.duration,_e=B.ads.position,ke=B.ads.playbackState,Ce=B.ui.isFullscreen,Ee=B.ui.playerSize,Le=B.ui.additionalButtonsDeprecated$,Pe=B.actions.internal.getVideoElement,Me=B.actions.internal.replayInteractive,Ie=B.state.isInteractive,Re=B.state.isInteractiveTime$,Ve=B.state.showInteractiveGraph,Oe=B.state.showSeekToInteractive,Fe=B.state.showPlayPrevChapter,je=B.state.showInteractiveTimeIndicator,ze=D.seekToInteractiveDisabledTooltip$,Ue=D.graphIsOpened$,qe=ne((()=>Es(B.state.playPrevChapterDisabledTooltip))),He=ne((()=>Es(la(ze,"$seekToInteractiveDisabledTooltip$",i)))),We=ne((()=>a().has("EPISODE_BUTTON"))),Qe=ne((()=>a().has("GRAPH_BUTTON"))),Ge=ne((()=>a().has("SEEK_TO_INTERACTIVE_BUTTON"))),Ke=ne((()=>a().has("PLAY_BUTTON"))),Ye=ne((()=>a().has("REPLAY_BUTTON"))),Ze=ne((()=>a().has("PLAY_PREV_CHAPTER_BUTTON"))),Xe=ne((()=>s()===f.PlaybackState.PLAYING)),Je=ne((()=>"paused"===n())),et=ne((()=>o()&&!I()&&!Ie)),tt=ne((()=>!o()||I())),it=ne((()=>t.showNextPrevButtons&&!I()&&t.prevButtonActive)),rt=ne((()=>t.showNextPrevButtons&&!I()&&t.nextButtonActive)),at=ne((()=>l().width>300)),st=ne((()=>l().width>400)),nt=ne(u),ot=ne((()=>!(d()===f.ChromecastState.NOT_AVAILABLE||c()&&1===h()||p()||Ie))),lt=ne((()=>"LiveWaitingStart"===la(Q,"$playerPhase",i))),ut=ne((()=>!!ge&&d()!==f.ChromecastState.CONNECTED&&!p()&&(1===h()&&Tt(lt)||!Tt(lt))&&!Tt(nt)&&!Ie)),dt=ne((()=>!Tt(nt)&&iu(v(),"s"))),ct=ne((()=>!t.logoHidden&&l().width>350)),ht=ne((()=>O.features.fullscreen&&!(c()&&1===h())&&(!Ie||N())&&!Tt(nt))),pt=ne((()=>(!g()||I())&&l().width>260&&!Tt(nt)&&!(O.features.interactiveHideTime&&Ie))),ft=ne((()=>b()||t.showControls)),mt=ne((()=>!I()&&!g()&&!!ve?.length&&Tt(at)&&!Tt(We)&&!Tt(nt))),vt=ne((()=>!y()||!!la(ae,"$isActiveLive$",i))),gt=ne((()=>Ve&&iu(v(),"m"))),bt=Ae({}),yt=(0,m.debounceFn)(bd,260);Rt((()=>{l(),la(Re,"$isInteractiveTime$",i),yt(Pe(),me,bt,t.showControls)}));let wt=()=>B.actions.internal.toggleChromecast();async function St(){ge?.isActive()?await(ge?.remove()):await(ge?.request())}function xt(){!X&&w()&&he.set(!1),Lo({isAudioDisabled:X,audioDisabledHintCallback:W,isAudioAvailable:w(),audioIsNotExistHintCallback:H})&&F()}let $t=te("");Rt((()=>{var e,t;e=Tt(vt),t=s(),e?t&&t===f.PlaybackState.PAUSED&&re($t,Ae(Es("tooltip_play"))):re($t,Ae(Es("tooltip_live")))}));let _t=ra();Rt((()=>{S()&&Sn(S(),b(),fe)})),Rt((()=>{yd(Se,la(Se,"$startedByKeyboard$",i),bt.playButton)}));var kt=Yc(),Ct=Be(kt),Et=e=>{var r=Hc(),a=Be(r);let s;var n=De(a,2);let o;var l=Ne(n),h=e=>{let t=ne((()=>w()&&!X&&la(ce,"$mobileUnmuteButtonExpanded",i)));Vc(e,{get muted(){return _()},get expanded(){return Tt(t)},click:xt,get ref(){return bt.volume},set ref(e){bt.volume=e}})};Xi(l,(e=>{(!w()||$())&&e(h)})),Te(n);var f=De(n,2);let v;var g=Ne(f);ar(g,1,k,(({iconUrl:e,ariaLabel:t,testId:i,onClick:r,tooltip:a})=>e),((e,t)=>{let i=ne((()=>Tt(t).ariaLabel??Tt(t).tooltip));!function(e,t){vr(e,Ac);let i=ma(t,"disabled",3,!1),r=ma(t,"onClick",3,m.noop),a=ne((()=>r()===m.noop)),s=ne((()=>Tt(a)||i())),n=te(!1),o=()=>{re(n,!0)},l=ne((()=>Tt(a)?"btn-full-opacity":""));jo(e,{get className(){return Tt(l)},get ariaLabel(){return t.ariaLabel},get click(){return r()},get disabled(){return Tt(s)},get testId(){return t.testId},children:(e,i)=>{var r=ji(),a=Be(r),s=e=>{zi(e,Cc())},l=e=>{var i=Ec();Bt((()=>Lr(i,"src",t.iconUrl))),Ii("error",i,o),Pi(i),zi(e,i)};Xi(a,(e=>{Tt(n)?e(s):e(l,!1)})),zi(e,r)},$$slots:{default:!0}})}(e,{get iconUrl(){return Tt(t).iconUrl},get ariaLabel(){return Tt(i)},get testId(){return Tt(t).testId},get onClick(){return Tt(t).onClick}})}));var b=De(g,2),y=e=>{sc(e,{get ref(){return bt.autoplayNextToggle},set ref(e){bt.autoplayNextToggle=e}})};Xi(b,(e=>{t.showAutoplayNext&&!V()&&e(y)}));var S=De(b,2),C=e=>{wu(e,{isMobile:!0,click:wt,get state(){return d()},get ref(){return bt.chromecast},set ref(e){bt.chromecast=e}})};Xi(S,(e=>{Tt(ot)&&e(C)}));var E=De(S,2),A=e=>{!function(e,t){pi(t,!0);let i=ma(t,"ref",15,void 0),r=ma(t,"isPictureInPictureActive",3,!1),a=ma(t,"click",3,m.noop);jo(e,{testId:"btn-pip",ariaLabel:Es("menu_pip"),get click(){return a()},get ref(){return i()},set ref(e){i(e)},children:(e,t)=>{Dc(e,{get isActive(){return r()}})},$$slots:{default:!0}}),fi()}(e,{click:St,get isPictureInPictureActive(){return c()},get ref(){return bt.pip},set ref(e){bt.pip=e}})};Xi(E,(e=>{Tt(ut)&&e(A)}));var L=De(E,2),P=e=>{bl(e,{ref$:_t})};Xi(L,(e=>{la(ye,"$crashed$",i)&&e(P)}));var M=De(L,2),I=e=>{vu(e,{click:z,get targetUrl(){return R()},get logoClickable(){return t.logoClickable},get ref(){return bt.vkLogo},set ref(e){bt.vkLogo=e}})};Xi(M,(e=>{Tt(ct)&&e(I)})),Te(f);var N=De(f,2);let B;var D=Ne(N),O=e=>{let t=ne((()=>U.bind(null,!0)));Fd(e,{get click(){return Tt(t)},type:"prev",isMobile:!0,get ref(){return bt.prevButton},set ref(e){bt.prevButton=e}})};Xi(D,(e=>{Tt(it)&&e(O)}));var F=De(D,2),H=e=>{ec(e,{get disabled(){return Tt(Ke)},click:j,isMobile:!0,get isPlaying(){return Tt(Xe)},get ref(){return bt.playButton},set ref(e){bt.playButton=e}})};Xi(F,(e=>{Tt(tt)&&e(H)}));var W=De(F,2),Q=e=>{Wd(e,{get disabled(){return Tt(Ye)},click:j,isMobile:!0,get ref(){return bt.replayButton},set ref(e){bt.replayButton=e}})};Xi(W,(e=>{Tt(et)&&e(Q)}));var G=De(W,2),K=e=>{let t=ne((()=>q.bind(null,!0)));Fd(e,{get click(){return Tt(t)},type:"next",isMobile:!0,get ref(){return bt.nextButton},set ref(e){bt.nextButton=e}})};Xi(G,(e=>{Tt(rt)&&e(K)})),Te(N);var Y=De(N,2),Z=e=>{var i=qc(),r=Be(i),a=e=>{var i=jc();let r;i.__click=[Oc,Ze,t,qe];var a=Ne(i);let s=ne((()=>!t.showControls));ic(a,{get hidden(){return Tt(s)},get disabled(){return Tt(Ze)},get click(){return t.playPrevChapter},get ref(){return bt.playPrevChapterButton},set ref(e){bt.playPrevChapterButton=e}}),Te(i),Bt((e=>r=xr(i,1,"wrapper-middle-left svelte-1afsgkw",null,r,e)),[()=>({fullscreen:x(),hidden:!t.showControls})]),zi(e,i)};Xi(r,(e=>{Fe&&e(a)}));var s=De(r,2),n=e=>{var i=zc();let r;var a=Ne(i);let s=ne((()=>!t.showControls&&!T()));cc(a,{get hidden(){return Tt(s)},get disabled(){return Tt(Qe)},get click(){return Ue.toggle},get graphIsOpened(){return T()},get ref(){return bt.interactiveGraphButton},set ref(e){bt.interactiveGraphButton=e}}),Te(i),Bt((e=>r=xr(i,1,br(Fe?"wrapper-middle-left-second":"wrapper-middle-left"),"svelte-1afsgkw",r,e)),[()=>({fullscreen:x(),hidden:!t.showControls&&!T()})]),zi(e,i)};Xi(s,(e=>{Tt(gt)&&e(n)}));var o=De(s,2),l=e=>{var i=Uc();let r;i.__click=[Fc,Ge,t,He];var a=Ne(i);let s=ne((()=>!t.showControls));oc(a,{get hidden(){return Tt(s)},get disabled(){return Tt(Ge)},get click(){return t.seekToInteractive},get ref(){return bt.seekToInteractiveButton},set ref(e){bt.seekToInteractiveButton=e}}),Te(i),Bt((e=>r=xr(i,1,"wrapper-middle-right svelte-1afsgkw",null,r,e)),[()=>({fullscreen:x(),hidden:!t.showControls})]),zi(e,i)};Xi(o,(e=>{Oe&&e(l)})),zi(e,i)};Xi(Y,(e=>{Ie&&!u()&&e(Z)})),Bt(((e,t,i,r)=>{s=xr(a,1,"overlay-mobile svelte-1afsgkw",null,s,e),o=xr(n,1,"wrapper-top-left svelte-1afsgkw",null,o,t),v=xr(f,1,"wrapper-top-right svelte-1afsgkw",null,v,i),B=xr(N,1,"wrapper-middle svelte-1afsgkw",null,B,r)}),[()=>({hidden:!Tt(ft)}),()=>({hidden:!t.showControls,fullscreen:x()}),()=>({hidden:!t.showControls&&!p(),fullscreen:x()}),()=>({hidden:!t.showControls||u()||t.endScreenShown&&t.showNextPrevButtons})]),zi(e,r)};Xi(Ct,(e=>{I()||e(Et)}));var At=De(Ct,2),Lt=e=>{var t=Gc(),i=Be(t),r=e=>{var t=Wc();let i;Vc(Ne(t),{get muted(){return _()},expanded:!1,click:xt,get ref(){return bt.volume},set ref(e){bt.volume=e}}),Te(t),Bt((e=>i=xr(t,1,"wrapper-top-right svelte-1afsgkw",null,i,e)),[()=>({fullscreen:x()})]),zi(e,t)};Xi(i,(e=>{$()&&e(r)}));var a=De(i,2),s=e=>{var t=Qc(),i=Ne(t);let r=ne((()=>!Tt(Je)));ec(i,{get disabled(){return Tt(Ke)},click:j,isMobile:!0,get isPlaying(){return Tt(r)},get ref(){return bt.playButton},set ref(e){bt.playButton=e}}),Te(t),zi(e,t)};Xi(a,(e=>{Tt(Je)&&e(s)}));var n=De(a,2);let o;Vu(Ne(n),{get position(){return C()},get duration(){return E()}}),Te(n),Bt((e=>o=xr(n,1,"wrapper-bottom ads-timeline-mobile svelte-1afsgkw",null,o,e)),[()=>({fullscreen:x()})]),zi(e,t)};Xi(At,(e=>{I()&&"inactive"!==n()&&e(Lt)}));var Pt=De(At,2);let Mt;var It=Ne(Pt);let Vt;var Nt=Ne(It);xr(Nt,1,"controls svelte-1afsgkw",null,{},{mobile:!0});var Dt=Ne(Nt),Ot=e=>{Ol(e,{get disabled(){return Tt(Ye)},get ref(){return bt.replayButton},set ref(e){bt.replayButton=e},children:(e,t)=>{Wd(e,{get disabled(){return Tt(Ye)},click:Me})},$$slots:{default:!0}})};Xi(Dt,(e=>{Ie&&e(Ot)}));var Ft=De(Dt,2),jt=e=>{Ol(e,{get ref(){return bt.liveButton},set ref(e){bt.liveButton=e},children:(e,t)=>{hc(e,{get isLiveActive(){return Tt(vt)},isMobile:!0,get ariaLabel(){return Tt($t)}})},$$slots:{default:!0}})};Xi(Ft,(e=>{!I()&&g()&&e(jt)}));var zt=De(Ft,2),Ut=e=>{let t=ne((()=>I()?C():A())),i=ne((()=>I()?E():L()));Tl(e,{get showDuration(){return Tt(st)},get position(){return Tt(t)},get duration(){return Tt(i)},isMobile:!0,get ref(){return bt.time},set ref(e){bt.time=e}})};Xi(zt,(e=>{Tt(pt)&&e(Ut)}));var qt=De(zt,2);let Ht=ne((()=>!Tt(mt)));Ol(qt,{className:"w-max",get disabled(){return Tt(Ht)},get ref(){return bt.episodes},set ref(e){bt.episodes=e},children:(e,t)=>{var i=ji(),r=Be(i),a=e=>{var t=Kc();Qu(De(Be(t),2),{get position(){return A()},get duration(){return L()},timeCodes:ve}),zi(e,t)};Xi(r,(e=>{Tt(mt)&&e(a)})),zi(e,i)},$$slots:{default:!0}});var Wt=De(qt,2),Qt=e=>{Ol(e,{get ref(){return bt.settings},set ref(e){bt.settings=e},children:(e,t)=>{bl(e,{ref$:_t})},$$slots:{default:!0}})};Xi(Wt,(e=>{Tt(dt)&&e(Qt)}));var Gt=De(Wt,2),Kt=e=>{Ol(e,{get ref(){return bt.fullscreen},set ref(e){bt.fullscreen=e},children:(e,i)=>{cu(e,{get click(){return t.toggleFullscreen},get isFullscreen(){return x()}})},$$slots:{default:!0}})};Xi(Gt,(e=>{Tt(ht)&&e(Kt)})),Te(Nt),Kr(Nt,(e=>M(e)),(()=>M())),Ou(De(Nt,2),{get isAds(){return I()},get canRewindLive(){return t.canRewindLive},get isRewindableLive(){return y()},get ref(){return bt.timeline},set ref(e){bt.timeline=e}}),Te(It),Te(Pt),Kr(Pt,(e=>P(e)),(()=>P()));var Yt=De(Pt,2),Zt=e=>{kd(e,{get ref(){return bt.interactiveTimeIndicator},set ref(e){bt.interactiveTimeIndicator=e}})};Xi(Yt,(e=>{je&&e(Zt)})),Bt(((e,t)=>{Mt=xr(Pt,1,"wrapper-bottom svelte-1afsgkw",null,Mt,e),Vt=xr(It,1,"controls-wrapper svelte-1afsgkw",null,Vt,t)}),[()=>({hidden:t.bottomHidden,"controls-hidden":!t.showControls,"no-smooth":t.bottomNoSmooth,mobile:!0}),()=>({fullscreen:x()})]),zi(e,kt),fi(),r()}function Jc(e,t){pi(t,!0);let[i,r]=ua(),a=ma(t,"bottomNoSmooth",3,!1),s=ma(t,"playerControlsWrapperRef",15,void 0),n=ma(t,"playerControlsRef",15,void 0),o=ma(t,"isAds",3,!1),l=ma(t,"logoTargetUrl",3,""),u=ma(t,"showAutoplayNext",3,!1),d=ma(t,"isOneVideoPlaylist",3,!1),c=ma(t,"customFullscreenSupported",3,!0),h=ma(t,"endScreenShown",3,!1),p=ma(t,"onDisabledPlayPrevChapterClick",3,m.noop),f=ma(t,"onDisabledSeekToInteractiveClick",3,m.noop),v=Oa().ui.isMobile,g=te(!1);Xr((()=>{let e=setTimeout((()=>re(g,!0)),0);return()=>clearTimeout(e)}));var b=ji(),y=Be(b),w=e=>{var r=ji(),m=Be(r),g=e=>{Xc(e,{get bottomHidden(){return t.bottomHidden},get bottomNoSmooth(){return a()},get showControls(){return t.showControls},get isAds(){return o()},get canRewindLive(){return t.canRewindLive},get logoClickable(){return t.logoClickable},get logoHidden(){return t.logoHidden},get logoTargetUrl(){return l()},get showAutoplayNext(){return u()},get showNextPrevButtons(){return t.showNextPrevButtons},get nextButtonActive(){return t.nextButtonActive},get prevButtonActive(){return t.prevButtonActive},get isOneVideoPlaylist(){return d()},get customFullscreenSupported(){return c()},get endScreenShown(){return h()},get toggleFullscreen(){return t.toggleFullscreen},get seekToInteractive(){return t.seekToInteractive},get playPrevChapter(){return t.playPrevChapter},get onDisabledPlayPrevChapterClick(){return p()},get onDisabledSeekToInteractiveClick(){return f()},get playerControlsWrapperRef(){return s()},set playerControlsWrapperRef(e){s(e)},get playerControlsRef(){return n()},set playerControlsRef(e){n(e)}})},b=e=>{Tc(e,{get bottomHidden(){return t.bottomHidden},get bottomNoSmooth(){return a()},get showControls(){return t.showControls},get isAds(){return o()},get canRewindLive(){return t.canRewindLive},get logoClickable(){return t.logoClickable},get logoHidden(){return t.logoHidden},get logoTargetUrl(){return l()},get isOneVideoPlaylist(){return d()},get showAutoplayNext(){return u()},get showNextPrevButtons(){return t.showNextPrevButtons},get nextButtonActive(){return t.nextButtonActive},get prevButtonActive(){return t.prevButtonActive},get customFullscreenSupported(){return c()},get toggleFullscreen(){return t.toggleFullscreen},get seekToInteractive(){return t.seekToInteractive},get playPrevChapter(){return t.playPrevChapter},get playerControlsWrapperRef(){return s()},set playerControlsWrapperRef(e){s(e)},get playerControlsRef(){return n()},set playerControlsRef(e){n(e)}})};Xi(m,(e=>{la(v,"$isMobile",i)?e(g):e(b,!1)})),zi(e,r)};Xi(y,(e=>{Tt(g)&&e(w)})),zi(e,b),fi(),r()}Ri(["click"]);var eh=Oi('<svg><!><g filter="url(#a)"><path fill="var(--btn-color, #fff)" d="M15.537 10.534a1.157 1.157 0 0 0 .003 1.96l7.658 4.823c.78.491 1.798-.065 1.798-.981v-3.3c7.265.512 13 6.568 13 13.964 0 7.732-6.268 14-14 14-5.98 0-11.088-3.75-13.093-9.032a1.5 1.5 0 0 0-2.805 1.064C10.531 39.441 16.73 44 23.996 44c9.39 0 17-7.611 17-17 0-9.053-7.076-16.453-16-16.971V6.664c0-.918-1.021-1.473-1.8-.98z"></path><path stroke="#000" stroke-opacity=".12" stroke-width=".5" d="M15.404 10.322a1.407 1.407 0 0 0 .003 2.384l7.657 4.823c.944.594 2.182-.076 2.182-1.193v-3.03c7.008.631 12.5 6.522 12.5 13.694 0 7.594-6.156 13.75-13.75 13.75-5.873 0-10.89-3.683-12.86-8.871a1.75 1.75 0 1 0-3.272 1.242c2.469 6.503 8.758 11.129 16.132 11.129 9.527 0 17.25-7.723 17.25-17.25 0-9.107-7.056-16.565-16-17.205V6.664c0-1.118-1.241-1.788-2.184-1.19z"></path></g><defs><filter id="a" width="43.996" height="49.5" x="2.5" y="0" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset></feOffset><feGaussianBlur stdDeviation="2.5"></feGaussianBlur><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.16 0"></feColorMatrix><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_2260_100684"></feBlend><feBlend in="SourceGraphic" in2="effect1_dropShadow_2260_100684" result="shape"></feBlend></filter></defs></svg>');function th(e,t){let i=ma(t,"reversed",3,!1),r=ne((()=>i()?"transform: scaleX(-1);":void 0));!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=eh();let a;hr(Ne(r),(()=>t.children??D)),Ce(2),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"51",fill:"none","aria-hidden":"true","data-testid":"seek-icon",role:"img",...i}))),zi(e,r)}(e,{get style(){return Tt(r)}})}var ih=Oi('<svg><!><g clip-path="url(#c)" filter="url(#a)"><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M28.167 7h-8.334c-2.463 0-4.404 0-5.966.128-1.594.13-2.925.4-4.134 1.016a10.5 10.5 0 0 0-4.589 4.59c-.616 1.208-.886 2.54-1.016 4.133C4 18.429 4 20.37 4 22.833v2.334c0 2.463 0 4.404.128 5.966.13 1.594.4 2.925 1.016 4.134a10.5 10.5 0 0 0 4.59 4.589c1.208.616 2.54.886 4.133 1.016 1.562.128 3.502.128 5.966.128h8.334c2.463 0 4.404 0 5.966-.128 1.594-.13 2.925-.4 4.134-1.016a10.5 10.5 0 0 0 4.589-4.59c.616-1.208.886-2.54 1.016-4.133.128-1.562.128-3.502.128-5.966v-2.334c0-2.463 0-4.404-.128-5.966-.13-1.594-.4-2.925-1.016-4.134a10.5 10.5 0 0 0-4.59-4.589c-1.208-.616-2.54-.886-4.133-1.016C32.571 7 30.63 7 28.167 7M13.5 28a1.5 1.5 0 0 0 0 3h11a1.5 1.5 0 0 0 0-3zM12 22a1.5 1.5 0 0 1 1.5-1.5h4a1.5 1.5 0 0 1 0 3h-4A1.5 1.5 0 0 1 12 22m18.5 6a1.5 1.5 0 0 0 0 3h4a1.5 1.5 0 0 0 0-3zM22 22a1.5 1.5 0 0 1 1.5-1.5h11a1.5 1.5 0 0 1 0 3h-11A1.5 1.5 0 0 1 22 22" clip-rule="evenodd"></path><path stroke="#000" stroke-opacity=".12" stroke-width=".5" d="M28.167 6.75h-8.344c-2.455 0-4.405 0-5.977.128-1.609.132-2.976.407-4.226 1.044a10.75 10.75 0 0 0-4.698 4.698c-.637 1.25-.912 2.617-1.044 4.226-.128 1.572-.128 3.522-.128 5.977v2.354c0 2.455 0 4.405.128 5.977.132 1.609.407 2.976 1.044 4.226a10.75 10.75 0 0 0 4.698 4.698c1.25.637 2.617.912 4.226 1.044 1.572.128 3.522.128 5.977.128h8.354c2.455 0 4.404 0 5.977-.128 1.609-.132 2.976-.407 4.226-1.044a10.75 10.75 0 0 0 4.698-4.698c.637-1.25.912-2.617 1.044-4.226.128-1.573.128-3.522.128-5.977v-2.354c0-2.455 0-4.405-.128-5.977-.132-1.609-.407-2.976-1.044-4.226a10.75 10.75 0 0 0-4.698-4.698c-1.25-.637-2.617-.912-4.226-1.044-1.572-.128-3.522-.128-5.977-.128zM12.25 29.5c0-.69.56-1.25 1.25-1.25h11a1.25 1.25 0 1 1 0 2.5h-11c-.69 0-1.25-.56-1.25-1.25Zm0-7.5c0-.69.56-1.25 1.25-1.25h4a1.25 1.25 0 1 1 0 2.5h-4c-.69 0-1.25-.56-1.25-1.25Zm17 7.5c0-.69.56-1.25 1.25-1.25h4a1.25 1.25 0 1 1 0 2.5h-4c-.69 0-1.25-.56-1.25-1.25Zm-7-7.5c0-.69.56-1.25 1.25-1.25h11a1.25 1.25 0 1 1 0 2.5h-11c-.69 0-1.25-.56-1.25-1.25Z"></path></g><defs><clipPath id="c"><path fill="var(--btn-color, #fff)" d="M0 0h48v48H0z"></path></clipPath><filter id="a" width="51" height="45" x="-1.5" y="1.5" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset></feOffset><feGaussianBlur stdDeviation="2.5"></feGaussianBlur><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.16 0"></feColorMatrix><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_2260_104204"></feBlend><feBlend in="SourceGraphic" in2="effect1_dropShadow_2260_104204" result="shape"></feBlend></filter></defs></svg>');var rh=Oi('<svg><!><g clip-path="url(#c)" filter="url(#a)"><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M6.56 4.44a1.5 1.5 0 1 0-2.12 2.12l3.088 3.09a10.5 10.5 0 0 0-2.384 3.083c-.616 1.21-.886 2.54-1.016 4.134C4 18.429 4 20.369 4 22.833v2.334c0 2.463 0 4.404.128 5.966.13 1.594.4 2.925 1.016 4.134a10.5 10.5 0 0 0 4.59 4.589c1.208.616 2.54.886 4.133 1.016 1.562.128 3.502.128 5.966.128h8.334c2.463 0 4.404 0 5.966-.128 1.437-.117 2.66-.348 3.773-.844l3.533 3.533a1.5 1.5 0 0 0 2.122-2.122l-37-37ZM13.5 28a1.5 1.5 0 0 0 0 3h11a1.5 1.5 0 0 0 0-3zM12 22a1.5 1.5 0 0 1 1.5-1.5h4a1.5 1.5 0 0 1 0 3h-4A1.5 1.5 0 0 1 12 22" clip-rule="evenodd"></path><path fill="var(--btn-color, #fff)" d="M34.5 23.5h-4.639l12.552 12.551q.237-.381.443-.784c.616-1.21.886-2.54 1.016-4.134.128-1.562.128-3.502.128-5.966v-2.334c0-2.463 0-4.404-.128-5.966-.13-1.594-.4-2.925-1.016-4.134a10.5 10.5 0 0 0-4.59-4.589c-1.208-.616-2.54-.886-4.133-1.016C32.571 7 30.63 7 28.167 7h-8.334c-2.463 0-4.404 0-5.966.128l-.347.03L26.86 20.5h7.64a1.5 1.5 0 0 1 0 3"></path><path stroke="#000" stroke-opacity=".12" stroke-width=".5" d="M29.861 23.25h-.603l.427.427 12.55 12.551.223.223.167-.268q.243-.39.453-.803c.637-1.25.912-2.617 1.044-4.226.128-1.573.128-3.522.128-5.977v-2.354c0-2.455 0-4.405-.128-5.977-.132-1.609-.407-2.976-1.044-4.226a10.75 10.75 0 0 0-4.698-4.698c-1.25-.637-2.617-.912-4.226-1.044-1.572-.128-3.522-.128-5.977-.128h-8.354c-2.455 0-4.405 0-5.977.128q-.177.014-.35.032l-.527.051.374.374 13.341 13.342.074.073H34.5a1.25 1.25 0 1 1 0 2.5zM6.737 4.263a1.75 1.75 0 0 0-2.474 2.474l2.903 2.904a10.8 10.8 0 0 0-2.244 2.979c-.637 1.25-.912 2.617-1.044 4.226-.128 1.572-.128 3.522-.128 5.977v2.354c0 2.455 0 4.405.128 5.977.132 1.609.407 2.976 1.044 4.226a10.75 10.75 0 0 0 4.698 4.698c1.25.637 2.617.912 4.226 1.044 1.572.128 3.522.128 5.977.128h8.354c2.455 0 4.404 0 5.977-.128 1.384-.114 2.59-.333 3.696-.797l3.413 3.412a1.75 1.75 0 1 0 2.474-2.474zM12.25 29.5c0-.69.56-1.25 1.25-1.25h11a1.25 1.25 0 1 1 0 2.5h-11c-.69 0-1.25-.56-1.25-1.25Zm0-7.5c0-.69.56-1.25 1.25-1.25h4a1.25 1.25 0 1 1 0 2.5h-4c-.69 0-1.25-.56-1.25-1.25Z"></path></g><defs><clipPath id="c"><path fill="var(--btn-color, #fff)" d="M0 0h48v48H0z"></path></clipPath><filter id="a" width="51" height="51" x="-1.5" y="-1.5" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset></feOffset><feGaussianBlur stdDeviation="2.5"></feGaussianBlur><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.16 0"></feColorMatrix><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_2260_104293"></feBlend><feBlend in="SourceGraphic" in2="effect1_dropShadow_2260_104293" result="shape"></feBlend></filter></defs></svg>');function ah(e,t){let i=ma(t,"isOff",3,!1);var r=ji(),a=Be(r),s=e=>{!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=rh();let a;hr(Ne(r),(()=>t.children??D)),Ce(2),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",fill:"none","aria-hidden":"true","data-testid":"subtitles-off-icon",role:"img",...i}))),zi(e,r)}(e,{})},n=e=>{!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=ih();let a;hr(Ne(r),(()=>t.children??D)),Ce(2),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",fill:"none","aria-hidden":"true","data-testid":"subtitles-on-icon",role:"img",...i}))),zi(e,r)}(e,{})};Xi(a,(e=>{i()?e(s):e(n,!1)})),zi(e,r)}var sh=Oi('<svg><!><g filter="url(#a)"><path fill="var(--btn-color, #fff)" d="M24 22.677v-5.87a1.2 1.2 0 0 0-1.792-1.045L9.51 22.955a1.2 1.2 0 0 0 0 2.088l12.697 7.192a1.2 1.2 0 0 0 1.791-1.044v-5.873l12.21 6.916A1.2 1.2 0 0 0 38 31.19V16.805a1.2 1.2 0 0 0-1.791-1.044z"></path><path stroke="#000" stroke-opacity=".12" stroke-width=".5" d="M24.25 16.806v5.442l11.835-6.704a1.45 1.45 0 0 1 2.165 1.261V31.19a1.45 1.45 0 0 1-2.165 1.262L24.25 25.747v5.444a1.45 1.45 0 0 1-2.164 1.262L9.388 25.26a1.45 1.45 0 0 1 0-2.523l12.697-7.192a1.45 1.45 0 0 1 2.164 1.261Z"></path></g><defs><filter id="a" width="40.098" height="27.785" x="3.402" y="10.105" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset></feOffset><feGaussianBlur stdDeviation="2.5"></feGaussianBlur><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.16 0"></feColorMatrix><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_2260_106627"></feBlend><feBlend in="SourceGraphic" in2="effect1_dropShadow_2260_106627" result="shape"></feBlend></filter></defs></svg>');function nh(e,t){let i=ma(t,"reversed",3,!1),r=ne((()=>i()?"transform: scaleX(-1);":void 0));!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=sh();let a;hr(Ne(r),(()=>t.children??D)),Ce(2),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",fill:"none","aria-hidden":"true","data-testid":"rate-change-icon",role:"img",...i}))),zi(e,r)}(e,{get style(){return Tt(r)}})}var oh=Oi('<svg><!><g filter="url(#a)"><path fill="var(--btn-color, #fff)" d="M14 21.817c.631-.505 1.627-1.054 3.084-1.857l13.009-7.172c2.268-1.25 3.402-1.875 4.332-1.778a2.9 2.9 0 0 1 2.026 1.134c.549.73.549 1.991.549 4.511v14.69c0 2.52 0 3.78-.549 4.51a2.9 2.9 0 0 1-2.026 1.135c-.93.097-2.064-.528-4.332-1.778L17.084 28.04c-1.457-.803-2.453-1.352-3.084-1.857V34.5a1.5 1.5 0 0 1-3 0v-21a1.5 1.5 0 0 1 3 0z"></path><path stroke="#000" stroke-opacity=".12" stroke-width=".5" d="m16.964 19.74-.029.016c-1.162.641-2.046 1.129-2.685 1.567V13.5a1.75 1.75 0 1 0-3.5 0v21a1.75 1.75 0 1 0 3.5 0v-7.823c.639.438 1.523.926 2.685 1.567l.029.015 13.008 7.172.012.006c1.124.62 1.983 1.093 2.676 1.398.695.306 1.26.46 1.791.404a3.16 3.16 0 0 0 2.2-1.233c.317-.421.46-.976.53-1.711.069-.733.069-1.688.069-2.936V16.641c0-1.248 0-2.203-.07-2.936-.07-.735-.212-1.29-.529-1.711a3.16 3.16 0 0 0-2.2-1.233c-.53-.055-1.096.098-1.79.404-.694.305-1.553.778-2.677 1.398l-.012.006z"></path></g><defs><filter id="a" width="37" height="37" x="5.5" y="5.5" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset></feOffset><feGaussianBlur stdDeviation="2.5"></feGaussianBlur><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.16 0"></feColorMatrix><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_2340_106922"></feBlend><feBlend in="SourceGraphic" in2="effect1_dropShadow_2340_106922" result="shape"></feBlend></filter></defs></svg>');function lh(e,t){let i=ma(t,"reversed",3,!1),r=ne((()=>i()?"transform: scaleX(-1);":void 0));!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=oh();let a;hr(Ne(r),(()=>t.children??D)),Ce(2),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",fill:"none","aria-hidden":"true","data-testid":"episodes-seek-icon",role:"img",...i}))),zi(e,r)}(e,{get style(){return Tt(r)}})}var uh=Di('<span class="hot-key-helpers-text svelte-1ad3n06"> </span>'),dh=Di('<div class="svelte-1ad3n06"><!> <!> <!> <!> <!> <!> <!> <!> <!> <!></div> <!>',1),ch=Di("<div><!></div>"),hh={hash:"svelte-1ad3n06",code:'.hot-key-helpers-container.svelte-1ad3n06 {position:absolute;z-index:var(--hot-key-helpers-container-z-index);top:calc(50% - 40px);left:calc(50% - 100px);width:200px;height:120px;display:flex;align-items:center;flex-direction:column;\n    animation: svelte-1ad3n06-fadeIn ease var(--controls-transition-duration);padding-top:14px;box-sizing:border-box;}.hot-key-helpers-container.svelte-1ad3n06 > div:where(.svelte-1ad3n06) {width:48px;height:48px;display:flex;justify-content:center;align-items:center;}.hot-key-helpers-container.svelte-1ad3n06 svg[data-testid="volume-off-icon"],\n  .hot-key-helpers-container.svelte-1ad3n06 svg[data-testid="volume-max-icon"] {transform:scale(2);}.hot-key-helpers-container.svelte-1ad3n06 svg[data-testid="replay-icon"],\n  .hot-key-helpers-container.svelte-1ad3n06 svg[data-testid="play-icon"],\n  .hot-key-helpers-container.svelte-1ad3n06 svg[data-testid="pause-icon"] {transform:scale(2.5);}.hot-key-helpers-container--left.svelte-1ad3n06 {left:calc(25% - 100px);}.hot-key-helpers-container--right.svelte-1ad3n06 {left:calc(75% - 100px);}.hot-key-helpers-text.svelte-1ad3n06 {text-align:center;font-feature-settings:\'clig\' off, \'liga\' off;text-shadow:0px 0px 5px rgba(0, 0, 0, 0.16);font-size:15px;font-style:normal;font-weight:600;line-height:20px; /* 133.333% */letter-spacing:-0.105px;width:100%;max-height:40px;margin-top:4px;display:-webkit-box;text-overflow:ellipsis;white-space:pre-wrap;overflow:hidden;-webkit-line-clamp:2;-webkit-box-orient:vertical;}.hidden.svelte-1ad3n06 {visibility:hidden;\n    animation: svelte-1ad3n06-fadeOut ease var(--controls-transition-duration);width:0;height:0;}\n\n  @keyframes svelte-1ad3n06-fadeIn {\n    0% {opacity:0;}\n    100% {opacity:1;}\n  }\n\n  @keyframes svelte-1ad3n06-fadeOut {\n    0% {opacity:1;}\n    100% {opacity:0;}\n  }'};var ph=Oi('<svg><!><path fill="currentColor" fill-opacity=".72" fill-rule="evenodd" d="M11.736 6.736a.9.9 0 0 1-1.272 0L6 2.273 1.536 6.736A.9.9 0 1 1 .264 5.464l5.1-5.1a.9.9 0 0 1 1.272 0l5.1 5.1a.9.9 0 0 1 0 1.272" clip-rule="evenodd"></path></svg>');var fh=Oi('<svg><!><path fill="currentColor" d="m5.773 8 3.363 3.364a.9.9 0 1 1-1.272 1.272l-4-4a.9.9 0 0 1 0-1.272l4-4a.9.9 0 0 1 1.272 1.272z"></path></svg>');function mh(e,t){pi(t,!0);let i=ma(t,"direction",3,"left"),r=ma(t,"useBtnColor",3,!1),a=ne((()=>["up","down"].includes(i()))),s=ne((()=>["right","down"].includes(i()))),n=ne((()=>(()=>{let e="";return Tt(s)&&(e+="transform: rotate(180deg);"),r()&&(e+="color: var(--btn-color, #fff);"),e.length?e:void 0})()));var o=ji(),l=Be(o),u=e=>{let t=ne((()=>Tt(s)?"chevron-icon--down":"chevron-icon--up"));!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=ph();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"7",fill:"none","aria-hidden":"true",color:"#fff",role:"img",...i}))),zi(e,r)}(e,{get style(){return Tt(n)},get"data-testid"(){return Tt(t)}})},d=e=>{let t=ne((()=>Tt(s)?"chevron-icon--right":"chevron-icon--left"));!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=fh();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",fill:"none","aria-hidden":"true",color:"#fff",role:"img",...i}))),zi(e,r)}(e,{get style(){return Tt(n)},get"data-testid"(){return Tt(t)}})};Xi(l,(e=>{Tt(a)?e(u):e(d,!1)})),zi(e,o),fi()}var vh=(e,t,i,r,a,s)=>{if(t.has(e.code))switch(e.preventDefault(),e.stopPropagation(),e.code){case"ArrowUp":i();break;case"ArrowDown":r();break;case"ArrowLeft":a();break;case"ArrowRight":s()}},gh=(e,t,i)=>{t.has(e.code)&&(e.preventDefault(),e.stopPropagation(),i())},bh=Di('<div tabindex="0" role="button"><div class="button-block svelte-1yzc86r" aria-hidden="true"><div class="button-row svelte-1yzc86r"><div class="button button-up svelte-1yzc86r"><!></div> <div class="button button-right svelte-1yzc86r"><!></div></div> <div class="button-row svelte-1yzc86r"><div class="button button-left svelte-1yzc86r"><!></div> <div class="button button-down svelte-1yzc86r"><!></div></div></div></div>'),yh={hash:"svelte-1yzc86r",code:".immersive-controls.svelte-1yzc86r {position:absolute;display:flex;flex-direction:row;top:10px;left:10px;width:56px;height:56px;background-color:rgba(0, 0, 0, .56);border-radius:8px;transition-property:top, left;transition-duration:var(--controls-transition-duration);transition-timing-function:var(--controls-transition-fn);}.immersive-controls.m-shifted.svelte-1yzc86r {top:50px;left:20px;}.button-block.svelte-1yzc86r {width:40px;height:40px;margin:auto auto;transform:rotate(45deg);}.button-row.svelte-1yzc86r {display:flex;flex-direction:row;position:relative;}.button.svelte-1yzc86r {width:20px;height:20px;text-align:center;cursor:pointer;}.button.svelte-1yzc86r svg {opacity:0.7;transition:opacity linear 0.2s;}.button.button-up.svelte-1yzc86r svg {transform:rotate(-45deg) translate(-1px, -1px);}.button.button-right.svelte-1yzc86r svg {transform:rotate(45deg) translate(1px, -1px);}.button.button-down.svelte-1yzc86r svg {transform:rotate(135deg) translate(1px, -3px);}.button.button-left.svelte-1yzc86r svg {transform:rotate(-135deg) translate(-1px, -3px);}.button.svelte-1yzc86r:hover svg {opacity:1;}"};function wh(e,t){pi(t,!0),vr(e,yh);let i=ma(t,"isShifted",3,!1),r=Oa(),a=new Set(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"]),s=()=>{r.actions.internal.startCameraManualRotation(0,1)},n=()=>{r.actions.internal.startCameraManualRotation(0,-1)},o=()=>{r.actions.internal.startCameraManualRotation(1,0)},l=()=>{r.actions.internal.startCameraManualRotation(-1,0)},u=()=>(r.actions.internal.stopCameraManualRotation(),null),d=Es("aria_label_spherical_control");var c=bh();let h;c.__keydown=[vh,a,s,n,l,o],c.__keyup=[gh,a,u],Lr(c,"aria-label",d);var p=Ne(c),f=Ne(p),m=Ne(f);m.__mousedown=s,m.__mouseup=u,mh(Ne(m),{direction:"up",useBtnColor:!0}),Te(m);var v=De(m,2);v.__mousedown=o,v.__mouseup=u,mh(Ne(v),{direction:"up",useBtnColor:!0}),Te(v),Te(f);var g=De(f,2),b=Ne(g);b.__mousedown=l,b.__mouseup=u,mh(Ne(b),{direction:"up",useBtnColor:!0}),Te(b);var y=De(b,2);y.__mousedown=n,y.__mouseup=u,mh(Ne(y),{direction:"up",useBtnColor:!0}),Te(y),Te(g),Te(p),Te(c),Bt((e=>h=xr(c,1,"immersive-controls svelte-1yzc86r",null,h,e)),[()=>({"m-shifted":i()})]),Ii("mouseleave",m,u),Ii("mouseleave",v,u),Ii("mouseleave",b,u),Ii("mouseleave",y,u),zi(e,c),fi()}Ri(["keydown","keyup","mousedown","mouseup"]);var Sh=class{subscribe(){return this.subscriptions.add(this.captions$.pipe((0,m.filter)((()=>this.isEnabled())),(0,m.filterChanged)()).subscribe((e=>{this.processCaptions(e)}))),this}setIsAuto(e){this.isAuto=e}setIsLive(e){this.isLive=e}setCaptions(e){this.captions$.next(e)}destroy(){this.subscriptions.unsubscribe(),this.flickeringTimeout.clear()}isEnabled(){return this.isAuto&&!this.isLive}processCaptions(e){if(!e.length)return void this.flickeringTimeout.add((()=>{this.captionsPrepared$.next([])}));this.flickeringTimeout.clear();let t=[],i=e.length>1&&"timestamp"!==e[0].type&&"timestamp"!==e[1].type;i&&t.push([{value:String(e[0].value),timeAppeared:null}]),t.push(e.reduce(((e,{type:t,value:r},a)=>(i&&!a||("timestamp"===t?e.push({timeAppeared:Number(r),value:""}):0===e.length?e.push({value:String(r)}):e[e.length-1].value=String(r)),e)),[])),this.captionsPrepared$.next(t)}constructor(){this.flickeringTimeout=((e=1e3)=>{let t=null,i=()=>{t&&(clearTimeout(t),t=null)};return{add:r=>{i(),t=setTimeout(r,e)},clear:i}})(1e3),this.subscriptions=new m.Subscription,this.isAuto=!1,this.isLive=!1,this.captions$=new m.ValueSubject([]),this.captionsPrepared$=new m.ValueSubject([])}},xh=Di('<span class="caption-line svelte-c2x749"><span class="caption-segment svelte-c2x749"> </span></span>'),$h=Di('<span class="caption-line svelte-c2x749"><span class="caption-segment svelte-c2x749"></span></span>'),_h=Di('<span class="caption-line svelte-c2x749"><span class="caption-segment svelte-c2x749"> </span></span>'),kh=Di('<div><span class="caption svelte-c2x749"><!></span></div>'),Th=Di("<div><!></div>"),Ch={hash:"svelte-c2x749",code:".subtitles-container.svelte-c2x749 {position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;transition:transform var(--controls-transition-duration);}.subtitles-container.shifted.svelte-c2x749 {transform:translateY(calc(var(--controls-height) * -1));}.subtitles-caption.svelte-c2x749 {position:absolute;left:4%;right:4%;bottom:4%;display:flex;justify-content:center;}.subtitles-caption.mobile.svelte-c2x749 {bottom:8%;}.subtitles-container.auto.svelte-c2x749 .subtitles-caption:where(.svelte-c2x749) {left:var(--subtitles-caption-margin);right:var(--subtitles-caption-margin);}.caption.svelte-c2x749 {display:block;overflow-wrap:normal;padding:4px 8px;border-radius:4px;background:rgba(0, 0, 0, 0.4);}.subtitles-container.auto.svelte-c2x749 .caption:where(.svelte-c2x749) {width:100%;}.caption-line.svelte-c2x749 {display:block;text-align:center;}.subtitles-container.auto.svelte-c2x749 .caption-line:where(.svelte-c2x749) {text-align:left;}.caption-segment.svelte-c2x749 {display:inline-block;line-height:1.2;font-size:13px;\n    /*font-weight: 500;*/color:var(--white);white-space:pre-wrap;}"};function Eh(e,t){pi(t,!0),vr(e,Ch);let[i,r]=ua(),a=()=>la(u,"$isAutoSubtitleCaptionVisible$",i),s=ma(t,"isMobile",3,!1),n=Oa(),o=ya(),l=n.state.currentSubtitle$,u=n.state.isAutoSubtitleCaptionVisible$,d=n.state.isLive$,c=n.ui.isFullscreen,h=ne((()=>!!la(l,"$currentSubtitle$",i).isAuto)),p=ne((()=>!!la(d,"$isLive$",i))),f=ne((()=>.02*t.playerSize.width)),m=ne((()=>s()&&!la(c,"$isFullscreen",i)||Tt(f)<=o.minSubtitlesFontSize?o.minSubtitlesFontSize:Tt(f))),v=te(null);Rt((()=>{Tt(v)?.setIsAuto(Tt(h)),Tt(v)?.setIsLive(Tt(p)),Tt(v)?.setCaptions(t.captions)}));let g=te(Ae([[]]));Xr((()=>{re(v,Ae((new Sh).subscribe()));let e=Tt(v).captionsPrepared$.subscribe((e=>{re(g,Ae(e))}));return()=>{Tt(v)?.destroy(),e.unsubscribe()}})),Xr((()=>{if(Tt(h)){let e=window.setTimeout((()=>{u.set(!1)}),o.autoSubtitlesTimeout);return()=>{window.clearTimeout(e)}}u.set(!1)}));let b=ne((()=>t.playerSize.width<400?10:t.playerSize.width<550?14:24));var y=Th();let w;var S=Ne(y),x=e=>{var i=kh();let r;var n=Ne(i),o=Ne(n),l=e=>{var t=xh(),i=Ne(t),r=Ne(i,!0);Te(i),Te(t),Bt((e=>{_r(i,`font-size: ${Tt(m)??""}px`),Hi(r,e)}),[()=>Es("subtitles_auto_caption")]),zi(e,t)},u=(e,i)=>{var r=e=>{var i=ji();ar(Be(i),17,(()=>Tt(g)),rr,((e,i)=>{var r=$h(),a=Ne(r);ar(a,21,(()=>Tt(i)),(({value:e,timeAppeared:t})=>t),((e,i)=>{let r=()=>Tt(i).timeAppeared;var a=ji(),s=Be(a),n=e=>{var t=Fi();Bt((()=>Hi(t,Tt(i).value))),zi(e,t)};Xi(s,(e=>{(!r()||r()<=t.position)&&e(n)})),zi(e,a)})),Te(a),Te(r),Bt((()=>_r(a,`font-size: ${Tt(m)??""}px`))),zi(e,r)})),zi(e,i)},a=e=>{var i=ji();ar(Be(i),17,(()=>t.captions),(({value:e})=>e),((e,t)=>{var i=_h(),r=Ne(i),a=Ne(r,!0);Te(r),Te(i),Bt((()=>{_r(r,`font-size: ${Tt(m)??""}px`),Hi(a,Tt(t).value)})),zi(e,i)})),zi(e,i)};Xi(e,(e=>{Tt(h)&&Tt(g)?.length?e(r):e(a,!1)}),i)};Xi(o,(e=>{Tt(h)&&a()?e(l):e(u,!1)})),Te(n),Te(i),Bt((e=>{r=xr(i,1,"subtitles-caption svelte-c2x749",null,r,e),_r(i,`--subtitles-caption-margin: ${Tt(b)??""}%`)}),[()=>({mobile:s()})]),zi(e,i)};Xi(S,(e=>{(t.captions.length||Tt(g)?.length)&&e(x)})),Te(y),Bt((e=>w=xr(y,1,"subtitles-container svelte-c2x749",null,w,e)),[()=>({shifted:t.shifted,auto:Tt(h)&&!Tt(p)&&!a()})]),zi(e,y),fi(),r()}var Ah=Di('<div class="text svelte-raurnb"> </div>'),Lh=Di('<div><div class="icon_wrapper svelte-raurnb"><svg class="icon svelte-raurnb" width="22" height="22" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M1 18v3h3c0-1.66-1.34-3-3-3zm0-4v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7zm0-4v2a9 9 0 0 1 9 9h2c0-6.08-4.93-11-11-11zm20-7H3c-1.1 0-2 .9-2 2v3h2V5h18v14h-7v2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z" fill="var(--btn-color, #fff)"></path><path d="M0 0h24v24H0z"></path></g></svg></div> <!></div>'),Ph={hash:"svelte-raurnb",code:".wrapper.svelte-raurnb {height:100%;background-position:center;background-size:contain;background-repeat:no-repeat;display:flex;align-items:center;justify-content:center;font-size:16px;flex-direction:column;}.wrapper.bgCover.svelte-raurnb {background-size:cover;}.icon_wrapper.svelte-raurnb {display:flex;flex-direction:column;align-items:center;width:400px;}.icon.svelte-raurnb {width:50px;height:50px;}.text.svelte-raurnb {margin-top:20px;}"};function Mh(e,t){pi(t,!0),vr(e,Ph);let i=ya();var r=Lh();let a;var s=De(Ne(r),2),n=e=>{var i=Ah(),r=Ne(i);Te(i),Bt((()=>Hi(r,`Видео воспроизводится на ${t.chromecastDeviceName??""}`))),zi(e,i)};Xi(s,(e=>{t.chromecastDeviceName&&e(n)})),Te(r),Bt((e=>{a=xr(r,1,"wrapper svelte-raurnb",null,a,e),_r(r,`background-image: linear-gradient(0deg, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('${t.thumbUrl||""}')`)}),[()=>({bgCover:i.features.previewNoEmptySpace})]),zi(e,r),fi()}var Ih=Oi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M460 193.998a3.997 3.997 0 0 1 3.997-3.998h122.006a4.003 4.003 0 0 1 3.997 3.998v82.004a3.997 3.997 0 0 1-3.997 3.998H463.997a4.003 4.003 0 0 1-3.997-3.998zm6 2.993c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm112-72c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zM507 232a6 6 0 1 0 0-12 6 6 0 0 0 0 12m36 0a6 6 0 1 0 0-12 6 6 0 0 0 0 12m-18.05 15c6.05 0 11.624 4.446 11.944 4.65 2.106 1.35 3.252.772 3.957.156s1.15-2.806-1.044-4.657c-1.735-1.48-5.806-5.16-14.856-5.15s-12.95 3.5-14.792 5.185c-1.84 1.685-2.288 3.498-.973 4.657s2.315 1.158 4.357-.327c-.007.007 5.357-4.515 11.408-4.515z"></path></svg>');var Rh=Di('<div class="container svelte-13zpvm8"><!></div>'),Vh={hash:"svelte-13zpvm8",code:".container.svelte-13zpvm8 {position:absolute;top:0;bottom:0;left:0;right:0;background:#000;display:flex;align-items:center;justify-content:center;}"};function Nh(e){vr(e,Vh);var t=Rh();(function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=Ih();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"200",height:"200","aria-hidden":"true","data-testid":"error-icon",viewBox:"460 190 130 90",role:"img",...i}))),zi(e,r)})(Ne(t),{}),Te(t),zi(e,t)}var Bh=Di('<div><div class="playButton svelte-1xnh9dd" tabindex="0" role="button"><div class="playButtonBackground svelte-1xnh9dd"></div> <!></div></div>'),Dh={hash:"svelte-1xnh9dd",code:".container.svelte-1xnh9dd {position:absolute;top:0;bottom:0;left:0;right:0;background-position:center;background-size:contain;background-repeat:no-repeat;cursor:pointer;transition:opacity 0.2s, visibility 0.2s;will-change:opacity;}.container.hidden.svelte-1xnh9dd {opacity:0;visibility:hidden;}.container.bgCover.svelte-1xnh9dd {background-size:cover;}.playButton.svelte-1xnh9dd {position:absolute;top:0;bottom:0;left:0;right:0;margin:auto;width:var(--big-play-size);height:var(--big-play-size);display:flex;align-items:center;justify-content:center;}.playButtonBackground.svelte-1xnh9dd {position:absolute;top:0;bottom:0;left:0;right:0;border-radius:var(--big-play-radius);background-color:var(--big-play-bg-color);transition:background 0.2s, transform 0.2s;transition-timing-function:ease-out;will-change:background, transform;}.container.svelte-1xnh9dd:hover .playButtonBackground:where(.svelte-1xnh9dd) {background-color:var(--big-play-hover-bg-color);transform:scale(1.15);}.playButton.svelte-1xnh9dd svg {transform:scale(2);}"};function Oh(e,t){pi(t,!0),vr(e,Dh);let i=Oa(),r=ya(),a=i.ui.startedByKeyboard$,s=Es("tooltip_play"),n=e=>{let i=e.code;["Enter","Space"].includes(i)&&(e.stopPropagation(),e.preventDefault(),a.set(!0),t.startVideo())},o=e=>{e.stopPropagation(),t.startVideo()};var l=Bh();let u;l.__click=o;var d=Ne(l);return d.__keydown=n,Lr(d,"aria-label",s),Gd(De(Ne(d),2),{}),Te(d),Te(l),Bt((e=>{u=xr(l,1,"container svelte-1xnh9dd",null,u,e),_r(l,`background-color: #222; background-image: url('${t.thumbUrl||""}')`)}),[()=>({hidden:t.hidden,bgCover:r.features.previewNoEmptySpace})]),zi(e,l),fi({handlePressKey:n,handleClick:o})}Ri(["click","keydown"]);var Fh=Di("<div> </div>"),jh={hash:"svelte-1bcvcf2",code:".title.svelte-1bcvcf2 {position:absolute;pointer-events:none;left:0;top:0;width:100%;height:var(--controls-gradient-height);font-size:15px;color:var(--white);box-sizing:border-box;padding:18px 20px 10px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition-property:visibility, transform, opacity;transition-duration:var(--controls-transition-duration);transition-timing-function:var(--controls-transition-fn);will-change:transform, opacity;background:linear-gradient(\n      0deg,\n      rgba(0, 0, 0, 0) 0%,\n      rgba(0, 0, 0, 0.02) 19%,\n      rgba(0, 0, 0, 0.10) 34%,\n      rgba(0, 0, 0, 0.40) 60%,\n      rgba(0, 0, 0, 0.60) 100%\n    );}.hidden.svelte-1bcvcf2 {visibility:hidden;transform:translateY(calc(var(--controls-gradient-height) * -1));opacity:0;}"};var zh=Di('<div class="timer__cell cell svelte-1qpxtfg"><span class="cell__value svelte-1qpxtfg"> </span> <span class="cell__unit svelte-1qpxtfg"> </span></div> <span class="timer__points svelte-1qpxtfg"> </span>',1),Uh=Di('<div class="timer__cell cell svelte-1qpxtfg"><span class="cell__value svelte-1qpxtfg"> </span> <span class="cell__unit svelte-1qpxtfg"> </span></div> <span class="timer__points svelte-1qpxtfg"> </span>',1),qh=Di('<div class="timer__cell cell svelte-1qpxtfg"><span class="cell__value svelte-1qpxtfg"> </span> <span class="cell__unit svelte-1qpxtfg"> </span></div> <span class="timer__points svelte-1qpxtfg"> </span>',1),Hh=Di('<div class="timer__cell cell svelte-1qpxtfg"><span class="cell__value svelte-1qpxtfg"> </span> <span class="cell__unit svelte-1qpxtfg"> </span></div>'),Wh=Di('<div class="timer__container svelte-1qpxtfg"><!> <!> <!> <!></div>'),Qh={hash:"svelte-1qpxtfg",code:".timer__container.svelte-1qpxtfg {display:flex;align-items:flex-start;justify-content:center;}.cell.svelte-1qpxtfg {display:flex;flex-direction:column;align-items:center;width:62px;}.cell__value.svelte-1qpxtfg {font-size:48px;line-height:1.2;font-weight:700;}.cell__unit.svelte-1qpxtfg {font-size:14px;line-height:1.2;font-weight:400;}.timer__points.svelte-1qpxtfg {display:inline-block;margin:0 8px;font-size:42px;line-height:1.2;font-weight:600;}"};function Gh(e,t){pi(t,!0),vr(e,Qh);let i,r=te(""),a=te(""),s=te(""),n=te(""),o=e=>String(e).padStart(2,"0"),l=()=>{let e=Math.floor(Date.now()/1e3),u=t.startTime-e;(e=>{let t=Math.floor(e/86400);t&&(e-=86400*t,re(r,Ae(o(t))));let i=Math.floor(e/3600);re(a,Ae(o(i)));let l=Math.floor(e/60)%60;re(s,Ae(o(l))),re(n,Ae(o(e%60)))})(u),u>=1?i=requestAnimationFrame(l):t.onTimerOver()};Xr((()=>{i=requestAnimationFrame(l)})),Jr((()=>{cancelAnimationFrame(i)}));var u=Wh(),d=Ne(u),c=e=>{var t=zh(),i=Be(t),a=Ne(i),s=Ne(a,!0);Te(a);var n=De(a,2),o=Ne(n,!0);Te(n),Te(i);var l=De(i,2),u=Ne(l,!0);Te(l),Bt(((e,t)=>{Hi(s,Tt(r)),Hi(o,e),Hi(u,t)}),[()=>Es("waiting_live_day_value"),()=>Es("waiting_live_colon")]),zi(e,t)};Xi(d,(e=>{Tt(r)&&e(c)}));var h=De(d,2),p=e=>{var t=Uh(),i=Be(t),r=Ne(i),s=Ne(r,!0);Te(r);var n=De(r,2),o=Ne(n,!0);Te(n),Te(i);var l=De(i,2),u=Ne(l,!0);Te(l),Bt(((e,t)=>{Hi(s,Tt(a)),Hi(o,e),Hi(u,t)}),[()=>Es("waiting_live_hour_value"),()=>Es("waiting_live_colon")]),zi(e,t)};Xi(h,(e=>{Tt(a)&&e(p)}));var f=De(h,2),m=e=>{var t=qh(),i=Be(t),r=Ne(i),a=Ne(r,!0);Te(r);var n=De(r,2),o=Ne(n,!0);Te(n),Te(i);var l=De(i,2),u=Ne(l,!0);Te(l),Bt(((e,t)=>{Hi(a,Tt(s)),Hi(o,e),Hi(u,t)}),[()=>Es("waiting_live_minute_value"),()=>Es("waiting_live_colon")]),zi(e,t)};Xi(f,(e=>{Tt(s)&&e(m)}));var v=De(f,2),g=e=>{var t=Hh(),i=Ne(t),r=Ne(i,!0);Te(i);var a=De(i,2),s=Ne(a,!0);Te(a),Te(t),Bt((e=>{Hi(r,Tt(n)),Hi(s,e)}),[()=>Es("waiting_live_second_value")]),zi(e,t)};Xi(v,(e=>{Tt(n)&&e(g)})),Te(u),zi(e,u),fi()}var Kh=Oi('<svg><!><path fill="#fefffe" d="M179.5-.5h40q127.56 18.67 171.5 140 5.724 19.896 8.5 40v40q-5.549 51.6-35.5 94-9.626-12.614-24.5-18.5-1.526-1.574-.5-3.5 39.742-61.7 23-133Q329.24 50.25 217.5 33 112.126 26.56 55 114.5q-40.395 74.102-9 152a152.3 152.3 0 0 0 14 25q1.026 1.926-.5 3.5-14.874 5.886-24.5 18.5-29.95-42.4-35.5-94v-40Q18.17 51.94 139.5 8q19.896-5.724 40-8.5" style="opacity:.965"></path><path fill="#fefffe" d="M183.5 63.5q86.294-5.475 133.5 66 32.442 60.138 8 124a186.7 186.7 0 0 1-17.5 29.5 633 633 0 0 1-38-7q54.668-57.264 19.5-128.5Q252.733 91.244 185.5 97q-74.25 14.25-88.5 88.5-5.916 53.38 32.5 90.5a1150 1150 0 0 0-36 7.5q-2.294-.044-3.5-2-43.947-63.646-16-136 32.799-70.278 109.5-82" style="opacity:.965"></path><path fill="#fefffe" d="M187.5 127.5q66.786-4.422 83.5 60 5.146 66.825-59.5 83.5-66.825 5.146-83.5-59.5-4.844-66.856 59.5-84" style="opacity:.985"></path><path fill="#fefffe" d="M219.5 399.5h-40q-67.453-7.982-117-54a31.7 31.7 0 0 1 3.5-10q8.539-9.646 20.5-14.5 54.786-19.435 113-17.5 58.214-1.935 113 17.5 11.962 4.854 20.5 14.5a31.7 31.7 0 0 1 3.5 10q-49.547 46.018-117 54" style="opacity:.986"></path></svg>');var Yh=Di('<div class="upcoming svelte-15pewff"><div class="upcoming-icon svelte-15pewff"><!></div> <span class="upcoming__title svelte-15pewff"> </span></div>'),Zh=Di('<div class="waiting-timer timer svelte-15pewff"><span class="timer__title svelte-15pewff"> </span> <!></div>'),Xh=Di('<div class="waiting-container svelte-15pewff"><!></div>'),Jh={hash:"svelte-15pewff",code:".waiting-container.svelte-15pewff {position:absolute;top:0;left:0;width:100%;height:100%;background-color:var(--black);background-position:center;background-size:cover;background-repeat:no-repeat;}.waiting-container.svelte-15pewff::before {content:'';position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0, 0, 0, 0.56);z-index:1;}.upcoming.svelte-15pewff {position:absolute;top:50%;left:0;width:100%;transform:translateY(-50%);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:0;}.upcoming-icon.svelte-15pewff {width:20%;max-width:200px;margin-bottom:20px;}.upcoming__title.svelte-15pewff {font-size:14px;line-height:1.2;font-weight:400;}.waiting-timer.svelte-15pewff {position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);z-index:2;}.timer.svelte-15pewff {display:flex;flex-direction:column;align-items:center;justify-content:center;}.timer__title.svelte-15pewff {display:inline-block;vertical-align:middle;margin-bottom:12px;font-size:14px;line-height:1.2;font-weight:400;}"};function ep(e,t){pi(t,!0),vr(e,Jh);let i=te(!1);Rt((()=>{re(i,Ae(void 0===t.startTime||t.startTime<Math.floor(Date.now()/1e3)))}));var r=Xh(),a=Ne(r),s=e=>{var t=Yh(),i=Ne(t);(function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=Kh();let a;hr(Ne(r),(()=>t.children??D)),Ce(4),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true","data-testid":"podcast-icon",style:"shape-rendering:geometricPrecision;text-rendering:geometricPrecision;image-rendering:optimizeQuality;fill-rule:evenodd;clip-rule:evenodd;width:100%;height:100%",viewBox:"0 0 400 400",role:"img",...i}))),zi(e,r)})(Ne(i),{}),Te(i);var r=De(i,2),a=Ne(r,!0);Te(r),Te(t),Bt((e=>Hi(a,e)),[()=>Es("waiting_live_upcoming_title")]),zi(e,t)},n=e=>{var r=Zh(),a=Ne(r),s=Ne(a,!0);Te(a);var n=De(a,2);let o=ne((()=>t.startTime||0));Gh(n,{get startTime(){return Tt(o)},onTimerOver:()=>re(i,!0)}),Te(r),Bt((e=>Hi(s,e)),[()=>Es("waiting_live_timer_title")]),zi(e,r)};Xi(a,(e=>{Tt(i)?e(s):e(n,!1)})),Te(r),Bt((()=>_r(r,`background-image: url(${Tt(i)?"":t.thumbUrl})`))),zi(e,r),fi()}var tp=Di('<div class="waiting-container svelte-xvqwsa"><div class="waiting-caption svelte-xvqwsa"><!> <p class="waiting-title svelte-xvqwsa"> </p></div></div>'),ip={hash:"svelte-xvqwsa",code:".waiting-container.svelte-xvqwsa {position:absolute;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background-color:var(--black);background-position:center;background-size:cover;background-repeat:no-repeat;}.waiting-container.svelte-xvqwsa::before {content:'';position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0, 0, 0, 0.4);backdrop-filter:blur(10px);}.waiting-caption.svelte-xvqwsa {position:relative;display:flex;flex-direction:column;align-items:center;}.waiting-title.svelte-xvqwsa {margin:0;padding:20px;text-align:center;font-size:20px;line-height:1.2;font-weight:400;}"};function rp(e,t){pi(t,!0),vr(e,ip);let i=ma(t,"thumbUrl",3,""),r={recover:Es("waiting_live_recover_title"),record:Es("waiting_record_title")},a=ne((()=>r[t.kind]||""));var s=tp(),n=Ne(s),o=Ne(n);No(o,{style:"position: static; transform: translate(0, 0)"});var l=De(o,2),u=Ne(l,!0);Te(l),Te(n),Te(s),Bt((()=>{_r(s,`background-image: url('${i()}')`),Hi(u,Tt(a))})),zi(e,s),fi()}var ap=Oi('<svg><!><path fill="var(--btn-color, #fff)" d="M6 10.2 3.5 7.7a.99.99 0 0 0-1.4 1.4l3.2 3.2a1 1 0 0 0 1.4 0l7.6-7.6a.99.99 0 0 0-1.4-1.4z"></path></svg>');var sp=Di('<div class="select-icon svelte-124aexk"><!></div>'),np={hash:"svelte-124aexk",code:".select-icon.svelte-124aexk {margin-right:auto;padding-right:12px;opacity:0.9;position:relative;top:3px;}"};function op(e){vr(e,np);var t=sp();(function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=ap();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true","data-testid":"check-mark-icon",role:"img",...i}))),zi(e,r)})(Ne(t),{}),Te(t),zi(e,t)}var lp=(e,t)=>{e.stopPropagation(),t.item.selectItem(t.item.value)},up=(e,t)=>{kn(e,(()=>t.item.selectItem(t.item.value)))},dp=Di("<p> </p>"),cp=Di('<p class="sublabel svelte-1t7rx2m"> </p>'),hp=Di('<li role="menuitem" tabindex="0"><!> <div><!> <!></div></li>'),pp={hash:"svelte-1t7rx2m",code:".menu-item-value.svelte-1t7rx2m {display:flex;flex-direction:column;align-items:end;min-width:0;}.menu-item-value[data-selected='false'].svelte-1t7rx2m {--select-icon-width: 16px;--icon-padding: 12px;\n\n    /**\n    * Если элемент не выбран(иконка отсутствует), то должны заполнить пустое место\n    * чтобы все лейблы начинались с одного отступа.\n    */margin-left:calc(var(--icon-padding) + var(--select-icon-width));}.label.svelte-1t7rx2m,\n  .sublabel.svelte-1t7rx2m {text-overflow:ellipsis;overflow:hidden;max-width:100%;}.sublabel.svelte-1t7rx2m {opacity:0.5;}"};Ri(["click","keydown"]);var fp=Di('<li role="menuitem" tabindex="0" aria-haspopup="true"><!> <div><!></div></li>');Ri(["click","keydown"]);var mp=100,vp=200,gp=300,bp=400,yp=500,wp=600,Sp=700,xp=800,$p=900,_p=1e3,kp=(e,t)=>{(async(e,t,i)=>{if(yn(e),(e=>"ArrowLeft"===e.code)(e))return vn(e),void t();gn(e)&&(vn(e),i())})(e,t.returnFromSubMenu,t.closeSettingsMenu)},Tp=(e,t)=>{e.stopPropagation(),t.returnFromSubMenu()},Cp=(e,t)=>{bn(e)&&(vn(e),t.returnFromSubMenu())},Ep=Di('<div><ul role="menu"><li role="menuitem" tabindex="0" data-testid="return-to-settings-menu"><!> <p class="title svelte-7dfsuh"> </p></li> <!></ul></div>'),Ap={hash:"svelte-7dfsuh",code:".sub-menu.svelte-7dfsuh {--item-padding-vertical-mobile: 16px;--item-padding-vertical: 7px;--item-label-line-height: 18px;\n    /*Для первого и последнего элемента списка*/--edge-item-padding-vertical-mobile: calc(6px + var(--item-padding-vertical-mobile));--edge-item-padding-vertical: calc(8px + var(--item-padding-vertical));}.sub-menu.svelte-7dfsuh .item.mobile {padding:var(--item-padding-vertical-mobile) 17px;line-height:var(--item-label-line-height);font-size:14px;}.sub-menu.svelte-7dfsuh {\n    /**\n    * Так как у нас заголовок должен быть стики, нужно добавить паддинг с высоту заголовка.\n    * Предполагаем, что в одну строку он, иначе нужно рассчитывать динамически.\n    * paddingTop + lineHeight + paddingBottom.\n    */padding-top:calc(var(--edge-item-padding-vertical) + var(--item-padding-vertical) + var(--item-label-line-height));}.sub-menu.mobile.svelte-7dfsuh {padding-top:calc(\n      var(--edge-item-padding-vertical-mobile) + var(--item-padding-vertical-mobile) + var(--item-label-line-height) +\n        1px\n    );}.sub-menu.svelte-7dfsuh .items:where(.svelte-7dfsuh) .item.header:where(.svelte-7dfsuh) {position:absolute;top:0;left:0;right:0;min-width:max-content;display:flex;justify-content:space-between;border-bottom:var(--divider-border);}.header.svelte-7dfsuh .title:where(.svelte-7dfsuh) {margin-left:8px;}.sub-menu.svelte-7dfsuh .item {padding:var(--item-padding-vertical) 12px;padding-right:22px;}.items.svelte-7dfsuh .item:first-child:not(.mobile) {padding-top:var(--edge-item-padding-vertical);}.items.svelte-7dfsuh .item:last-child:not(.mobile) {padding-bottom:var(--edge-item-padding-vertical);}.items.svelte-7dfsuh .item.mobile:first-child {padding-top:var(--edge-item-padding-vertical-mobile);}.items.svelte-7dfsuh .item.mobile:last-child {padding-bottom:var(--edge-item-padding-vertical-mobile);}.sub-menu.svelte-7dfsuh .item.bottomBordered {border-bottom:var(--divider-border);}.sub-menu.svelte-7dfsuh .item .sublabel {line-height:14px;font-size:12px;}.sub-menu.svelte-7dfsuh .item:not(.mobile) .label,\n  .item.svelte-7dfsuh:not(.mobile) p:where(.svelte-7dfsuh) {line-height:var(--item-label-line-height);font-size:13px;}"};function Lp(e,t){pi(t,!0),vr(e,Ap);let[i,r]=ua(),a=()=>la(c,"$playerSize",i),s=ma(t,"isMobile",3,!1),n=ma(t,"playerControlsHeight",3,0),o=ma(t,"ariaLabelReturnFromSubMenu",19,(()=>Es("aria_label_submenu_back"))),l=ma(t,"listRef",15);Xr((()=>{let e=t.items.findIndex((e=>e.selected));l().children[e+1].focus()}));let u=Oa(),d=u.ui.isFullscreen,c=u.ui.playerSize,h=te(void 0),p=te(0),f=te(0),m=ne((()=>s()&&la(d,"$isFullscreen",i)?`max-height: ${Math.round(.6*a().height)}px`:s()?"":`max-height: ${a().height-32-Tt(f)-n()}px; overflow: auto;`)),v=ne((()=>Math.max(t.minWidth,Tt(p))));var g=Ep();let b;var y=Ne(g);let w;y.__keydown=[kp,t];var S=Ne(y);let x;S.__click=[Tp,t],S.__keydown=[Cp,t];var $=Ne(S);mh($,{direction:"left"});var _=De($,2),k=Ne(_,!0);Te(_),Te(S),Kr(S,(e=>re(h,e)),(()=>Tt(h))),ar(De(S,2),17,(()=>t.items),rr,((e,i)=>{var r=ji(),a=Be(r),n=e=>{!function(e,t){pi(t,!0),vr(e,pp);let i=ma(t,"isMobile",3,!1);var r=hp();let a;r.__click=[lp,t],r.__keydown=[up,t];var s=Ne(r),n=e=>{op(e)};Xi(s,(e=>{t.item.selected&&e(n)}));var o=De(s,2);let l;var u=Ne(o),d=e=>{var i=ji();pr(Be(i),(()=>t.item.valueComponent),((e,i)=>{i(e,pa((()=>t.item.valueComponentParams??{})))})),zi(e,i)},c=e=>{var r=dp();let a;var s=Ne(r,!0);Te(r),Bt((e=>{a=xr(r,1,"label svelte-1t7rx2m",null,a,e),Hi(s,t.item.label??t.item.value)}),[()=>({mobile:i()})]),zi(e,r)};Xi(u,(e=>{t.item.valueComponent?e(d):e(c,!1)}));var h=De(u,2),p=e=>{var i=cp(),r=Ne(i,!0);Te(i),Bt((()=>Hi(r,t.item.sublabel))),zi(e,i)};Xi(h,(e=>{t.item.sublabel&&e(p)})),Te(o),Te(r),Bt(((e,i,s)=>{a=xr(r,1,"item",null,a,e),Lr(r,"data-value",t.item.value),Lr(r,"aria-label",i),l=xr(o,1,"menu-item-value svelte-1t7rx2m",null,l,s),Lr(o,"data-selected",t.item.selected)}),[()=>({mobile:i()}),()=>t.item.ariaLabel??t.item.label??t.item.value.toString(),()=>({"submenu-value-mobile":i()})]),zi(e,r),fi()}(e,{get item(){return Tt(i)},get isMobile(){return s()}})},o=(e,r)=>{var a=e=>{!function(e,t){pi(t,!0);let i=ma(t,"isMobile",3,!1),r=ma(t,"refMenuItems",15),a=ne((()=>()=>t.openSubMenuList(t.item.children))),s=ne((()=>e=>_n(e,Tt(a))));var n=fp();let o;n.__click=function(...e){Tt(a)?.apply(this,e)},n.__keydown=function(...e){Tt(s)?.apply(this,e)};var l=Ne(n),u=e=>{op(e)};Xi(l,(e=>{t.item.selected&&e(u)}));var d=De(l,2);let c;var h=Ne(d),p=e=>{var i=ji();let r=ne((()=>t.item.valueComponent));pr(Be(i),(()=>Tt(r)),((e,i)=>{i(e,pa((()=>t.item.valueComponentParams??{})))})),zi(e,i)},f=e=>{var i=Fi();Bt((()=>Hi(i,t.item.label))),zi(e,i)};Xi(h,(e=>{t.item.valueComponent?e(p):e(f,!1)})),Te(d),Te(n),Kr(n,(e=>r(r()[t.item.id]=e,!0)),(()=>r()?.[t.item.id])),Bt(((e,i)=>{o=xr(n,1,"item",null,o,e),Lr(n,"aria-label",t.item.ariaLabel??t.item.label),Lr(n,"data-testid",t.item.id),c=xr(d,1,"menu-item-value",null,c,i)}),[()=>({mobile:i(),bottomBordered:t.item.bottomBordered}),()=>({"submenu-value-mobile":i()})]),zi(e,n),fi()}(e,{get isMobile(){return s()},get item(){return Tt(i)},get openSubMenuList(){return t.openSubMenuList},get refMenuItems(){return t.refMenuItems}})};Xi(e,(e=>{"OPEN_SUB_MENU"===Tt(i).type&&e(a)}),r)};Xi(a,(e=>{"SELECT_VALUE"===Tt(i).type?e(n):e(o,!1)})),zi(e,r)})),Te(y),Kr(y,(e=>l(e)),(()=>l())),Te(g),Bt(((e,i,r)=>{b=xr(g,1,"sub-menu menu svelte-7dfsuh",null,b,e),Lr(g,"data-testid",`sub-menu-${t.id}`),_r(g,`min-width: ${Tt(v)}px`),w=xr(y,1,"items svelte-7dfsuh",null,w,i),_r(y,Tt(m)),x=xr(S,1,"item header back svelte-7dfsuh",null,x,r),Lr(S,"aria-label",o()),Hi(k,t.title)}),[()=>({desktop:!s(),mobile:s()}),()=>({mobile:s()}),()=>({mobile:s()})]),Qr(S,"clientWidth",(e=>re(p,e))),Qr(S,"clientHeight",(e=>re(f,e))),zi(e,g),fi(),r()}Ri(["keydown","click"]);var Pp=(e,t)=>_n(e,t()),Mp=(e,t)=>{e.stopPropagation(),t()()},Ip=Di('<div class="value svelte-1ikfjte"> </div>'),Rp=Di('<li role="menuitem" tabindex="0" aria-haspopup="true"><div class="icon-wrapper"><!></div> <div class="label"> </div> <!></li>'),Vp={hash:"svelte-1ikfjte",code:".value.svelte-1ikfjte {position:relative;opacity:0.7;overflow:hidden;text-overflow:ellipsis;}"};Ri(["click","keydown"]);var Np=(e,t)=>{kn(e,(()=>t()))},Bp=Di('<div class="icon icon-error-stub"><div class="inner"></div></div>'),Dp=Di('<img class="icon" aria-hidden="true">'),Op=Di('<li role="menuitem" tabindex="0"><div class="icon-wrapper"><!></div> <div class="label svelte-15ifkac"> </div></li>'),Fp={hash:"svelte-15ifkac",code:".label.svelte-15ifkac {overflow:hidden;text-overflow:ellipsis;}"};Ri(["click","keydown"]);var jp=Di('<div class="toggle_wrap svelte-17wbjko"><div></div> <div class="toggle-label svelte-17wbjko"></div></div>'),zp={hash:"svelte-17wbjko",code:'.toggle_wrap.svelte-17wbjko {min-height:15px;padding:0;font-size:12px;line-height:15px;cursor:pointer;user-select:none;}.toggle.svelte-17wbjko {float:right;margin-top:3px;width:28px;height:9px;border-radius:45px;background-color:var(--toggle-color-separator);cursor:pointer;}.toggle.svelte-17wbjko::after {content:"";float:left;position:relative;width:15px;height:15px;border-radius:50%;background-color:var(--toggle-color-off);top:-3px;left:0;transition:left .1s ease;}.toggle.on.svelte-17wbjko::after {background-color:var(--toggle-color-on);left:13px;}.toggle-label.svelte-17wbjko {overflow:hidden;}'};var Up=(e,t,i)=>{((e,t,i)=>{if(bn(e))vn(e),i(!t);else{let r=e.code;if("ArrowLeft"===r&&t)return i(!1),void vn(e);"ArrowRight"===r&&!t&&(i(!0),vn(e))}})(e,t(),(e=>i()(e)))},qp=(e,t,i)=>{e.stopPropagation(),t()(!i())},Hp=Di('<div><div class="icon-wrapper"><!></div> <div class="label"> </div> <!></div>'),Wp=Di('<li role="menuitem" tabindex="0"><!></li>');function Qp(e,t){pi(t,!0);let i=ma(t,"isMobile",3,!1),r=ma(t,"onClick",3,m.noop),a=ma(t,"enabled",3,!1),s=ma(t,"tooltipText",3,void 0),n=ma(t,"maxTooltipWidth",3,void 0);var o=Wp();let l;o.__click=[qp,r,a],o.__keydown=[Up,a,r],Vl(Ne(o),{get content(){return s()},get isMobile(){return i()},placement:"left",translateX:10,isFullWidthWrapper:!0,get maxTooltipWidth(){return n()},children:(e,r)=>{var s=Hp();let n;var o=Ne(s),l=Ne(o),u=e=>{mc(e,{get icon(){return t.icon}})},d=e=>{var i=ji();let r=ne((()=>t.icon));pr(Be(i),(()=>Tt(r)),((e,t)=>{t(e,{})})),zi(e,i)};Xi(l,(e=>{"string"==typeof t.icon?e(u):e(d,!1)})),Te(o);var c=De(o,2),h=Ne(c,!0);Te(c),function(e,t){vr(e,zp);let i=ma(t,"enabled",3,!1);var r=jp(),a=Ne(r);let s;Ce(2),Te(r),Bt((e=>s=xr(a,1,"toggle svelte-17wbjko",null,s,e)),[()=>({on:i()})]),zi(e,r)}(De(c,2),{get enabled(){return a()}}),Te(s),Bt((e=>{n=xr(s,1,"switch-wrapper",null,n,e),Hi(h,t.label)}),[()=>({mobile:i()})]),zi(e,s)},$$slots:{default:!0}}),Te(o),Bt((e=>{l=xr(o,1,"item switch-item",null,l,e),Lr(o,"aria-label",t.ariaLabel??t.label),Lr(o,"data-testid",t.id)}),[()=>({mobile:i()})]),zi(e,o),fi()}Ri(["click","keydown"]);var Gp=Di('<div class="quality-icon svelte-t2qk8t"><!></div>'),Kp=Di('<div class="quality-label svelte-t2qk8t"><span> </span> <!></div>'),Yp={hash:"svelte-t2qk8t",code:".quality-label.svelte-t2qk8t {position:relative;}.quality.svelte-t2qk8t {font-size:13px;line-height:18px;}.quality.sub.svelte-t2qk8t {opacity:0.7;}.quality-icon.svelte-t2qk8t {position:absolute;padding-left:2px;transform:translateX(100%);display:flex;top:0;right:0;}.quality-icon.svelte-t2qk8t svg {color:var(--blue-light);}"};function Zp(e,t){pi(t,!0),vr(e,Yp);let i=ma(t,"isSubCase",3,!1),r=ne((()=>dl(t.quality)));var a=Kp(),s=Ne(a);let n;var o=Ne(s,!0);Te(s);var l=De(s,2),u=e=>{var t=Gp();let i=ne((()=>Tt(r)));pr(Ne(t),(()=>Tt(i)),((e,t)=>{t(e,{})})),Te(t),zi(e,t)};Xi(l,(e=>{Tt(r)&&!t.isMobile&&e(u)})),Te(a),Bt((e=>{n=xr(s,1,"svelte-t2qk8t",null,n,e),Hi(o,t.label)}),[()=>({sub:!i(),quality:!t.isMobile})]),zi(e,a),fi()}var Xp=({quality:e,availableQualities:t})=>{let i=t.find((t=>t.value===e));return i?i.displayValue:e},Jp=Di('<div class="menu-item-value-wrapper svelte-1j7b2kc"><!></div>'),ef={hash:"svelte-1j7b2kc",code:".menu-item-value-wrapper.svelte-1j7b2kc {line-height:normal;}"};function tf(e,t){pi(t,!0),vr(e,ef);let[i,r]=ua(),a=()=>la(n,"$currentQuality$",i),s=Oa(),n=s.state.currentQuality$,o=s.state.availableQualities$,l=s.ui.isMobile,u=ne((()=>t.prefix+(t.selected&&a()!==m.VideoQuality.INVARIANT?" · ":""))),d=ne((()=>(({quality:e,availableQualities:t,prefix:i,onlyPrefix:r})=>e?r||e===f.VideoQuality.INVARIANT?i:`${i}${Xp({quality:e,availableQualities:t})}`:"...")({prefix:Tt(u),quality:a(),availableQualities:la(o,"$availableQualities$",i),onlyPrefix:!t.selected})));var c=Jp(),h=Ne(c);let p=ne((()=>t.selected?a():void 0));Zp(h,{get quality(){return Tt(p)},get label(){return Tt(d)},get isMobile(){return la(l,"$isMobile$",i)},isSubCase:!0}),Te(c),zi(e,c),fi(),r()}var rf={br:!0,span:!0},af=(e,t={})=>{if(!e)return e;let i={...rf,...t},r=Object.keys(i);if(!r.length)return e;let a=(e=>{let t=e.join("|");return new RegExp(`<(?<keyhtml>.*?)(?<propshtml> .*?)?>(?<childrenhtml>.*?)</\\k<keyhtml>>|{(?<keyi18n>${t})}(?<childreni18n>.*?){/\\k<keyi18n>}|<(?<keyhtmlself>.*?)(?<propshtmlself> .*?)?/?>|{(?<keyi18nself>${t})}`,"g")})(r),s=[],n=0;for(let t of e.matchAll(a)){let r=t[0],a=t.groups?.keyhtml||t.groups?.keyi18n||t.groups?.keyhtmlself||t.groups?.keyi18nself||"",{index:o}=t;if(!i[a]){s.push(e.slice(n,o)),n=o+r.length;continue}let l=t.groups?.childrenhtml?af(t.groups.childrenhtml,i):"",u=t.groups?.childrenhtml?r.replace(new RegExp(t.groups?.childrenhtml),(()=>l||"")):r;s.push(e.slice(n,o),u),n=o+r.length}return 0===n?e:(s.push(e.slice(n)),s.join(""))};function sf(e,t){pi(t,!1);let i=ma(t,"message",8),r=af(i());Yr();var a=ji(),s=Be(a),n=e=>{var t=ji();cr(Be(t),(()=>r),!1,!1),zi(e,t)};Xi(s,(e=>{r&&e(n)})),zi(e,a),fi()}var nf=Di('<p class="quality-applies sublabel svelte-1qk3zto"><!></p>'),of={hash:"svelte-1qk3zto",code:".quality-applies.svelte-1qk3zto {display:flex;justify-content:end;padding:3px 0;color:rgba(255, 255, 255, 0.5);}.quality-applies span {color:#70c1ff;}"};function lf(e,t){pi(t,!1),vr(e,of),Yr();var i=nf(),r=Ne(i);let a=oe((()=>Es("quality_applience",{action:`<span>${Es("quality_applience_action")}</span>`})));sf(r,{get message(){return Tt(a)}}),Te(i),zi(e,i),fi()}var uf=({isAutoQualityEnabled:e,trafficSavingEnabled:t,highQualityEnabled:i})=>{let r=!e&&!t&&!i;return{id:"QUALITY_OTHER",type:"OPEN_SUB_MENU",selected:r,valueComponent:tf,valueComponentParams:{prefix:Es("other_quality"),selected:r},children:"QUALITY"}},df=({appliesTo:e,labelWithQuality:t,selected:i},{selectQuality:r})=>({id:"QUALITY_AUTO",type:"SELECT_VALUE",value:"auto",label:Es("auto_quality_limit"),valueComponent:t?tf:void 0,valueComponentParams:{prefix:Es("auto_quality_limit"),selected:i},selectItem:()=>r("auto",e),selected:i}),cf=({labelWithQuality:e,appliesTo:t,selected:i},{toggleHighQuality:r})=>({id:"QUALITY_HIGH",type:"SELECT_VALUE",value:"high_quality",selectItem:()=>r(!0,t),selected:i,label:Es("high_quality"),valueComponent:e?tf:void 0,valueComponentParams:{prefix:Es("high_quality"),selected:i},sublabel:Es("high_quality_description")}),hf=({labelWithQuality:e,appliesTo:t,selected:i},{toggleTrafficSaving:r})=>({id:"QUALITY_TRAFFIC_SAVING",type:"SELECT_VALUE",value:"save_traffic",selectItem:()=>r(!0,t),selected:i,label:Es("traffic_saving_quality"),valueComponent:e?tf:void 0,valueComponentParams:{prefix:Es("traffic_saving_quality"),selected:i},sublabel:Es("traffic_saving_quality_description")}),pf=(e,t)=>String(t.findIndex((t=>t.id===e.id))+1),ff=(e,t)=>{if(!e)return"";let i,{language:r,label:a}=e;if("und"===r?i=void 0:r&&(i=dd(r)??r),a&&r&&i){let s=t.filter((e=>e.label===a&&e.language===r));if(1===s.length)return Es("audio_stream_display_language_label",{language:i,label:a});{let t=pf(e,s);return Es("audio_stream_display_language_label_index",{language:i,label:a,index:t})}}if(a){let i=t.filter((e=>e.label===a));if(1===i.length)return a;{let t=pf(e,i);return Es("audio_stream_display_label_index",{label:a,index:t})}}if(r&&i){let a=t.filter((e=>e.language===r));if(1===a.length)return i;{let t=pf(e,a);return Es("audio_stream_display_language_index",{language:i,index:t})}}let s=pf(e,t);return Es("audio_stream_display_unknown",{index:s})},mf={QUALITY_DETAILS:e=>{let{isAutoQualityEnabled:t,isAutoQualityAvailable:i,trafficSavingEnabled:r,highQualityEnabled:a}=e,s=[];return i&&s.push({handler:df,selected:t&&!r&&!a||!1}),s.push({handler:hf,selected:r},{handler:cf,selected:a}),{title:Es("submenu_quality"),id:"QUALITY_DETAILS",items:[{id:"QUALITY_APPLIENCE",type:"OPEN_SUB_MENU",valueComponent:lf,bottomBordered:!0,children:"QUALITY_APPLIENCE"},...s.map((({handler:t,selected:i})=>t({labelWithQuality:!0,appliesTo:"to-video",selected:i},e))),uf(e)]}},QUALITY:({closeSettingsMenu:e,selectQuality:t,availableQualities:i,isMobile:r})=>({id:"QUALITY",title:Es("submenu_quality"),closeSettingsMenu:e,items:i.map((e=>({type:"SELECT_VALUE",value:e.value,valueComponent:Zp,valueComponentParams:{quality:e.value,label:e.displayValue,isMobile:r,isSubCase:!0},selectItem:e=>t(e,"to-video"),selected:e.selected,label:e.displayValue})))}),QUALITY_APPLIENCE:e=>{let{closeSettingsMenu:t}=e;return{id:"QUALITY_APPLIENCE",title:Es("default_quality_for_any_video"),closeSettingsMenu:t,items:[{handler:df,selected:"auto_quality"===vs()?.type},{handler:hf,selected:"traffic_saving"===vs()?.type},{handler:cf,selected:"high_quality"===vs()?.type}].map((({handler:t,selected:i})=>t({labelWithQuality:!1,appliesTo:"as-default",selected:i},e)))}},AUDIO_LANGUAGES:({closeSettingsMenu:e,availableAudioStreams:t,currentAudioStream:i,selectAudioLanguage:r})=>({id:"AUDIO_LANGUAGES",title:Es("submenu_audio_languages"),closeSettingsMenu:e,items:t.map((e=>({type:"SELECT_VALUE",value:e,dataValue:e.id,selectItem:r,selected:e.id===i?.id,label:ff(e,t)})))}),PLAYBACK_RATE_SUB_MENU:({closeSettingsMenu:e,availablePlaybackRates:t,selectPlaybackRate:i})=>({id:"PLAYBACK_RATE_SUB_MENU",title:Es("submenu_playback_rate"),closeSettingsMenu:e,items:t.map((e=>({type:"SELECT_VALUE",value:e.value,selectItem:i,selected:e.selected,label:e.displayValue})))}),SUBTITLES:({availableSubtitlesList:e,selectSubtitle:t})=>({id:"SUBTITLES",minWidth:164,title:Es("subtitles_caption"),items:e.map((e=>({type:"SELECT_VALUE",value:e,selectItem:t,selected:e.selected,label:e.displayValue})))})},vf=Oi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M.1 6.5c0-2.24 0-3.36.436-4.216A4 4 0 0 1 2.284.536C3.139.1 4.259.1 6.5.1h5c2.24 0 3.36 0 4.216.436a4 4 0 0 1 1.748 1.748c.436.856.436 1.976.436 4.216s0 3.36-.436 4.216a4 4 0 0 1-1.748 1.748c-.836.426-1.925.436-4.064.436l.55 2.2H14.1a.9.9 0 0 1 0 1.8H3.9a.9.9 0 1 1 0-1.8h1.897l.55-2.2c-2.139 0-3.227-.01-4.063-.436a4 4 0 0 1-1.748-1.748C.1 9.86.1 8.74.1 6.5m11.4-4.6h-5c-1.15 0-1.904.002-2.481.049-.556.045-.786.124-.918.19a2.2 2.2 0 0 0-.962.962c-.067.132-.145.363-.19.918-.048.577-.05 1.331-.05 2.481s.002 1.904.05 2.48c.045.556.123.787.19.919a2.2 2.2 0 0 0 .962.961c.132.068.362.146.918.192.577.047 1.33.048 2.48.048h5c1.15 0 1.904-.001 2.481-.048.556-.046.787-.124.918-.192a2.2 2.2 0 0 0 .962-.961c.067-.132.146-.363.191-.918.047-.577.049-1.331.049-2.48s-.002-1.905-.049-2.482c-.045-.555-.124-.786-.191-.918a2.2 2.2 0 0 0-.962-.961c-.131-.067-.362-.146-.918-.191-.577-.048-1.33-.049-2.48-.049m-3.298 11-.55 2.2h2.695l-.55-2.2z" clip-rule="evenodd"></path></svg>');function gf(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=vf();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"17",fill:"none","aria-hidden":"true","data-testid":"traffic-saving-icon",role:"img",...i}))),zi(e,r)}var bf=Oi('<svg><!><path fill="var(--btn-color, #fff)" d="M8.295 14.247c1.87 1.896 5.505.02 5.505-3.548V5.645l2.399-.697A2.74 2.74 0 0 0 18 2.364l-.01-1.72a.75.75 0 0 0-.906-.623l-.267.061c-.941.215-1.886.431-2.807.721-1.332.45-2.03 1.614-2.01 3.077V9c-3.887.196-5.639 3.286-3.705 5.247M.9.1a.9.9 0 0 0 0 1.8h8.197a.9.9 0 0 0 0-1.8zM.9 5.1a.9.9 0 1 0 0 1.8h7.196a.9.9 0 0 0 0-1.8zM0 11a.9.9 0 0 1 .9-.9h4.183a.9.9 0 1 1 0 1.8H.9A.9.9 0 0 1 0 11"></path></svg>');function yf(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=bf();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"15",fill:"none","aria-hidden":"true","data-testid":"audio-languages-icon",role:"img",...i}))),zi(e,r)}var wf=Oi('<svg><!><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z"></path><path fill="var(--btn-color, #fff)" fill-rule="nonzero" d="M11 4.07V2.05c-2.01.2-3.84 1-5.32 2.21L7.1 5.69A7.94 7.94 0 0 1 11 4.07M5.69 7.1 4.26 5.68A9.95 9.95 0 0 0 2.05 11h2.02c.18-1.46.76-2.79 1.62-3.9M2.05 13c.2 2.01 1 3.84 2.21 5.32l1.43-1.43A7.87 7.87 0 0 1 4.07 13zM11 21.95v-2.02a7.94 7.94 0 0 1-3.9-1.62l-1.42 1.43A10 10 0 0 0 11 21.95M22 12c0 5.16-3.92 9.42-8.95 9.95v-2.02C16.97 19.41 20 16.05 20 12s-3.03-7.41-6.95-7.93V2.05C18.08 2.58 22 6.84 22 12M10.688 8.576l4.746 2.736a.792.792 0 0 1 0 1.372l-4.746 2.737a.792.792 0 0 1-1.188-.686V9.262a.792.792 0 0 1 1.188-.686"></path></g></svg>');function Sf(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=wf();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24","aria-hidden":"true","data-testid":"play-speed-icon",role:"img",...i}))),zi(e,r)}var xf=Oi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M8 0a.9.9 0 0 1 .9.9v10.927l4.564-4.563a.9.9 0 0 1 1.272 1.272l-6.1 6.1a.9.9 0 0 1-1.272 0l-6.1-6.1a.9.9 0 1 1 1.272-1.272L7.1 11.827V.9A.9.9 0 0 1 8 0M0 18a.9.9 0 0 1 .9-.9h14.2a.9.9 0 1 1 0 1.8H.9A.9.9 0 0 1 0 18" clip-rule="evenodd"></path></svg>');function $f(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=xf();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"19",fill:"none","aria-hidden":"true","data-testid":"download-icon",role:"img",...i}))),zi(e,r)}var _f=Oi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M8.863 2.1h6.274c.674-.002 1.2.211 1.683.697l4.383 4.383c.478.476.699.998.697 1.683v6.274c.002.685-.22 1.207-.697 1.683l-4.383 4.383c-.476.478-.998.699-1.683.697H8.863c-.685.002-1.207-.22-1.683-.697L2.797 16.82c-.478-.476-.699-.998-.697-1.683V8.863c-.002-.685.22-1.207.697-1.683L7.18 2.797c.484-.486 1.009-.699 1.683-.697m-.445 2.005L4.105 8.418c-.18.18-.205.242-.205.495v6.174c0 .25.025.316.205.495l4.313 4.313c.179.179.24.205.495.205h6.174c.253 0 .316-.026.495-.205l4.313-4.313c.18-.18.205-.245.205-.495V8.913c0-.254-.026-.316-.205-.495l-4.313-4.313c-.18-.18-.242-.205-.495-.205H8.913c-.254 0-.319.029-.495.205M13 16a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-.1-8.1a.9.9 0 0 0-1.8 0v5.2a.9.9 0 1 0 1.8 0z" clip-rule="evenodd"></path></svg>');function kf(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=_f();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"report-icon",role:"img",...i}))),zi(e,r)}var Tf=Oi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M4 12.3V12c0-1.47.005-2.547.075-3.403.074-.904.216-1.482.454-1.949a4.85 4.85 0 0 1 2.12-2.12c.466-.237 1.044-.379 1.948-.453C9.51 4.001 10.675 4 12.3 4h4.512a2 2 0 0 0-.174-.49 2.4 2.4 0 0 0-1.048-1.048 2.4 2.4 0 0 0-.931-.239 14 14 0 0 0-1.026-.023H12.26c-1.576 0-2.814 0-3.81.081-1.014.083-1.856.255-2.62.644A6.65 6.65 0 0 0 2.926 5.83c-.389.763-.56 1.605-.644 2.62-.081.995-.081 2.233-.081 3.809v1.373c0 .392 0 .738.023 1.025.025.306.081.623.239.931a2.4 2.4 0 0 0 1.048 1.05c.162.082.326.136.49.173V12.3zM10.08 6h-.035c-.52 0-.964 0-1.329.03-.383.03-.755.097-1.112.276a2.9 2.9 0 0 0-1.298 1.298c-.179.357-.246.73-.277 1.112C6 9.081 6 9.524 6 10.046v7.909c0 .52 0 .964.03 1.329.03.382.097.755.276 1.112a2.9 2.9 0 0 0 1.298 1.298c.357.179.73.246 1.112.277.365.029.808.029 1.329.029h6.91c.52 0 .964 0 1.329-.03.382-.03.755-.097 1.112-.276a2.9 2.9 0 0 0 1.298-1.298c.179-.357.246-.73.277-1.112.029-.365.029-.808.029-1.33v-7.909c0-.52 0-.964-.03-1.329-.03-.382-.097-.755-.276-1.112a2.9 2.9 0 0 0-1.298-1.298c-.357-.179-.73-.246-1.112-.277C17.919 6 17.476 6 16.954 6zM8.408 7.916c.065-.032.179-.07.452-.093a18 18 0 0 1 1.22-.023h6.84c.565 0 .936 0 1.22.023.273.022.387.06.452.093a1.1 1.1 0 0 1 .492.492c.032.065.07.179.093.452.022.284.023.655.023 1.22v7.84c0 .565 0 .936-.023 1.22-.023.273-.06.387-.093.452a1.1 1.1 0 0 1-.492.492c-.065.032-.18.07-.452.093a18 18 0 0 1-1.22.023h-6.84c-.565 0-.936 0-1.22-.023-.273-.023-.387-.06-.452-.093a1.1 1.1 0 0 1-.492-.492c-.032-.065-.07-.18-.093-.452a17 17 0 0 1-.023-1.22v-7.84c0-.565 0-.936.023-1.22.022-.273.06-.387.093-.452a1.1 1.1 0 0 1 .492-.492" clip-rule="evenodd"></path></svg>');function Cf(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=Tf();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"copy-icon",role:"img",...i}))),zi(e,r)}var Ef=Oi('<svg><!><path fill="var(--btn-color, #fff)" d="M12 20.105a8.105 8.105 0 1 0 0-16.21 8.105 8.105 0 0 0 0 16.21M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10m0-12.372a1.316 1.316 0 1 1 0-2.632 1.316 1.316 0 0 1 0 2.632m-.947 2.822c0-.541.424-.98.947-.98s.947.439.947.98v3.83c0 .54-.424.98-.947.98s-.947-.44-.947-.98z"></path></svg>');function Af(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=Ef();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"info-icon",role:"img",...i}))),zi(e,r)}var Lf=Di('<div class="menu-item-value-wrapper svelte-1j7b2kc"><!></div>'),Pf={hash:"svelte-1j7b2kc",code:".menu-item-value-wrapper.svelte-1j7b2kc {line-height:normal;}"};function Mf(e,t){pi(t,!0),vr(e,Pf);let[i,r]=ua(),a=()=>la(n,"$currentQuality$",i),s=Oa(),n=s.state.currentQuality$,o=s.state.availableQualities$,l=s.state.isAutoQualityEnabled$,u=s.ui.isMobile,d=ne((()=>(({quality:e,availableQualities:t,isAutoQualityEnabled:i})=>{if(!e)return"...";let r=Xp({quality:e,availableQualities:t});return i?e===f.VideoQuality.INVARIANT?Es("auto_quality_invariant"):Es("auto_quality",{actual:r}):r})({quality:a(),availableQualities:la(o,"$availableQualities$",i),isAutoQualityEnabled:la(l,"$isAutoQualityEnabled$",i)})));var c=Lf();Zp(Ne(c),{get quality(){return a()},get label(){return Tt(d)},get isMobile(){return la(u,"$isMobile$",i)}}),Te(c),zi(e,c),fi(),r()}var If={QUALITY_SETTINGS:({isAutoQualityEnabled:e,currentQuality:t,qualityDetailsSubMenuEnabled:i})=>{let r=(e?Es("auto_quality_option"):t)||"";return{id:"QUALITY_SETTINGS",type:"OPEN_SUB_MENU",ariaLabel:Es("aria_label_menu_quality",{actual:r}),icon:ml,label:Es("menu_quality"),value:t,valueComponent:Mf,weight:mp,children:i?"QUALITY_DETAILS":"QUALITY"}},TRAFFIC_SAVING_SWITCH:({trafficSavingEnabled:e,toggleTrafficSaving:t})=>({id:"TRAFFIC_SAVING_SWITCH",weight:yp,type:"SWITCH",onClick:e=>t(e,"to-video"),ariaLabel:e?Es("aria_label_submenu_traffic_saving_off"):`${Es("aria_label_submenu_traffic_saving_on")}. ${Es("traffic_saving_helper_text")}`,icon:gf,label:Es("menu_traffic_saving"),enabled:e,tooltipText:Es("traffic_saving_helper_text"),maxTooltipWidth:175}),AUDIO_LANGUAGES:({currentAudioStream:e,availableAudioStreams:t})=>{let i=ff(e,t);return{id:"AUDIO_LANGUAGES",weight:vp,type:"OPEN_SUB_MENU",ariaLabel:Es("aria_label_menu_audio_languages",{actual:i}),icon:yf,label:Es("menu_audio_languages"),value:i,children:"AUDIO_LANGUAGES"}},PLAYBACK_RATE:({availablePlaybackRates:e,currentPlaybackRate:t})=>{let i=e.find((e=>e.value===t))?.displayValue||"";return{id:"PLAYBACK_RATE",weight:gp,type:"OPEN_SUB_MENU",ariaLabel:Es("aria_label_menu_rate",{actual:i}),icon:Sf,label:Es("menu_playback_rate"),value:`${t}x`,children:"PLAYBACK_RATE_SUB_MENU"}},SUBTITLES:({currentSubtitle:e})=>({id:"SUBTITLES",weight:bp,type:"OPEN_SUB_MENU",ariaLabel:Es("aria_label_menu_subtitle",{actual:e.displayValue}),icon:Sl,label:Es("subtitles_caption"),value:e.displayValue,children:"SUBTITLES"}),DOWNLOAD:({onDownloadClick:e})=>({id:"DOWNLOAD",weight:wp,type:"CLICK",onClick:e,label:Es("download_video_caption"),ariaLabel:Es("aria_label_menu_download"),icon:$f}),SHOW_SUPPORT:({onReportProblemClick:e})=>({id:"SHOW_SUPPORT",weight:Sp,type:"CLICK",onClick:e,label:Es("menu_report"),ariaLabel:`${Es("menu_report")}. ${Es("aria_label_new_tab_alert")}`,icon:kf,isHiddenFor:["desktop"]}),COPY_DATA:({onCopyDataClick:e})=>({id:"COPY_DATA",weight:xp,type:"CLICK",onClick:e,label:Es("menu_copy_debug"),ariaLabel:Es("menu_copy_debug"),icon:Cf,isHiddenFor:["desktop"]}),SAVE_TRACE_INFO:({onSaveTraceDataClick:e})=>({id:"SAVE_TRACE_INFO",weight:$p,type:"CLICK",onClick:e,label:Es("menu_save_debug"),ariaLabel:Es("menu_save_debug"),icon:Cf,isHiddenFor:["desktop"]}),DEBUG_INFO:({toggleShowDebugInfo:e,debugPanelVisible:t})=>({id:"DEBUG_INFO",weight:_p,type:"CLICK",onClick:e,label:Es(t?"aria_label_menu_debug_overlay_disable":"aria_label_menu_debug_overlay_enable"),ariaLabel:Es("menu_debug_overlay"),icon:Af,isHiddenFor:["desktop"]})},Rf=(e,t)=>{$n(e,t)},Vf=Di('<div><div> </div> <div class="close svelte-17or3al"></div></div>'),Nf=Di('<div data-testid="settings-menu"><!> <ul role="menu"></ul></div>'),Bf=Di("<div><!> <!></div>"),Df={hash:"svelte-17or3al",code:".settings-menu-container.mobile.svelte-17or3al {width:100%;}.settings-menu-container.svelte-17or3al ul {margin:0;padding:0;list-style-type:none;}.settings-menu-container.svelte-17or3al .menu {background-color:var(--settings-bg);border-radius:var(--settings-radius);transition:opacity 0.2s, visibility 0.2s;overflow:hidden;}.settings-menu-container.svelte-17or3al .menu .item:first-child:not(.mobile) {border-top-right-radius:var(--settings-radius);border-top-left-radius:var(--settings-radius);}.settings-menu-container.svelte-17or3al .menu .item:last-child {border-bottom-right-radius:var(--settings-radius);border-bottom-left-radius:var(--settings-radius);}.settings-menu-container.svelte-17or3al .settings-menu .item:first-child:not(.mobile) {padding-top:6px;}.settings-menu-container.svelte-17or3al .settings-menu .item:last-child:not(.mobile) {padding-bottom:6px;}.settings-menu-container.svelte-17or3al .menu.desktop {position:absolute;right:0;bottom:0;max-width:100%;}.settings-menu.svelte-17or3al {line-height:40px;}.settings-menu.desktop.svelte-17or3al {\n    /* нужно чтоб меню не скакало в ширине при смене разрешения, особо актуально при авто режиме */min-width:300px;}.settings-menu-container.svelte-17or3al .menu.mobile {width:100%;background:var(--mobile-settings-bg);font-size:15px;line-height:50px;}.settings-menu-container.svelte-17or3al .menu.mobile.hidden {display:none;}.settings-menu-container.svelte-17or3al .menu .item:not(.switch-item),\n  .settings-menu-container.svelte-17or3al .menu .switch-wrapper {align-items:center;color:var(--white);cursor:pointer;display:flex;justify-content:flex-end;white-space:nowrap;position:relative;}.settings-menu-container.svelte-17or3al .menu .item:hover {background-color:var(--settings-item-bg-hover);}.settings-menu-container.svelte-17or3al .menu .item.mobile:hover {background:var(--mobile-settings-bg);}.settings-menu.svelte-17or3al .item:not(.switch-item),\n  .settings-menu.svelte-17or3al .switch-wrapper {padding:0 32px 0 18px;}.settings-menu.svelte-17or3al .item.mobile:not(.switch-item),\n  .settings-menu.svelte-17or3al .switch-wrapper.mobile {padding:0 14px;}.settings-menu.svelte-17or3al .icon-wrapper {width:24px;min-width:24px;height:24px;display:flex;align-items:center;justify-content:center;margin-right:16px;}.settings-menu.svelte-17or3al .label {flex-grow:1;margin-right:24px;overflow:hidden;text-overflow:ellipsis;}.settings-menu.svelte-17or3al .item.header.mobile:where(.svelte-17or3al) {color:var(--white);cursor:pointer;justify-content:space-between;column-gap:12px;display:flex;border-bottom:var(--divider-border);margin-bottom:4px;}.settings-menu-container.svelte-17or3al .items::-webkit-scrollbar {width:8px;}.settings-menu-container.svelte-17or3al .items::-webkit-scrollbar-track {box-shadow:none;background-color:#3a3a3a;border-radius:4px;}.settings-menu-container.svelte-17or3al .items::-webkit-scrollbar-thumb {min-height:40px;border-radius:5px;background-color:#666;border:1px solid transparent;background-clip:padding-box;}.settings-menu-container.svelte-17or3al .items::-webkit-scrollbar-thumb:hover {background-color:#777;}.settings-menu-container.svelte-17or3al .items.mobile {overflow-y:auto;overflow-x:hidden;max-height:160px;text-align:left;}.close.svelte-17or3al {position:relative;width:12px;height:12px;padding:12px;margin-right:-12px;}.close.svelte-17or3al:before, .close.svelte-17or3al:after {position:absolute;left:18px;content:' ';height:12px;width:2px;background-color:var(--white);}.close.svelte-17or3al:before {transform:rotate(45deg);}.close.svelte-17or3al:after {transform:rotate(-45deg);}"};function Of(e,t){pi(t,!0),vr(e,Df);let[i,r]=ua(),a=()=>la(B,"$settingsMenuVisible",i),s=()=>la(D,"$settingsMenuOpenedByKeyboard",i),n=()=>la(W,"$debugPanelVisible",i),o=()=>la(F,"$isMobile",i),l=()=>la(H,"$playerSize",i),u=()=>la(j,"$mobileNotReportControlHidden$",i),d=()=>la(R,"$availableSubtitlesList$",i),c=()=>la(k,"$availableAudioStreams$",i),h=()=>la(M,"$availablePlaybackRates$",i),p=()=>la(_,"$currentAudioStream$",i),f=()=>la(U,"$trafficSavingEnabled",i),v=()=>la(T,"$currentQuality$",i),g=()=>la(A,"$isAutoQualityEnabled$",i),b=ma(t,"ref",15,void 0),y=ma(t,"playerControlsHeight",3,0),w=Ae({}),S=Ae({}),x=Oa(),$=ya(),_=x.state.audioStream$,k=x.state.availableAudioStreams$,T=x.state.currentQuality$,C=x.state.availableQualities$,E=x.state.autoQualityLimitingAvailable$,A=x.state.isAutoQualityEnabled$,L=x.state.isAutoQualityAvailable$,P=x.state.currentPlaybackRate$,M=x.state.availablePlaybackRates$,I=x.state.currentSubtitle$,R=x.state.availableSubtitlesList$,V=x.state.canDownload,N=x.state.hasMpegSources$,B=x.ui.settingsMenu.visible$,D=x.ui.settingsMenu.openedByBtnKeyboard$,O=x.ui.settingsMenu.ref$,F=x.ui.isMobile,j=x.ui.mobileNotReportControlHidden$,z=x.state.canChangePlaybackSpeed$,U=x.state.trafficSavingEnabled$,q=x.state.highQualityEnabled$,H=x.ui.playerSize,W=x.ui.debugPanelVisible,Q=x.state.isInteractiveTime$,G=x.ui.additionalSettingsMenuItems$,K=x.ui.t,Y=x.actions.internal.downloadVideo,Z=x.actions.internal.closeSettingsMenu,X=x.actions.internal.openSettingsSubMenu,J=x.actions.internal.closeSettingsSubMenu,ee=te(!1),ie=te(void 0),ae=(()=>{let e=te(Ae([])),t=ne((()=>(Tt(e).length?Tt(e).at(-1):null)||null));return{get current(){return Tt(t)},pushSubMenu:t=>{Tt(e).push(t)},popSubMenu:()=>{re(e,Ae(Tt(e).slice(0,-1)))},popAllSubMenus:()=>{re(e,Ae([]))}}})();async function se(e){ae.pushSubMenu(e),await kt(),X(e,S[e])}function oe(e){e?.stopPropagation(),s()||t.returnFocus?.(),Z(),re(ee,!1)}function le(e,t){x.actions.internal.setQuality(e,{appliesTo:t}),oe()}function ue(e){x.actions.internal.setAudioStream(e),oe()}function de(e,t){x.actions.internal.setTrafficSavingEnabled(e,t),$.features.qualityDetailsSubMenuEnabled&&oe()}function ce(e,t){x.actions.internal.setHighQualityEnabled(e,t),oe()}function he(e){x.actions.internal.setPlaybackRate(e),oe()}function pe(e){x.actions.internal.setSubtitle(e),oe()}function fe(){Y()}function me(){(0,m.isValidURL)(t.supportLink)&&window.open(t.supportLink,"_blank"),x.actions.internal.reportProblem(),x.actions.internal.pause()}function ve(){mn(x.actions.internal.getDebugTextData())}Rt((()=>{!a()&&ae.current&&(J(S[ae.current]),ae.popAllSubMenus())})),Rt((()=>{a()||re(ie,void 0)})),Rt((()=>{!ae.current&&Tt(ie)&&(async(e,t)=>{setTimeout((()=>{let i=e[t];i&&i.focus()}),100)})(w,Tt(ie))})),Rt((()=>{b()&&O.set(b())}));let ge=()=>{let e=x.actions.internal.getTraceTextData(),t=new Blob([...e],{type:"application/json"}),i=window.URL.createObjectURL(t);Na(i,"vk_player_trace_info","json")};function be(){W.set(!n())}function ye(){re(ee,!0)}function we(){re(ee,!1)}function Se(){return o()?`max-height: ${Math.round(.6*l().height)}px`:`max-height: ${l().height-32-y()}px; overflow: auto;`}let xe=ne((()=>V&&la(N,"$hasMpegSources$",i)&&!u())),$e=ne((()=>$.features.trafficSaving&&!u()&&la(E,"$autoQualityLimitingAvailable$",i)&&!$.features.qualityDetailsSubMenuEnabled)),_e=ne((()=>d().length>0&&!u())),ke=ne((()=>!!la(z,"$isLiveWithPlaybackSpeed",i)&&!u())),Ce=ne((()=>$.features.audioLanguages&&c().length>=2&&!u())),Ee=ne((()=>!u()));Xr((()=>Q.subscribe((e=>{e&&!o()&&!Tt(ee)&&!s()&&oe()}))));let Le=ne((()=>(({items:e,context:t,additionalSettingsMenuItems:i})=>{let{isMobile:r}=t;return[...e.map((e=>If[e](t))),...i.map((e=>({...e,isAdditional:!0})))].filter((e=>!e?.isHiddenFor?.length||!e?.isHiddenFor?.includes("desktop")&&!r||!e?.isHiddenFor?.includes("mobile")&&r)).sort(On)})({items:[Tt(Ee)&&"QUALITY_SETTINGS",Tt(Ce)&&"AUDIO_LANGUAGES",Tt(ke)&&"PLAYBACK_RATE",Tt(_e)&&"SUBTITLES",Tt($e)&&"TRAFFIC_SAVING_SWITCH",Tt(xe)&&"DOWNLOAD",$.showSupport&&"SHOW_SUPPORT","COPY_DATA",$.features.saveTraceInfoToFile&&"SAVE_TRACE_INFO","DEBUG_INFO"].filter((e=>!!e)),context:{qualityDetailsSubMenuEnabled:$.features.qualityDetailsSubMenuEnabled,availablePlaybackRates:h(),currentAudioStream:p(),availableAudioStreams:c(),currentPlaybackRate:la(P,"$currentPlaybackRate$",i),selectPlaybackRate:he,trafficSavingEnabled:f(),toggleTrafficSaving:de,currentQuality:v()||m.VideoQuality.INVARIANT,isAutoQualityEnabled:g()||!1,currentSubtitle:la(I,"$currentSubtitle$",i),isMobile:o(),onDownloadClick:fe,debugPanelVisible:n(),onCopyDataClick:ve,onReportProblemClick:me,onSaveTraceDataClick:ge,toggleShowDebugInfo:be},additionalSettingsMenuItems:la(G,"$additionalSettingsMenuItems$",i)}))),Pe=ne((()=>(({subMenuId:e,context:t})=>e?[mf[e](t)]:[])({subMenuId:ae.current,context:{availablePlaybackRates:h(),selectPlaybackRate:he,trafficSavingEnabled:f(),toggleTrafficSaving:de,currentQuality:v()||m.VideoQuality.INVARIANT,isAutoQualityEnabled:g()||!1,isAutoQualityAvailable:la(L,"$isAutoQualityAvailable$",i)||!1,availableQualities:la(C,"$availableQualities$",i),highQualityEnabled:la(q,"$highQualityEnabled",i),toggleHighQuality:ce,availableAudioStreams:c(),availableSubtitlesList:d(),closeSettingsMenu:Z,currentAudioStream:p(),isMobile:o(),selectAudioLanguage:ue,selectQuality:le,selectSubtitle:pe}})));var Me=Bf();let Ie;var Re=Ne(Me),Ve=e=>{var t=Nf();let i;t.__keydown=[Rf,Z];var r=Ne(t),a=e=>{var t=Vf();let i;var r=Ne(t),a=Ne(r,!0);Te(r),De(r,2).__click=oe,Te(t),Bt(((e,r)=>{i=xr(t,1,"item header svelte-17or3al",null,i,e),Hi(a,r)}),[()=>({mobile:o()}),()=>K("submenu_settings")]),zi(e,t)};Xi(r,(e=>{o()&&e(a)}));var s=De(r,2);let n;ar(s,21,(()=>Tt(Le)),(e=>e.id),((e,t)=>{var i=ji(),r=Be(i),a=e=>{!function(e,t){pi(t,!0),vr(e,Vp);let i=ma(t,"isMobile",3,!1),r=ma(t,"onClick",3,m.noop),a=ma(t,"valueComponent",3,void 0),s=ma(t,"ref",15);var n=Rp();let o;n.__click=[Mp,r],n.__keydown=[Pp,r];var l=Ne(n),u=Ne(l),d=e=>{mc(e,{get icon(){return t.icon}})},c=e=>{var i=ji();let r=ne((()=>t.icon));pr(Be(i),(()=>Tt(r)),((e,t)=>{t(e,{})})),zi(e,i)};Xi(u,(e=>{"string"==typeof t.icon?e(d):e(c,!1)})),Te(l);var h=De(l,2),p=Ne(h,!0);Te(h);var f=De(h,2),v=e=>{var t=ji();let i=ne(a);pr(Be(t),(()=>Tt(i)),((e,t)=>{t(e,{})})),zi(e,t)},g=e=>{var i=Ip(),r=Ne(i,!0);Te(i),Bt((()=>Hi(r,t.value))),zi(e,i)};Xi(f,(e=>{a()?e(v):e(g,!1)})),Te(n),Kr(n,(e=>s(e)),(()=>s())),Bt((e=>{o=xr(n,1,"item",null,o,e),Lr(n,"aria-label",t.ariaLabel),Lr(n,"data-testid",t.id),Hi(p,t.label)}),[()=>({mobile:i()})]),zi(e,n),fi()}(e,{get isMobile(){return o()},get id(){return Tt(t).id},get icon(){return Tt(t).icon},get label(){return Tt(t).label},get ariaLabel(){return Tt(t).ariaLabel},get value(){return Tt(t).value},get valueComponent(){return Tt(t).valueComponent},onClick:()=>{se(Tt(t).children),re(ie,Ae(Tt(t).id))},get ref(){return w[Tt(t).id]},set ref(e){w[Tt(t).id]=e}})},s=(e,i)=>{var r=e=>{!function(e,t){pi(t,!0),vr(e,Fp);let i=ma(t,"isMobile",3,!1),r=ma(t,"onClick",3,m.noop),a=ma(t,"closeSettings",3,m.noop),s=te(!1),n=()=>{re(s,!0)},o=e=>{e?.stopPropagation(),r()(),a()()};var l=Op();let u;l.__click=o,l.__keydown=[Np,o];var d=Ne(l),c=Ne(d),h=e=>{var i=ji(),r=Be(i),a=e=>{zi(e,Bp())},o=e=>{var i=Dp();Bt((()=>Lr(i,"src",t.icon))),Ii("error",i,n),Pi(i),zi(e,i)};Xi(r,(e=>{Tt(s)?e(a):e(o,!1)})),zi(e,i)},p=e=>{var i=ji();let r=ne((()=>t.icon));pr(Be(i),(()=>Tt(r)),((e,t)=>{t(e,{})})),zi(e,i)};Xi(c,(e=>{"string"==typeof t.icon?e(h):e(p,!1)})),Te(d);var f=De(d,2),v=Ne(f,!0);Te(f),Te(l),Bt((e=>{u=xr(l,1,"item",null,u,e),Lr(l,"aria-label",t.ariaLabel??t.label),Lr(l,"data-testid",t.id),Hi(v,t.label)}),[()=>({mobile:i()})]),zi(e,l),fi()}(e,{get isMobile(){return o()},get id(){return Tt(t).id},get onClick(){return Tt(t).onClick},get icon(){return Tt(t).icon},get label(){return Tt(t).label},get ariaLabel(){return Tt(t).ariaLabel},closeSettings:oe})},a=(e,i)=>{var r=e=>{Qp(e,{get isMobile(){return o()},get id(){return Tt(t).id},get onClick(){return Tt(t).onClick},get icon(){return Tt(t).icon},get label(){return Tt(t).label},get ariaLabel(){return Tt(t).ariaLabel},get enabled(){return Tt(t).enabled},get tooltipText(){return Tt(t).tooltipText},get maxTooltipWidth(){return Tt(t).maxTooltipWidth}})};Xi(e,(e=>{"SWITCH"===Tt(t).type&&e(r)}),i)};Xi(e,(e=>{"CLICK"===Tt(t).type?e(r):e(a,!1)}),i)};Xi(r,(e=>{"OPEN_SUB_MENU"===Tt(t).type?e(a):e(s,!1)})),zi(e,i)})),Te(s),Kr(s,(e=>b(e)),(()=>b())),Te(t),Bt(((e,r,a)=>{i=xr(t,1,"settings-menu menu svelte-17or3al",null,i,e),n=xr(s,1,"items",null,n,r),_r(s,a)}),[()=>({desktop:!o(),mobile:o(),hidden:!!ae.current}),()=>({mobile:o()}),Se]),Ii("mouseenter",t,ye),Ii("mouseleave",t,we),zi(e,t)};Xi(Re,(e=>{a()&&e(Ve)})),ar(De(Re,2),17,(()=>Tt(Pe)),(e=>e.id),((e,t)=>{let i=ne((()=>Tt(t).minWidth??137));Lp(e,{get isMobile(){return o()},get playerControlsHeight(){return y()},get returnFromSubMenu(){return ae.popSubMenu},get id(){return Tt(t).id},get title(){return Tt(t).title},closeSettingsMenu:Z,openSubMenuList:se,get items(){return Tt(t).items},get minWidth(){return Tt(i)},get refMenuItems(){return w},get listRef(){return S[Tt(t).id]},set listRef(e){S[Tt(t).id]=e}})})),Te(Me),Bt((e=>Ie=xr(Me,1,"settings-menu-container svelte-17or3al",null,Ie,e)),[()=>({mobile:o(),hidden:!a()})]),zi(e,Me),fi(),r()}Ri(["keydown","click"]);var Ff=e=>e;function jf(e,{delay:t=0,duration:i=400,easing:r=Ff}={}){let a=+getComputedStyle(e).opacity;return{delay:t,duration:i,easing:r,css:e=>"opacity: "+e*a}}var zf=Di('<button class="button svelte-1sbbskl"> </button>'),Uf={hash:"svelte-1sbbskl",code:".button.svelte-1sbbskl {margin-top:12px;font-size:14px;line-height:18px;background:rgba(255, 255, 255, 0.1);padding:6px 12px 7px;border-radius:8px;}"};Ri(["click"]);var qf=Di('<div class="container svelte-1es7arp"><div class="notification svelte-1es7arp"><div><p class="description svelte-1es7arp"><!></p> <!></div> <!></div></div>'),Hf={hash:"svelte-1es7arp",code:".container.svelte-1es7arp {position:absolute;left:0;right:0;top:20px;display:flex;justify-content:center;\n    /**\n    *  Если не отключим у контейнера события, то не сможем по этой области вызвать контекстное меню.\n    */pointer-events:none;}.notification.svelte-1es7arp {padding:9px 14px 10px 12px;background:var(--notification-bg);display:inline-flex;border-radius:var(--notification-radius);gap:10px;pointer-events:auto;}.description.svelte-1es7arp {line-height:16px;font-size:13px;margin:0;white-space:pre;}"};function Wf(e,t){pi(t,!0),vr(e,Hf);let{features:{forceAutoQualityWhenSevereStallHappens:i}}=ya(),{ui:{t:r}}=Oa(),a=r(i?"slow_video_notification_force_description":"slow_video_notification_suggest_description");var s=qf(),n=Ne(s),o=Ne(n),l=Ne(o);sf(Ne(l),{message:a}),Te(l);var u=De(l,2),d=e=>{let i=ne((()=>r("slow_video_notification_button")));!function(e,t){vr(e,Uf);var i=zf();i.__click=function(...e){t.onClick?.apply(this,e)};var r=Ne(i,!0);Te(i),Bt((()=>Hi(r,t.label))),zi(e,i)}(e,{get label(){return Tt(i)},get onClick(){return t.onSelectAutoQuality}})};Xi(u,(e=>{i||e(d)})),Te(o),bo(De(o,2),{get onClick(){return t.onClose}}),Te(n),Te(s),function(e,t,i,r){var a,s,n,o,l=!!(1&e),u=!!(2&e),d=!!(4&e),c=l&&u?"both":l?"in":"out",h=t.inert,p=t.style.overflow;function f(){var e=Ke,a=Xe;Ze(null),Je(null);try{return s??(s=i()(t,r?.()??{},{direction:c}))}finally{Ze(e),Je(a)}}var m={is_global:d,in(){if(t.inert=h,!l)return o?.abort(),void o?.reset?.();u||n?.abort(),Fr(t,"introstart"),n=qr(t,f(),o,1,(()=>{Fr(t,"introend"),n?.abort(),n=s=void 0,t.style.overflow=p}))},out(e){if(!u)return e?.(),void(s=void 0);t.inert=!0,Fr(t,"outrostart"),o=qr(t,f(),n,0,(()=>{Fr(t,"outroend"),e?.()}))},stop:()=>{n?.abort(),o?.abort()}},v=Xe;if(((a=v).transitions??(a.transitions=[])).push(m),l&&Ui){var g=d;if(!g){for(var b=v.parent;b&&65536&b.f;)for(;(b=b.parent)&&!(16&b.f););g=!b||!!(32768&b.f)}g&&Vt((()=>{Ct((()=>m.in()))}))}}(3,n,(()=>jf),(()=>({duration:340}))),zi(e,s),fi()}var Qf="annotation",Gf=class{init(e){this.shadowRootContainer=e}add(e,{overlay:t,id:i}){e.setAttribute("slot",Qf),this.setupSlotStyles(e,t),this.shadowRootContainer.append(e),this.slots.set(i,e)}setupSlotStyles(e,t){switch(e.style.position="absolute",t){case"over_video":e.style.zIndex="calc(var(--video-container-z-index) + 1)";break;case"over_controls":e.style.zIndex="calc(var(--controls-container-z-index) + 1)";break;default:e.style.zIndex="0"}}remove(e){let t=this.slots.get(e);t&&(t.remove(),this.slots.delete(e))}destroy(){for(let e in this.slots.keys())this.remove(e);this.slots.clear()}constructor(){this.slots=new Map}},Kf=Di('<div class="container svelte-f47ws8"><div class="playback_state_icon svelte-f47ws8"><!></div></div>'),Yf={hash:"svelte-f47ws8",code:".container.svelte-f47ws8 {position:absolute;display:flex;width:100%;height:100%;align-items:center;justify-content:center;pointer-events:none;}.playback_state_icon.svelte-f47ws8 {display:flex;align-items:center;justify-content:center;width:64px;height:64px;border-radius:100%;background-color:#00000073;will-change:opacity, scale;\n\n    animation-name: svelte-f47ws8-videoPlayerStatusIconPopup;animation-fill-mode:forwards;}\n\n  @keyframes svelte-f47ws8-videoPlayerStatusIconPopup {\n    from {\n      opacity: 0;\n      scale: 0.6;\n    }\n\n    10% {\n      opacity: 1;\n      scale: 1;\n      animation-timing-function: ease-in;\n    }\n\n    75% {\n      opacity: 1;\n      scale: 1;\n    }\n\n    90% {\n      opacity: 0;\n      scale: 0.4;\n      animation-timing-function: ease-out;\n    }\n\n    to {\n      opacity: 0;\n      scale: 0;\n    }\n  }"};var Zf=(e,t,i,r,a,s)=>{e.preventDefault(),t&&(i({message:"double click on video"}),r(),a(s.uiConfig.controls.hideTimeoutCursor))},Xf=(e,t,i,r,a,s,n,o,l,u,d,c,h,p,m,v,g)=>{if(e.preventDefault(),t()||r())s();else if(!n()||l){if(Tt(u))return d();if(c()?.focus(),!h())return p.firstStart(),void m(p.uiConfig.controls.hideTimeoutCursor);(!p.uiConfig.preventPauseOnVideoClick||v()!==f.PlaybackState.PLAYING)&&p.store.actions.internal.togglePlay(),m(p.uiConfig.controls.hideTimeoutCursor)}},Jf=(e,t,i,r,a,s)=>{e.stopPropagation(),(t()||r())&&s()},em=Di("<div><!></div>"),tm=Di('<div class="spherical-video-icon svelte-cy741x"><!></div>'),im=Di("<div><!></div>"),rm=Di('<div class="settings-menu svelte-cy741x"><!></div>'),am=Di("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1),sm=Di('<div><div data-testid="video-container"></div></div> <!> <!>',1),nm=Di('<div class="blocked svelte-cy741x"></div>'),om=Di('<div class="player-wrapper svelte-cy741x"><!> <div class="overlay-container"></div></div> <!>',1),lm={hash:"svelte-cy741x",code:".player-wrapper.svelte-cy741x {position:absolute;width:100%;height:100%;}.blocked.svelte-cy741x {position:absolute;width:100%;height:100%;z-index:var(--overlay-container-z-index);}.player-wrapper.svelte-cy741x .player-media {position:absolute;left:0;top:0;width:100%;height:100%;background:var(--black);transition:transform 0.2s ease-in-out;}.spherical-video-icon.svelte-cy741x {display:inline-block;position:absolute;top:calc(50% - 23px);left:calc(50% - 38px);}.video-wrapper.svelte-cy741x,\n  .video-container.svelte-cy741x,\n  .ads-container.svelte-cy741x {position:absolute;width:100%;height:100%;left:0;top:0;}.video-wrapper.svelte-cy741x {z-index:var(--video-container-z-index);background:var(--black);}.video-container.svelte-cy741x {z-index:var(--video-container-z-index);transition:var(--rotate-transition-duration) ease all;}.video-container.fast-rotate.svelte-cy741x {transition:none;}.nocursor.svelte-cy741x {cursor:none;}.ads-container.svelte-cy741x {z-index:var(--ads-container-z-index);background:var(--black);}.settings-menu.svelte-cy741x {position:absolute;z-index:var(--settings-menu-z-index);bottom:57px;right:18px;left:0;transition:opacity 0.2s, visibility 0.2s;}"};function um(e,t){pi(t,!0),vr(e,lm);let i,r,a,[s,n]=ua(),o=()=>la(le,"$playerPhase",s),l=()=>la(Ce,"$crashed",s),u=()=>la(je,"$isInteractiveTime$",s),d=()=>la(he,"$settingsMenuVisible",s),c=()=>la(ce,"$controlsVisible",s),h=()=>la(rt,"$graphIsOpened$",s),p=()=>la(ue,"$isFullscreen",s),m=()=>la(Je,"$autoplayNextEnabled$",s),v=()=>la(we,"$isEnded$",s),g=()=>la(Oe,"$rotateAlpha",s),b=()=>la(Ie,"$playerSize",s),y=()=>la(mt,"$bottomNoSmooth",s),w=()=>la(Ge,"$interactiveTimeIndicator",s),S=()=>la(Re,"$is3DVideo",s),x=()=>la(ve,"$contextMenuVisible$",s),$=()=>la(ie,"$playbackState$",s),_=()=>la(fe,"$scrubbingInProgress",s),k=()=>la(Se,"$chromecastConnected$",s),T=()=>la(pe,"$settingsMenuOpenedByKeyboard",s),C=()=>la(ii,"$contextMenuOpenedByKeyboard$",s),E=()=>la(si,"$contextMenuOpenedByHotKey$",s),A=()=>la(ke,"$isPlaying$",s),L=()=>la(ee,"$language$",s),P=()=>la(se,"$position$",s),M=()=>la(oe,"$duration$",s),I=ma(t,"videoContainer",15),R=ma(t,"adsSlotId",3,void 0),V=ma(t,"adsParams",3,void 0),N=ma(t,"adsPreviewParam",3,void 0),B=ma(t,"adsAutoplayParam",3,void 0),D=ma(t,"duration",3,void 0),O=ma(t,"logoTargetUrl",3,""),F=ma(t,"showNextPrevButtons",3,!1),j=ma(t,"nextButtonActive",3,!1),z=ma(t,"prevButtonActive",3,!1),U=ma(t,"endScreenVideoTitle",3,void 0),q=ma(t,"endScreenVideoThumb",3,void 0),H=ma(t,"isOneVideoPlaylist",3,!1),W=ma(t,"shadowRootContainer",3,void 0),Q=ma(t,"outerContainerRef",3,void 0),G=ma(t,"playerStarted",3,!1),K=ma(t,"fullScreenTarget",3,void 0),Y=ma(t,"showMiniTimer",3,!1),Z=ma(t,"showEndScreen",3,!0),X=ma(t,"keyboardControls",15),J=t.store.getLogger().createComponentLog("Root component"),ee=t.store.interfaceLanguage$,ie=t.store.state.playbackState$,ae=t.store.ads.playbackState,se=t.store.state.positionWithScrubbing$,oe=t.store.state.duration$,le=t.store.playerPhase,ue=t.store.ui.isFullscreen,de=t.store.ui.isFullscreenOpenedByKeyboard,ce=t.store.ui.controlsVisible,he=t.store.ui.settingsMenu.visible$,pe=t.store.ui.settingsMenu.openedByBtnKeyboard$,fe=t.store.ui.scrubbingInProgress,me=t.store.ui.volumeChangingInProgress,ve=t.store.ui.contextMenu.visible$,ge=t.store.ui.debugPanelVisible,ye=t.store.state.isLoaderVisible,we=t.store.state.isEnded$,Se=t.store.state.chromecastConnected$,xe=t.store.state.chromecastDeviceName$,$e=t.store.ads.postrollPassed,_e=t.store.state.isLive$,ke=t.store.state.isPlaying$,Ce=t.store.state.crashed$,Ee=t.store.webApi.annotationsApi,Le=t.store.webApi.pictureInPictureApi,Pe=t.store.state.currentSubtitle$,Me=t.store.state.currentSubtitleCaptions$,Ie=t.store.ui.playerSize,Re=t.store.ui.is3DVideo,Ve=t.store.ui.icon3DVideoVisible,Oe=t.store.ui.rotateAlpha,Fe=t.store.state.isInteractive,je=t.store.state.isInteractiveTime$,ze=t.store.state.isInteractiveExpectation$,Ue=t.store.state.hasInteractiveBranches,qe=t.store.ui.touched,He=t.store.ui.modals.hotKeyMap.data,We=t.store.ui.modals.hotKeyMap.show,Qe=t.store.ui.overlayContainer$,Ge=t.store.ui.controls.interactiveTimeIndicator,Ke=t.store.state.showInteractiveTimeIndicator,Ye=t.store.ui.contextMenu.position$,Ze=t.store.actions.internal.setQuality,Xe=t.store.actions.internal.closeSettingsMenu,Je=t.store.ui.autoplayNextEnabled$,et=t.store.ui.userActionsDisabled,{fakeIsPlaying$:tt,notifications$:it,graphIsOpened$:rt}=Fa(),at=te(void 0),st=te(void 0),nt=te(void 0),ot=te(void 0);He.set({title:Es("hotkey_map_modal_title"),closeBtnText:Es("hotkey_map_modal_close_btn_text"),groups:[{title:Es("hotkey_map_group_title_common"),items:[{description:Es("hotkey_map_item_mute_description"),value:Es("hotkey_map_item_mute_value")},{description:Es("hotkey_map_item_volume_up_description"),value:Es("hotkey_map_item_volume_up_value")},{description:Es("hotkey_map_item_volume_down_description"),value:Es("hotkey_map_item_volume_down_value")},{description:Es("hotkey_map_item_pip_description"),value:Es("hotkey_map_item_pip_value")},{description:Es("hotkey_map_item_full_screen_description"),value:Es("hotkey_map_item_full_screen_value")},{description:Es("hotkey_map_item_show_context_menu_description"),value:Es("hotkey_map_item_show_context_menu_value")},{description:Es("hotkey_map_item_show_hotkey_map_description"),value:Es("hotkey_map_item_show_hotkey_map_value")}]},{title:Es("hotkey_map_group_title_playback"),items:[{description:Es("hotkey_map_item_play_toggle_description"),value:Es("hotkey_map_item_play_toggle_value")},{description:Es("hotkey_map_item_seek_backward_description"),value:Es("hotkey_map_item_seek_backward_value")},{description:Es("hotkey_map_item_seek_forward_description"),value:Es("hotkey_map_item_seek_forward_value")},{description:Es("hotkey_map_item_fast_seek_backward_description"),value:Es("hotkey_map_item_fast_seek_backward_value")},{description:Es("hotkey_map_item_fast_seek_forward_description"),value:Es("hotkey_map_item_fast_seek_forward_value")},{description:Es("hotkey_map_item_rate_down_description"),value:Es("hotkey_map_item_rate_down_value")},{description:Es("hotkey_map_item_rate_up_description"),value:Es("hotkey_map_item_rate_up_value")},{description:Es("hotkey_map_item_prev_frame_description"),value:Es("hotkey_map_item_prev_frame_value")},{description:Es("hotkey_map_item_next_frame_description"),value:Es("hotkey_map_item_next_frame_value")},{description:Es("hotkey_map_item_jump_seek_description"),value:Es("hotkey_map_item_jump_seek_value")},{description:Es("hotkey_map_item_next_video_description"),value:Es("hotkey_map_item_next_video_value")},{description:Es("hotkey_map_item_prev_video_description"),value:Es("hotkey_map_item_prev_video_value")}]},{title:Es("hotkey_map_group_title_subtitles"),items:[{description:Es("hotkey_map_item_subtitles_toggle_description"),value:Es("hotkey_map_item_subtitles_toggle_value")}]},{title:Es("hotkey_map_group_title_episodes"),items:[{description:Es("hotkey_map_item_prev_episode_description"),value:f.clientChecker.device.isApple?Es("hotkey_map_item_prev_episode_mac_value"):Es("hotkey_map_item_prev_episode_pc_value")},{description:Es("hotkey_map_item_next_episode_description"),value:f.clientChecker.device.isApple?Es("hotkey_map_item_next_episode_mac_value"):Es("hotkey_map_item_next_episode_pc_value")}]}]});let lt,{closeNotification:ut,notificationsToShow$:dt}=it,ct=ne((()=>!!la(dt,"$notificationsToShow$",s).slow_video)),ht=()=>ut("slow_video"),pt=ne((()=>("video"===o()&&la(ye,"$isLoaderVisible",s)||"ads"===o()&&"inactive"===la(ae,"$adPlaybackState",s))&&!l())),ft=te(void 0),mt=ra(!1),vt=ra(!1),gt=ra(),bt=ra(!1),yt=te(!1),wt=te(!1),St=te(!1),xt=te(!(t.autoplay&&!t.uiConfig.controls.showOnStartupAtAutoplay)),$t=ne((()=>u()&&!d()&&!(Tt(yt)||Tt(wt))&&!(Tt(St)&&!la(ze,"$isInteractiveExpectation$",s)))),_t=!0,Et=ne((()=>t.uiConfig.features.thumbTimer&&Y()&&"video"===o()&&!c()&&!l()&&!Fe&&(t.uiConfig.hideThumbTimerAfterTouch&&!la(qe,"$touched",s)||!t.uiConfig.hideThumbTimerAfterTouch))),At=ne((()=>"video"===o()&&!h()&&p())),Lt=te(!1),Pt=ne((()=>(Z()||t.showAutoplayNext&&m())&&!!U()&&!!q()&&(t.showAds&&la($e,"$postrollPassed",s)||!t.showAds)&&v()&&!l()&&!Tt(Lt))),Mt=ne((()=>la(bt,"$cursorInside",s)&&!(c()||Tt(Pt))&&!u())),It=te(!1),Vt=ne((()=>I()&&g()%180?b().height/b().width:1)),Nt=ne((()=>null!==la(tt,"$fakeIsPlaying$",s))),{toggle:Dt}=tt,Ot=!1,Ft=null;Le?.setContext(hi());t.store.setUiCallbacks({onStarted:()=>{t.autoplay&&!Fe&&t.uiConfig.controls.showOnStartupAtAutoplay&&jt(t.uiConfig.controls.hideTimeout)}});let jt=e=>{window.clearTimeout(i),vt.set(!1),vt.set(!0),i=window.setTimeout((()=>vt.set(!1)),e);let t=e-100;lt=window.setTimeout((()=>{y()&&mt.set(!1)}),t>0?t:e)},zt=(e,t)=>{window.clearTimeout(r),gt.set(null),gt.set(t),r=window.setTimeout((()=>gt.set(null)),e)},Ut=Re.subscribe((e=>{Ve.set(e),e&&(window.clearTimeout(a),a=window.setTimeout((()=>Ve.set(!1)),t.uiConfig.controls.hide360IconTimeout))})),qt=async()=>{let e=Hs();if(e){let t=qs();e=t===Qt()||t===W()}if(e){jt(t.uiConfig.controls.hideTimeoutFullscreen);try{await(Le?.remove())}catch(e){J({message:String(e)})}}ue.set(e),t.store.getAdmanWrapper().setFullscreen(e),p()?t.store.callbacks?.onFullscreenEnter?.():t.store.callbacks?.onFullscreenExit?.()},Ht=e=>{let{width:t,height:i}=e.target;Ie.set({width:t,height:i})},Wt=()=>{let{width:e,height:t}=Tt(at).getBoundingClientRect();Ie.set({width:e,height:t})};Xr((()=>(Ws(qt),t.uiConfig.features.annotationsInside&&Ee?.init(Tt(at)),Ks(Le)&&(Le?.assignPlayerContainer(Tt(at)),Le?.registryExternalEventHandlers({resize:Ht,leavepictureinpicture:Wt})),t.interactiveContainer&&I().parentElement?.insertBefore(t.interactiveContainer,I().nextSibling),()=>{window.clearTimeout(i),window.clearTimeout(lt),window.clearTimeout(r),window.clearTimeout(a),Ut(),Le?.dispose().catch((e=>{J({message:String(e)})})),Qs(qt)})));let Qt=()=>{let e=t.uiConfig.features.fullscreenInternalTargetPlayerContainer||!Q()?Tt(at):Q(),i=e.getRootNode(),r=i instanceof ShadowRoot?i.host:i,a=K()instanceof HTMLElement&&K().contains(r);return t.uiConfig.allowChangingFullscreenTarget&&K()&&a?K():e},Gt=async()=>{Hs()?(await Us(document),J({message:"exit fullscreen"})):(J({message:"request fullscreen"}),await zs(Qt()))},Kt=()=>{Xe(),ve.set(!1)},Yt=e=>{h()||(e.preventDefault(),ve.set(!0),Ye.set({left:e.clientX,top:e.clientY}))};function Zt(e){return e?e.offsetTop+Zt(e.offsetParent):0}function Xt(e){return e?e.offsetLeft+Xt(e.offsetParent):0}function Jt(e){if(w()&&Ke){let t=e.currentTarget,i=Zt(t),r=Xt(t),a=e.pageX-r,s=e.pageY-i,{left:n,bottom:o,right:l}=w(),u=l-n;return a>=n-u&&s<=o+u}}let ei=e=>{e.preventDefault(),0===e.button&&(Ot=!0,t.store.actions.internal.holdCamera()),jt(t.uiConfig.controls.hideTimeoutCursor)},ti=e=>{e.preventDefault(),0===e.button&&(Ft=e,Ot=!1,t.store.actions.internal.releaseCamera()),jt(t.uiConfig.controls.hideTimeoutCursor)},ii=t.store.ui.contextMenu.openedByBtnKeyboard$,ri=t.store.ui.contextMenu.btnRef$,ai=te(void 0),si=t.store.ui.contextMenu.openedByHotKey$,ni=t.store.ui.contextMenu.lastActiveElem$;Rt((()=>{Qe.set(Tt(ft))})),Rt((()=>{re(St,Ae(Tt(xt)&&$()!==f.PlaybackState.PLAYING)),Tt(xt)||Ct((()=>re(xt,!0)))})),Rt((()=>{ce.set((Tt(St)||v()||d()||_()||la(me,"$volumeChangingInProgress",s)||k()||la(vt,"$controlsTimeoutActive",s))&&!Tt($t)&&("video"===o()||"ads"===o())&&!l())})),Rt((()=>{!_()&&Tt(It)&&!u()&&jt(t.uiConfig.controls.hideTimeoutCursor),Ct((()=>re(It,Ae(_()))))})),Rt((()=>{Tt(ot),d(),T(),Ct((()=>xn(Tt(ot),d(),T())))})),Rt((()=>{Tt(ai),x(),C(),Ct((()=>xn(Tt(ai),x(),C())))})),Rt((()=>{let e=la(ri,"$contextMenuButtonRef$",s);e&&(x(),Ct((()=>Sn(e,x(),ii))))})),Rt((()=>{Tt(ai),x(),E(),Ct((()=>xn(Tt(ai),x(),E())))})),Rt((()=>{let e=la(ni,"$contextMenuLastActiveElem$",s);e&&(x(),Ct((()=>(async(e,t,i)=>{await kt(),e&&!t&&sa(i)&&(i.set(!1),e.focus())})(e,x(),si))))})),Rt((()=>{!la(de,"$isFullscreenOpenedByKeyboard",s)&&p()&&(Ct((()=>de.set(!1))),X()?.focus())})),Rt((()=>{h()&&Kt()}));let oi=Es("video360");var li=om();Ii("blur",be,Kt);var ui=Be(li);ui.__mousemove=function(e){(function(e){if(Tt(at)){let t=Zt(e.currentTarget),i=b().height,r=e.pageY-t;if(Jt(e))return void re(wt,!1);r<40?re(wt,!0):r>i-40?re(yt,!0):(re(wt,!1),d()||re(yt,!1))}})(e),Tt($t)||jt(t.uiConfig.controls.hideTimeoutCursor),S()&&Ot&&Ft&&t.store.actions.internal.moveCameraFocusPX(Ft.clientX-e.clientX,Ft.clientY-e.clientY,e.timeStamp-Ft.timeStamp),Ft=e};var di=Ne(ui);let ci=ne((()=>"ads"===o())),mi=ne((()=>Tt(Nt)?Dt:void 0));Kr(Io(di,{toggleFullscreen:Gt,hideContextMenu:Kt,showHotKeyHelpers:e=>{Kt(),qe.set(!0),jt(t.uiConfig.controls.hideTimeout),e&&zt(t.uiConfig.controls.hideHotKeyHelpers,e)},showKeyMap:()=>{Kt(),t.store.callbacks?.onOpenHotKeyMap?t.store.callbacks?.onOpenHotKeyMap(la(He,"$hotKeyMapData",s)):We.update((e=>!e))},get isAds(){return Tt(ci)},get fakePlayButtonHandler(){return Tt(mi)},get nextButtonActive(){return j()},get prevButtonActive(){return z()},children:(e,i)=>{var r=sm(),a=Be(r);let n;a.__contextmenu=Yt,a.__mousedown=ei,a.__mouseup=ti,a.__click=[Xf,x,ve,d,he,Kt,v,we,Ue,Nt,Dt,X,G,t,jt,$,ie],a.__dblclick=[Zf,_t,J,Gt,jt,t];var u=Ne(a);let h;Kr(u,(e=>I(e)),(()=>I())),Te(a);var p=De(a,2);fr(p,(()=>"slot"),!1,((e,t)=>{Pr(e,null,{name:Qf})})),Ji(De(p,2),L,(e=>{var i=am(),r=Be(i);let a=ne((()=>"thumb"!==o()||l()||Fe&&t.autoplay));Oh(r,{get hidden(){return Tt(a)},get thumbUrl(){return t.thumbUrl},get startVideo(){return t.firstStart}});var n=De(r,2);!function(e,t){pi(t,!0),vr(e,Yf);let[i,r]=ua(),a=()=>la(n,"$isPlaying$",i),s=()=>la(o,"$aboutToGoNextVideo",i),{state:{isPlaying$:n},ui:{aboutToGoNextVideo:o},actions:l}=Oa(),{features:{playbackStatusShow:u,playbackStatusAnimationDuration:d,playbackStatusNextVideoAnimationDuration:c}}=ya(),h=0,p=te(null),f=te(!1);Rt((()=>{re(p,Ae(a()?Gd:Yd))})),Rt((()=>{re(p,Ae(s()?Nd:null))})),Rt((()=>{if(u)return h=window.setTimeout((()=>{h=0,s()&&Tt(p)===Nd&&("next"===s()?l.internal.nextVideoClick(!1):l.internal.prevVideoClick(!1)),re(p,null)}),Tt(p)!==Nd?d:c),()=>{h&&(window.clearTimeout(h),h=0)}})),Rt((()=>{a()&&!Tt(f)&&(re(f,!0),re(p,null))}));var m=ji(),v=Be(m),g=e=>{var t=ji();Ji(Be(t),(()=>Tt(p)),(e=>{var t=Kf(),i=Ne(t),r=Ne(i);let a=ne((()=>"prev"===s()));pr(r,(()=>Tt(p)),((e,t)=>{t(e,{width:"40",height:"40",viewBox:"0 0 24 24",get isPrev(){return Tt(a)}})})),Te(i),Te(t),Bt((()=>_r(i,`animation-duration: ${Tt(p)!==Nd?d:c}ms`))),zi(e,t)})),zi(e,t)};Xi(v,(e=>{Tt(p)&&u&&e(g)})),zi(e,m),fi(),r()}(n,{});var u=De(n,2),h=e=>{let i=ne((()=>t.live?.startTime));ep(e,{get thumbUrl(){return t.thumbUrl},get startTime(){return Tt(i)}})};Xi(u,(e=>{"LiveWaitingStart"===o()&&e(h)}));var p=De(u,2),f=e=>{rp(e,{kind:"recover",get thumbUrl(){return t.thumbUrl}})};Xi(p,(e=>{"LiveWaitingRecover"===o()&&e(f)}));var v=De(p,2),g=e=>{rp(e,{kind:"record",get thumbUrl(){return t.thumbUrl}})};Xi(v,(e=>{"LiveWaitingRecord"===o()&&e(g)}));var w=De(v,2),$=e=>{var t=em();let i;nn(Ne(t),{get adsSlotId(){return R()},get adsParams(){return V()},get adsPreviewParam(){return N()},get adsAutoplayParam(){return B()},get duration(){return D()}}),Te(t),Bt((e=>i=xr(t,1,"ads-container svelte-cy741x",null,i,e)),[()=>({hidden:"ads"!==o()})]),zi(e,t)};Xi(w,(e=>{t.showAds&&G()&&e($)}));var _=De(w,2),T=e=>{let i=ne((()=>!Z()&&t.showAutoplayNext&&m()));ko(e,{get title(){return U()},get thumb(){return q()},get isHide(){return Tt(i)},clickCloseIcon:()=>re(Lt,!0)})};Xi(_,(e=>{Tt(Pt)&&U()&&q()&&e(T)}));var C=De(_,2),E=e=>{let i=ne((()=>!c()));!function(e,t){vr(e,jh);let i=ma(t,"title",3,""),r=ma(t,"isHidden",3,!1);var a=Fh();let s;var n=Ne(a,!0);Te(a),Bt((e=>{s=xr(a,1,"title svelte-1bcvcf2",null,s,e),Hi(n,i())}),[()=>({hidden:r()})]),zi(e,a)}(e,{get title(){return t.title},get isHidden(){return Tt(i)}})};Xi(C,(e=>{Tt(At)&&e(E)}));var L=De(C,2),I=e=>{let t=ne((()=>"video"===o()&&c()));wh(e,{get isShifted(){return Tt(t)}})};Xi(L,(e=>{S()&&e(I)}));var W=De(L,2),Q=e=>{var t=tm();bs(Ne(t),{"aria-label":oi}),Te(t),zi(e,t)};Xi(W,(e=>{la(Ve,"$icon3DVideoVisible",s)&&e(Q)}));var K=De(W,2),Y=e=>{Mh(e,{get thumbUrl(){return t.thumbUrl},get chromecastDeviceName(){return la(xe,"$chromecastDeviceName$",s)}})};Xi(K,(e=>{k()&&e(Y)}));var J=De(K,2),ee=e=>{Eh(e,{get shifted(){return c()},get captions(){return la(Me,"$currentSubtitleCaptions$",s)},get position(){return P()},get playerSize(){return b()}})};Xi(J,(e=>{"off"!==la(Pe,"$currentSubtitle$",s).value&&e(ee)}));var ie=De(J,2),ae=e=>{var t=im();t.__contextmenu=Yt,t.__click=[Jf,x,ve,d,he,Kt],Nh(Ne(t)),Te(t),zi(e,t)};Xi(ie,(e=>{l()&&e(ae)}));var se=De(ie,2),oe=e=>{let i=ne((()=>"thumb"===o()||"LiveWaitingStart"===o()||"LiveWaitingRecover"===o()||"LiveWaitingRecord"===o())),r=ne((()=>"ads"===o())),a=ne((()=>t.canRewindLive&&0!==M()));Jc(e,{get bottomHidden(){return Tt(i)},get bottomNoSmooth(){return y()},get showControls(){return c()},get isAds(){return Tt(r)},get canRewindLive(){return Tt(a)},get logoClickable(){return t.logoClickable},get logoHidden(){return t.logoHidden},get logoTargetUrl(){return O()},get showAutoplayNext(){return t.showAutoplayNext},get showNextPrevButtons(){return F()},get nextButtonActive(){return j()},get prevButtonActive(){return z()},get isOneVideoPlaylist(){return H()},customFullscreenSupported:_t,toggleFullscreen:Gt,get seekToInteractive(){return t.seekToInteractive},get playPrevChapter(){return t.playPrevChapter},get playerControlsWrapperRef(){return Tt(st)},set playerControlsWrapperRef(e){re(st,Ae(e))},get playerControlsRef(){return Tt(nt)},set playerControlsRef(e){re(nt,Ae(e))}})};Xi(se,(e=>{G()&&e(oe)}));var le=De(se,2),ue=e=>{var i=rm(),r=Ne(i);let a=ne((()=>Tt(nt)?.clientHeight));Of(r,{get supportLink(){return t.supportLink},get playerControlsHeight(){return Tt(a)},returnFocus:()=>X()?.focus(),get ref(){return Tt(ot)},set ref(e){re(ot,Ae(e))}}),Te(i),zi(e,i)};Xi(le,(e=>{!k()&&"ads"!==o()&&e(ue)}));var de=De(le,2);let ce=ne((()=>!Tt(Et)));fn(de,{get isLive(){return la(_e,"$isLive$",s)},get isHidden(){return Tt(ce)},get isPlaying(){return A()},get position(){return P()},get duration(){return M()}});var pe=De(de,2);!function(e,t){pi(t,!0),vr(e,hh);let[i,r]=ua(),a=()=>la(t.data,"$data",i),s=Oa().ui.t,n=ne((()=>!a())),o=ne((()=>"BACKWARD_SEEK"===a()?.type)),l=ne((()=>"FORWARD_SEEK"===a()?.type)),u=ne((()=>a()?.type)),d=ne((()=>a()?.t?s(a().t.key,{value:a().t.value||""}):a()?.text));var c=ch();let h;var p=Ne(c),f=e=>{var t=dh(),i=Be(t),r=Ne(i),a=e=>{let t=ne((()=>"FORWARD_SEEK"===Tt(u)));th(e,{get reversed(){return Tt(t)}})};Xi(r,(e=>{["BACKWARD_SEEK","FORWARD_SEEK"].includes(Tt(u))&&e(a)}));var s=De(r,2),n=e=>{Yd(e,{})};Xi(s,(e=>{"PAUSE"===Tt(u)&&e(n)}));var o=De(s,2),l=e=>{Gd(e,{})};Xi(o,(e=>{"PLAY"===Tt(u)&&e(l)}));var c=De(o,2),h=e=>{zd(e,{})};Xi(c,(e=>{"REPLAY"===Tt(u)&&e(h)}));var p=De(c,2),f=e=>{ah(e,{isOff:!0})};Xi(p,(e=>{"SUBTITLES_OFF"===Tt(u)&&e(f)}));var m=De(p,2),v=e=>{ah(e,{})};Xi(m,(e=>{"SUBTITLES_ON"===Tt(u)&&e(v)}));var g=De(m,2),b=e=>{let t=ne((()=>"RATE_UP"===Tt(u)));nh(e,{get reversed(){return Tt(t)}})};Xi(g,(e=>{["RATE_DOWN","RATE_UP"].includes(Tt(u))&&e(b)}));var y=De(g,2),w=e=>{let t=ne((()=>"EPISODE_NEXT"===Tt(u)));lh(e,{get reversed(){return Tt(t)}})};Xi(y,(e=>{["EPISODE_PREV","EPISODE_NEXT"].includes(Tt(u))&&e(w)}));var S=De(y,2),x=e=>{Al(e,{volume:0})};Xi(S,(e=>{"MUTE"===Tt(u)&&e(x)}));var $=De(S,2),_=e=>{Al(e,{volume:1})};Xi($,(e=>{"VOLUME"===Tt(u)&&e(_)})),Te(i);var k=De(i,2),T=e=>{var t=uh(),i=Ne(t,!0);Te(t),Bt((()=>Hi(i,Tt(d)))),zi(e,t)};Xi(k,(e=>{Tt(d)&&e(T)})),zi(e,t)};Xi(p,(e=>{!Tt(n)&&Tt(u)&&e(f)})),Te(c),Bt((e=>h=xr(c,1,"hot-key-helpers-container svelte-1ad3n06",null,h,e)),[()=>({hidden:Tt(n),"hot-key-helpers-container--left":Tt(o),"hot-key-helpers-container--right":Tt(l)})]),zi(e,c),fi(),r()}(pe,{data:gt});var fe=De(pe,2);Hn(fe,{get supportLink(){return t.supportLink},returnFocus:()=>X()?.focus(),get visible(){return x()},get playerContainerRef(){return Tt(at)},get controlsContainerRef(){return Tt(st)},get position(){return la(Ye,"$contextMenuPosition$",s)},get menuElementRef(){return Tt(ai)},set menuElementRef(e){re(ai,Ae(e))}});var me=De(fe,2),be=e=>{Wf(e,{onClose:ht,onSelectAutoQuality:()=>{Ze("auto"),ht()}})};Xi(me,(e=>{Tt(ct)&&e(be)}));var ye=De(me,2),we=e=>{No(e,{})};Xi(ye,(e=>{Tt(pt)&&e(we)}));var Se=De(ye,2),$e=e=>{Zo(e,{})};Xi(Se,(e=>{la(We,"$showHotKeyMap",s)&&e($e)}));var ke=De(Se,2),Ce=e=>{fo(e,{})};Xi(ke,(e=>{la(ge,"$debugPanelVisible",s)&&e(Ce)})),zi(e,i)})),Bt(((e,t)=>{n=xr(a,1,"video-wrapper svelte-cy741x",null,n,e),h=xr(u,1,"video-container svelte-cy741x",null,h,t),_r(u,`transform: rotate(${g()}deg) scale(${Tt(Vt)})`),Lr(u,"data-is-playing",A())}),[()=>({hidden:"video"!==o(),nocursor:Tt(Mt)}),()=>({"fast-rotate":!t.uiConfig.isSmoothVideoRotate})]),zi(e,r)},$$slots:{default:!0}}),(e=>X(e)),(()=>X())),Kr(De(di,2),(e=>re(ft,e)),(()=>Tt(ft))),Te(ui),Kr(ui,(e=>re(at,e)),(()=>Tt(at)));var vi=De(ui,2),gi=e=>{zi(e,nm())};Xi(vi,(e=>{la(et,"$userActionsDisabled$",s)&&e(gi)})),Ii("mouseenter",ui,(function(){bt.set(!0),Fe||jt(t.uiConfig.controls.hideTimeoutCursor)})),Ii("mouseleave",ui,(function(){bt.set(!1),re(wt,!1),re(yt,!1),Ot=!1,t.store.actions.internal.releaseCamera(),jt(t.uiConfig.controls.hideTimeout)})),Ii("click",ui,(()=>{qe.set(!0)}),!0),Ii("focusin",ui,(function(){Fe||(mt.set(!0),jt(t.uiConfig.controls.hideTimeoutCursor))}),!0),zi(e,li),fi(),n()}Ri(["mousemove","contextmenu","mousedown","mouseup","click","dblclick"]);var dm=Di('<div></div> <div class="info svelte-nhq2ld"><div class="triangles-wrapper svelte-nhq2ld"><div></div> <div></div> <div></div></div> <p class="step-caption svelte-nhq2ld"> </p></div>',1),cm=Di("<div><!></div>"),hm={hash:"svelte-nhq2ld",code:".double-click-area.svelte-nhq2ld {position:absolute;top:0;height:100%;width:25%;overflow:hidden;}.double-click-area.left.svelte-nhq2ld {left:0;}.double-click-area.right.svelte-nhq2ld {right:0;}.semicircle.svelte-nhq2ld {position:absolute;top:0;width:100%;height:100%;background-color:rgba(0, 0, 0, 0.5);}.semicircle.left.svelte-nhq2ld {left:0;border-top-right-radius:50%;border-bottom-right-radius:50%;}.semicircle.right.svelte-nhq2ld {right:0;border-top-left-radius:50%;border-bottom-left-radius:50%;}.info.svelte-nhq2ld {position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);display:flex;flex-direction:column;align-items:center;justify-content:center;}.triangles-wrapper.svelte-nhq2ld {position:relative;display:flex;margin-bottom:10px;justify-content:center;}.triangle.svelte-nhq2ld {width:0;height:0;border-top:6px solid transparent;border-bottom:6px solid transparent;\n    animation: svelte-nhq2ld-blink 500ms infinite;opacity:0;}.triangle.right.svelte-nhq2ld:nth-child(1),\n  .triangle.left.svelte-nhq2ld:nth-child(3) {animation-delay:0ms;}.triangle.right.svelte-nhq2ld:nth-child(2),\n  .triangle.left.svelte-nhq2ld:nth-child(2) {animation-delay:100ms;}.triangle.right.svelte-nhq2ld:nth-child(3),\n  .triangle.left.svelte-nhq2ld:nth-child(1) {animation-delay:200ms;}\n\n  @keyframes svelte-nhq2ld-blink {\n    0% {\n      opacity: 0;\n    }\n    50% {\n      opacity: 1;\n    }\n    100% {\n      opacity: 0;\n    }\n  }.triangle.left.svelte-nhq2ld {border-right:8px solid var(--white);}.triangle.right.svelte-nhq2ld {border-left:8px solid var(--white);}.triangle.svelte-nhq2ld:not(:last-child) {margin-right:5px;}.step-caption.svelte-nhq2ld {margin:0;text-align:center;font-size:12px;line-height:1;color:var(--white);}"};function pm(e,t){pi(t,!0),vr(e,hm);let i=ma(t,"seekStep",3,0),r=te(!1),a=0,s=0,n=te(Ae(i()));Jr((()=>{window.clearTimeout(a)}));var o=cm();o.__click=e=>{e.stopPropagation(),s+=1,re(n,i()*(s-1)),1===s?t.handleSingleFirstClick(e):(re(r,!0),t.handleSecondClick()),window.clearTimeout(a),a=window.setTimeout((()=>{s=0,re(r,!1)}),300)};var l=Ne(o),u=e=>{var i=dm(),r=Be(i),a=De(r,2),s=Ne(a),o=Ne(s),l=De(o,2),u=De(l,2);Te(s);var d=De(s,2),c=Ne(d,!0);Te(d),Te(a),Bt((e=>{xr(r,1,`semicircle ${t.side??""}`,"svelte-nhq2ld"),xr(o,1,`triangle ${t.side??""}`,"svelte-nhq2ld"),xr(l,1,`triangle ${t.side??""}`,"svelte-nhq2ld"),xr(u,1,`triangle ${t.side??""}`,"svelte-nhq2ld"),Hi(c,e)}),[()=>Es("doubletap_seek_step",{seconds:Tt(n).toFixed(0)})]),zi(e,i)};Xi(l,(e=>{Tt(r)&&e(u)})),Te(o),Bt((()=>xr(o,1,`double-click-area ${t.side??""}`,"svelte-nhq2ld"))),zi(e,o),fi()}Ri(["click"]);var fm=(e,t,i)=>{t(!1),i()},mm=Di('<div class="overlay svelte-1qdxi6t"></div> <div class="next-video svelte-1qdxi6t"><div class="top svelte-1qdxi6t"><div class="caption svelte-1qdxi6t"> </div> <!></div> <div class="row svelte-1qdxi6t"><div class="column svelte-1qdxi6t"><div class="thumb svelte-1qdxi6t"><div></div> <!></div></div> <div class="column svelte-1qdxi6t"><div class="title svelte-1qdxi6t"> </div></div></div></div>',1),vm={hash:"svelte-1qdxi6t",code:".overlay.svelte-1qdxi6t {width:100%;height:100%;background:rgba(0, 0, 0, 0.72);position:absolute;}.next-video.svelte-1qdxi6t {position:absolute;top:50%;left:50%;z-index:var(--end-screen-mobile-z-index);transform:translate(-50%, -50%);display:flex;flex-direction:column;max-width:362px;min-width:320px;margin:0 auto;padding-bottom:12px;}.top.svelte-1qdxi6t {display:flex;justify-content:space-between;}.caption.svelte-1qdxi6t {font-size:11px;font-weight:bold;color:var(--white);text-transform:uppercase;opacity:0.8;}.row.svelte-1qdxi6t {height:102px;background:rgba(48, 48, 48, .8);cursor:pointer;margin-top:6px;display:flex;flex-direction:row;width:100%;}.column.svelte-1qdxi6t {display:flex;flex-direction:column;flex-basis:50%;}.thumb.svelte-1qdxi6t {width:100%;height:100%;background:no-repeat center;background-size:cover;display:flex;align-items:center;position:relative;justify-content:space-around;}.thumb-overlay.svelte-1qdxi6t {width:100%;height:100%;position:absolute;}.thumb-overlay.withOpacity.svelte-1qdxi6t {background:var(--black);opacity:0.3;}.title.svelte-1qdxi6t {padding:10px 16px;font-size:12px;font-weight:bold;color:var(--white);line-height:1.6;max-height:52px;overflow:hidden;}"};function gm(e,t){pi(t,!0),vr(e,vm);let[i,r]=ua(),a=()=>la(n,"$autoplayNextEnabled$",i),s=Oa(),n=s.ui.autoplayNextEnabled$,o=s.ui.timerNextVideoRunning$,l=s.actions.internal.nextVideoClick,u=s.actions.internal.nextVideoAnnouncementShow,d=s.actions.internal.nextVideoAnnouncementClick,c=s.actions.internal.nextVideoAnnouncementAuto,h=s.actions.internal.nextVideoAnnouncementCancel,p=()=>{l(!1),c()},f=()=>{t.clickCloseIcon(),h()};Xr((()=>{t.isHide||u(),t.isHide&&a()&&(l(!1),c())}));var m=ji(),v=Be(m),g=e=>{var r=mm(),s=De(Be(r),2),n=Ne(s),u=Ne(n),c=Ne(u,!0);Te(u),bo(De(u,2),{onClick:f}),Te(n);var h=De(n,2);h.__click=[fm,l,d];var m=Ne(h),v=Ne(m),g=Ne(v);let b;var y=De(g,2),w=e=>{So(e,{get isRunning(){return la(o,"$timerNextVideoRunning$",i)},onTimerEnded:p})};Xi(y,(e=>{a()&&e(w)})),Te(v),Te(m);var S=De(m,2),x=Ne(S),$=Ne(x,!0);Te(x),Te(S),Te(h),Te(s),Bt(((e,i)=>{Hi(c,e),_r(v,`background-image: url('${t.thumb}')`),b=xr(g,1,"thumb-overlay svelte-1qdxi6t",null,b,i),Hi($,t.title)}),[()=>a()?Es("end_screen_next_video"):Es("end_screen_recommended_video"),()=>({withOpacity:a()})]),zi(e,r)};Xi(v,(e=>{t.isHide||e(g)})),zi(e,m),fi(),r()}Ri(["click"]);var bm=class{getTracksArray(){return Array.from(this.video.getElementsByTagName("track"))}attach(e,t=!1){let i=document.createElement("track");i.setAttribute("src",e.url),i.setAttribute("id",e.id),e.label&&i.setAttribute("label",e.label),e.language&&i.setAttribute("srclang",e.language),t&&(i.track.mode="showing"),this.video.appendChild(i)}detachAll(){for(let e of this.getTracksArray())this.video.removeChild(e)}updateSrc(e){let t=this.getTracksArray().find((t=>t.id===e.id));t&&(t.src=e.url)}getCurrentShowingId(){return this.getTracksArray().find((e=>"showing"===e.track.mode))?.id??null}constructor(e){this.video=e}},ym=({store:e,getFullscreenTarget:t})=>{let{isFullscreen:i}=e.ui,{setSubtitle:r}=e.actions.internal,{currentSubtitle$:a,availableSubtitlesList$:s,currentFormat$:n,availableTextTracks$:o}=e.state,l=null,u=()=>{l?.(),l=null},d=e=>{if(u(),!f.clientChecker.device.isIOS||sa(n)!==f.VideoFormat.DASH_LIVE_CMAF||!e)return;let i=t().querySelector("video");if(!i)return;let d=new bm(i),c=sa(o),h=sa(s),p=sa(a);for(let e of c)h.some((t=>t.value===e.id))&&d.attach(e,p.value===e.id);let m=o.subscribe((e=>{for(let t of e)d.updateSrc(t)})),v=()=>{let e=d.getCurrentShowingId();r(sa(s).find((t=>t.value===e)))};i.textTracks.addEventListener("change",v),l=()=>{m(),d.detachAll(),i.textTracks.removeEventListener("change",v)}};Xr((()=>i.subscribe(d))),Jr(u)},wm=(e,t,i,r)=>{e.stopPropagation(),t()&&r()},Sm=Di("<!> <!>",1),xm=Di("<div><!></div>"),$m=Di('<div class="spherical-video-icon svelte-dtyj47"><!></div>'),_m=Di("<div><!></div>"),km=Di('<div class="settings-mobile svelte-dtyj47"><!></div>'),Tm=Di("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1),Cm=Di('<div class="player-wrapper svelte-dtyj47" role="region" tabindex="-1"><div><div data-testid="video-container"></div></div> <!> <!> <div class="overlay-container"></div></div>'),Em={hash:"svelte-dtyj47",code:".player-wrapper.svelte-dtyj47 {position:absolute;width:100%;height:100%;}.player-wrapper.svelte-dtyj47 .player-media {position:absolute;left:0;top:0;width:100%;height:100%;background:var(--black);transition:transform 0.2s ease-in-out;}.spherical-video-icon.svelte-dtyj47 {display:inline-block;position:absolute;top:calc(50% - 23px);left:calc(50% - 38px);}.video-wrapper.svelte-dtyj47,\n  .video-container.svelte-dtyj47,\n  .ads-container.svelte-dtyj47 {position:absolute;width:100%;height:100%;left:0;top:0;}.video-wrapper.svelte-dtyj47 {z-index:var(--video-container-z-index);background:var(--black);}.video-container.svelte-dtyj47 {z-index:var(--video-container-z-index);transition:var(--rotate-transition-duration) ease all;}.video-container.fast-rotate.svelte-dtyj47 {transition:none;}.ads-container.svelte-dtyj47 {z-index:var(--ads-container-z-index);background:var(--black);}.settings-mobile.svelte-dtyj47 {position:absolute;z-index:var(--settings-menu-z-index);top:50%;left:50%;transform:translate(-50%,-50%);transition:opacity var(--controls-transition-duration);display:flex;align-items:center;max-width:320px;width:90%;}"};function Am(e,t){pi(t,!0),vr(e,Em);let i,r,a,s,[n,o]=ua(),l=()=>la(J,"$playerPhase",n),u=()=>la($e,"$crashed",n),d=()=>la(ae,"$interactiveHideMobileControls",n),c=()=>la(he,"$isEnded$",n),h=()=>la(ie,"$controlsVisible",n),p=()=>la(We,"$autoplayNextEnabled$",n),v=()=>la(Ve,"$rotateAlpha",n),g=()=>la(Me,"$playerSize",n),b=()=>la(lt,"$bottomNoSmooth",n),y=()=>la(Ce,"$videoSize",n),w=()=>la(Z,"$position$",n),S=()=>la(X,"$duration$",n),x=()=>la(se,"$settingsMenuVisible",n),$=()=>la(le,"$scrubbingInProgress",n),_=()=>la(pe,"$chromecastConnected$",n),k=()=>la(we,"$isPlaying$",n),T=ma(t,"videoContainer",15),C=ma(t,"adsSlotId",3,void 0),E=ma(t,"adsParams",3,void 0),A=ma(t,"adsPreviewParam",3,void 0),L=ma(t,"adsAutoplayParam",3,void 0),P=ma(t,"duration",3,void 0),M=ma(t,"logoTargetUrl",3,""),I=ma(t,"showNextPrevButtons",3,!1),R=ma(t,"nextButtonActive",3,!1),V=ma(t,"prevButtonActive",3,!1),N=ma(t,"endScreenVideoTitle",3,void 0),B=ma(t,"endScreenVideoThumb",3,void 0),D=ma(t,"isOneVideoPlaylist",3,!1),O=ma(t,"shadowRootContainer",3,void 0),F=ma(t,"outerContainerRef",3,void 0),j=ma(t,"showMiniTimer",3,!1),z=ma(t,"fullScreenTarget",3,void 0),U=ma(t,"playerStarted",3,!1),q=ma(t,"showEndScreen",3,!0),{notifications$:H,graphIsOpened$:W}=Fa(),Q=t.store.getLogger().createComponentLog("Root component"),G=t.store.interfaceLanguage$,K=t.store.state.playbackState$,Y=t.store.ads.playbackState,Z=t.store.state.positionWithScrubbing$,X=t.store.state.duration$,J=t.store.playerPhase,ee=t.store.ui.isFullscreen,ie=t.store.ui.controlsVisible,ae=t.store.ui.interactiveHideMobileControls,se=t.store.ui.settingsMenu.visible$,oe=t.store.ui.settingsMenu.openedByBtnKeyboard$,le=t.store.ui.scrubbingInProgress,ue=t.store.ui.volumeChangingInProgress,de=t.store.ui.debugPanelVisible,ce=t.store.state.isLoaderVisible,he=t.store.state.isEnded$,pe=t.store.state.chromecastConnected$,fe=t.store.state.chromecastDeviceName$,me=t.store.ads.postrollPassed,ve=t.store.ui.mobileUnmuteButtonExpanded,ge=t.store.ui.mobileUnmuteButtonVisible,ye=t.store.state.isLive$,we=t.store.state.isPlaying$,Se=t.store.state.isActiveLive$,xe=t.store.state.isRewindableLive$,$e=t.store.state.crashed$,_e=t.store.webApi.annotationsApi,ke=t.store.webApi.pictureInPictureApi,Ce=t.store.state.videoSize$,Ee=t.store.state.currentSubtitle$,Le=t.store.state.currentSubtitleCaptions$,Pe=t.store.state.duration$,Me=t.store.ui.playerSize,Ie=t.store.ui.is3DVideo,Re=t.store.ui.icon3DVideoVisible,Ve=t.store.ui.rotateAlpha,Oe=t.store.state.isInteractive,Fe=t.store.state.isInteractiveTime$,je=t.store.state.isInteractiveExpectation$,ze=t.store.state.hasInteractiveBranches,Ue=t.store.ui.controls.disabledControls$,qe=t.store.ui.touched,He=t.store.ui.overlayContainer$,We=t.store.ui.autoplayNextEnabled$,Qe=t.store.state.loadedMetadata$,Ge=t.store.actions.internal.closeSettingsMenu,Ke=t.store.callbacks?.onDisabledPlayPrevChapterClick,Ye=t.store.callbacks?.onDisabledSeekToInteractiveClick,Ze=t.store.actions.internal.setQuality,Xe=te(void 0),Je=te(void 0),et=te(void 0),tt=te(void 0),it=ne((()=>("video"===l()&&la(ce,"$isLoaderVisible",n)||"ads"===l()&&"inactive"===la(Y,"$adPlaybackState",n))&&!u())),rt=te(void 0),{closeNotification:at,notificationsToShow$:st}=H,nt=ne((()=>!!la(st,"$notificationsToShow$",n).slow_video)),ot=()=>at("slow_video"),lt=ra(!1),ut=te(!1),dt=ne((()=>la(K,"$playbackState$",n)!==f.PlaybackState.PLAYING)),ct=te(!1),ht=ne((()=>la(W,"$graphIsOpened$",n)||d()||!Tt(ut)&&(c()&&!!ze||Tt(dt)&&la(je,"$isInteractiveExpectation$",n)))),pt=te(!0),ft=ne((()=>t.uiConfig.features.thumbTimer&&j()&&"video"===l()&&!h()&&!u()&&!Oe&&(t.uiConfig.hideThumbTimerAfterTouch&&!la(qe,"$touched",n)||!t.uiConfig.hideThumbTimerAfterTouch))),mt=te(!1),vt=ne((()=>(q()||t.showAutoplayNext&&p())&&!!N()&&!!B()&&(t.showAds&&la(me,"$postrollPassed",n)||!t.showAds)&&c()&&!u()&&!Tt(mt))),gt=te(!1),bt=ne((()=>T()&&v()%180?g().height/g().width:1));ke?.setContext(hi());t.store.setUiCallbacks({onStarted:e=>{clearTimeout(r),e&&(ge.set(!0),ve.set(!0),r=setTimeout((()=>{ve.set(!1)}),t.uiConfig.controls.collapseMobileUnmute),Oe||wt(t.uiConfig.controls.hideTimeoutMobile))}});let yt=()=>{clearTimeout(i),re(ut,!1),d()&&ae.set(!1)},wt=e=>{yt(),re(ut,!0),i=setTimeout((()=>re(ut,!1)),e);let t=e-100;s=setTimeout((()=>{b()&&lt.set(!1)}),t>0?t:e)},St=Ie.subscribe((e=>{Re.set(e),e&&(clearTimeout(a),a=setTimeout((()=>Re.set(!1)),t.uiConfig.controls.hide360IconTimeout))})),xt=async(e=Hs())=>{if(e&&!f.clientChecker.device.isIOS){let t=qs(),i=Et(),r=f.clientChecker.browser.isSamsungBrowser&&t===O();e=t===i||r}if(e){wt(t.uiConfig.controls.hideTimeoutFullscreen);try{await(ke?.remove())}catch(e){Q({message:String(e)})}try{let e=y()?.width&&y()?.height?y():g();await(e=>{let t=window.screen;return(async e=>t.orientation?t.orientation.lock(e):t.mozLockOrientation?t.mozLockOrientation(e):t.msLockOrientation?t.msLockOrientation(e):Promise.reject())(((e={width:0,height:0})=>e.width<=e.height?"portrait":"landscape")(e))})(e)}catch(e){Q({message:String(e)})}}ee.set(e),t.store.getAdmanWrapper().setFullscreen(e),la(ee,"$isFullscreen",n)?t.store.callbacks?.onFullscreenEnter?.():t.store.callbacks?.onFullscreenExit?.()},$t=e=>{let t=e;Me.set({width:t.target.width,height:t.target.height})};Xr((()=>(Ws(xt),t.uiConfig.features.annotationsInside&&_e?.init(Tt(Xe)),Ks(ke)&&(ke?.assignPlayerContainer(Tt(Xe)),ke?.registryExternalEventHandlers({resize:$t})),re(pt,!f.clientChecker.device.isIphoneOrOldIpad),t.interactiveContainer&&T().parentElement?.insertBefore(t.interactiveContainer,T().nextSibling),()=>{clearTimeout(i),clearTimeout(s),clearTimeout(r),clearTimeout(a),St(),ke?.dispose().catch((e=>{Q({message:String(e)})})),Qs(xt)})));let _t=te(!0),kt=te(!0),Ct=e=>{let i=w()+("forward"===e?1:-1)*t.uiConfig.controls.seekStepMobile/1e3;i<0?(re(_t,!1),i=0):i>=S()&&(re(kt,!1),i=S()),re(ct,!0),t.seekTime(i)},Et=()=>{let e=f.clientChecker.device.isIOS||t.uiConfig.features.fullscreenInternalTargetPlayerContainer||!F()?Tt(Xe):F(),i=e.getRootNode(),r=i instanceof ShadowRoot?i.host:i,a=z()instanceof HTMLElement&&z().contains(r);return t.uiConfig.allowChangingFullscreenTarget&&z()&&a?z():e},At=async()=>{try{if(Hs())await Us(document),Q({message:"exit fullscreen"});else{if(Q({message:"request fullscreen"}),f.clientChecker.device.isIOS&&!la(Qe,"$loadedMetadata",n))return;await zs(Et())}}catch(e){Q({message:String(e)})}},Lt=()=>{Ge()},Pt=e=>{if(e.preventDefault(),!x())return U()?(re(ct,!1),void(h()?yt():wt(t.uiConfig.controls.hideTimeoutMobile))):(t.firstStart(),void wt(t.uiConfig.controls.hideTimeoutCursor));Lt()},Mt=e=>{Ke&&(Ke(e),wt(t.uiConfig.controls.hideTimeoutMobile))},It=e=>{Ye&&(Ye(e),wt(t.uiConfig.controls.hideTimeoutMobile))};Rt((()=>{He.set(Tt(rt))})),Rt((()=>{ie.set((Tt(dt)||x()||$()||la(ue,"$volumeChangingInProgress",n)||_()||!Tt(vt)&&(c()||Tt(ut)&&!Tt(ct)))&&!Tt(ht)&&"video"===l()&&!u())})),Rt((()=>{!$()&&Tt(gt)&&!la(Fe,"$isInteractiveTime$",n)&&wt(t.uiConfig.controls.hideTimeoutMobile),re(gt,Ae($()))})),Rt((()=>{re(_t,w()>0),re(kt,Ae(!la(Se,"$isActiveLive",n)&&w()<S()))})),Rt((()=>{xn(Tt(tt),x(),la(oe,"$settingsMenuOpenedByKeyboard",n))}));let Vt=Es("aria_label_video_player"),Nt=Es("video360");(({getFullscreenTarget:e,fullScreenChangeHandler:t})=>{let i,r=null;Xr((()=>{f.clientChecker.device.isIOS&&(i=setTimeout((()=>{let i=e().querySelector("video");if(!i)return;let a=()=>t(!0),s=()=>t(!1);i.addEventListener("webkitbeginfullscreen",a),i.addEventListener("webkitendfullscreen",s),r=()=>{i.removeEventListener("webkitbeginfullscreen",a),i.removeEventListener("webkitendfullscreen",s)}}),0))})),Jr((()=>{r?.(),clearTimeout(i)}))})({fullScreenChangeHandler:xt,getFullscreenTarget:Et}),ym({store:t.store,getFullscreenTarget:Et});var Dt=Cm();Ii("blur",be,Lt),Lr(Dt,"aria-label",Vt);var Ot=Ne(Dt);let Ft;Ot.__click=Pt;var jt=Ne(Ot);let zt;Kr(jt,(e=>T(e)),(()=>T())),Te(Ot);var Ut=De(Ot,2);fr(Ut,(()=>"slot"),!1,((e,t)=>{Pr(e,null,{name:Qf})}));var qt=De(Ut,2);Ji(qt,(()=>la(G,"$language$",n)),(e=>{var i=Tm(),r=Be(i);let a=ne((()=>"thumb"!==l()||u()||Oe&&t.autoplay));Oh(r,{get hidden(){return Tt(a)},get thumbUrl(){return t.thumbUrl},get startVideo(){return t.firstStart}});var s=De(r,2),o=e=>{var i=Sm(),r=Be(i),a=e=>{let i=ne((()=>t.uiConfig.controls.seekStepMobile/1e3));pm(e,{side:"left",get seekStep(){return Tt(i)},handleSingleFirstClick:Pt,handleSecondClick:()=>Ct("backward")})};Xi(r,(e=>{Tt(_t)&&e(a)}));var s=De(r,2),n=e=>{let i=ne((()=>t.uiConfig.controls.seekStepMobile/1e3));pm(e,{side:"right",get seekStep(){return Tt(i)},handleSingleFirstClick:Pt,handleSecondClick:()=>Ct("forward")})};Xi(s,(e=>{Tt(kt)&&e(n)})),zi(e,i)};Xi(s,(e=>{t.canRewindLive&&xe&&!la(Ue,"$disabledControls$",n).has("TIMELINE")&&e(o)}));var d=De(s,2),c=e=>{let i=ne((()=>t.live?.startTime));ep(e,{get thumbUrl(){return t.thumbUrl},get startTime(){return Tt(i)}})};Xi(d,(e=>{"LiveWaitingStart"===l()&&e(c)}));var f=De(d,2),v=e=>{rp(e,{kind:"recover",get thumbUrl(){return t.thumbUrl}})};Xi(f,(e=>{"LiveWaitingRecover"===l()&&e(v)}));var y=De(f,2),$=e=>{rp(e,{kind:"record",get thumbUrl(){return t.thumbUrl}})};Xi(y,(e=>{"LiveWaitingRecord"===l()&&e($)}));var T=De(y,2),O=e=>{var t=xm();let i;nn(Ne(t),{get adsSlotId(){return C()},get adsParams(){return E()},get adsPreviewParam(){return A()},get adsAutoplayParam(){return L()},get duration(){return P()}}),Te(t),Bt((e=>i=xr(t,1,"ads-container svelte-dtyj47",null,i,e)),[()=>({hidden:"ads"!==l()})]),zi(e,t)};Xi(T,(e=>{t.showAds&&U()&&e(O)}));var F=De(T,2),j=e=>{let i=ne((()=>!q()&&t.showAutoplayNext&&p()));gm(e,{get title(){return N()},get thumb(){return B()},get isHide(){return Tt(i)},clickCloseIcon:()=>re(mt,!0)})};Xi(F,(e=>{Tt(vt)&&N()&&B()&&e(j)}));var z=De(F,2),H=e=>{wh(e,{})};Xi(z,(e=>{la(Ie,"$is3DVideo",n)&&e(H)}));var W=De(z,2),Q=e=>{var t=$m();bs(Ne(t),{"aria-label":Nt}),Te(t),zi(e,t)};Xi(W,(e=>{la(Re,"$icon3DVideoVisible",n)&&e(Q)}));var G=De(W,2),K=e=>{Mh(e,{get thumbUrl(){return t.thumbUrl},get chromecastDeviceName(){return la(fe,"$chromecastDeviceName$",n)}})};Xi(G,(e=>{_()&&e(K)}));var Y=De(G,2),Z=e=>{Eh(e,{get shifted(){return h()},get captions(){return la(Le,"$currentSubtitleCaptions$",n)},get position(){return w()},get playerSize(){return g()},isMobile:!0})};Xi(Y,(e=>{"off"!==la(Ee,"$currentSubtitle$",n).value&&e(Z)}));var X=De(Y,2),J=e=>{var t=_m();t.__click=[wm,x,se,Lt],Nh(Ne(t)),Te(t),zi(e,t)};Xi(X,(e=>{u()&&e(J)}));var ee=De(X,2),te=e=>{let i=ne((()=>"thumb"===l()||"LiveWaitingStart"===l()||"LiveWaitingRecover"===l()||"LiveWaitingRecord"===l()||"ads"===l())),r=ne((()=>"ads"===l())),a=ne((()=>t.canRewindLive&&0!==la(Pe,"$realDuration$",n)));Jc(e,{get bottomHidden(){return Tt(i)},get showControls(){return h()},get bottomNoSmooth(){return b()},get isAds(){return Tt(r)},get canRewindLive(){return Tt(a)},get logoClickable(){return t.logoClickable},get logoHidden(){return t.logoHidden},get logoTargetUrl(){return M()},get showAutoplayNext(){return t.showAutoplayNext},get showNextPrevButtons(){return I()},get nextButtonActive(){return R()},get prevButtonActive(){return V()},get isOneVideoPlaylist(){return D()},get customFullscreenSupported(){return Tt(pt)},get endScreenShown(){return Tt(vt)},toggleFullscreen:At,get seekToInteractive(){return t.seekToInteractive},get playPrevChapter(){return t.playPrevChapter},onDisabledPlayPrevChapterClick:Mt,onDisabledSeekToInteractiveClick:It,get playerControlsWrapperRef(){return Tt(Je)},set playerControlsWrapperRef(e){re(Je,Ae(e))},get playerControlsRef(){return Tt(et)},set playerControlsRef(e){re(et,Ae(e))}})};Xi(ee,(e=>{U()&&e(te)}));var ie=De(ee,2),ae=e=>{var i=km();Of(Ne(i),{get supportLink(){return t.supportLink},returnFocus:m.noop,get ref(){return Tt(tt)},set ref(e){re(tt,Ae(e))}}),Te(i),zi(e,i)};Xi(ie,(e=>{x()&&e(ae)}));var oe=De(ie,2);let le=ne((()=>!Tt(ft)));fn(oe,{get isLive(){return la(ye,"$isLive$",n)},get isHidden(){return Tt(le)},get isPlaying(){return k()},get position(){return w()},get duration(){return S()}});var ue=De(oe,2),ce=e=>{No(e,{})};Xi(ue,(e=>{Tt(it)&&e(ce)}));var he=De(ue,2),pe=e=>{fo(e,{})};Xi(he,(e=>{la(de,"$debugPanelVisible",n)&&e(pe)}));var me=De(he,2),ve=e=>{Wf(e,{onClose:ot,onSelectAutoQuality:()=>{Ze("auto"),ot()}})};Xi(me,(e=>{Tt(nt)&&e(ve)})),zi(e,i)})),Kr(De(qt,2),(e=>re(rt,e)),(()=>Tt(rt))),Te(Dt),Kr(Dt,(e=>re(Xe,e)),(()=>Tt(Xe))),Bt(((e,t)=>{Ft=xr(Ot,1,"video-wrapper svelte-dtyj47",null,Ft,e),zt=xr(jt,1,"video-container svelte-dtyj47",null,zt,t),_r(jt,`transform: rotate(${v()}deg) scale(${Tt(bt)})`),Lr(jt,"data-is-playing",k())}),[()=>({hidden:"video"!==l()}),()=>({"fast-rotate":!t.uiConfig.isSmoothVideoRotate})]),Ii("click",Dt,(()=>{qe.set(!0)}),!0),Ii("focusin",Dt,(()=>{Oe||(lt.set(!0),wt(t.uiConfig.controls.hideTimeoutCursor))}),!0),zi(e,Dt),fi(),o()}function Lm(e){let t="";return Pm(e.timelineSliderFilledColor)&&(t+=`--timeline-slider-filled-bg:${e.timelineSliderFilledColor};`),Pm(e.timelineSliderHandleColor)&&(t+=`--timeline-slider-handle-bg:${e.timelineSliderHandleColor};`),Pm(e.timelineSliderLoadedColor)&&(t+=`--timeline-slider-loaded-bg:${e.timelineSliderLoadedColor};`),Pm(e.timelineSliderColor)&&(t+=`--timeline-slider-bg:${e.timelineSliderColor};`),Pm(e.volumeSliderColor)&&(t+=`--volume-slider-bg:${e.volumeSliderColor};`),Pm(e.volumeSliderHandleColor)&&(t+=`--volume-slider-handle-bg:${e.volumeSliderHandleColor};`),Pm(e.volumeSliderFilledColor)&&(t+=`--volume-slider-filled-bg:${e.volumeSliderFilledColor};`),Pm(e.controlsTimeColor)&&(t+=`--controls-time:${e.controlsTimeColor};`),Pm(e.timelineSliderFilledActiveLiveColor)&&(t+=`--timeline-slider-filled-active-live-bg:${e.timelineSliderFilledActiveLiveColor};`),Pm(e.timelineSliderHandleActiveLiveColor)&&(t+=`--timeline-slider-handle-active-live-bg:${e.timelineSliderHandleActiveLiveColor};`),Pm(e.buttonColor)&&(t+=`--btn-color:${e.buttonColor};`),Pm(e.buttonToggleOnColor)&&(t+=`--toggle-color-on:${e.buttonToggleOnColor};`,t+=`--toggle-color-autoplay-on:${e.buttonToggleOnColor};`),Pm(e.focusedColor)&&(t+=`--focused:${e.focusedColor};`),t.length&&t||void 0}function Pm(e){return"string"==typeof e&&!e.includes(";")}Ri(["click"]);var Mm=Di('<div class="root svelte-1cnbt6x"><!></div>'),Im={hash:"svelte-1cnbt6x",code:".root.svelte-1cnbt6x {--white: #fff;--black: #000;--red: #ff3347;--blue-light: #70c1ff;--black-alpha-40: rgba(0, 0, 0, 0.4);--white-alpha-24: rgba(255, 255, 255, 0.24);--white-alpha-72: rgba(255, 255, 255, 0.72);--devider-gray: #dce1e6;--text-gray: #626d7a;--font: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;--controls-height: 40px;--controls-gradient-height: 100px;--controls-transition-duration: 0.25s;--controls-transition-fn: cubic-bezier(0.455, 0.03, 0.515, 0.955);--controls-desktop-item-margin-left: 4px;--focused: var(--white);--focused-element-shadow: inset 0 0 0 2px var(--focused);--focused-slider-shadow: 0 0 0 2px var(--focused);--big-play-size: 96px;--big-play-radius: 50%;--big-play-bg-color: rgba(0, 0, 0, 0.5);--big-play-hover-bg-color: rgba(0, 0, 0, 0.6);--big-play-icon-width: 38px;--big-play-icon-height: 33px;--interactive-episode-complete: rgba(92, 156, 230, 1);--slider-bg: rgba(255, 255, 255, 0.4);--slider-filled-bg: var(--white);--slider-handle-bg: var(--white);--slider-loaded-bg: rgba(255, 255, 255, 0.4);--slider-height: 3px;--slider-video-episode-gap: 1.5px;--slider-radius: 0px;--slider-handle-size: 12px;--slider-filled-ads: rgba(103, 165, 235, 1);--slider-disabled-color: rgba(248, 248, 248, 0.31);--slider-volume-height: 5px;--slider-volume-radius: calc(var(--slider-volume-height) / 2);--slider-volume-handle-size: 13px;\n\n    /* USER DEFINED COLORS */\n\n    /* timeline active live */--timeline-slider-filled-active-live-bg: var(--red);--timeline-slider-handle-active-live-bg: var(--red);\n    /* timeline & timeline ads */--timeline-slider-bg: var(--slider-bg);--timeline-slider-filled-bg: var(--slider-filled-bg);--timeline-slider-handle-bg: var(--slider-handle-bg);--timeline-slider-loaded-bg: var(--slider-loaded-bg);\n    /* volume slider colors */--volume-slider-bg: var(--slider-bg);--volume-slider-filled-bg: var(--slider-filled-bg);--volume-slider-handle-bg: var(--slider-handle-bg);\n    /* controls time */--controls-time: var(--white);\n\n    /* /// USER DEFINED COLORS */--controls-gradient: linear-gradient(\n      180deg,\n      rgba(0, 0, 0, 0) 0%,\n      rgba(0, 0, 0, 0.01) 6.67%,\n      rgba(0, 0, 0, 0.04) 13.33%,\n      rgba(0, 0, 0, 0.08) 20%,\n      rgba(0, 0, 0, 0.15) 26.67%,\n      rgba(0, 0, 0, 0.23) 33.33%,\n      rgba(0, 0, 0, 0.33) 40%,\n      rgba(0, 0, 0, 0.44) 46.67%,\n      rgba(0, 0, 0, 0.56) 53.33%,\n      rgba(0, 0, 0, 0.67) 60%,\n      rgba(0, 0, 0, 0.77) 66.67%,\n      rgba(0, 0, 0, 0.85) 73.33%,\n      rgba(0, 0, 0, 0.92) 80%,\n      rgba(0, 0, 0, 0.96) 86.67%,\n      rgba(0, 0, 0, 0.99) 93.33%,\n      #000 100%\n    );--timeline-preview-shadow: rgba(0, 0, 0, 0.08);--timeline-preview-bg: rgba(34, 34, 34, 1);--settings-bg: rgba(0, 0, 0, 0.72);--settings-item-bg-hover: rgba(255, 255, 255, 0.08);--settings-radius: 8px;--mobile-settings-bg: #2c2d2e;--divider-border: 1px solid var(--white-alpha-24);--toggle-color-separator: #363738;--toggle-color-off: #656565;--toggle-color-on: #71aaeb;--toggle-color-autoplay-on: var(--white);--notification-bg: #2C2D2E;--notification-radius: 8px;--button-hover-transition: opacity 0.2s;--video-container-z-index: 0;--controls-container-z-index: 1;--ads-container-z-index: 1;--end-screen-mobile-z-index: 1;--notification-z-index: 1;--thumb-timer-z-index: 2;--debug-panel-z-index: 2;--settings-menu-z-index: 2;--context-menu-z-index: 3;--hot-key-helpers-container-z-index: 3;--overlay-container-z-index: 4;--rotate-transition-duration: 0.25s;--btn-color: var(--white);position:relative;width:100%;height:100%;color:var(--white);font-size:12px;line-height:normal;overflow:hidden;outline:0;user-select:none;\n    /* --vk-vp-custom-font - vk video player custom font */font-family:var(--vk-vp-custom-font, var(--font));background:var(--black);}\n\n  /* css reset start */* {-webkit-tap-highlight-color:transparent;}button {border:none;margin:0;padding:0;width:auto;overflow:visible;background:transparent;color:inherit;font:inherit;line-height:normal;-webkit-font-smoothing:inherit;-moz-osx-font-smoothing:inherit;-webkit-appearance:none;cursor:pointer;}p {margin:0;}svg:not(.interactive-root svg) {pointer-events:none;}.interactive-root {\n    /* --vk-vp-int-custom-font - vk video player interactive custom font */font-family:var(--vk-vp-int-custom-font, inherit);}*:focus, *:focus-visible {outline:none;}*:focus-visible {box-shadow:var(--focused-element-shadow);}\n  /* css reset end */.hidden {visibility:hidden;opacity:0;}.overlay-container {pointer-events:none;top:0;left:0;height:100%;width:100%;position:fixed;z-index:var(--overlay-container-z-index);}\n\n  /* Класс для сокрытие контента визуально но не для обхода по таб и скрин ридера */.out-of-view {position:absolute !important;left:-1000vh !important;}.icon.icon-error-stub {display:flex;justify-content:center;align-items:center;}"};function Rm(e,t){pi(t,!0),vr(e,Im);let[i,r]=ua(),a=ma(t,"sources",7),s=ma(t,"store",7),n=ma(t,"microStoresRoot",7),o=ma(t,"videoConfig",7),l=ma(t,"uiConfig",7),u=ma(t,"title",7),d=ma(t,"thumbUrl",7),c=ma(t,"interactiveContainer",7),h=ma(t,"interactiveController",7),p=ma(t,"subtitles",7),g=ma(t,"live",7),b=ma(t,"preload",7),y=ma(t,"autoplay",7),w=ma(t,"volume",7,void 0),S=ma(t,"muted",7,void 0),x=ma(t,"fromTime",7),$=ma(t,"canRewindLive",7),_=ma(t,"showAds",7),k=ma(t,"adsSlotId",7,void 0),T=ma(t,"adsParams",7,void 0),C=ma(t,"adsPreviewParam",7,void 0),E=ma(t,"adsAutoplayParam",7,void 0),A=ma(t,"duration",7,void 0),L=ma(t,"logoClickable",7),P=ma(t,"logoHidden",7),M=ma(t,"isMobile",7),I=ma(t,"showNextPrevButtons",7,!1),R=ma(t,"nextButtonActive",7,!1),V=ma(t,"prevButtonActive",7,!1),N=ma(t,"endScreenVideoTitle",7,void 0),B=ma(t,"endScreenVideoThumb",7,void 0),D=ma(t,"isOneVideoPlaylist",7,!1),O=ma(t,"supportLink",7),F=ma(t,"shadowRootContainer",7,void 0),j=ma(t,"outerContainerRef",7,void 0),z=ma(t,"fullScreenTarget",7,void 0),U=ma(t,"failoverHosts",7,void 0),q=ma(t,"showMiniTimer",7,!1),H=ma(t,"saveRate",7),W=ma(t,"seekToInteractive",7,m.noop),Q=ma(t,"playPrevChapter",7,m.noop),G=ma(t,"volumeMultiplier",7),K=ma(t,"showAutoplayNext",7),Y=ma(t,"showEndScreen",7,!0),Z=ma(t,"keyboardControls",15,void 0),{subscribers:X,stores:J}=n();(e=>{ci("ui-config",e)})(l());let ee=ya(),ie=l().logoLink,ae=s().ui.debugPanelVisible,se=s().ui.playerSize,ne=s().state.isLive$,oe=s().state.isInteractive&&f.clientChecker.device.isAndroid,le=te(void 0),ue=null,de=te(!1);s().getAdmanWrapper().init({switchFromAdsToVideo:s().actions.internal.switchFromAdsToVideo,switchFromVideoToAds:s().actions.internal.switchFromVideoToAds,setMuted:s().actions.external.setMuted},s().ads,{isMobile:s().ui.isMobile,mobileUnmuteButtonVisible:s().ui.mobileUnmuteButtonVisible,vsid:s().vsid}),((e,t)=>{ci(Ba,e),ci(Da,t)})(s(),J),Rt((()=>{s().ui.isMobile.set(M())}));let ce=(e=!1)=>{re(de,!0),e?s().actions.external.firstStart(_()):s().actions.internal.firstStart(_())};function he(e){let t=a()||e;t&&s().initVideo({container:Tt(le),sources:t,failoverHosts:U(),subtitles:p(),volumeMultiplier:G()});let r="true"===m.safeStorage.get(wa);ae.set(r),x()>0&&s().actions.external.seekTime(x());let n=M()?ee.volumeDefault:w()??ts()??ee.volumeDefault,o=S()??ns(Wa);if(s().actions.external.setVolume(n),s().actions.external.setMuted(o),s().getAdmanWrapper().setInitialVolume(o?0:n),(()=>{if(ee.features.qualityDetailsSubMenuEnabled){let e=cs(s().videoId);if(e)switch(e.type){case"high_quality":s().actions.internal.setHighQualityEnabled(!0,e.appliesTo);break;case"traffic_saving":s().actions.internal.setTrafficSavingEnabled(!0,e.appliesTo);break;case"exact_quality":s().actions.internal.setQuality(e.quality)}}else{hs(s().videoId),us()&&s().actions.internal.setTrafficSavingEnabled(!0);let e=as(s().videoId);e&&s().actions.internal.setQuality(e)}})(),ee.features.saveRate&&H()){let e=(()=>{let e=m.safeStorage.get(Za);if((0,m.isNullable)(e))return;let{rate:t}=JSON.parse(e);return t})();e&&!la(ne,"$isLive$",i)&&s().actions.internal.setPlaybackRate(e)}if(K()){let e=ns(Xa);e&&s().actions.internal.setAutoplayNextEnabled(e)}s().ui.isAutoplay.set(y()),y()?ce():b()&&ee.features.preload&&s().actions.internal.preload()}let pe=()=>{document.hidden&&s().actions.external.stop()};function fe(e){s().actions.internal.seekTime(e,v.SeekAction.UNKNOWN)}Xr((()=>{oe&&document.addEventListener("visibilitychange",pe),ee.debugLog&&s().actions.internal.startLogging(),(e=>{if(window.ResizeObserver){let t,i;ue=new ResizeObserver((0,m.throttleFn)((e=>{let r=e[0];if(r.contentBoxSize){let e=Array.isArray(r.contentBoxSize)?r.contentBoxSize[0]:r.contentBoxSize;t=e.inlineSize,i=e.blockSize}else r.contentRect&&(t=r.contentRect.width,i=r.contentRect.height);se.set({width:t,height:i})}),300)),ue.observe(e)}se.set({width:e.clientWidth,height:e.clientHeight})})(Tt(le));let e=X.map((e=>e.init({store:s(),microStores:J,config:o(),interactiveController:h(),uiConfig:l()}))),t=()=>{oe&&document.removeEventListener("visibilitychange",pe),ue?.disconnect(),e.forEach((e=>e.unsubscribe())),s().destroy()};return"upcoming"===g()?.status?(s().actions.internal.setLiveWaitingStart(!0),t):"waiting"===g()?.status?(s().actions.internal.setLiveWaitingRecover(!0),t):"finished"!==g()?.status&&"postlive"!==g()?.status||Object.keys(a()||[]).length?(he(),t):(s().actions.internal.setLiveWaitingRecord(!0),t)}));let me=Lm(ee.view);var ve=Mm();_r(ve,me);var ge=Ne(ve),be=e=>{Am(e,{get store(){return s()},uiConfig:ee,get thumbUrl(){return d()},get interactiveContainer(){return c()},get live(){return g()},get autoplay(){return y()},get canRewindLive(){return $()},get showAds(){return _()},get adsSlotId(){return k()},get adsParams(){return T()},get adsPreviewParam(){return C()},get adsAutoplayParam(){return E()},get duration(){return A()},get logoClickable(){return L()},get logoHidden(){return P()},logoTargetUrl:ie,get nextButtonActive(){return R()},get prevButtonActive(){return V()},get endScreenVideoTitle(){return N()},get endScreenVideoThumb(){return B()},get isOneVideoPlaylist(){return D()},get supportLink(){return O()},get shadowRootContainer(){return F()},get outerContainerRef(){return j()},get fullScreenTarget(){return z()},get showMiniTimer(){return q()},get playerStarted(){return Tt(de)},get seekToInteractive(){return W()},get playPrevChapter(){return Q()},firstStart:ce,seekTime:fe,get showEndScreen(){return Y()},get showAutoplayNext(){return K()},get showNextPrevButtons(){return I()},get videoContainer(){return Tt(le)},set videoContainer(e){re(le,Ae(e))}})},ye=e=>{um(e,{get store(){return s()},uiConfig:ee,get title(){return u()},get thumbUrl(){return d()},get interactiveContainer(){return c()},get live(){return g()},get autoplay(){return y()},get canRewindLive(){return $()},get showAds(){return _()},get adsSlotId(){return k()},get adsParams(){return T()},get adsPreviewParam(){return C()},get adsAutoplayParam(){return E()},get duration(){return A()},get logoClickable(){return L()},get logoHidden(){return P()},logoTargetUrl:ie,get nextButtonActive(){return R()},get prevButtonActive(){return V()},get endScreenVideoTitle(){return N()},get endScreenVideoThumb(){return B()},get isOneVideoPlaylist(){return D()},get supportLink(){return O()},get shadowRootContainer(){return F()},get outerContainerRef(){return j()},get fullScreenTarget(){return z()},get showMiniTimer(){return q()},get playerStarted(){return Tt(de)},get seekToInteractive(){return W()},get playPrevChapter(){return Q()},firstStart:ce,get showEndScreen(){return Y()},get showAutoplayNext(){return K()},get showNextPrevButtons(){return I()},get videoContainer(){return Tt(le)},set videoContainer(e){re(le,Ae(e))},get keyboardControls(){return Z()},set keyboardControls(e){Z(e)}})};Xi(ge,(e=>{M()?e(be):e(ye,!1)})),Te(ve),zi(e,ve);var we=fi({initVideo:he,play:function(){Tt(de)?s().actions.external.play():ce(!0)},pause:function(){s().actions.external.pause()},setMuted:function(e){s().actions.external.setMuted(e)},setVolume:function(e){M()||e>=0&&e<=1&&s().actions.external.setVolume(e)},seekTime:fe,seekEpisodeStartTime:function(e){s().actions.external.seekEpisodeStartTime(e)},returnFocusToEpisodes:function(){s().actions.external.returnFocusToEpisodes()},setPlaybackRate:function(e){s().actions.external.setPlaybackRate(e)},setAutoQualityLimits:function(e){s().actions.external.setAutoQualityLimits(e)},get sources(){return a()},set sources(e){a(e)},get store(){return s()},set store(e){s(e)},get microStoresRoot(){return n()},set microStoresRoot(e){n(e)},get videoConfig(){return o()},set videoConfig(e){o(e)},get uiConfig(){return l()},set uiConfig(e){l(e)},get title(){return u()},set title(e){u(e)},get thumbUrl(){return d()},set thumbUrl(e){d(e)},get interactiveContainer(){return c()},set interactiveContainer(e){c(e)},get interactiveController(){return h()},set interactiveController(e){h(e)},get subtitles(){return p()},set subtitles(e){p(e)},get live(){return g()},set live(e){g(e)},get preload(){return b()},set preload(e){b(e)},get autoplay(){return y()},set autoplay(e){y(e)},get volume(){return w()},set volume(e){w(e)},get muted(){return S()},set muted(e){S(e)},get fromTime(){return x()},set fromTime(e){x(e)},get canRewindLive(){return $()},set canRewindLive(e){$(e)},get showAds(){return _()},set showAds(e){_(e)},get adsSlotId(){return k()},set adsSlotId(e){k(e)},get adsParams(){return T()},set adsParams(e){T(e)},get adsPreviewParam(){return C()},set adsPreviewParam(e){C(e)},get adsAutoplayParam(){return E()},set adsAutoplayParam(e){E(e)},get duration(){return A()},set duration(e){A(e)},get logoClickable(){return L()},set logoClickable(e){L(e)},get logoHidden(){return P()},set logoHidden(e){P(e)},get isMobile(){return M()},set isMobile(e){M(e)},get showNextPrevButtons(){return I()},set showNextPrevButtons(e){I(e)},get nextButtonActive(){return R()},set nextButtonActive(e){R(e)},get prevButtonActive(){return V()},set prevButtonActive(e){V(e)},get endScreenVideoTitle(){return N()},set endScreenVideoTitle(e){N(e)},get endScreenVideoThumb(){return B()},set endScreenVideoThumb(e){B(e)},get isOneVideoPlaylist(){return D()},set isOneVideoPlaylist(e){D(e)},get supportLink(){return O()},set supportLink(e){O(e)},get shadowRootContainer(){return F()},set shadowRootContainer(e){F(e)},get outerContainerRef(){return j()},set outerContainerRef(e){j(e)},get fullScreenTarget(){return z()},set fullScreenTarget(e){z(e)},get failoverHosts(){return U()},set failoverHosts(e){U(e)},get showMiniTimer(){return q()},set showMiniTimer(e){q(e)},get saveRate(){return H()},set saveRate(e){H(e)},get showAutoplayNext(){return K()},set showAutoplayNext(e){K(e)},get seekToInteractive(){return W()},set seekToInteractive(e){W(e)},get playPrevChapter(){return Q()},set playPrevChapter(e){Q(e)},get volumeMultiplier(){return G()},set volumeMultiplier(e){G(e)},get showEndScreen(){return Y()},set showEndScreen(e){Y(e)},get keyboardControls(){return Z()},set keyboardControls(e){Z(e)}});return r(),we}var Vm=Oi('<svg><!><path fill="currentColor" d="M38.245 6c3.566 0 4.859.371 6.162 1.069a7.27 7.27 0 0 1 3.025 3.024c.697 1.303 1.068 2.597 1.068 6.163v23.489c0 3.566-.371 4.859-1.069 6.162a7.27 7.27 0 0 1-3.024 3.025C43.104 49.629 41.811 50 38.245 50h-19.49c-3.565 0-4.859-.371-6.162-1.069a7.27 7.27 0 0 1-3.024-3.024C8.87 44.604 8.5 43.311 8.5 39.745v-23.49c0-3.565.371-4.859 1.069-6.162a7.27 7.27 0 0 1 3.024-3.024C13.896 6.37 15.19 6 18.756 6zm.314 3H18.756c-2.799 0-3.761.186-4.749.714a4.27 4.27 0 0 0-1.793 1.793c-.508.95-.7 1.876-.713 4.434L11.5 39.744c0 2.799.186 3.761.714 4.749a4.27 4.27 0 0 0 1.793 1.793c.988.528 1.95.714 4.749.714h19.489c2.798 0 3.76-.186 4.748-.714a4.27 4.27 0 0 0 1.793-1.793c.528-.988.714-1.95.714-4.748v-23.49c0-2.798-.186-3.76-.714-4.748a4.27 4.27 0 0 0-1.793-1.793c-.95-.508-1.876-.7-4.434-.713zM19.22 38c.445 0 .607.046.77.134a.9.9 0 0 1 .377.378c.088.163.134.324.134.77v1.436c0 .446-.046.607-.134.77a.9.9 0 0 1-.378.378c-.162.088-.324.134-.77.134h-1.436c-.446 0-.608-.046-.77-.134a.9.9 0 0 1-.378-.378c-.088-.163-.134-.324-.134-.77v-1.436c0-.446.046-.607.134-.77a.9.9 0 0 1 .378-.378c.162-.088.324-.134.77-.134h1.436zm20 0c.445 0 .606.046.77.134a.9.9 0 0 1 .377.378c.088.163.134.324.134.77v1.436c0 .446-.046.607-.134.77a.9.9 0 0 1-.378.378c-.163.088-.324.134-.77.134h-1.436c-.446 0-.607-.046-.77-.134a.9.9 0 0 1-.378-.378c-.088-.163-.134-.324-.134-.77v-1.436c0-.446.046-.607.134-.77a.9.9 0 0 1 .378-.378c.163-.088.324-.134.77-.134zm-20-8c.445 0 .607.046.77.134a.9.9 0 0 1 .377.378c.088.162.134.324.134.77v1.436c0 .446-.046.607-.134.77a.9.9 0 0 1-.378.378c-.162.088-.324.134-.77.134h-1.436c-.446 0-.608-.046-.77-.134a.9.9 0 0 1-.378-.378c-.088-.163-.134-.324-.134-.77v-1.436c0-.446.046-.608.134-.77a.9.9 0 0 1 .378-.378c.162-.088.324-.134.77-.134h1.436zm20 0c.445 0 .606.046.77.134a.9.9 0 0 1 .377.378c.088.162.134.324.134.77v1.436c0 .446-.046.607-.134.77a.9.9 0 0 1-.378.378c-.163.088-.324.134-.77.134h-1.436c-.446 0-.607-.046-.77-.134a.9.9 0 0 1-.378-.378c-.088-.163-.134-.324-.134-.77v-1.436c0-.446.046-.608.134-.77a.9.9 0 0 1 .378-.378c.163-.088.324-.134.77-.134zm-20-8c.445 0 .607.046.77.134a.9.9 0 0 1 .377.378c.088.162.134.324.134.77v1.436c0 .446-.046.608-.134.77a.9.9 0 0 1-.378.378c-.162.088-.324.134-.77.134h-1.436c-.446 0-.608-.046-.77-.134a.9.9 0 0 1-.378-.378c-.088-.162-.134-.324-.134-.77v-1.436c0-.446.046-.608.134-.77a.9.9 0 0 1 .378-.378c.162-.088.324-.134.77-.134h1.436zm20 0c.445 0 .606.046.77.134a.9.9 0 0 1 .377.378c.088.162.134.324.134.77v1.436c0 .446-.046.608-.134.77a.9.9 0 0 1-.378.378c-.163.088-.324.134-.77.134h-1.436c-.446 0-.607-.046-.77-.134a.9.9 0 0 1-.378-.378c-.088-.162-.134-.324-.134-.77v-1.436c0-.446.046-.608.134-.77a.9.9 0 0 1 .378-.378c.163-.088.324-.134.77-.134zm-20-8c.445 0 .607.046.77.134a.9.9 0 0 1 .377.378c.088.162.134.324.134.77v1.436c0 .446-.046.608-.134.77a.9.9 0 0 1-.378.378c-.162.088-.324.134-.77.134h-1.436c-.446 0-.608-.046-.77-.134a.9.9 0 0 1-.378-.378c-.088-.162-.134-.324-.134-.77v-1.436c0-.446.046-.607.134-.77a.9.9 0 0 1 .378-.378c.162-.088.324-.134.77-.134h1.436zm20 0c.445 0 .606.046.77.134a.9.9 0 0 1 .377.378c.088.162.134.324.134.77v1.436c0 .446-.046.608-.134.77a.9.9 0 0 1-.378.378c-.163.088-.324.134-.77.134h-1.436c-.446 0-.607-.046-.77-.134a.9.9 0 0 1-.378-.378c-.088-.162-.134-.324-.134-.77v-1.436c0-.446.046-.607.134-.77a.9.9 0 0 1 .378-.378c.163-.088.324-.134.77-.134z"></path></svg>');function Nm(e,t){let i=ma(t,"isWhite",3,!1),r=ne((()=>i()?"color: #fff;":"color: #909499;"));!function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=Vm();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"57",height:"60",fill:"none","aria-hidden":"true","data-testid":"stub-icon",role:"img",...i}))),zi(e,r)}(e,{get style(){return Tt(r)}})}var Bm=Di('<div class="title svelte-1y9fytq"> </div>'),Dm=Di('<div class="playerStub svelte-1y9fytq"><!> <!></div>'),Om={hash:"svelte-1y9fytq",code:".playerStub.svelte-1y9fytq {width:100%;height:100%;background-color:#222;display:flex;justify-content:center;align-items:center;position:relative;background-position:center;background-size:cover;font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;}.title.svelte-1y9fytq {position:absolute;left:0;top:0;width:100%;font-size:15px;color:#fff;box-sizing:border-box;padding:18px 20px 10px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}"};function Fm(e,t){vr(e,Om);var i=Dm(),r=Ne(i),a=e=>{var i=Bm(),r=Ne(i,!0);Te(i),Bt((()=>Hi(r,t.title))),zi(e,i)};Xi(r,(e=>{t.title&&e(a)}));var s=De(r,2),n=e=>{let i=ne((()=>!!t.thumbUrl));Nm(e,{get isWhite(){return Tt(i)}})};Xi(s,(e=>{(!t.title||!t.thumbUrl)&&e(n)})),Te(i),Bt((()=>_r(i,t.thumbUrl?`background-image: url('${t.thumbUrl}')`:""))),zi(e,i)}var jm=class{isSupported(){return"mediaSession"in navigator}setMetaData({title:e,artist:t="",thumbUrl:i=""}){this.isSupported()&&(navigator.mediaSession.metadata=new MediaMetadata({title:e,artist:t,artwork:[{src:i,sizes:"96x96",type:"image/png"},{src:i,sizes:"128x128",type:"image/png"},{src:i,sizes:"192x192",type:"image/png"},{src:i,sizes:"256x256",type:"image/png"},{src:i,sizes:"384x384",type:"image/png"},{src:i,sizes:"512x512",type:"image/png"}]}))}updateActionHandlers(e){this.resetActionHandlers(),this.setActionHandlers(e)}resetActionHandlers(){this.setActionHandlers([["play",null],["pause",null],["stop",null],["nexttrack",null],["previoustrack",null],["seekto",null],["seekbackward",null],["seekforward",null]])}setActionHandlers(e){if(this.isSupported())for(let[t,i]of e)try{navigator.mediaSession.setActionHandler?.(t,i)}catch{throw new Error(`The media session action "${t}" is not supported yet.`)}}attachToStore(e){!this.isSupported()||!e||(this.clearSubscriptions(),this.subscription.add(e.state.positionExact$.subscribe((t=>{let i=sa(e.state.currentPlaybackRate$),r=sa(e.state.duration$);if(isFinite(t)&&isFinite(r))try{navigator.mediaSession.setPositionState?.({position:t,playbackRate:i,duration:r})}catch{this.log({message:`MediaSession setPositionState can't call with position: ${t} and duration: ${r}`})}}))))}clearSubscriptions(){this.subscription.unsubscribe()}destroy(){this.resetActionHandlers(),this.clearSubscriptions()}constructor(){this.subscription=new m.Subscription,this.logger=new m.Logger,this.log=this.logger.createComponentLog("MediaSessionApi")}},zm=Oi('<svg><!><g fill="var(--btn-color, #fff)"><path d="m30.744 4 .744.005c2.981.046 4.526.385 6.127 1.24a8.77 8.77 0 0 1 3.475 3.347l.174.312.15.292c.772 1.553 1.066 3.18 1.085 6.251v9.045a1.5 1.5 0 0 1-3 .016l-.008-9.651c-.04-2.032-.228-3.12-.627-4.035l-.126-.27-.13-.252A5.77 5.77 0 0 0 36.2 7.891c-1.187-.635-2.339-.873-5.115-.89L22.255 7c-2.737 0-4.003.2-5.071.698l-.133.064-.251.13a5.77 5.77 0 0 0-2.409 2.408c-.635 1.187-.873 2.339-.89 5.114l-.001 20.83c0 2.738.2 4.004.698 5.072l.064.133.13.251a5.77 5.77 0 0 0 2.408 2.409c1.1.588 2.134.825 4.438.88l.323.006 3.695.005H26a1.5 1.5 0 0 1 0 3h-.756l-3.718-.005c-2.989-.047-4.526-.377-6.14-1.24a8.77 8.77 0 0 1-3.476-3.347l-.174-.312-.15-.292c-.731-1.472-1.036-3.016-1.08-5.803l-.006-.756v-20.49l.005-.743c.046-2.981.385-4.526 1.24-6.127a8.77 8.77 0 0 1 3.347-3.475l.312-.174.292-.15c1.472-.731 3.016-1.036 5.803-1.08L22.256 4z"></path><path d="M30.5 33.8c0-1.68 0-2.52.327-3.162a3 3 0 0 1 1.311-1.311C32.78 29 33.62 29 35.3 29h6.4c1.68 0 2.52 0 3.162.327a3 3 0 0 1 1.311 1.311c.327.642.327 1.482.327 3.162v13.4c0 1.68 0 2.52-.327 3.162a3 3 0 0 1-1.311 1.311C44.22 52 43.38 52 41.7 52h-6.4c-1.68 0-2.52 0-3.162-.327a3 3 0 0 1-1.311-1.311C30.5 49.72 30.5 48.88 30.5 47.2z"></path></g></svg>');var Um=Di('<div><div><!></div> <span class="title svelte-1pbsod4"> </span></div>'),qm={hash:"svelte-1pbsod4",code:".player-pip-dummy.svelte-1pbsod4 {width:100%;height:100%;background-color:#19191A;display:flex;flex-direction:column;justify-content:center;align-items:center;font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;}.player-pip-dummy.is-pip-api.svelte-1pbsod4 {position:relative;}.dummy-image.svelte-1pbsod4 svg {transform:scale(1.07143);}.dummy-image.desktop.svelte-1pbsod4 {transform:scale(1.07143) rotate(-90deg) rotateY(180deg);}.title.svelte-1pbsod4 {font-size:16px;color:#fff;padding:18px 20px 10px;text-align:center;}"};function Hm(e,t){pi(t,!0),vr(e,qm);let[i,r]=ua(),a=Oa(),s=ya(),n=!!a.webApi.pictureInPictureApi,o=a.interfaceLanguage$,l=a.ui.isMobile,u=a.ui.t,d=ne((()=>la(o,"$interfaceLanguage$",i)&&u("pip_dummy_title"))),c=Lm(s.view);var h=Um();xr(h,1,"player-pip-dummy svelte-1pbsod4",null,{},{"is-pip-api":n}),_r(h,c);var p=Ne(h);let f;(function(e,t){let i=ca(t,["$$slots","$$events","$$legacy","children"]);var r=zm();let a;hr(Ne(r),(()=>t.children??D)),Ce(),Te(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"57",height:"56",fill:"none","aria-label":"dummy-image","data-testid":"pip-dummy-icon",role:"img",...i}))),zi(e,r)})(Ne(p),{}),Te(p);var m=De(p,2),v=Ne(m,!0);Te(m),Te(h),Bt((e=>{f=xr(p,1,"dummy-image svelte-1pbsod4",null,f,e),Hi(v,Tt(d))}),[()=>({desktop:!la(l,"$isMobile$",i)})]),zi(e,h),fi(),r()}var Wm=class{isSupported(){let{isEmbed:e}=(0,m.detectEmbed)();return"documentPictureInPicture"in window&&!e}isActive(){return this.isSupported()&&!!documentPictureInPicture.window}setPlayerDomElement(e,t){this.playerDomElement=e,this.playerParentShadowRoot=t}setContext(e){this.svelteContext=e}async request(){if(!this.isSupported()||!this.playerDomElement||!this.playerParentShadowRoot)return;this.pipWindow=await documentPictureInPicture.requestWindow({width:460,height:280,copyStyleSheets:!0}),this.pipWindow.document.body.style.margin="0";let e=[...this.playerParentShadowRoot.styleSheets].map((e=>[...e.cssRules].map((e=>e.cssText)).join(" "))).filter(Boolean).join("\n"),t=document.createElement("style");t.textContent=e;let i=this.createStretchedContainer(),r=i.attachShadow({mode:"open"});r.append(t),r.append(this.playerDomElement);let a={target:this.playerParentShadowRoot,context:this.svelteContext};this.playerDummyElement=Wi(Hm,a),this.pipWindow?.document.body.append(i),this.info.isActive$.next(!0),this.pipWindow?.addEventListener("unload",(e=>{!this.playerDomElement||!this.playerParentShadowRoot||!this.playerDummyElement||(Zi(this.playerDummyElement),this.playerParentShadowRoot.append(this.playerDomElement),this.info.isActive$.next(!1))}))}async remove(){return new Promise((e=>{documentPictureInPicture.window?.close(),e()}))}async dispose(){await this.remove()}setEnabled(e){this.info.isEnabled$.next(e)}createStretchedContainer(){let e=document.createElement("div");return e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e}constructor({enabled:e=!0}={enabled:!0}){this.info={isActive$:new m.ValueSubject(!1),isEnabled$:new m.ValueSubject(!1),type:1},this.info.isEnabled$=new m.ValueSubject(e)}};var Qm=class{static getLatestSupportedVersion(e){let t=new Gs,i=new Wm(e);return i.isSupported()?i:t.isSupported()?t:void 0}};function Gm(e,t){let i=new Set([...Object.keys(e),...Object.keys(t)]),r={};for(let a of i)r[a]=t[a]??e[a]??void 0;return r}var Km=class extends Error{constructor(e){super(e),this.name="AnnotationError"}},Ym=class{init(e){if(this.rootAnnotationsContainer=e,this.annotationsInside)return;let t=(0,m.throttleFn)((()=>{for(let e of this.annotations.values())this.isElementExceedsBoundaries(e,this.playerSize.width,this.playerSize.height)?e.style.visibility="hidden":e.style.visibility="visible"}),100);this.subscriptions.add((0,m.observeElementSize)(this.rootAnnotationsContainer).subscribe((({width:e,height:i})=>{this.playerSize={width:e,height:i},t()}))),this.mutationObserver=new MutationObserver(t),this.mutationObserver.observe(this.rootAnnotationsContainer,{attributes:!0,childList:!0,subtree:!0,characterData:!0})}add(e,t){if(!this.rootAnnotationsContainer)throw new Km("Inner error. Unexpectedly root annotation container null reference exception");if(this.annotations.has(e))throw new Km("Annotation with such name already exists");t.style.zIndex=t.style.zIndex??"1",t.style.position="absolute",this.rootAnnotationsContainer.append(t),this.annotations.set(e,t)}get(e){let t=this.annotations.get(e);if(!t)throw new Km("Annotation with such name does not exist");return t}remove(e){let t=this.get(e);this.annotations.delete(e)&&t.remove()}clear(){for(let e in this.annotations.keys())this.remove(e)}destroy(){this.annotations.clear(),this.subscriptions.unsubscribe(),this.mutationObserver?.disconnect(),this.rootAnnotationsContainer=null}isElementExceedsBoundaries(e,t,i){let r=e.offsetTop,a=e.offsetLeft,s=e.offsetWidth,n=e.offsetHeight;return r<0||a<0||a+s>t||r+n>i}registryRootContainer(e){}addLayer(e){return document.createElement("div")}getLayer(e){}removeLayer(e){}clearLayer(e){}detach(){}reattach(){}constructor(e){this.annotationsInside=e,this.annotations=new Map,this.subscriptions=new m.Subscription}},Zm=class{init({store:e,microStores:t,interactiveController:i,config:r}){return(0,m.assertNonNullable)(e),(0,m.assertNonNullable)(t),(0,m.assertNonNullable)(r),r.interactiveData&&(0,m.assertNonNullable)(i),this.subscription=new m.Subscription,this.subscription}},Xm=class extends Zm{init(e){let t=super.init(e),{isInteractiveExpectation$:i}=e.store.state;return t.add(i.subscribe((e=>{this.state$.set(!!e||null)}))),t}constructor(){super(...arguments),this.stateName="fakeIsPlaying$",this.state$={...ra(null),toggle:()=>this.state$.update((e=>!e))}}},Jm=class extends Zm{init(e){let t=super.init(e),{microStores:i,store:r}=e,{fakeIsPlaying$:a}=i,{isInteractiveExpectation$:s,isPlaying$:n}=r.state,{controlsVisible:o,isMobile:l}=r.ui,u=sa(l),d=()=>u&&sa(o);return t.add(o.subscribe((e=>{if(!u)return;let t=sa(a);sa(n)?this.state$.set(e):null!==t&&this.state$.set(!t||e)}))),t.add(n.subscribe((e=>{this.state$.set(!e||d())}))),t.add(a.subscribe((e=>{if(null===e)return;let t=sa(s);d()?this.state$.set(!0):t&&this.state$.set(!e)}))),t}constructor(){super(...arguments),this.stateName="interactiveControlsOpacity$",this.state$={...ra(null),toggle:()=>this.state$.update((e=>!e))}}},ev=class extends Zm{init(e){let t=super.init(e),{store:i}=e;return t.add(i.state.interactiveEpisodes$.subscribe((e=>{e.length&&(e.every((e=>e.completed))?this.state$.set("tooltip_interactive_of_chapter_completed"):this.state$.set("tooltip_disabled_when_interactive"))}))),t}constructor(){super(...arguments),this.stateName="seekToInteractiveDisabledTooltip$",this.state$=ra("tooltip_chapter_without_interactive")}},tv=ra(!1),iv=null,rv=class extends Zm{init(e){let t=super.init(e),{store:i,config:r}=e,{isInteractiveTime$:a,isPlaying$:s}=i.state,n=i.ui.controlsVisible,{interactiveTimeIndicator:o}=i.ui.controls;t.add(n.subscribe((e=>{sa(a)&&e&&this.state$.set(!1)})));let l=r?.interactiveData||{tooltipHelpHintActive:!1};return t.add((0,m.combine)({isPlaying$:s,isInteractiveTime$:a,interactiveTimeIndicator:o}).subscribe((({isPlaying$:e,isInteractiveTime$:t,interactiveTimeIndicator:r})=>{if(e&&r?.isDisplayed){if(!t)return this.state$.set(!1);l.tooltipHelpHintActive&&null===iv&&(iv=!0,l.tooltipHelpHintActive=!1,this.state$.set(!0),i.callbacks?.onInteractiveTimeIndicatorHintDeactivated?.())}}))),t}clearTimeout(){window.clearTimeout(this.timeout)}constructor(){super(...arguments),this.stateName="showInteractiveTimeIndicatorTooltip$",this.state$={...tv,set:(e,t=!1)=>{e!==sa(tv)&&(this.clearTimeout(),tv.set(e),!e&&iv&&(iv=!1),e&&t&&(this.timeout=setTimeout((()=>{this.state$.set(!1)}),3e3)))},clearTimeout:()=>this.clearTimeout()}}},av=class extends Zm{init(e){let t=super.init(e),{store:i,interactiveController:r}=e,a=i.ui.currentGridType$,s=i.getLogger().createComponentLog("GraphIsOpened microStore");return this.state$.toggle=async()=>{if(this.checkIfShouldHide(sa(a)))return;let e=sa(this.state$),{isEnded$:t,playbackState$:n}=i.state,{disabledControls$:o}=i.ui.controls,l=sa(t),u=sa(n);if(e)try{await(r?.toggleGraphView(!1)),this.state$.set(!1),o.remove(La),!l&&this.graphMadePause&&i.actions.internal.play()}catch{s({message:"Cant hide graph"})}else{this.graphMadePause="playing"===u;try{await(r?.toggleGraphView(!0)),this.state$.set(!0),o.add(La),!l&&this.graphMadePause&&i.actions.internal.pause()}catch{s({message:"Cant show graph"})}}},t.add((0,m.combine)({graphIsOpened:this.state$,currentGridType:a}).subscribe((async({graphIsOpened:e,currentGridType:t})=>{if(this.checkIfShouldHide(t)&&e)try{await(r?.toggleGraphView(!1)),this.state$.set(!1)}catch{s({message:"Cant hide graph"})}}))),t}constructor(){super(...arguments),this.stateName="graphIsOpened$",this.graphMadePause=!1,this.state$={...ra(null),toggle:m.noop},this.checkIfShouldHide=e=>ru(e,"s")}},sv=class extends Zm{init(e){let t=super.init(e),{store:i}=e,{info:{isActive$:r,isEnabled$:a,type:s}}=i.webApi.pictureInPictureApi||{info:{isActive$:new m.ValueSubject(!1),isEnabled$:new m.ValueSubject(!1)}};return t.add(r.subscribe((e=>{this.state$.isActive$.set(e)}))),t.add(a.subscribe((e=>{this.state$.isEnabled$.set(e)}))),this.state$.type$.set(s),t}constructor(){super(...arguments),this.stateName="pictureInPicture$",this.state$={isActive$:ra(!1),isEnabled$:ra(!1),type$:ra(void 0)}}},nv=({maxCount:e})=>{let t={};return{notificationShowed:e=>{t[e]=(t[e]??0)+1,m.safeStorage.set("videoplayer_notifications_manager_count",JSON.stringify(t[e]??0))},canShowNotification:i=>(t[i]??0)<e}},ov=({timeout:e})=>{let t="videoplayer_notifications_manager",i=()=>{try{return JSON.parse(m.safeStorage.get(t)||"{}")}catch{return{}}},r=e=>m.safeStorage.set(t,JSON.stringify(e));return{notificationShowed:t=>{r({...i(),[t]:{timeout:e,launchTime:Date.now()}})},canShowNotification:t=>{let a=i()[t];if(a){let s=Date.now()-a.launchTime>e;return s&&(e=>{let t=i();delete t[e],r(t)})(t),s}return!0}}},lv=class extends Zm{init(e){let t=super.init(e),{store:i,uiConfig:{features:{maxCountShowSlowVideoNotification:r,timeoutShowSlowVideoNotification:a,showSlowVideoNotification:s,forceAutoQualityWhenSevereStallHappens:n}}}=e;this.notificationManager=(({maxShowCount:e,timeout:t})=>{let i=[0!==e?nv({maxCount:e}):void 0,0!==t?ov({timeout:t}):void 0].filter((e=>!!e));return{notificationShowed:e=>i.forEach((t=>t.notificationShowed(e))),canShowNotification:e=>i.every((t=>t.canShowNotification(e)))}})({maxShowCount:r,timeout:a});let o=i.getPlayer();return t.add(o.events.severeStallOccured$.pipe((0,m.filterChanged)(),(0,m.filter)((e=>e))).subscribe((()=>{s&&!o.info.isAutoQualityEnabled$.getValue()&&this.notificationManager.canShowNotification("slow_video")&&(n&&i.actions.internal.setQuality("auto"),this.state$.showNotification("slow_video"))}))),t}constructor(){super(...arguments),this.stateName="notifications$",this.state$={notificationsToShow$:ra({}),showNotification:e=>{this.state$.notificationsToShow$.update((t=>(t[e]=!0,t))),this.notificationManager.notificationShowed(e)},closeNotification:e=>{this.state$.notificationsToShow$.update((t=>(delete t[e],t)))}}}},uv={preload:!0,autoplay:!1,repeat:!1,fromTime:0,canRewindLive:!0,showAds:!1,interfaceLanguage:m.InterfaceLanguage.RU,isCyrillicRelatedInterface:!0,logoClickable:!1,logoHidden:!1,isTouch:(0,f.isMobile)(),isMediaSessionEnabled:!0,isPictureInPictureEnabled:!0,isAudioDisabled:!1,callbacks:{uiInfo:{}},tuningConfig:{configName:[]},saveRate:!0,volumeMultiplier:1,showEndScreen:!0,showAutoplayNext:!0,showNextPrevButtons:!0},dv=te(void 0),cv=class extends HTMLElement{connectedCallback(){if(this.isInited||this.shadowDOMCallbacksDisabled)return;this.initPlayerRootContainers();let e=Ae({title:this.getAttribute("stub-title")??void 0,thumbUrl:this.getAttribute("stub-thumb-url")??void 0}),t={target:this.playerContainer,props:e};this.svelteStubComponent=Wi(Fm,t)}disconnectedCallback(){this.shadowDOMCallbacksDisabled||(this.annotationsApi?.destroy(),this.mediaSessionApi?.destroy(),this.unmountComponent(this.svelteRootComponent),this.unmountComponent(this.svelteStubComponent),this.subscription.unsubscribe(),this.unsubscribePlayerPhaseSubscription?.(),this.interactiveController?.destroy(),this.interactiveSubscription.unsubscribe(),this.internalsExposure?.destroy(),m.devNull.destroy("ui"))}initPlayerRootContainers(){this.rootContainer=document.createElement("div"),this.rootContainer.style.position="relative",this.rootContainer.className="root-container",this.rootContainer.style.width="100%",this.rootContainer.style.height="100%",this.rootContainer.style.minHeight="206px",this.shadowRootContainer=document.createElement("div"),this.shadowRootContainer.style.position="absolute",this.shadowRootContainer.className="shadow-root-container",this.shadowRootContainer.style.width="100%",this.shadowRootContainer.style.height="100%",this._shadowRoot=this.shadowRootContainer.attachShadow({mode:"open"}),this.playerContainer=document.createElement("div"),this.playerContainer.style.all="initial",this.playerContainer.style.display="block",this.playerContainer.style.contain="strict",this.playerContainer.style.width="100%",this.playerContainer.style.height="100%",this._shadowRoot.append(this.playerContainer),this.rootContainer.append(this.shadowRootContainer),this.append(this.rootContainer)}needToShowNextPrevButtons(){return!!this.videoConfig&&(this.videoConfig.videos.length>1&&this.videoConfig.showNextPrevButtons)}isNextButtonActive(){return!!this.videoConfig&&(this.needToShowNextPrevButtons()&&(this.currentPlayingVideoIndex<this.videoConfig.videos.length-1||this.needToRepeatPlaylist))}isPrevButtonActive(){return!!this.videoConfig&&(this.needToShowNextPrevButtons()&&(this.currentPlayingVideoIndex>0||this.needToRepeatPlaylist))}isControlDisabled(e){return this.store?.ui.controls.disabledControls$?.includes(e)||!1}getNextVideoInfo(){if(!this.videoConfig)return{nextVideoTitle:void 0,nextVideoThumb:void 0};let e=this.videoConfig.videos[this.currentPlayingVideoIndex+1]||{};return{nextVideoTitle:e.title,nextVideoThumb:e.thumbUrl}}createPlayer(e,t={},i){if(!this.videoConfig)return;let{albumId:r,statPlace:a,statAuthToken:s,preload:n,autoplay:o,volume:l,muted:u,fromTime:d,canRewindLive:c,supportLink:h,showAds:p,adsSlotId:v,adsParams:g={},adsPreviewParam:b,adsAutoplayParam:y,interfaceLanguage:w,isCyrillicRelatedInterface:S,logoClickable:x,logoHidden:$,isMobile:_,isTouch:k,isAudioDisabled:T,isLiveCatchUpMode:C,fullScreenTarget:E,failoverHosts:A,canDownload:L,callbacks:P,interactiveData:M,showThumbTimer:I,additionalButtons:R=[],additionalSettingsMenuItems:V=[],additionalContextMenuItems:N=[],repeat:B,saveRate:D,volumeMultiplier:O,showEndScreen:F,showAutoplayNext:j}=Gm(this.videoConfig,t),{sources:z,title:U,thumbUrl:q,unitedVideoId:H,isClip:W=!1,duration:Q,adsParams:G={},videoEpisodes:K,previewThumbsData:Y,subtitles:Z,live:X}=e,J={...g,...G},ee=this.getNextVideoInfo(),te={sources:z,title:U,thumbUrl:q,subtitles:Z,unitedVideoId:H,isClip:W,live:X,albumId:r,statPlace:a,autoplay:o,muted:u,volume:l,fromTime:d,canRewindLive:c,showAds:p,adsSlotId:v,adsParams:J,adsPreviewParam:b,adsAutoplayParam:y,duration:Q,logoClickable:x,logoHidden:$,isTouch:k??_,repeat:B,showNextPrevButtons:this.needToShowNextPrevButtons(),nextButtonActive:this.isNextButtonActive(),prevButtonActive:this.isPrevButtonActive(),endScreenVideoTitle:ee.nextVideoTitle,endScreenVideoThumb:ee.nextVideoThumb,isOneVideoPlaylist:this.isOneVideoPlaylist()},ie={pictureInPictureApi:this.pictureInPictureApi,annotationsApi:this.annotationsApi};this.log({message:`create player, props: ${JSON.stringify(te)}`});let ae=this.interactiveController?.state.statistics$.getValue(),se=ae?.oneStat||this.createOneStat(e,t);se&&(this.statistics=new cd(se,ae?.statSubscription)),this.uiConfig.features.sentry&&this.uiConfig.sentry.dsn&&new Fs(this.uiConfig.sentry,{version:Va,env:Ra},{movieId:H,albumId:r,place:a,autoplay:(o&&!this.interactiveController)??!1,mobile:k??_,clip:W}),this.interactiveController&&(this.prevIsid??(this.prevIsid=this.statistics?.oneStat.isid$.getValue())),this.sentry={...this.sentry,...Fs.getInstance()};let ne=!!M,oe=[],le="tooltip_interactive_go_back_disabled_first";if(ne&&this.interactiveController){let e=this.interactiveController.state.isInitialChapter$.getValue(),t=this.interactiveController.getHistoryState();e&&oe.push("REPLAY_BUTTON"),this.interactiveController.getIsSeekable().getValue()||oe.push("SEEK_TO_INTERACTIVE_BUTTON"),t.hasPrevChapter$.getValue()||(oe.push("PLAY_PREV_CHAPTER_BUTTON"),e||(le=t.isGoBackLimited$.getValue()?"tooltip_interactive_go_back_disabled_limit":"tooltip_interactive_go_back_disabled"))}this.store=vd({player:i,interfaceLanguage:w,isCyrillicRelatedInterface:S,videoId:H,isClip:W,isLiveCatchUpMode:C,isAudioDisabled:T,statAuthToken:s,callbacks:P,webApi:ie,videoEpisodes:K,previewThumbsData:Y,canDownload:L,uiConfig:this.uiConfig,coreConfig:this.coreConfig,disabledControls:oe,isInteractive:ne,saveRate:D,interactiveRanges$:this.interactiveController?.state.interactiveRanges$,isInteractiveTime$:this.interactiveController?.state.isInteractiveTime$,stopPlayer:()=>this.stop(),replayInteractive:()=>{this.isInited=!1,this.prevIsid=void 0;let e=i?.info.isEnded$.getValue()&&this.interactiveController?.state.isEndChapter$.getValue();P.onReplayInteractiveVideo&&!e?P.onReplayInteractiveVideo():this.replayInteractiveVideo()},playPrevChapterDisabledTooltip:le,hasInteractiveBranches:!!this.interactiveController?.getChapterBranches()?.length,additionalButtons:this.uiConfig.features.additionalButtons?R:[],additionalSettingsMenuItems:V??[],additionalContextMenuItems:N??[],playPrevVideo:()=>this.playPrevVideo(),playNextVideo:()=>this.playNextVideo(),looped:B&&1===this.videoConfig.videos.length,statistics:this.statistics,internalsExposure:this.internalsExposure});let{stores:ue}=this.microStoresRoot=[Xm,Jm,ev,rv,av,sv,lv].reduce((({subscribers:e,stores:t},i)=>{let r=new i;return{subscribers:[...e,r],stores:{...t,[r.stateName]:r.state$}}}),{subscribers:[],stores:{}}),de=()=>{if(!this.store||!this.microStoresRoot||!this.videoConfig)return;this.subscription.add(this.store.state.currentFormat$.subscribe((e=>P?.onCurrentFormatChanged?.(e)))),this.subscription.add(ue.interactiveControlsOpacity$.subscribe((e=>{null!==e&&this?.interactiveController?.setDisabledControls(e)}))),this.subscription.add(this.store.state.throughputEstimation$.subscribe((e=>P?.onThroughputEstimationChanged?.(e)))),this.subscription.add(this.store.state.trafficSavingEnabled$.subscribe((e=>P?.onTrafficSavingEnabledChanged?.(e)))),this.subscription.add(new m.Observable((e=>{this.store&&this.subscription.add(this.store.state.currentPlaybackRate$.subscribe((t=>e.next(t))))})).pipe(this.uiConfig.features.skipInitialPlaybackRateValue?(0,m.skip)(1):e=>e).subscribe((e=>P?.onCurrentPlaybackRateChanged?.(e)))),this.subscription.add(this.store.state.volume$.subscribe((e=>P?.onVolumeChange?.(e)))),this.subscription.add(this.store.state.muted$.subscribe((e=>e?P?.onMute?.():P?.onUnmute?.()))),this.subscription.add(this.store.state.videoBitrate$.subscribe((e=>P?.onVideoBitrateChanged?.(e)))),this.subscription.add(this.store.state.isInteractiveTime$.subscribe((e=>{let t=this.store?.ui.controls.disabledControls$;t&&(e&&!t.includes(Aa)&&t.add(Aa),e||t.remove(Aa))}))),this.subscription.add(this.store.ui.isFullscreen.subscribe((async e=>{f.clientChecker.browser.isSamsungBrowser&&e&&this.interactiveController&&document.fullscreenElement===this.shadowRootContainer&&await this.replayInteractiveChapter(this.videoConfig?.callbacks.onExternalFullscreenExit)}))),this.statistics&&this.subscription.add(this.statistics.oneStat.vsid$.subscribe((e=>P?.onVSIDChanged?.(e)))),this.initMediaSession(),re(dv,Ae({interactiveController:this.interactiveController,interactiveContainer:this.interactiveContainer,sources:z,store:this.store,microStoresRoot:this.microStoresRoot,videoConfig:this.videoConfig,uiConfig:this.uiConfig,title:U,thumbUrl:q,subtitles:Z,live:X,preload:n,autoplay:o,muted:u,volume:l,fromTime:d,canRewindLive:c,supportLink:h,showAds:p,adsSlotId:v,adsParams:J,adsPreviewParam:b,adsAutoplayParam:y,duration:Q,logoClickable:x,logoHidden:$,isMobile:k??_,failoverHosts:A,fullScreenTarget:E,saveRate:D,shadowRootContainer:this.shadowRootContainer,showMiniTimer:I,outerContainerRef:this.rootContainer,showNextPrevButtons:this.needToShowNextPrevButtons(),nextButtonActive:this.isNextButtonActive(),prevButtonActive:this.isPrevButtonActive(),endScreenVideoTitle:ee.nextVideoTitle,endScreenVideoThumb:ee.nextVideoThumb,isOneVideoPlaylist:this.isOneVideoPlaylist(),playPrevChapter:()=>this.playPrevChapter(),seekToInteractive:()=>this.seekToInteractive(),volumeMultiplier:O,showEndScreen:F,showAutoplayNext:j}));let e={target:this.playerContainer,props:Tt(dv)};this.svelteRootComponent=Wi(Rm,e),this.addPlayerInfoSubscriptions(),this.isInited||(this.isInited=!0,this.videoConfig?.callbacks?.onInited?.()),this.internalsExposure?.expose({player:this,videoConfig:this.videoConfig,coreConfig:this.coreConfig,uiConfig:this.uiConfig,statisticsConfig:this.statisticsConfig,logger:this.logger,log:this.log}),this.uiConfig.devNullLog&&this.videoConfig?.callbacks?.onDevNullLog?m.devNull.subscribe("ui",this.videoConfig.callbacks.onDevNullLog):m.devNull.destroy("ui")};this.coreConfig.asyncResolveClientChecker?f.clientChecker.isInited$.subscribe((e=>{e&&(console.log("UI SDK async start"),de())})):de()}addPlayerInfoSubscriptions(){let e=this.store,t=this.microStoresRoot?.stores;if(!e||!t)return;let i=this.videoConfig?.callbacks;i&&this.subscription.add(e.playerPhase.subscribe((e=>i.onPlayerPhaseChanged?.(e)))).add(e.state.playbackState$.subscribe((e=>e&&i.onPlaybackStateChanged?.(e)))).add(e.state.isLive$.subscribe((e=>i.onIsLiveChanged?.(e)))).add(e.state.isActiveLive$.subscribe((e=>i.onIsActiveLiveChanged?.(e)))).add(e.state.isAudioAvailable$.subscribe((e=>i.onIsAudioAvailableChanged?.(e)))).add(e.state.currentQuality$.subscribe((e=>i.onCurrentQualityChanged?.(e)))).add(e.state.availableQualities$.subscribe((e=>i.onAvailableQualitiesChanged?.(e.map((({value:e})=>e)).filter((e=>"auto"!==e)))))).add(e.state.availableAudioStreams$.subscribe((e=>{e.length>1&&i.onAudioLanguagesAvailable&&i.onAudioLanguagesAvailable()}))).add(t.pictureInPicture$.isActive$.subscribe((e=>e?i.onPiPEnter?.():i.onPiPExit?.())));let r=i?.uiInfo;r&&this.subscription.add(e.ui.controlsVisible.subscribe((e=>r.onControlsVisibleChanged?.(e)))).add(e.ui.isMobile.subscribe((e=>r.onIsMobileChanged?.(e)))).add(e.ui.playerSize.subscribe((e=>r.onPlayerSizeChanged?.(e)))).add(e.ui.controls.prevButton.subscribe((e=>r.onPrevButtonChanged?.(e)))).add(e.ui.controls.playButton.subscribe((e=>r.onPlayButtonChanged?.(e)))).add(e.ui.controls.replayButton.subscribe((e=>r.onReplayButtonChanged?.(e)))).add(e.ui.controls.nextButton.subscribe((e=>r.onNextButtonChanged?.(e)))).add(e.ui.controls.playPrevChapterButton.subscribe((e=>r.onPlayPrevChapterChanged?.(e)))).add(e.ui.controls.seekToInteractiveButton.subscribe((e=>r.onSeekToInteractiveButtonChanged?.(e)))).add(e.ui.controls.interactiveGraphButton.subscribe((e=>r.onGraphButtonChanged?.(e)))).add(e.ui.controls.liveButton.subscribe((e=>r.onLiveButtonChanged?.(e)))).add(e.ui.controls.time.subscribe((e=>r.onTimeUpdateChanged?.(e)))).add(e.ui.controls.episodes.subscribe((e=>r.onEpisodesChanged?.(e)))).add(e.ui.controls.subtitles.subscribe((e=>r.onSubtitlesChanged?.(e)))).add(e.ui.controls.settings.subscribe((e=>r.onSettingsChanged?.(e)))).add(e.ui.controls.fullscreen.subscribe((e=>r.onFullscreenChanged?.(e)))).add(e.ui.controls.chromecast.subscribe((e=>r.onChromecastChanged?.(e)))).add(e.ui.controls.pip.subscribe((e=>r.onPipChanged?.(e)))).add(e.ui.controls.vkLogo.subscribe((e=>r.onVkLogoChanged?.(e)))).add(e.ui.controls.interactiveTimeIndicator.subscribe((e=>r.onInteractiveTimeIndicatorChanged?.(e)))).add(e.ui.controls.timeline.subscribe((e=>r.onTimelineChanged?.(e))))}playNextVideo(){this.videoConfig&&(this.currentPlayingVideoIndex++,this.currentPlayingVideoIndex>=this.videoConfig.videos.length&&(this.currentPlayingVideoIndex=0),this.log({message:`play next video, index: ${this.currentPlayingVideoIndex}`}),this.createPlayerWithCurrentVideo())}playPrevVideo(){this.videoConfig&&(this.currentPlayingVideoIndex--,this.currentPlayingVideoIndex<0&&(this.currentPlayingVideoIndex=this.videoConfig.videos.length-1),this.log({message:`play prev video, index: ${this.currentPlayingVideoIndex}`}),this.createPlayerWithCurrentVideo())}createPlayerWithCurrentVideo(e,t=!0){if(!this.videoConfig)return;let i=this.videoConfig.videos[this.currentPlayingVideoIndex];i?(this.isInited&&(0,m.isNonNullable)(i.unitedVideoId)&&this.store?.actions.internal.nextMovie(i.unitedVideoId),this.unmountComponent(this.svelteRootComponent),this.createPlayer(i,{autoplay:t,fromTime:0},e)):this.log({message:"no next video"})}playPrevChapter(){this.interactiveController?.playPrevChapter()}seekToInteractive(){let e=this.interactiveController?.getNextInteractiveStartTime();"number"==typeof e&&this.seekTime(e/1e3)}async initInteractives(){if(this.videoConfig?.interactiveData)try{let{Interactives:e}=await Promise.all([i.e(17356),i.e("langs/web/17356")]).then(i.bind(i,34414));this.interactiveContainer=document.createElement("div"),this.interactiveContainer.classList.add("interactive-root");let t=this.store?.interfaceLanguage$,r=t?sa(t):this.videoConfig.interfaceLanguage,{projectInfo:a,initChapterId:s,historyApi:n,videoLoader:o}=this.videoConfig.interactiveData;this.interactiveController=new e({parentElement:this.interactiveContainer,fullscreenTargetElement:this.playerContainer,lang:r,graph:this.uiConfig.features.interactiveGraph,projectInfo:a,initChapterId:s,historyApi:n,vkVideoLoader:o,lastFrame:this.uiConfig.features.interactiveLastFrame,permanentTextControls:this.uiConfig.features.interactiveTextPermanent,interactiveTimeOpenUri:this.uiConfig.features.interactiveTimeOpenUri,initSeamless:!0,config:this.uiConfig.interactive,coreConfig:this.coreConfig,createOneStat:this.createOneStat,animationsFeatureToggles:{areaControlShadow:this.uiConfig.features.interactiveAreaControlShadow,controlsExpectTimeBlinkAnimation:this.uiConfig.features.interactiveControlsExpectTimeBlinkAnimation}});let{isInteractiveExpectation$:l,isSeekable$:u}=this.interactiveController.state;this.uiConfig.features.seekToInteractive&&this.subscription.add(u.subscribe((e=>{if(!this.isInited)return;let t=this.store;e?t.ui.controls.disabledControls$.remove("SEEK_TO_INTERACTIVE_BUTTON"):t.ui.controls.disabledControls$.add("SEEK_TO_INTERACTIVE_BUTTON")}))),this.subscription.add(l.subscribe((e=>{this.store&&this.store.state.isInteractiveExpectation$.set(e)})));let d=!0;if(this.subscription.add(this.interactiveController.events.playerChanged$.subscribe((e=>{if(!this.videoConfig)return;this.videoConfig.videos[this.currentPlayingVideoIndex]={...e.config,title:a?.title||e.config.title};let t=!d||this.videoConfig.autoplay;this.createPlayerWithCurrentVideo(e.player,t),d&&(d=!1)}))),this.interactiveSubscription.add(this.interactiveController.events.interactiveActionChoice$.subscribe((({type:e,actionType:t})=>{if(!this.store||!this.microStoresRoot)return;let i=l.getValue();if("action-choice"===e&&"setRandomBranch"===t&&(this.microStoresRoot.stores.graphIsOpened$.set(!1),this.store.ui.controls.disabledControls$.remove(Pa)),"action-choice-canceled"===e){let e=sa(this.store.state.isPlaying$)||i;if((this.videoConfig?.isTouch??this.videoConfig?.isMobile)&&e)return void this.store.ui.interactiveHideMobileControls.set(!0);this.videoConfig?.callbacks.onDisabledInteractiveClick?.()}}))),this.interactiveSubscription.add(this.interactiveController.events.interactiveContainerFakeRemoved$.subscribe((({type:e,removeAllOpenURI:t})=>{this.store&&"container-fake-removed"===e&&t&&this.store.ui.controls.disabledControls$.remove(Pa)}))),await this.interactiveController.setManifest(this.videoConfig.interactiveData.manifest),this.videoConfig?.callbacks?.onInteractiveHistoryChanged){let e=this.interactiveController.getHistoryState();this.subscription.add(e.history$.subscribe((e=>{e.length&&this.videoConfig?.callbacks?.onInteractiveHistoryChanged?.(e)})))}this.uiConfig.features.interactiveTimeIndicator&&this.subscription.add(this.interactiveController.events.noInteraction$.subscribe((()=>{this.microStoresRoot?.stores.showInteractiveTimeIndicatorTooltip$.set(!0,!0),this.videoConfig?.callbacks.onInteractiveTimeIndicatorClick?.()}))),this.interactiveSubscription.add(this.interactiveController.events.error$.subscribe((e=>{this.log({message:e.toString()})})))}catch(e){this.log({message:e.message})}}initPlayer(e,t={}){var i,r;if(!Array.isArray(e.videos)||0===e.videos.length&&!e.interactiveData)throw new Error("empty videos");if(this.videoConfig=Gm(uv,(0,m.cloneDeepWith)(e,(e=>e instanceof HTMLElement?e:void 0))),this.uiConfig=(e=>(0,m.fillWithDefault)(e,ba))(t.ui??{}),this.coreConfig=t.core??{configName:[]},this.statisticsConfig=t.statistics??{},this.uiConfig.features.forcePlayerDisplayBlock&&(this.rootContainer.style.minHeight="unset",this.style.display="block",this.style.width="100%",this.style.height="100%"),this.sentry={config:this.uiConfig.sentry??{}},this.uiConfig.features.exposeInternalsToGlobal&&(this.internalsExposure??(this.internalsExposure=new m.InternalsExposure("UI"))),m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","player_init_player","ads.enable: "+this.uiConfig.ads.enable,"showAds: "+this.videoConfig?.showAds],numbers:[(0,m.now)()]}),(0,m.isNonNullable)(this.videoConfig.isMediaSessionEnabled)&&(this.uiConfig.features.mediaSession=this.uiConfig.features.mediaSession??this.videoConfig.isMediaSessionEnabled??!0),(0,m.isNonNullable)(this.videoConfig.isPictureInPictureEnabled)&&(this.uiConfig.features.pip=this.uiConfig.features.pip??this.videoConfig.isPictureInPictureEnabled??!0,this.uiConfig.features.dpip=this.uiConfig.features.dpip??this.videoConfig.isPictureInPictureEnabled??!0),this.videoConfig.isTouch=this.uiConfig.isMobile??this.videoConfig.isTouch??this.videoConfig.isMobile,(i=this.videoConfig).autoplay&&(i.autoplay=this.uiConfig.features.autoplay),this.videoConfig.showAds=this.uiConfig.ads.enable??this.videoConfig.showAds,this.videoConfig.adsSlotId=this.uiConfig.ads.slot??this.videoConfig.adsSlotId,this.videoConfig.adsPreviewParam=this.uiConfig.ads.preview??this.videoConfig.adsPreviewParam,this.videoConfig.logoHidden=!(this.uiConfig.showLogo??!this.videoConfig.logoHidden),(r=this.videoConfig).canRewindLive&&(r.canRewindLive=this.uiConfig.features.liveRewind),this.videoConfig.supportLink=this.videoConfig.supportLink??this.uiConfig.supportLink,this.videoConfig.showEndScreen=this.uiConfig.features.endScreen??this.videoConfig.showEndScreen,this.videoConfig.showAutoplayNext=this.uiConfig.features.autoplayNext??this.videoConfig.showAutoplayNext,this.videoConfig.showNextPrevButtons=this.uiConfig.features.nextPrevButtons??this.videoConfig.showNextPrevButtons,this.currentPlayingVideoIndex=this.videoConfig.videoIndex&&this.videoConfig.videos?.[this.videoConfig.videoIndex]?this.videoConfig.videoIndex:0,this.needToRepeatPlaylist=this.videoConfig.repeat,this.uiConfig.features.pip){let e={enabled:this.videoConfig.pipEnabled};this.uiConfig.features.dpip?this.pictureInPictureApi=Qm.getLatestSupportedVersion(e):this.pictureInPictureApi=new Gs(e)}this.mediaSessionApi=this.uiConfig.features.mediaSession?new jm:void 0,this.slotsApi=this.uiConfig.features.slots?new Gf:void 0,this.annotationsApi=this.uiConfig.features.annotations?new Ym(this.uiConfig.features.annotationsInside):void 0,this.annotationsApi&&!this.uiConfig.features.annotationsInside&&this.annotationsApi.init(this.rootContainer),this.slotsApi?.init(this.shadowRootContainer),this.unmountComponent(this.svelteStubComponent),this.unmountComponent(this.svelteRootComponent),this.isInited=!1,this.prevIsid=void 0,this.interactiveController&&(this.interactiveController.destroy(),this.interactiveController=void 0,this.interactiveSubscription.unsubscribe()),this.videoConfig.interactiveData?this.initInteractives():this.createPlayer(this.videoConfig.videos[this.currentPlayingVideoIndex]),function(e){return e instanceof Wm}(this.pictureInPictureApi)&&this.pictureInPictureApi.setPlayerDomElement(this.playerContainer,this._shadowRoot)}isOneVideoPlaylist(){return!!this.videoConfig&&1===this.videoConfig.videos.length}updateVideos(e,t){if(!this.videoConfig)return;this.log({message:`update ${t} videos, videos: ${JSON.stringify(e)}`}),"prev"===t?(this.videoConfig.videos.splice(0,this.currentPlayingVideoIndex),this.videoConfig.videos.unshift(...e),this.currentPlayingVideoIndex=e.length):"next"===t&&(this.videoConfig.videos.splice(this.currentPlayingVideoIndex+1),this.videoConfig.videos.push(...e));let i=this.getNextVideoInfo();Tt(dv)&&(Tt(dv).showNextPrevButtons=this.needToShowNextPrevButtons(),Tt(dv).nextButtonActive=this.isNextButtonActive(),Tt(dv).prevButtonActive=this.isPrevButtonActive(),Tt(dv).endScreenVideoTitle=i.nextVideoTitle,Tt(dv).endScreenVideoThumb=i.nextVideoThumb,Tt(dv).isOneVideoPlaylist=this.isOneVideoPlaylist())}updatePrevVideos(e){this.updateVideos(e,"prev")}updateNextVideos(e){this.updateVideos(e,"next")}initMediaSession(){this.mediaSessionApi&&(this.unsubscribePlayerPhaseSubscription?.(),this.mediaSessionApi.clearSubscriptions(),this.unsubscribePlayerPhaseSubscription=this.store?.playerPhase.subscribe((e=>{"video"===e?this.setupMediaSessionForVideo():"ads"===e&&this.setupMediaSessionForAds()})))}setupMediaSessionForVideo(){if(this.videoConfig&&this.mediaSessionApi)try{let{title:e,thumbUrl:t}={...this.videoConfig.videos[this.currentPlayingVideoIndex]},i=[["play",()=>this.play()],["pause",()=>this.pause()],["seekto",e=>this.seekTime(e.seekTime)]];this.videoConfig.videos.length>1&&(this.currentPlayingVideoIndex<this.videoConfig.videos.length-1&&i.push(["nexttrack",()=>this.playNextVideo()]),this.currentPlayingVideoIndex>0&&i.push(["previoustrack",()=>this.playPrevVideo()])),this.mediaSessionApi.setMetaData({title:e,thumbUrl:t}),this.mediaSessionApi.updateActionHandlers(i),this.mediaSessionApi.attachToStore(this.store)}catch(e){this.log({message:e.message})}}setupMediaSessionForAds(){if(this.videoConfig&&this.mediaSessionApi)try{let e="Реклама",t=[["play",()=>this.play()],["pause",()=>this.pause()]];this.mediaSessionApi.setMetaData({title:e}),this.mediaSessionApi.updateActionHandlers(t),this.mediaSessionApi.attachToStore(this.store)}catch(e){this.log({message:e.message})}}moveTo(e){this.shadowDOMCallbacksDisabled=!0,e.append(this),this.shadowDOMCallbacksDisabled=!1}play(){this.isControlDisabled("PLAY_BUTTON")||this.store?.playerPhase.is("LiveWaitingStart")||this.store?.playerPhase.is("LiveWaitingRecover")||this.store?.playerPhase.is("LiveWaitingRecord")||(this.log({message:"play"}),this.svelteRootComponent?.play())}pause(){this.log({message:"pause"}),this.svelteRootComponent?.pause()}stop(){if(!this.videoConfig)return;this.log({message:"stop"});let e=!!this.interactiveController;e&&(this.interactiveController.destroy(),this.interactiveController=void 0,this.interactiveContainer=void 0,this.interactiveSubscription.unsubscribe()),this.unmountComponent(this.svelteStubComponent),this.mediaSessionApi?.destroy();let t=this.videoConfig.videos[0];t&&(this.unmountComponent(this.svelteRootComponent),e?(this.videoConfig.autoplay=!1,this.initInteractives()):this.createPlayer(t))}setMuted(e){this.log({message:`set muted, muted: ${e}`}),this.svelteRootComponent?.setMuted(e)}setPiPEnabled(e){this.store?.webApi.pictureInPictureApi?.setEnabled(e)}setVolume(e){this.log({message:`set volume, volume: ${e}`}),this.svelteRootComponent?.setVolume(e)}setRepeat(e){this.log({message:`set repeat, repeat: ${e}`}),this.needToRepeatPlaylist=e,Tt(dv)&&(Tt(dv).needToRepeatPlaylist=this.needToRepeatPlaylist,Tt(dv).showNextPrevButtons=this.needToShowNextPrevButtons(),Tt(dv).nextButtonActive=this.isNextButtonActive(),Tt(dv).prevButtonActive=this.isPrevButtonActive())}seekTime(e){this.isControlDisabled("TIMELINE")||(this.log({message:`seek time, time: ${e}`}),this.svelteRootComponent?.seekTime(e))}seekEpisodeStartTime(e){this.log({message:`seek episode start time, time: ${e}`}),this.svelteRootComponent?.seekEpisodeStartTime(e)}returnFocusToEpisodes(){this.log({message:"return focus to episodes button"}),this.svelteRootComponent?.returnFocusToEpisodes()}setPlaybackRate(e){this.log({message:`set playback rate to: ${e}`}),this.svelteRootComponent?.setPlaybackRate(e)}setAutoQualityLimits(e){this.log({message:`set auto quality limitation. Max: ${e.max??"none"}. Min: ${e.min??"none"}`}),this.svelteRootComponent?.setAutoQualityLimits(e)}addLanguage(e){this.store?.actions.internal.addLanguage(e)}async setLanguage(e){await(this.store?.actions.internal.setLanguage(e))}setLiveStart(e){this.log({message:"live started"}),this.store?.actions.internal.setLiveWaitingRecover(!1),this.store?.actions.internal.setLiveWaitingStart(!1),this.unmountComponent(this.svelteRootComponent),this.createPlayer(e,{autoplay:!0})}setLiveWaitingRecover(){this.log({message:"live waiting"}),this.store?.callbacks&&(this.store.callbacks.onLiveEnded=()=>{this.store?.actions.internal.setLiveWaitingRecover(!0),this.store?.destroy()})}setLiveWaitingRecord(){this.log({message:"post live"}),this.store?.callbacks&&(this.store.callbacks.onLiveEnded=()=>{this.store?.actions.internal.setLiveWaitingRecord(!0),this.store?.destroy()})}setLiveEnd(e){this.log({message:"live ended"}),this.store?.callbacks&&(this.store.callbacks.onLiveEnded=()=>{this.store?.actions.internal.setLiveWaitingRecover(!1),this.store?.actions.internal.setLiveWaitingRecord(!1),this.unmountComponent(this.svelteRootComponent),this.createPlayer(e,{autoplay:!1})})}setLiveLowLatency(e){this.log({message:"live switch to low latency "+e}),this.store?.actions.external.setLiveLowLatency(e)}getDebugData(){return this.store?.actions.internal.getDebugTextData()??""}getDeviceId(){return this.statistics?.oneStat.getDeviceId()??void 0}replayInteractiveVideo(){this.interactiveController&&this.interactiveController.setChapter()}async replayInteractiveChapter(e){if(this.interactiveController&&this.store?.state.positionExact$){let t=sa(this.store.state.positionExact$),i=sa(this.store.state.interactiveEpisodes$).find((e=>!e.completed));this.interactiveController.events.playerChanged$.pipe((0,m.once)()).subscribe((()=>{i&&t>=i.time?this.seekTime(i.time):this.seekTime(t),e?.()}));let r=this.interactiveController.getCurrentChapter();await this.interactiveController.setChapter({chapterId:r?.chapter?.id,pushToHistory:!1})}}showInteractiveIndicatorTooltip(e,t=!1){this.microStoresRoot?.stores.showInteractiveTimeIndicatorTooltip$.set(e,t)}switchToActiveLive(){this.store?.actions.internal.switchToActiveLive()}updateAdditionalSettingsItem(e,t){this.store?.actions.external.updateAdditionalSettingsItem(e,t)}addAdditionalSettingsItem(e){this.store?.actions.external.addAdditionalSettingsItem(e)}removeAdditionalSettingsItem(e){this.store?.actions.external.removeAdditionalSettingsItem(e)}updateAdditionalContextItem(e,t){this.store?.actions.external.updateAdditionalContextItem(e,t)}addAdditionalContextItem(e){this.store?.actions.external.addAdditionalContextItem(e)}removeAdditionalContextItem(e){this.store?.actions.external.removeAdditionalContextItem(e)}updateAdditionalButton(e,t){this.store?.actions.external.updateAdditionalButton(e,t)}addAdditionalButton(e){this.store?.actions.external.addAdditionalButton(e)}removeAdditionalButton(e){this.store?.actions.external.removeAdditionalButton(e)}updateStatContext(e){this.statistics&&this.statistics.oneStat.updateContext(e)}handleTimerNextVideo(e){this.store?.actions.internal.setTimerNextVideoRunning(e)}focus(){this.svelteRootComponent?.keyboardControls?.focus?.()}unmountComponent(e){e&&Zi(e)}constructor(){super(),this.currentPlayingVideoIndex=0,this.needToRepeatPlaylist=!1,this.videoConfig=void 0,this.pictureInPictureApi=void 0,this.mediaSessionApi=void 0,this.unsubscribePlayerPhaseSubscription=void 0,this.annotationsApi=void 0,this.prevIsid=void 0,this.isInited=!1,this.internalsExposure=null,this.shadowDOMCallbacksDisabled=!1,this.createOneStat=(e,t={})=>{let{albumId:i,statPlace:r,statUserSalt:a,statTrackCode:s,statVKAppId:n,refreshStatAuthToken:o,autoplay:l,isMobile:u,isTouch:d,refDomain:c,deviceId:h,interactiveData:p}=Gm(this.videoConfig,t),f=p?.projectInfo?.pid,m=this.interactiveController?.state.isReplay$.getValue()??!1;m&&(this.prevIsid=void 0);let{unitedVideoId:g,isClip:b=!1}=e;if(this.uiConfig.features.statistics&&g)return new v.OneStat({movieId:g,albumId:i,place:r,trackCode:s,vkAppId:n,autoplay:(l&&!this.interactiveController)??!1,mobile:d??u,clip:b,refDomain:c,deviceId:h,...f&&(!this.isInited||m)&&{projectId:Number(f)}},{refreshAuthToken:o,userSalt:a,config:this.statisticsConfig,...this.interactiveController&&{useIsid:!0,isid:this.prevIsid}})},m.devNull.create("ui"),this.logger=new m.Logger,this.log=this.logger.createComponentLog("VKVideoPlayer"),this.subscription=new m.Subscription,this.interactiveSubscription=new m.Subscription,this.graphMadePause=!1}},hv=()=>{window.customElements.define("vk-video-player",cv)};function pv(){return(0,h._)(this,l)[l]??((0,h._)(this,l)[l]=new ResizeObserver((e=>{for(var t of e)for(var i of(c.entries.set(t.target,t),(0,h._)(this,o)[o].get(t.target)||[]))i(t)})))}}}])}if("undefined"!=typeof window&&window.partConfigEnabled?.("static_loading_execute_errors"))try{e(),window.stManager?.done?.("dist/web/chunks/3f3e013b.fb59a9b7.js")}catch(e){throw window.stManager?.fail?.("dist/web/chunks/3f3e013b.fb59a9b7.js",e),e}else e(),"undefined"!=typeof window&&window.stManager?.done?.("dist/web/chunks/3f3e013b.fb59a9b7.js");